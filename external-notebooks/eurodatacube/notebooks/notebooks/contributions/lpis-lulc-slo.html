<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>LPIS Use Case for Land Use / Land Cover Classification - Location for eodashboard notebooks</title><meta property="og:title" content="LPIS Use Case for Land Use / Land Cover Classification - Location for eodashboard notebooks"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/notebooks_test/build/_assets/app-HG4THSM4.css"/><link rel="stylesheet" href="/notebooks_test/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/notebooks_test/favicon.ico"/><link rel="stylesheet" href="/notebooks_test/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/notebooks_test/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3iop:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/eoxhub-workspaces/documentation/" title="GitHub Repository: eoxhub-workspaces/documentation/" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rd4fop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">LPIS Use Case for Land Use / Land Cover Classification</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="z1YGy4FGGC" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from edc import setup_environment_variables
setup_environment_variables()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="J-UERZaff-9BJ6vI6YDYy" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="QTmvx4pA78" class="relative group/block"><h1 id="lpis-use-case-for-land-use-land-cover-classification" class="relative group"><span class="heading-text">LPIS Use Case for Land Use / Land Cover Classification</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#lpis-use-case-for-land-use-land-cover-classification" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><p>This notebook demonstrates how Euro Data Cube (EDC) tools can be utilized for an exploratory analysis and manipulation of data in Land Parcel Identification System (LPIS). The most important part is the example of using satellite imagery and machine learning algorithms to provide additional information about the area of interest, which should be a valuable support for decisions related with LPIS controls.</p><p>A workflow consist of three parts:</p><ol start="1"><li>Prepare and explore LPIS data, reference land use data and satellite imagery</li><li>Run Machine Learning for Land Cover Land Use (LULC) prediction</li><li>Visualize results and extract information to support LPIS controls</li></ol><p>Step 2. is based on machine learning pipeline developed for LULC prediction in <a target="_blank" rel="noreferrer" href="https://eo-learn.readthedocs.io/en/latest/examples/land-cover-map/SI_LULC_pipeline.html" class="">Slovenia</a>. The workflow in this notebook is simplified and focused less on machine learning algorithm and more on usefulness of the results. It allows the user to change settings such as: area of interest, time range, mapping of classes.</p></div><div id="P8xSIeXYs7" class="relative group/block"><h3 id="aws-s3-bucket-sentinelhub-and-database-access-parameters" class="relative group"><span class="heading-text">AWS: S3 bucket, SentinelHub and database access parameters</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#aws-s3-bucket-sentinelhub-and-database-access-parameters" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>You need to replace the placeholder values with your own database Amazon S3 and SentinelHub parameters:</p></div><div id="Y6lCnbB8rv" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># S3 parameters
aws_access_key_id = &quot;&lt;aws_access_key&gt;&quot;
aws_secret_access_key = &quot;&lt;aws_secret_key&gt;&quot;
aws_s3_bucket = &quot;&lt;aws_s3_bucket_name&gt;&quot; # Bucket must be configured as described here:
                                       # https://docs.sentinel-hub.com/api/latest/#/API/byoc?id=configuring-the-bucket
aws_s3_path = &quot;&lt;aws_s3_path_prediction&gt;&quot; # path on the bucket for the reference data, example: &quot;DCFS/{0}/{value_name}.tiff&quot;, where {0} represents patch index
                                        # where {0} represents patch index.

# SentinelHub
sentinelhub_prediction_layer = &#x27;&lt;sentinelhub_prediction_layer&gt;&#x27; # name of the &quot;Prediction&quot; layer within the above defined SentinelHub instance ID
sentinelhub_land_use_layer = &#x27;&lt;sentinelhub_prediction_layer&gt;&#x27; # name of the &quot;Land use&quot; layer within the above defined SentinelHub instance ID
sentinelhub_prediction_diff_layer = &#x27;&lt;sentinelhub_prediction_layer&gt;&#x27; # name of the &quot;Prediction vs. Land use difference&quot; layer within the above defined SentinelHub instance ID
 
# BYOC collections
sentinelhub_collection_name = &quot;DCFS&quot;


# This notebook uses the EO-Learn ML library which requires configuration passed via the &#x27;sentinel.config&#x27; tool
!sentinelhub.config --sh_base_url &#x27;https://services.sentinel-hub.com&#x27;
!sentinelhub.config --sh_client_id $SH_CLIENT_ID
!sentinelhub.config --sh_client_secret $SH_CLIENT_SECRET
!sentinelhub.config --instance_id $SH_INSTANCE_ID</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Oa3ZAjqvHI8XA1lc9gKoW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="CfdWjmu3IC" class="relative group/block"><h3 id="user-constants" class="relative group"><span class="heading-text">User constants</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#user-constants" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="esCdD0OmXu" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">country_name = &quot;slovenia&quot;
country_crs_code = &quot;EPSG:32633&quot;
country_border_file = &#x27;svn_buffered.geojson&#x27;

db_srid = 3794
db_land_use_table = &quot;land_use_slo&quot;
db_land_use_class_column = &quot;raba_id&quot;
db_lpis_table = &quot;lpis_slo&quot;
db_lpis_class_column = &quot;raba_id&quot;

selected_db_records_time = &#x27;2019-09-30&#x27; # records that are used as a reference to compare with prediction
selected_patch_center = (16.1977, 46.7299) # 15.1664, 46.2498) # (13.860377, 46.283196) # longitude, latitude
selected_patch_displayed_time = &#x27;2019-09-15&#x27; #User&#x27;s input. Must be a value in cube.time</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="M5UXTET4IuYRrlf-VhYzW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="A9Y6zAFz5T" class="relative group/block"><h3 id="import-packages" class="relative group"><span class="heading-text">Import packages</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#import-packages" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="Xg5oQ8cXkL" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Firstly, some necessary imports

# Jupyter notebook related
%reload_ext autoreload
%autoreload 2
%matplotlib inline

# Built-in modules
import pickle
import sys
import os
import datetime
import time
import itertools
import math
import subprocess
import json
import fiona
from geojson import Polygon as geoJsonPolygon
from enum import Enum

# interactive map
from ipyleaflet import Map as LeafletMap, Marker as LeafletMarker, Polygon as LeafletPolygon
from ipyleaflet import ImageOverlay as LeafletImageOverlay, DrawControl as LeafletDrawControl
from ipyleaflet import LayersControl as LeafletLayersControl, LayerGroup as LeafletLayerGroup
from ipyleaflet import basemaps, basemap_to_tiles

# Basics of Python data handling and visualization
import numpy as np
import geopandas as gpd
import matplotlib as mpl
import matplotlib.pyplot as plt
import matplotlib.gridspec as gridspec
import matplotlib.patches as patches
from matplotlib.transforms import Bbox as plotBbox
from matplotlib import colors
from mpl_toolkits.axes_grid1 import make_axes_locatable
from shapely.geometry import Polygon
from tqdm import tqdm_notebook as tqdm

# Machine learning 
import lightgbm as lgb
from sklearn.externals import joblib
from sklearn import metrics
from sklearn import preprocessing

# Imports from eo-learn and sentinelhub-py
from eolearn.core import EOTask, EOPatch, LinearWorkflow, FeatureType, OverwritePermission, \
    LoadTask, SaveTask, EOExecutor
from eolearn.io import S2L1CWCSInput, ExportToTiff
from eolearn.mask import AddCloudMaskTask, get_s2_pixel_cloud_detector, AddValidDataMaskTask
from eolearn.geometry import VectorToRaster, PointSamplingTask, ErosionTask
from eolearn.features import LinearInterpolation, SimpleFilterTask
from sentinelhub import BBoxSplitter, BBox, CRS, CustomUrlParam, UtmGridSplitter

# OAuth2
from oauthlib.oauth2 import BackendApplicationClient
from requests_oauthlib import OAuth2Session

# DB and raw geometry
from xcube_geodb.core.geodb import GeoDBClient
import psycopg2
from psycopg2._psycopg import AsIs
from psycopg2.extensions import register_adapter
import shapely.wkt
from shapely.geometry import Polygon, MultiPolygon
from geopandas import GeoDataFrame
import pyproj

# imports for xcube
import xarray as xr
import shapely.geometry
from shapely.ops import cascaded_union
import zarr

from xcube_sh.cube import open_cube
from xcube_sh.observers import Observers
from xcube_sh.config import CubeConfig
from xcube_sh.viewer import ViewerServer
import xcube.core.geom
import xcube.core.chunk

# Amazon S3
import boto3

import logging
globalLogger = logging.getLogger()
globalLogger.setLevel(logging.CRITICAL)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="PSaFnJjBHMeSwIIyj7pUH" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\sklearn\externals\joblib\__init__.py:15: DeprecationWarning: sklearn.externals.joblib is deprecated in 0.21 and will be removed in 0.23. Please import this functionality directly from joblib, which can be installed with: pip install joblib. If this warning is raised when loading pickled models, you may need to re-serialize those models with scikit-learn 0.21+.
  warnings.warn(msg, category=DeprecationWarning)
E:\Python\DCFS\lib\site-packages\pywt\_utils.py:6: DeprecationWarning: Using or importing the ABCs from &#x27;collections&#x27; instead of from &#x27;collections.abc&#x27; is deprecated, and in 3.8 it will stop working
  from collections import Iterable
E:\Python\DCFS\lib\site-packages\xcube_sh\cube.py:22: DeprecationWarning: Using or importing the ABCs from &#x27;collections&#x27; instead of from &#x27;collections.abc&#x27; is deprecated, and in 3.8 it will stop working
  from collections import Callable
</span></code></pre></div></div></div><div id="etqumZO0hC" class="relative group/block"><h2 id="mappings-and-colors" class="relative group"><span class="heading-text">Mappings and colors</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mappings-and-colors" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="pFyJXooCFw" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">lulcMapping = {
    0: {&quot;name&quot;: &#x27;No Data&#x27;, &quot;color&quot;: [1.00, 1.00, 1.00]},
    1: {&quot;name&quot;: &#x27;Cultivated Land&#x27;, &quot;color&quot;: [0.75, 1.00, 0.00]},
    2: {&quot;name&quot;: &#x27;Forest&#x27;, &quot;color&quot;: [0.01, 0.21, 0.00]},
    3: {&quot;name&quot;: &#x27;Grassland&#x27;, &quot;color&quot;: [0.98, 0.45, 0.02]},
    4: {&quot;name&quot;: &#x27;Shrubland&#x27;, &quot;color&quot;: [0.82, 0.70, 0.44]},
    5: {&quot;name&quot;: &#x27;Water&#x27;, &quot;color&quot;: [0.02, 0.60, 0.95]},
    6: {&quot;name&quot;: &#x27;Wetlands&#x27;, &quot;color&quot;: [0.84, 1.00, 1.00]},
    7: {&quot;name&quot;: &#x27;Tundra&#x27;, &quot;color&quot;: [0.78, 0.62, 0.94]},
    8: {&quot;name&quot;: &#x27;Artificial Surface&#x27;, &quot;color&quot;: [0.55, 0.00, 0.06]},
    9: {&quot;name&quot;: &#x27;Bareland&#x27;, &quot;color&quot;: [0.90, 0.85, 0.65]},
    10: {&quot;name&quot;: &#x27;Snow and Ice&#x27;, &quot;color&quot;: [0.00, 0.00, 0.00]}
}
    
lulcColorMapping = {id: entry[&quot;color&quot;] for id, entry in lulcMapping.items()}
lulcLegendTexts = {id: str(id) + &quot; = &quot; + entry[&quot;name&quot;] for id, entry in lulcMapping.items()}

## mapping of land use classes into 10 classes that are to be predicted
lulcToLandUseMapping = {
    0: [0, 9999, 1411], # NOTE 1411 doesn&#x27;t match any class
    1: [1100, 1150, 1160, 1161, 1170, 1180, 1181, 1190, 1191, 1192, 1211, 1212, 1221, 1222, 1230, 1240, 1610],
    2: [1420, 2000, 1907],
    3: [1130, 1131, 1300, 1320, 1321, 1330, 1600, 1906, 1800, 1430],
    4: [5000, 1500, 1410],
    5: [7000, 1905],
    6: [4100, 4210, 4220],
    7: [],
    8: [3000, 1902, 1903, 1904],
    9: [6000],
    10: []
}

landUseToLulcMapping = {landUse: lulc for lulc, landUseList in lulcToLandUseMapping.items() for landUse in landUseList}

landUseMapping = {
    1100: {&quot;name&quot;: &#x27;Arable land&#x27;, &quot;color&quot;: [0.60, 0.40, 0.40]},
    1130: {&quot;name&quot;: &#x27;Temporary grassland (not in use anymore)&#x27;, &quot;color&quot;: [0.11, 0.56, 0.56]},
    1131: {&quot;name&quot;: &#x27;Temporary grassland&#x27;, &quot;color&quot;: [0.11, 0.56, 0.56]},
    1150: {&quot;name&quot;: &#x27;Field for snail farming&#x27;, &quot;color&quot;: [0.60, 0.40, 0.40]},
    1160: {&quot;name&quot;: &#x27;Hop field&#x27;, &quot;color&quot;: [1.00, 0.20, 1.00]},
    1161: {&quot;name&quot;: &#x27;Hop field in rotation&#x27;, &quot;color&quot;: [1.00, 0.20, 1.00]},
    1170: {&quot;name&quot;: &#x27;Strawberry field&#x27;, &quot;color&quot;: [0.60, 0.40, 0.40]},
    1180: {&quot;name&quot;: &#x27;Permanent crops on arable land&#x27;, &quot;color&quot;: [1.00, 0.73, 0.60]},
    1181: {&quot;name&quot;: &#x27;Permanent crops on arable land where production is not in soil (not eligible)&#x27;, &quot;color&quot;: [1.00, 0.73, 0.60]},
    1190: {&quot;name&quot;: &#x27;Greenhouse&#x27;, &quot;color&quot;: [0.60, 0.40, 0.40]},
    1191: {&quot;name&quot;: &#x27;Greenhouse where production is not in soil (not eligible)&#x27;, &quot;color&quot;: [0.60, 0.40, 0.40]},
    1192: {&quot;name&quot;: &#x27;Greenhouse with fruit plants&#x27;, &quot;color&quot;: [1.00, 0.73, 0.60]},
    1211: {&quot;name&quot;: &#x27;Vineyard&#x27;, &quot;color&quot;: [1.00, 1.00, 0.20]},
    1212: {&quot;name&quot;: &#x27;Nursery&#x27;, &quot;color&quot;: [1.00, 0.68, 0.68]},
    1221: {&quot;name&quot;: &#x27;Intensive orchard&#x27;, &quot;color&quot;: [1.00, 0.73, 0.20]},
    1222: {&quot;name&quot;: &#x27;Extensive orchard&#x27;, &quot;color&quot;: [1.00, 0.60, 0.20]},
    1230: {&quot;name&quot;: &#x27;Olive grove&#x27;, &quot;color&quot;: [0.73, 0.73, 0.20]},
    1240: {&quot;name&quot;: &#x27;Other permanent crop&#x27;, &quot;color&quot;: [1.00, 0.73, 0.60]},
    1300: {&quot;name&quot;: &#x27;Permanent grassland&#x27;, &quot;color&quot;: [0.20, 1.00, 0.20]},
    1320: {&quot;name&quot;: &#x27;Permanent grassland with scattered ineligible features (Pro-rata)&#x27;, &quot;color&quot;: [0.20, 0.78, 0.80]},
    1321: {&quot;name&quot;: &#x27;Swampy meadows&#x27;, &quot;color&quot;: [0.04, 0.96, 0.85]},
    1330: {&quot;name&quot;: &#x27;Mountain pasture (not in use anymore)&#x27;, &quot;color&quot;: [0.50, 1.00, 0.20]},
    1410: {&quot;name&quot;: &#x27;Overgrown agricultural area&#x27;, &quot;color&quot;: [1.00, 0.37, 0.37]},
    1411: {&quot;name&quot;: &#x27;Area for removing overgrowth&#x27;, &quot;color&quot;: [0.21, 0.58, 0.45]},
    1420: {&quot;name&quot;: &#x27;Forest plantation&#x27;, &quot;color&quot;: [0.20, 0.80, 0.60]},
    1430: {&quot;name&quot;: &#x27;Extensive karst pasture&#x27;, &quot;color&quot;: [0.58, 0.98, 0.67]},
    1500: {&quot;name&quot;: &#x27;Trees and shrubs&#x27;, &quot;color&quot;: [0.15, 0.84, 0.24]},
    1600: {&quot;name&quot;: &#x27;Uncultivated agricultural land  &#x27;, &quot;color&quot;: [0.50, 0.25, 0.25]},
    1610: {&quot;name&quot;: &#x27;Agricultural land being prepared for cultivation&#x27;, &quot;color&quot;: [0.20, 0.73, 0.20]},
    1800: {&quot;name&quot;: &#x27;Forest trees on agricultural land&#x27;, &quot;color&quot;: [0.15, 0.84, 0.24]},
    1902: {&quot;name&quot;: &#x27;Hayrack&#x27;, &quot;color&quot;: [0.72, 0.52, 0.05]},
    1903: {&quot;name&quot;: &#x27;Dirt road&#x27;, &quot;color&quot;: [0.85, 0.77, 0.65]},
    1904: {&quot;name&quot;: &#x27;Dry stone&#x27;, &quot;color&quot;: [0.75, 0.75, 0.75]},
    1905: {&quot;name&quot;: &#x27;Trench&#x27;, &quot;color&quot;: [0.75, 0.75, 0.75]},
    1906: {&quot;name&quot;: &#x27;Grassy border between fields&#x27;, &quot;color&quot;: [0.20, 1.00, 0.20]},
    1907: {&quot;name&quot;: &#x27;Trees in line&#x27;, &quot;color&quot;: [0.15, 0.84, 0.24]},
    2000: {&quot;name&quot;: &#x27;Forest&#x27;, &quot;color&quot;: [0.15, 0.84, 0.24]},
    3000: {&quot;name&quot;: &#x27;Built-up area and related surface&#x27;, &quot;color&quot;: [1.00, 0.20, 0.50]},
    4100: {&quot;name&quot;: &#x27;Swamp&#x27;, &quot;color&quot;: [0.04, 0.96, 0.85]},
    4210: {&quot;name&quot;: &#x27;Reed&#x27;, &quot;color&quot;: [0.04, 0.96, 0.85]},
    4220: {&quot;name&quot;: &#x27;Other marshy areas&#x27;, &quot;color&quot;: [0.04, 0.96, 0.85]},
    5000: {&quot;name&quot;: &#x27;Dried open area with special vegetation&#x27;, &quot;color&quot;: [0.50, 0.50, 1.00]},
    6000: {&quot;name&quot;: &#x27;Open area with little or no vegetation&#x27;, &quot;color&quot;: [0.84, 1.00, 0.67]},
    7000: {&quot;name&quot;: &#x27;Water&#x27;, &quot;color&quot;: [0.50, 1.00, 1.00]},
    9999: {&quot;name&quot;: &#x27;No data&#x27;, &quot;color&quot;: [0.00, 0.00, 0.00]}
}

landUseColorMapping = {id: entry[&quot;color&quot;] for id, entry in landUseMapping.items()}
landUseLegendTexts = {id: str(id) + &quot; = &quot; + ((entry[&quot;name&quot;][:15] + &#x27;..&#x27;) if len(entry[&quot;name&quot;]) &gt; 15 else entry[&quot;name&quot;]) for id, entry in landUseMapping.items()}

diffColorMapping = { # Blue through yellow to red
    -10: [0.19, 0.21, 0.58], 
    -9: [0.27, 0.29, 0.60], 
    -8: [0.35, 0.37, 0.62], 
    -7: [0.43, 0.45, 0.63], 
    -6: [0.52, 0.53, 0.65],
    -5: [0.60, 0.61, 0.67], 
    -4: [0.68, 0.68, 0.69], 
    -3: [0.76, 0.76, 0.70], 
    -2: [0.84, 0.84, 0.72], 
    -1: [0.92, 0.92, 0.74],
    0: [1.00, 1.00, 0.75], 
    1: [0.97, 0.90, 0.69], 
    2: [0.93, 0.80, 0.63], 
    3: [0.90, 0.70, 0.57], 
    4: [0.86, 0.60, 0.51],
    5: [0.83, 0.50, 0.45], 
    6: [0.80, 0.40, 0.39], 
    7: [0.76, 0.30, 0.33], 
    8: [0.73, 0.20, 0.27], 
    9: [0.69, 0.10, 0.21],
    10: [0.66, 0.00, 0.15]
}</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="SnyVXI9llTZfi-xqTmfpQ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="xymvz2QEyt" class="relative group/block"><h2 id="database-loading-functionality" class="relative group"><span class="heading-text">Database loading functionality</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#database-loading-functionality" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="i9PW37gtwr" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># needed for DB mapping
register_adapter(np.int64, AsIs)
register_adapter(Polygon, AsIs)
register_adapter(MultiPolygon, AsIs)

def loadFromDatabase(geodb, taskName, tableName, landUseColumnName, recordId, bbox, crs, 
    dateFilterMin, dateFilterMax, maxRows = None, logging = True, mappedColumnName = None, mappingLambdaFunc = None):
    
    conditions = []
    if not dateFilterMin is None:
        conditions.append(&quot;d_update &gt;= &#x27;{}&#x27;&quot;.format(dateFilterMin));

    if not dateFilterMax is None:
        conditions.append(&quot;d_update &lt;= &#x27;{}&#x27;&quot;.format(dateFilterMax));

    if not recordId is None:
        conditions.append(&quot;id=eq.{}&quot;.format(recordId));
        
    if len(conditions) == 0:
        conditions.append(&quot;id &gt;= -1&quot;)
        
    if not bbox is None:
        transformer = pyproj.Transformer.from_crs(str(crs), &quot;EPSG:&quot; + str(db_srid), always_xy=True)
        bbox_x1y1 = transformer.transform(bbox.min_x, bbox.min_y)
        bbox_x2y2 = transformer.transform(bbox.max_x, bbox.max_y)
        bbox_native = BBox((bbox_x1y1[0], bbox_x1y1[1], bbox_x2y2[0], bbox_x2y2[1]), crs)
    
        gdf = geodb.get_collection_by_bbox(collection = tableName, 
            bbox = (bbox_native.min_x, bbox_native.min_y, bbox_native.max_x, bbox_native.max_y), 
            where = &quot; AND &quot;.join(conditions),
            comparison_mode = &quot;intersects&quot;, bbox_crs = db_srid, 
            limit = 0 if maxRows is None else maxRows, offset = 0)
    else:
        gdf = geodb.get_collection(collection = tableName, query = &quot; AND &quot;.join(conditions))
        
    gdf.crs = fiona.crs.from_epsg(db_srid)
    gdf = gdf.to_crs(str(crs))
    gdf.crs = {&quot;init&quot;: &quot;epsg:{}&quot;.format(crs.value)}
    
    # Map the specific &quot;raba_id&quot; column to the general &quot;land_use&quot;. Also add a mapped column name if needed.
    gdf[&quot;land_use&quot;] = gdf[&quot;raba_id&quot;]
    if (mappedColumnName and mappingLambdaFunc):
        gdf[mappedColumnName] = gdf.apply(lambda row: mappingLambdaFunc(row[&quot;raba_id&quot;]), axis = 1)
    
    if logging and not bbox is None:
        print(taskName + &quot;: &quot; + str(len(gdf)) + &#x27; DB records for bbox = &#x27; + str(bbox))

    return gdf


def loadFromDatabaseWithLulcMapping(geodb, taskName, tableName, landUseColumnName, recordId, bbox, crs, 
    dateFilterMin, dateFilterMax, maxRows = None, logging = True):
    
    return loadFromDatabase(geodb, taskName, tableName, landUseColumnName, recordId, bbox, crs, 
        dateFilterMin, dateFilterMax, maxRows, logging,
        &quot;lulcid&quot;, lambda lulc: landUseToLulcMapping[lulc] if lulc in landUseToLulcMapping else 0)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="FTTJXgIABP7hPmiRd-J2i" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="iSiTAXWQOj" class="relative group/block"><h2 id="sentinelhub-client-functionality" class="relative group"><span class="heading-text">SentinelHub client functionality</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#sentinelhub-client-functionality" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="oz6t9jp94c" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class SentinelHubClient():
    def __init__(self, sh_oauth_session, s3_bucket):
        self.sh_oauth_session = sh_oauth_session
        self.s3_bucket = s3_bucket
        
    def getCollectionByName(self, name):
        try:
            url = &quot;{base_url}/byoc/collections&quot;
            url = url.format(base_url = sentinelhub_url)
            response = self.sh_oauth_session.get(url = url)
            response.raise_for_status()

            for collection_data in response.json()[&quot;data&quot;]:
                if collection_data[&quot;name&quot;] == name:
                    return collection_data[&quot;id&quot;]
            return None
        except Exception as e:
            print(e)
            raise
    
    def createCollection(self, name):
        try:
            url = &quot;{base_url}/byoc/collections&quot;
            url = url.format(base_url = sentinelhub_url)
            response = self.sh_oauth_session.post(url = url, json = {&#x27;name&#x27;: name, &#x27;s3Bucket&#x27;: self.s3_bucket})
            response.raise_for_status()
            return response.json()[&quot;data&quot;][&quot;id&quot;]
        except Exception as e:
            print(e)
            raise
            
    def getTileByPath(self, collection_id, s3_file_path):
        try:
            url = &quot;{base_url}/byoc/collections/{collection_id}/tiles&quot;
            url = url.format(base_url = sentinelhub_url, collection_id = collection_id)
            response = self.sh_oauth_session.get(url = url)
            response.raise_for_status()

            for tile_data in response.json()[&quot;data&quot;]:
                if tile_data[&quot;path&quot;] == s3_file_path:
                    return tile_data[&quot;id&quot;]
            return None
        except Exception as e:
            print(e)
            raise
            
    def deleteTile(self, collection_id, tile_id):
        try:
            url = &quot;{base_url}/byoc/collections/{collection_id}/tiles/{tile_id}&quot;
            url = url.format(base_url = sentinelhub_url, collection_id = collection_id, tile_id = tile_id)
            response = self.sh_oauth_session.delete(url = url)
            response.raise_for_status()
        except Exception as e:
            print(e)
            raise
            
    def ingestTile(self, collection_id, s3_file_path, bbox):
        try:
            crs = {&quot;type&quot;: &quot;name&quot;, &quot;properties&quot;: {&quot;name&quot;: &quot;urn:ogc:def:crs:EPSG::{}&quot;.format(bbox.crs.value)}}
            cover_geometry = geoJsonPolygon([bbox.get_polygon()], crs = crs)
            json = json = {&quot;path&quot;: s3_file_path, &quot;coverGeometry&quot;: cover_geometry, &quot;tileGeometry&quot;: cover_geometry}
            
            url = &quot;{base_url}/byoc/collections/{collection_id}/tiles&quot;
            url = url.format(base_url = sentinelhub_url, collection_id = collection_id)
            response = self.sh_oauth_session.post(url = url, json = json)
            response.raise_for_status()
            tile_id = response.json()[&quot;data&quot;][&quot;id&quot;]

            # wait until tile ingested
            url = &quot;{base_url}/byoc/collections/{collection_id}/tiles/{tile_id}&quot;
            url = url.format(base_url = sentinelhub_url, collection_id = collection_id, tile_id = tile_id)
            while True:
                response = self.sh_oauth_session.get(url = url)
                response.raise_for_status()
                status = response.json()[&quot;data&quot;][&quot;status&quot;]
                if status != &#x27;INGESTING&#x27; and status != &#x27;WAITING&#x27;:
                    if status == &#x27;FAILED&#x27;:
                        print(&quot;Failed to ingest tile &quot; + s3_file_path + &quot;: &quot; + response.json()[&quot;data&quot;][&quot;failedIngestionCause&quot;])
                    break
                time.sleep(1)
            
            return tile_id
        except Exception as e:
            print(e)
            raise</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="F0towkSRgbq0SLwsMZyFe" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="vqBp2kLlaN" class="relative group/block"><h2 id="part-1-exploratory-analysis" class="relative group"><span class="heading-text">Part 1: Exploratory Analysis</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#part-1-exploratory-analysis" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><h3 id="define-the-area-of-interest-aoi" class="relative group"><span class="heading-text">Define the Area-of-Interest (AOI):</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-area-of-interest-aoi" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The whole territory of a country is splited into patches which makes the processing more efficient. The process is run on are of 3x3 patches for demonstration purposes.  AOI can be selected as the id of the patch in the middle.</p><p>Main steps in this part of the notebook:</p><ul><li>A geographical shape of Slovenia was taken from <a target="_blank" rel="noreferrer" href="http://www.naturalearthdata.com/downloads/10m-cultural-vectors/" class="">Natural Earth database</a> and a buffer was applied. The shape is available in repository: <code>example_data/svn_buffered.geojson</code></li><li>Convert it to selected CRS: taken to be the CRS of central UTM tile (UTM_33N)</li><li>Split it into smaller, manageable, non-overlapping rectangular tiles (patches)</li><li>Select a small 3x3 area for classification</li></ul><p>Be sure that your choice of CRS is the same as the CRS of your reference data.</p><p>In the case that you are having problems with empty data being downloaded, try changing the CRS to something that suits the location of the AOI better.</p></div><div id="pZvFGhMUIg" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">country_crs = CRS(country_crs_code)

# Folder where data for running the notebook is stored
DATA_FOLDER = os.path.join(&#x27;example_data&#x27;)

# Load geojson file
country = gpd.read_file(os.path.join(DATA_FOLDER, country_border_file))

# Convert CRS
country = country.to_crs(crs={&#x27;init&#x27;: CRS.ogc_string(country_crs)})

# Get the country&#x27;s shape in polygon format
country_shape = country.geometry.values[-1]

# Create the splitter to obtain a list of bboxes
use_smaller_patches = True
bbox_splitter_large = BBoxSplitter([country_shape], country_crs, (25, 17))
bbox_splitter_small = BBoxSplitter([country_shape], country_crs, (25 * 3, 17 * 3))

bbox_splitter = bbox_splitter_small if use_smaller_patches else bbox_splitter_large
bbox_list_aligned = [BBox((10 * math.floor(bbox.min_x / 10), 10 * math.floor(bbox.min_y / 10), 
                           10 * math.floor(bbox.max_x / 10), 10 * math.floor(bbox.max_y / 10)), country_crs) 
                     for bbox in bbox_splitter.get_bbox_list()]

bbox_list = np.array(bbox_list_aligned)
info_list = np.array(bbox_splitter.get_info_list())


# For the future examples, we will be using a specific set of patches,
# Select a central patch

from_wgs84_transformer = pyproj.Transformer.from_crs(str(CRS.WGS84), str(country_crs), always_xy=True)
center_x, center_y = from_wgs84_transformer.transform(selected_patch_center[0], selected_patch_center[1])

def bboxContains(bbox, x, y):
    return (x &gt;= bbox.min_x) and (x &lt; bbox.max_x) and (y &gt;= bbox.min_y) and (y &lt; bbox.max_y)

# find index of the patch that contains user-defined central coordinate
center_patch_index = next((index for index, bbox in enumerate(bbox_list) if bboxContains(bbox, center_x, center_y)), None)

# Obtain surrounding patches
patchIDs = []
for idx, [bbox, info] in enumerate(zip(bbox_list, info_list)):
    if (abs(info[&#x27;index_x&#x27;] - info_list[center_patch_index][&#x27;index_x&#x27;]) &lt;= 1 and
        abs(info[&#x27;index_y&#x27;] - info_list[center_patch_index][&#x27;index_y&#x27;]) &lt;= 1):
        patchIDs.append(idx)

# Check if final size is 3x3
if len(patchIDs) &lt; 9:
    print(&#x27;Warning! Use a different central patch ID, this one is on the border.&#x27;)
    
# Change the order of the patches (used for plotting later)
patchIDs = np.transpose(np.fliplr(np.array(patchIDs).reshape(3, 3))).ravel()

# Prepare info of selected EOPatches
geometry = [Polygon(bbox.get_polygon()) for bbox in bbox_list[patchIDs]]
idxs_x = [info[&#x27;index_x&#x27;] for info in info_list[patchIDs]]
idxs_y = [info[&#x27;index_y&#x27;] for info in info_list[patchIDs]]

gdf = gpd.GeoDataFrame({&#x27;index_x&#x27;: idxs_x, &#x27;index_y&#x27;: idxs_y}, 
                       crs={&#x27;init&#x27;: CRS.ogc_string(country_crs)}, 
                       geometry=geometry)

## NOTE: save to shapefile, uncomment if needed
# shapefile_name = &#x27;./selected_3x3_bboxes_&#x27; + country_name + &#x27;_small.shp&#x27; if use_smaller_patches \
#    else &#x27;./selected_3x3_bboxes_&#x27; + country_name + &#x27;_large.shp&#x27;
# gdf.to_file(shapefile_name)

# Visualize the selection
poly = gdf[&#x27;geometry&#x27;][0]
x1, y1, x2, y2 = poly.bounds
aspect_ratio = (y1 - y2) / (x1 - x2)

fontdict = {&#x27;family&#x27;: &#x27;monospace&#x27;, &#x27;weight&#x27;: &#x27;normal&#x27;, &#x27;size&#x27;: 11}

# if bboxes have all same size, estimate offset
xl, yl, xu, yu = gdf.geometry[0].bounds
xoff, yoff = (xu - xl) / 3, (yu - yl) / 5

# figure
fig, ax = plt.subplots(figsize=(20, 20));
gdf.plot(ax=ax,facecolor=&#x27;w&#x27;,edgecolor=&#x27;r&#x27;,alpha=0.5);
country.plot(ax=ax, facecolor=&#x27;w&#x27;,edgecolor=&#x27;b&#x27;,alpha=0.5);
ax.set_title(&#x27;Selected 3x3 patches within the border&#x27;);
plt.axis(&#x27;off&#x27;);</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WZUCuhUVjyXjtHBjfhc5c" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/a244e8a112c015709cadea38019b9f50.png" alt="&lt;Figure size 1440x1440 with 1 Axes&gt;"/></div></div><div id="kTwkVHwGIt" class="relative group/block"><h3 id="visualization-of-land-use-reference-data-in-selected-aoi" class="relative group"><span class="heading-text">Visualization of land use (reference) data in selected AOI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visualization-of-land-use-reference-data-in-selected-aoi" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="SXaVGAxRhA" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Rearange selected EOPatches into bbox, which can be used for xcube definition
patches_geometries = [Polygon(bbox.transform(CRS.WGS84).get_polygon()) for bbox in bbox_list[patchIDs]]
bbox_of_patches = gpd.GeoSeries(cascaded_union(patches_geometries))

x1 = bbox_of_patches.bounds[&#x27;minx&#x27;][0].item()
y1 = bbox_of_patches.bounds[&#x27;miny&#x27;][0].item()
x2 = bbox_of_patches.bounds[&#x27;maxx&#x27;][0].item()
y2 = bbox_of_patches.bounds[&#x27;maxy&#x27;][0].item()
total_bbox_wgs84 = x1, y1, x2, y2</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ajDI49383-erNOXRlWtq2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="KXBhIuOoSJ" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Rearange selected EOPatches into bbox, which can be used for xcube definition
patches_geometries = [Polygon(bbox.get_polygon()) for bbox in bbox_list[patchIDs]]
bbox_of_patches = gpd.GeoSeries(cascaded_union(patches_geometries))

x1 = bbox_of_patches.bounds[&#x27;minx&#x27;][0].item()
y1 = bbox_of_patches.bounds[&#x27;miny&#x27;][0].item()
x2 = bbox_of_patches.bounds[&#x27;maxx&#x27;][0].item()
y2 = bbox_of_patches.bounds[&#x27;maxy&#x27;][0].item()
total_bbox = x1, y1, x2, y2</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="8PMsXznKFrfrGPdtnfkIk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="E5iJagiDhy" class="relative group/block"><h4 id="land-use-reference-data-for-selected-aoi" class="relative group"><span class="heading-text">Land use (reference) data for selected AOI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#land-use-reference-data-for-selected-aoi" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>Land use data are public in Slovenia, you can download the full dataset <a target="_blank" rel="noreferrer" href="http://rkg.gov.si/GERK/" class="">here</a>, selecting the <code>Grafični podatki RABA za celo Slovenijo (shape.rar ~ 500 MB) KoordSistem: D96/TM</code>. The dataset is provided in the national <code>D96/TM</code> coordinate system. It was stored ingeo database. Transformation of reference data to <code>UTM_33N</code> is preformed while reading the data from the database.</p></div><div id="PIk8DFYkFm" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Distinct &quot;d_update&quot;:
distinct_d_update = [    
    &quot;2019-09-30&quot;,
    &quot;2019-06-30&quot;,
    &quot;2019-03-31&quot;,
    &quot;2019-01-03&quot;,
    &quot;2018-09-30&quot;,
    &quot;2018-06-30&quot;,
    &quot;2018-03-31&quot;,
    &quot;2017-12-31&quot;,
    &quot;2017-09-30&quot;,
    &quot;2017-06-30&quot;,
    &quot;2017-03-31&quot;,
    &quot;2016-12-31&quot;,
    &quot;2016-09-30&quot;,
    &quot;2016-06-30&quot;,
    &quot;2016-03-31&quot;,
    &quot;2015-12-31&quot;,
    &quot;2015-09-30&quot;,
    &quot;2015-06-30&quot;,
    &quot;2015-03-31&quot;,
    &quot;2015-01-13&quot;
]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Gz1rWQfsN3ATkCv6verKa" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="HuZS9Wexsv" class="relative group/block"><h5 id="plot-time-series-of-land-use-and-mapped-land-use-for-selected-bbox" class="relative group"><span class="heading-text">Plot time series of land use and mapped land use for selected bbox</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-time-series-of-land-use-and-mapped-land-use-for-selected-bbox" title="Link to this Section" aria-label="Link to this Section">¶</a></h5></div><div id="C72xv0Ty4F" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">selected_timeseries_times = [distinct_d_update[0], distinct_d_update[5], distinct_d_update[8]]
selected_timeseries_center = (15.5250405633, 46.5505120371) # longitude, latitude
selected_timeseries_size = 900 # meters

def displayPlot(title, ax, data, dataColumn, bbox, colorMapping, legendMapping):
    ax.set_xlim([bbox.min_x, bbox.max_x])
    ax.set_ylim([bbox.min_y, bbox.max_y])

    # since geopandas does its own normalization, we need to find used values,
    # to properly map the colors and legend texts to the actual values
    uniqueVals = data[dataColumn].unique()
    uniqueVals.sort()
    cmap = colors.ListedColormap([colorMapping[val] for val in uniqueVals])
    norm = colors.BoundaryNorm(range(cmap.N), cmap.N)
    
    data.plot(ax=ax, column=dataColumn, edgecolor=&#x27;w&#x27;, alpha=1, categorical=True, legend=True, cmap=cmap, norm=norm)
    ax.set_title(title);
    for text, label in zip(ax.get_legend().get_texts(), [legendMapping[val] for val in uniqueVals]):
        text.set_text(label)

geodb = GeoDBClient()
from_wgs84_transformer = pyproj.Transformer.from_crs(str(CRS.WGS84), str(country_crs), always_xy=True)
x, y = from_wgs84_transformer.transform(selected_timeseries_center[0], selected_timeseries_center[1])
size = selected_timeseries_size
bbox = (x - size * 0.5, y - size * 0.5, x + size * 0.5, y + size * 0.5)
bbox = BBox(bbox=list(bbox), crs=country_crs)

for d_update in selected_timeseries_times:
    # Plot time series of land use for selected bbox
    land_use = loadFromDatabaseWithLulcMapping(geodb, &quot;Land use&quot;, db_land_use_table, db_land_use_class_column, 
        None, bbox, bbox.crs, d_update, d_update)
    
    fig, axes = plt.subplots(1, 2, figsize=(20, 20))

    displayPlot(&#x27;Land Use ({})&#x27;.format(d_update), axes[0], land_use, &#x27;land_use&#x27;, bbox, landUseColorMapping, landUseLegendTexts)
    displayPlot(&#x27;Mapped land use ({})&#x27;.format(d_update), axes[1], land_use, &#x27;lulcid&#x27;, bbox, lulcColorMapping, lulcLegendTexts)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="72PP8wLBRgEpuJKnvyWtQ" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Land use: 115 DB records for bbox = 539799.9999979775,5154900.000002044,540699.9999979775,5155800.000002044
Land use: 90 DB records for bbox = 539799.9999979775,5154900.000002044,540699.9999979775,5155800.000002044
Land use: 91 DB records for bbox = 539799.9999979775,5154900.000002044,540699.9999979775,5155800.000002044
</span></code></pre></div><img src="/notebooks_test/build/d8dd8414a5537a5af414501dd25538aa.png" alt="&lt;Figure size 1440x1440 with 2 Axes&gt;"/><img src="/notebooks_test/build/4b80ec4aac5fb11fdeb847be93cbed4e.png" alt="&lt;Figure size 1440x1440 with 2 Axes&gt;"/><img src="/notebooks_test/build/592c048f9433b1dab1713b68cae511d6.png" alt="&lt;Figure size 1440x1440 with 2 Axes&gt;"/></div></div><div id="Ols4cxaD7d" class="relative group/block"><h4 id="satellite-imagery-for-selected-aoi" class="relative group"><span class="heading-text">Satellite imagery for selected AOI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#satellite-imagery-for-selected-aoi" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="rhDV962TyJ" class="relative group/block"><h5 id="configure-xcube" class="relative group"><span class="heading-text">Configure xcube</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#configure-xcube" title="Link to this Section" aria-label="Link to this Section">¶</a></h5></div><div id="OovEyc9kbR" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Plot time series of satellite images for bbox
spatial_res_meters = 10
pixx = (total_bbox[2] - total_bbox[0]) / spatial_res_meters; pixy = (total_bbox[3] - total_bbox[1]) / spatial_res_meters;
spatial_res = float(np.mean([(total_bbox_wgs84[2] - total_bbox_wgs84[0]) / pixx, (total_bbox_wgs84[3] - total_bbox_wgs84[1]) / pixy]))

cube_config = CubeConfig(dataset_name=&#x27;S2L1C&#x27;,
                         band_names=[&quot;B02&quot;, &quot;B03&quot;, &quot;B04&quot;, &quot;B08&quot;, &quot;B11&quot;, &quot;B12&quot;],
                         chunk_size=[512, 512],
                         geometry=total_bbox_wgs84,
                         spatial_res=spatial_res,
                         time_range=[&#x27;2019-02-01&#x27;, &#x27;2019-09-30&#x27;],
                         time_period=&#x27;4D&#x27;)  

# So we can print some SentinelHub usage stats
request_collector = Observers.request_collector()
cube = open_cube(cube_config, request_collector, client_id=sentinelhub_client_id, client_secret=sentinelhub_client_secret)

# Add Indecies
## NDVI
b_red = cube.B04
b_nir = cube.B08
ndvi = (b_nir - b_red) / (b_nir + b_red)
ndvi.attrs[&#x27;long_name&#x27;] = &#x27;Normalized Difference Vegetation Index&#x27;
ndvi.attrs[&#x27;units&#x27;] = &#x27;unitless&#x27;
cube[&quot;ndvi&quot;] = ndvi

## NDWI
b_green = cube.B03
b_nir = cube.B08
ndwi = (b_green - b_nir) / (b_green + b_nir)
ndwi.attrs[&#x27;long_name&#x27;] = &#x27;Normalized Difference Water Index&#x27;
ndwi.attrs[&#x27;units&#x27;] = &#x27;unitless&#x27;
cube[&quot;ndwi&quot;] = ndwi

# cube.time</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="PJavRiB-0QxD2bFwv_oS9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\xcube_sh\store.py:73: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future
  t_array = np.array([s + 0.5 * (e - s) for s, e in self._time_ranges]).astype(&#x27;datetime64[s]&#x27;).astype(np.int64)
E:\Python\DCFS\lib\site-packages\xcube_sh\store.py:74: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future
  t_bnds_array = np.array(self._time_ranges).astype(&#x27;datetime64[s]&#x27;).astype(np.int64)
</span></code></pre></div></div></div><div id="rYVI0lv23I" class="relative group/block"><h5 id="plot-true-color-image-from-selected-date" class="relative group"><span class="heading-text">Plot True Color image from selected date</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-true-color-image-from-selected-date" title="Link to this Section" aria-label="Link to this Section">¶</a></h5></div><div id="ergWnyT8oj" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># True color image
factor = 2.5
R = cube.B04.sel(time=selected_patch_displayed_time)*factor
G = cube.B03.sel(time=selected_patch_displayed_time)*factor
B = cube.B02.sel(time=selected_patch_displayed_time)*factor
RGB = np.dstack([R, G, B])
rgb_array = xr.DataArray(RGB, dims=(&#x27;lat&#x27;, &#x27;lon&#x27;, &#x27;b&#x27;), coords=dict(lat=cube.B04.lat, lon=cube.B04.lon))
img = rgb_array.plot.imshow(rgb=&#x27;b&#x27;, figsize=(16, 16))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="25VymRRyMzVZtPbT2fA0S" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/c35d33c5e9c6c128b1c0a25549664868.png" alt="&lt;Figure size 1152x1152 with 1 Axes&gt;"/></div></div><div id="jT1pEzAghh" class="relative group/block"><h5 id="plot-time-series-of-satellite-images-for-selected-band" class="relative group"><span class="heading-text">Plot time series of satellite images for selected band</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-time-series-of-satellite-images-for-selected-band" title="Link to this Section" aria-label="Link to this Section">¶</a></h5></div><div id="snvj0E66GS" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot time series of band B04
img = cube.B04.plot.imshow(col=&#x27;time&#x27;, col_wrap=4, vmin=0, vmax=0.2, cmap=&#x27;Greys_r&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="czhaLiRubR2qXtkXH33Ph" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/71e7fa94e688b44fb5a4110052898aab.png" alt="&lt;Figure size 936x3456 with 65 Axes&gt;"/></div></div><div id="aOv09qBmhf" class="relative group/block"><h5 id="plot-time-series-of-ndvi" class="relative group"><span class="heading-text">Plot time series of NDVI</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-time-series-of-ndvi" title="Link to this Section" aria-label="Link to this Section">¶</a></h5></div><div id="EmRklimPHi" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot time series of NDVI
img = cube.ndvi.plot.imshow(col=&#x27;time&#x27;, col_wrap=4, vmin=-0.2, vmax=0.8, cmap=&#x27;YlGn&#x27;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="qa7tRTpdtOYdlx97mNHwl" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/8ea762ec607d77a2c72d772a403c5ecc.png" alt="&lt;Figure size 936x3456 with 65 Axes&gt;"/></div></div><div id="OoJBdNPI9A" class="relative group/block"><h5 id="plot-all-bands-and-data-in-xcube-for-given-date" class="relative group"><span class="heading-text">Plot all bands and data in xcube for given date</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-all-bands-and-data-in-xcube-for-given-date" title="Link to this Section" aria-label="Link to this Section">¶</a></h5></div><div id="hZSwH1qbWC" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot all bands and data in xcube for given date
for band in cube.data_vars:
    cube[band].sel(time=selected_patch_displayed_time).plot.imshow(vmin=0, vmax=0.4, cmap=&#x27;Greys_r&#x27;, figsize=(16, 14))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-5prGvERAdffOuw92X0t5" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/0276853a4959f604fcbdc34ea38b0fbc.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/e6a234ef4bb9765c0b03a9f8f7fd3dbf.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/2f479856efa2fa75e91df1a5eb373f0e.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/0b169413d5c8ff7cac37a4cce0175bfa.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/f16cb8018bd9c16661bbd66d20c0b112.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/23055f7706170a3fbc819f5173b226aa.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/b9bba6e79c3e87e4b83f59722da0263a.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/0bce00ea5d2cc1882dac1d655f27e974.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/></div></div><div id="EilKpXj8iX" class="relative group/block"><h5 id="zoom-closer-to-user-defined-area-mask-xcube" class="relative group"><span class="heading-text">Zoom closer to user defined area (mask xcube)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#zoom-closer-to-user-defined-area-mask-xcube" title="Link to this Section" aria-label="Link to this Section">¶</a></h5></div><div id="u0AyEZPaGX" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Mask original cube with smaller bbox
#zoomed_center = (15.1645, 46.2495) # (13.860377, 46.283196) # longitude, latitude
zoomed_center = (0.5 * (total_bbox_wgs84[0] + total_bbox_wgs84[2]), 0.5 * (total_bbox_wgs84[1] + total_bbox_wgs84[3]))
zoomed_size = 0.25 # ratio to the original 3x3 patches cube

zoomed_size_degrees = zoomed_size
selected_bbox = (
    zoomed_center[0] - zoomed_size * 0.5 * (total_bbox_wgs84[2] - total_bbox_wgs84[0]), 
    zoomed_center[1] - zoomed_size * 0.5 * (total_bbox_wgs84[3] - total_bbox_wgs84[1]),
    zoomed_center[0] + zoomed_size * 0.5 * (total_bbox_wgs84[2] - total_bbox_wgs84[0]), 
    zoomed_center[1] + zoomed_size * 0.5 * (total_bbox_wgs84[3] - total_bbox_wgs84[1])
)
small_cube = xcube.core.geom.mask_dataset_by_geometry(cube, selected_bbox, no_clip=False, save_geometry_wkt=True)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="nsP4BWOfd3IFN9w6IF356" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="GSVdzg85vy" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># True color
factor = 2.5
R = small_cube.B04.sel(time=selected_patch_displayed_time)*factor
G = small_cube.B03.sel(time=selected_patch_displayed_time)*factor
B = small_cube.B02.sel(time=selected_patch_displayed_time)*factor
RGB = np.dstack([R, G, B])
rgb_array = xr.DataArray(RGB, dims=(&#x27;lat&#x27;, &#x27;lon&#x27;, &#x27;b&#x27;), coords=dict(lat=small_cube.B04.lat, lon=small_cube.B04.lon))
img = rgb_array.plot.imshow(rgb=&#x27;b&#x27;, figsize=(16, 16))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="D6lIXHSLtdLUFlChmX8iB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/a86f7615242354a67a7a69d997c08f58.png" alt="&lt;Figure size 1152x1152 with 1 Axes&gt;"/></div></div><div id="fgSj4UJ6il" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Plot all bands for selected time
for band in small_cube.data_vars:
    small_cube[band].sel(time=selected_patch_displayed_time).plot.imshow(vmin=0, vmax=0.4, cmap=&#x27;Greys_r&#x27;, figsize=(16, 14))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="9tfKGUfUuloabOX9LxR4k" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/ed4c46c6fb9b6aa9dacc5242b82b5e12.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/55f2b80d40a208e23e79b2945f2bfc4f.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/2beb2d9ae0220a4ad20f991dd7cb8811.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/b243af6ba1f386e965b5ee769c3394bb.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/e932ce9e4278737dbe714412a0da058c.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/f8d06bfddd9b577f59a8a9532bda6d46.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/386f3be2bebb9471157010dfea647d09.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/><img src="/notebooks_test/build/0dd143e55e18992a14f62625ae35fb88.png" alt="&lt;Figure size 1152x1008 with 2 Axes&gt;"/></div></div><div id="W8QXQVe1Ea" class="relative group/block"><h2 id="part-2-lulc-prediction-with-machine-learning" class="relative group"><span class="heading-text">Part 2: LULC prediction with Machine Learning</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#part-2-lulc-prediction-with-machine-learning" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="J5RTHYWXwa" class="relative group/block"><h3 id="set-some-of-the-inputs-for-prediction-with-ml" class="relative group"><span class="heading-text">Set some of the inputs for prediction with ML</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#set-some-of-the-inputs-for-prediction-with-ml" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="BKyII3l5qr" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">selected_db_land_use_date = &#x27;2019-09-30&#x27;
selected_date_interval_for_satellite_imagery = [&#x27;2019-01-01&#x27;, &#x27;2019-09-19&#x27;]
selected_max_cc = 0.8</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="oCNjYhK3D_d-lJo8O9jYm" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="qokegdURO7" class="relative group/block"><h3 id="fill-eopatches-with-data" class="relative group"><span class="heading-text">Fill EOPatches with data:</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#fill-eopatches-with-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Now it’s time to create EOPatches and fill them with Sentinel-2 data using Sentinel Hub services. We will add the following data to each EOPatch:</p><ul><li><p>L1C custom list of bands [B02, B03, B04, B08, B11, B12], which corresponds to [B, G, R, NIR, SWIR1, SWIR2] wavelengths.</p></li><li><p>SentinelHub’s cloud probability map and cloud mask</p></li></ul><p>Additionally, we will add:</p><ul><li><p>Calculated NDVI, NDWI, euclidean NORM information</p></li><li><p>A mask of validity, based on acquired data from Sentinel and cloud coverage. Valid pixel is if:</p><ol start="1"><li>IS_DATA == True</li><li>CLOUD_MASK == 0 (1 indicates that pixel was identified to be covered with cloud)</li></ol></li></ul><p>An EOPatch is created and manipulated using EOTasks, which are chained in an EOWorkflow. In this example the final workflow is executed on all patches, which are saved to the specified directory.</p></div><div id="sZJABF8D4o" class="relative group/block"><h4 id="define-some-needed-custom-eotasks" class="relative group"><span class="heading-text">Define some needed custom EOTasks</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-some-needed-custom-eotasks" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="OHLdswAh4y" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class SentinelHubValidData:
    &quot;&quot;&quot;
    Combine Sen2Cor&#x27;s classification map with `IS_DATA` to define a `VALID_DATA_SH` mask
    The SentinelHub&#x27;s cloud mask is asumed to be found in eopatch.mask[&#x27;CLM&#x27;]
    &quot;&quot;&quot;
    def __call__(self, eopatch):        
        return np.logical_and(eopatch.mask[&#x27;IS_DATA&#x27;].astype(np.bool), 
                              np.logical_not(eopatch.mask[&#x27;CLM&#x27;].astype(np.bool)))
    
class CountValid(EOTask):   
    &quot;&quot;&quot;
    The task counts number of valid observations in time-series and stores the results in the timeless mask.
    &quot;&quot;&quot;
    def __init__(self, count_what, feature_name):
        self.what = count_what
        self.name = feature_name
        
    def execute(self, eopatch):
        eopatch.add_feature(FeatureType.MASK_TIMELESS, self.name, np.count_nonzero(eopatch.mask[self.what],axis=0))
        
        return eopatch


class NormalizedDifferenceIndex(EOTask):   
    &quot;&quot;&quot;
    The tasks calculates user defined Normalised Difference Index (NDI) between two bands A and B as:
    NDI = (A-B)/(A+B).
    &quot;&quot;&quot;
    def __init__(self, feature_name, band_a, band_b):
        self.feature_name = feature_name
        self.band_a_fetaure_name = band_a.split(&#x27;/&#x27;)[0]
        self.band_b_fetaure_name = band_b.split(&#x27;/&#x27;)[0]
        self.band_a_fetaure_idx = int(band_a.split(&#x27;/&#x27;)[-1])
        self.band_b_fetaure_idx = int(band_b.split(&#x27;/&#x27;)[-1])
        
    def execute(self, eopatch):
        band_a = eopatch.data[self.band_a_fetaure_name][..., self.band_a_fetaure_idx]
        band_b = eopatch.data[self.band_b_fetaure_name][..., self.band_b_fetaure_idx]
        
        ndi = (band_a - band_b) / (band_a  + band_b)
        
        eopatch.add_feature(FeatureType.DATA, self.feature_name, ndi[..., np.newaxis])
        
        return eopatch

    
class EuclideanNorm(EOTask):   
    &quot;&quot;&quot;
    The tasks calculates Euclidian Norm of all bands within an array:
    norm = sqrt(sum_i Bi**2),
    where Bi are the individual bands within user-specified feature array.
    &quot;&quot;&quot;
    def __init__(self, feature_name, in_feature_name):
        self.feature_name = feature_name
        self.in_feature_name = in_feature_name
    
    def execute(self, eopatch):
        arr = eopatch.data[self.in_feature_name]
        norm = np.sqrt(np.sum(arr**2, axis=-1))
        
        eopatch.add_feature(FeatureType.DATA, self.feature_name, norm[..., np.newaxis])
        return eopatch</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="FFWjvSPcuVLVkgM7a5s-8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="HTuAr6uBpW" class="relative group/block"><h4 id="define-the-workflow-tasks" class="relative group"><span class="heading-text">Define the workflow tasks</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-workflow-tasks" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="WHCeCI6Slb" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># TASK FOR BAND DATA
# add a request for B(B02), G(B03), R(B04), NIR (B08), SWIR1(B11), SWIR2(B12) 
# from default layer &#x27;ALL_BANDS&#x27; at 10m resolution
# Here we also do a simple filter of cloudy scenes. A detailed cloud cover 
# detection is performed in the next step
custom_script = &#x27;return [B02, B03, B04, B08, B11, B12];&#x27;
add_data = S2L1CWCSInput(
    layer=&#x27;BANDS-S2-L1C&#x27;, 
    feature=(FeatureType.DATA, &#x27;BANDS&#x27;), # save under name &#x27;BANDS&#x27;
    custom_url_params={CustomUrlParam.EVALSCRIPT: custom_script}, # custom url for 6 specific bands
    resx=&#x27;10m&#x27;, # resolution x
    resy=&#x27;10m&#x27;, # resolution y
    maxcc=selected_max_cc # maximum allowed cloud cover of original ESA tiles
)

# TASK FOR CLOUD INFO
# cloud detection is performed at 80m resolution 
# and the resulting cloud probability map and mask 
# are scaled to EOPatch&#x27;s resolution
cloud_classifier = get_s2_pixel_cloud_detector(average_over=2, dilation_size=1, all_bands=False)
add_clm = AddCloudMaskTask(cloud_classifier, &#x27;BANDS-S2CLOUDLESS&#x27;, cm_size_y=&#x27;80m&#x27;, cm_size_x=&#x27;80m&#x27;, 
                           cmask_feature=&#x27;CLM&#x27;, # cloud mask name
                           cprobs_feature=&#x27;CLP&#x27; # cloud prob. map name
                          )

# TASKS FOR CALCULATING NEW FEATURES
# NDVI: (B08 - B04)/(B08 + B04)
# NDWI: (B03 - B08)/(B03 + B08)
# NORM: sqrt(B02^2 + B03^2 + B04^2 + B08^2 + B11^2 + B12^2)
ndvi = NormalizedDifferenceIndex(&#x27;NDVI&#x27;, &#x27;BANDS/3&#x27;, &#x27;BANDS/2&#x27;)
ndwi = NormalizedDifferenceIndex(&#x27;NDWI&#x27;, &#x27;BANDS/1&#x27;, &#x27;BANDS/3&#x27;)
norm = EuclideanNorm(&#x27;NORM&#x27;,&#x27;BANDS&#x27;)

# TASK FOR VALID MASK
# validate pixels using SentinelHub&#x27;s cloud detection mask and region of acquisition 
add_sh_valmask = AddValidDataMaskTask(SentinelHubValidData(), 
                                      &#x27;IS_VALID&#x27; # name of output mask
                                     )

# TASK FOR COUNTING VALID PIXELS
# count number of valid observations per pixel using valid data mask 
count_val_sh = CountValid(&#x27;IS_VALID&#x27;, # name of existing mask
                          &#x27;VALID_COUNT&#x27; # name of output scalar
                         )

# TASK FOR SAVING TO OUTPUT (if needed)
path_out = &#x27;./eopatches_small/&#x27; if use_smaller_patches else &#x27;./eopatches_large/&#x27;
if not os.path.isdir(path_out):
    os.makedirs(path_out)
save = SaveTask(path_out, overwrite_permission=OverwritePermission.OVERWRITE_PATCH)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="-eh2dSj4gkw3DlpJj0OVz" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="ZgMNUNfbsj" class="relative group/block"><h4 id="reference-map-task" class="relative group"><span class="heading-text">Reference map task</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#reference-map-task" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>For this example, a subset of the country-wide reference for land-use-land-cover is provided. It is available in the form of a shapefile, which contains polygons and their corresponding labels. The labels represent the 10 classes from the lulcMapping.</p><p>The main point of this task is to create a raster mask from the vector polygons and add it to the eopatch. With this procedure, any kind of a labeled shapefile can be transformed into a raster reference map. This result is achieved with the existing task <code>VectorToRaster</code> from the <code>eolearn.geometry</code> package. All polygons belonging to the each of the classes are separately burned to the raster mask.</p></div><div id="KpNbaKqjUb" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class LoadFromDatabaseTask(EOTask):
    def __init__(self, feature, taskName, crs, tableName, landUseColumneName, 
        dateFilterMin, dateFilterMax, mappedColumnName = None, mappingLambdaFunc = None):
        
        self.feature_type, self.feature_name = next(self._parse_features(feature)())
        self.taskName = taskName
        self.crs = crs
        self.tableName = tableName
        self.landUseColumneName = landUseColumneName
        self.dateFilterMin = dateFilterMin
        self.dateFilterMax = dateFilterMax
        self.mappedColumnName = mappedColumnName
        self.mappingLambdaFunc = mappingLambdaFunc

    def execute(self, eopatch, geodb):
        eopatch[self.feature_type][self.feature_name] = loadFromDatabase(geodb, 
            self.taskName, self.tableName, self.landUseColumneName, None, eopatch.bbox, eopatch.bbox.crs,
            self.dateFilterMin, self.dateFilterMax, None, True,
            self.mappedColumnName, self.mappingLambdaFunc)
        return eopatch
    

# LPIS
load_lpis_db_task = LoadFromDatabaseTask((FeatureType.VECTOR_TIMELESS, &#x27;LPIS_GDF&#x27;), 
    &quot;LPIS&quot;, country_crs, db_lpis_table, db_lpis_class_column, selected_db_land_use_date, selected_db_land_use_date)

lpis_rasterization_task = VectorToRaster((FeatureType.VECTOR_TIMELESS, &#x27;LPIS_GDF&#x27;), (FeatureType.MASK_TIMELESS, &#x27;LPIS&#x27;),
    values_column=&#x27;land_use&#x27;, raster_shape=None, raster_resolution = 10,
    raster_dtype=np.uint16)

lpis_export_tiff = ExportToTiff((FeatureType.MASK_TIMELESS, &#x27;LPIS&#x27;))


# Land use
load_land_use_db_task = LoadFromDatabaseTask((FeatureType.VECTOR_TIMELESS, &#x27;LAND_USE_GDF&#x27;), 
    &quot;Land use&quot;, country_crs, db_land_use_table, db_land_use_class_column, selected_db_land_use_date, selected_db_land_use_date, 
    &quot;lulcid&quot;, lambda lulc: landUseToLulcMapping[lulc] if lulc in landUseToLulcMapping else 0)

land_use_rasterization_task = VectorToRaster((FeatureType.VECTOR_TIMELESS, &#x27;LAND_USE_GDF&#x27;), (FeatureType.MASK_TIMELESS, &#x27;LAND_USE&#x27;),
    values_column=&#x27;land_use&#x27;, raster_shape=None, raster_resolution = 10,
    raster_dtype=np.uint16)

land_use_export_tiff = ExportToTiff((FeatureType.MASK_TIMELESS, &#x27;LAND_USE&#x27;))


# LULC, uses the previously loaded LAND_USE_GDF
lulc_rasterization_task = VectorToRaster((FeatureType.VECTOR_TIMELESS, &#x27;LAND_USE_GDF&#x27;), (FeatureType.MASK_TIMELESS, &#x27;LULC&#x27;),
    values_column=&#x27;lulcid&#x27;, raster_shape=(FeatureType.MASK, &#x27;IS_VALID&#x27;),
    raster_dtype=np.uint8)
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WnQyJ8VRJMTXkHlRx-v_3" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="SIIXiYoK9J" class="relative group/block"><h4 id="define-the-workflow" class="relative group"><span class="heading-text">Define the workflow</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-the-workflow" title="Link to this Section" aria-label="Link to this Section">¶</a></h4><p>All the tasks that were defined so far create and fill the EOPatches. The tasks need to be put in some order and executed one by one. This can be achieved by manually executing the tasks, or more conveniently, defining an <code>EOWorkflow</code> which does this for you.</p><p>The following workflow is created and executed:</p><ol start="1"><li>Create EOPatches with band data</li><li>Add cloud info</li><li>Calculate and add NDVI, NDWI, NORM</li><li>Add mask of valid pixels</li><li>Add scalar feature representing the cound of valid pixels</li><li>Save eopatches</li></ol><p>An EOWorkflow can be linear or more complex, but it should be acyclic. Here we will use the linear case of the EOWorkflow, available as <code>LinearWorkflow</code></p></div><div id="qxPLhV3UD4" class="relative group/block"><p>Define the workflow</p></div><div id="e1R7NaR0jD" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define the workflow
workflow = LinearWorkflow(
    add_data,
    add_clm,
    ndvi,
    ndwi,
    norm,
    add_sh_valmask,
    count_val_sh,
    load_lpis_db_task,
    lpis_rasterization_task,
    lpis_export_tiff,
    load_land_use_db_task,
    land_use_rasterization_task,
    land_use_export_tiff,
    lulc_rasterization_task,
    save
)

# Let&#x27;s visualize it
workflow.dependency_graph()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="REtLoqoWh9JD7LjzYWBWR" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="LlzzxTRdky" class="relative group/block"><p><em>This may take some time, so go grab a cup of coffee ...</em></p></div><div id="FDbo3FZh8H" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time

# Execute the workflow

source_tiff_location = &#x27;./source_tiff&#x27;
if not os.path.isdir(source_tiff_location):
    os.makedirs(source_tiff_location)

# define additional parameters of the workflow
geodb = GeoDBClient()
execution_args = []
for idx, bbox in enumerate(bbox_list[patchIDs]):
    execution_args.append({
        add_data: {&#x27;bbox&#x27;: bbox, &#x27;time_interval&#x27;: selected_date_interval_for_satellite_imagery},
        load_land_use_db_task: {&#x27;geodb&#x27;: geodb},
        load_lpis_db_task: {&#x27;geodb&#x27;: geodb},
        lpis_export_tiff: {&#x27;filename&#x27;: &#x27;{}/lpis_eopatch_{}_original.tiff&#x27;.format(source_tiff_location, idx)},
        land_use_export_tiff: {&#x27;filename&#x27;: &#x27;{}/land_use_eopatch_{}_original.tiff&#x27;.format(source_tiff_location, idx)},
        save: {&#x27;eopatch_folder&#x27;: &#x27;eopatch_{}&#x27;.format(idx)}
    })
    
globalLogger.setLevel(logging.CRITICAL)

executor = EOExecutor(workflow, execution_args, save_logs=True)
executor.run(workers=1, multiprocess=False)

executor.make_report()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Jvsk08CU8xjorgTAx-mY9" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="DPfNkYWNDk" class="relative group/block"><p>In this case, all patches come from a small region, so all of them have the same dates of acquisition for at least a few dates, so we can inspect the area without interpolation at this point.</p></div><div id="s2hY14zPNt" class="relative group/block"><h3 id="visualize-the-true-color-image" class="relative group"><span class="heading-text">Visualize the true color image</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visualize-the-true-color-image" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="cjmczLQ2tA" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">selected_timestamp = datetime.datetime.strptime(&#x27;2019-05-01&#x27;, &quot;%Y-%m-%d&quot;) # or None

# Draw the RGB image
path_out = &#x27;./eopatches_small/&#x27; if use_smaller_patches else &#x27;./eopatches_large/&#x27;
fig = plt.figure(figsize=(20, 20 * aspect_ratio))

pbar = tqdm(total=9)
for i in range(9):
    eopatch = EOPatch.load(&#x27;{}/eopatch_{}&#x27;.format(path_out, i), lazy_loading=True)
    timeIndex = next(i for i, time in enumerate(eopatch.timestamp) if time.date() == selected_timestamp.date()) if not selected_timestamp is None else None
    if timeIndex is None:
        timeIndex = 0
        
    ax = plt.subplot(3, 3, i + 1)
    plt.imshow(np.clip(eopatch.data[&#x27;BANDS&#x27;][timeIndex][..., [2, 1, 0]] * 3.5, 0, 1))
    plt.xticks([])
    plt.yticks([])
    ax.set_aspect(&quot;auto&quot;)
    pbar.update(1)
    del eopatch

fig.subplots_adjust(wspace=0, hspace=0)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="NQE4P7zWwsUUC8MgHE4f8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="cEJcCtrFdp" class="relative group/block"><h3 id="visualize-the-reference-map" class="relative group"><span class="heading-text">Visualize the reference map</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visualize-the-reference-map" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="GGP49joX0P" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">path_out = &#x27;./eopatches_small/&#x27; if use_smaller_patches else &#x27;./eopatches_large/&#x27;
fig, axes = plt.subplots(figsize=(20, 20 * aspect_ratio), nrows=3, ncols=3)

cmapValues = [color for id, color in lulcColorMapping.items()]
normValues = list(lulcColorMapping.keys())
normValues.append(20)
cmap = colors.ListedColormap(cmapValues)
norm = colors.BoundaryNorm(normValues, cmap.N + 1)
    
pbar = tqdm(total=9)
for i, ax in enumerate(axes.flat):
    eopatch = EOPatch.load(&#x27;{}/eopatch_{}&#x27;.format(path_out, i), lazy_loading=True)
    im = ax.imshow(eopatch.mask_timeless[&#x27;LULC&#x27;].squeeze(), cmap=cmap, norm=norm)
    ax.set_xticks([])
    ax.set_yticks([])
    ax.set_aspect(&quot;auto&quot;)
    pbar.update(1)
    del eopatch

fig.subplots_adjust(wspace=0, hspace=0)

cb = fig.colorbar(im, ax=axes.ravel().tolist(), orientation=&#x27;horizontal&#x27;, pad=0.01, aspect=100)
cb.ax.tick_params(labelsize=20) 
cb.set_ticks([id for id in lulcMapping.keys()])
cb.ax.set_xticklabels([entry[&quot;name&quot;] for entry in lulcMapping.values()], rotation=45, fontsize=15)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="hogSNwACD0_pVmkmJuYUa" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="KVgsTh7e0c" class="relative group/block"><h3 id="prepare-the-training-data" class="relative group"><span class="heading-text">Prepare the training data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#prepare-the-training-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>We will create a new workflow that processes the data:</p><ol start="1"><li>Remove too cloudy scenes<ul><li>Check the ratio of the valid data for each patch and for each time frame</li><li>Keep only time frames with &gt; 80 % valid coverage (no clouds)</li></ul></li><li>Concatenate BAND, NDVI, NDWI, NORM info into a single feature called FEATURES</li><li>Perform temporal interpolation (filling gaps and resampling to the same dates)<ul><li>Create a task for linear interpolation in the temporal dimension</li><li>Provide the cloud mask to tell the interpolating function which values to update</li></ul></li><li>Perform erosion<ul><li>This removes artefacts with a width of 1 px, and also removes the edges between polygons of different classes</li></ul></li><li>Random spatial sampling of the EOPatches<ul><li>Randomly take a subset of pixels from a patch to use in the machine learning training</li></ul></li><li>Split patches for training/validation<ul><li>Split the patches into a training and validation set</li></ul></li></ol></div><div id="uIBA6OJS6q" class="relative group/block"><h4 id="define-eotasks" class="relative group"><span class="heading-text">Define EOTasks</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#define-eotasks" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="V2aqCTOIbW" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class ConcatenateData(EOTask):
    &quot;&quot;&quot; Task to concatenate data arrays along the last dimension
    &quot;&quot;&quot;
    def __init__(self, feature_name, feature_names_to_concatenate):
        self.feature_name = feature_name
        self.feature_names_to_concatenate = feature_names_to_concatenate

    def execute(self, eopatch):
        arrays = [eopatch.data[name] for name in self.feature_names_to_concatenate]

        eopatch.add_feature(FeatureType.DATA, self.feature_name, np.concatenate(arrays, axis=-1))

        return eopatch
    
    
class ValidDataFractionPredicate:
    &quot;&quot;&quot; Predicate that defines if a frame from EOPatch&#x27;s time-series is valid or not. Frame is valid, if the 
    valid data fraction is above the specified threshold.
    &quot;&quot;&quot;
    def __init__(self, threshold):
        self.threshold = threshold
        
    def __call__(self, array):
        coverage = np.sum(array.astype(np.uint8)) / np.prod(array.shape)
        return coverage &gt; self.threshold
    
# TASK TO LOAD EXISTING EOPATCHES
load = LoadTask(path_out)

# TASK FOR CONCATENATION
concatenate = ConcatenateData(&#x27;FEATURES&#x27;, [&#x27;BANDS&#x27;, &#x27;NDVI&#x27;, &#x27;NDWI&#x27;, &#x27;NORM&#x27;])

# TASK FOR FILTERING OUT TOO CLOUDY SCENES
# keep frames with &gt; 80 % valid coverage
valid_data_predicate = ValidDataFractionPredicate(0.8)
filter_task = SimpleFilterTask((FeatureType.MASK, &#x27;IS_VALID&#x27;), valid_data_predicate)

# TASK FOR LINEAR INTERPOLATION
# linear interpolation of full time-series and date resampling
rangeParams = selected_date_interval_for_satellite_imagery.copy()
rangeParams.append(16) # step of 16 days between key values
resampled_range = tuple(rangeParams)
linear_interp = LinearInterpolation(
    &#x27;FEATURES&#x27;, # name of field to interpolate
    mask_feature=(FeatureType.MASK, &#x27;IS_VALID&#x27;), # mask to be used in interpolation
    copy_features=[(FeatureType.MASK_TIMELESS, &#x27;LULC&#x27;)], # features to keep
    resample_range=resampled_range, # set the resampling range
    bounds_error=False # extrapolate with NaN&#x27;s
)

# TASK FOR EROSION
# erode each class of the reference map
erosion = ErosionTask(mask_feature=(FeatureType.MASK_TIMELESS,&#x27;LULC&#x27;,&#x27;LULC_ERODED&#x27;), disk_radius=1)

# TASK FOR SPATIAL SAMPLING
# Uniformly sample about pixels from patches
n_samples = int(4e4) if use_smaller_patches else int(1e5) # no. of pixels to sample
ref_labels = list(range(11)) # reference labels to take into account when sampling
spatial_sampling = PointSamplingTask(
    n_samples=n_samples, 
    ref_mask_feature=&#x27;LULC_ERODED&#x27;, 
    ref_labels=ref_labels, 
    sample_features=[  # tag fields to sample
        (FeatureType.DATA, &#x27;FEATURES&#x27;),
        (FeatureType.MASK_TIMELESS, &#x27;LULC_ERODED&#x27;)
    ])

path_out_sampled = &#x27;./eopatches_sampled_small/&#x27; if use_smaller_patches else &#x27;./eopatches_sampled_large/&#x27;
if not os.path.isdir(path_out_sampled):
    os.makedirs(path_out_sampled)
save = SaveTask(path_out_sampled, overwrite_permission=OverwritePermission.OVERWRITE_PATCH)

# Define the workflow
workflow = LinearWorkflow(
    load,
    concatenate,
    filter_task,
    linear_interp,
    erosion,
    spatial_sampling,
    save
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="8u9VlWggG2FpExtXIuYwj" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="tvbAwHSoCg" class="relative group/block"><h4 id="run-the-eoworkflow-over-all-eopatches" class="relative group"><span class="heading-text">Run the EOWorkflow over all EOPatches</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#run-the-eoworkflow-over-all-eopatches" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="jQBQtMrolE" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time
   
execution_args = []
for idx in range(len(patchIDs)):
    execution_args.append({
        load: {&#x27;eopatch_folder&#x27;: &#x27;eopatch_{}&#x27;.format(idx)},
        save: {&#x27;eopatch_folder&#x27;: &#x27;eopatch_{}&#x27;.format(idx)}
    })
    
executor = EOExecutor(workflow, execution_args, save_logs=True)

executor.run(workers=1, multiprocess=True)

executor.make_report()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="3VMQSGpEPss16wdA7VD83" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="ZeKB2m7N3K" class="relative group/block"><h3 id="model-construction-and-training" class="relative group"><span class="heading-text">Model construction and training</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#model-construction-and-training" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>The patches are split into a train and test subset, where we take the patch with ID = 1 for testing, since it seems a good representative of the area.</p><p>The test sample is hand picked because of the small set of patches, otherwise with a larged overall set, the training and testing patches should be randomly chosen.</p><p>The sampled features and labels are loaded and reshaped into <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>×</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">n \times m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6667em;vertical-align:-0.0833em;"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span></span></span></span></span>, where <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">n</span></span></span></span></span> represents the number of training pixels, and <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>m</mi><mo>=</mo><mi>f</mi><mo>×</mo><mi>t</mi></mrow><annotation encoding="application/x-tex">m = f \times t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.4306em;"></span><span class="mord mathnormal">m</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span> the number of all features (in this example 207), with <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi></mrow><annotation encoding="application/x-tex">f</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8889em;vertical-align:-0.1944em;"></span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span></span></span></span></span> the size of bands and band combinations (in this example 9) and <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi></mrow><annotation encoding="application/x-tex">t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em;"></span><span class="mord mathnormal">t</span></span></span></span></span> the length of the resampled time-series (in this example 23)</p><p><a target="_blank" rel="noreferrer" href="https://github.com/Microsoft/LightGBM" class="">LightGBM</a> is used as a ML model. It is a fast, distributed, high performance gradient boosting framework based on decision tree algorithms, used for many machine learning tasks.</p><p>The default hyper-parameters are used in this example. For more info on parameter tuning, check the <a target="_blank" rel="noreferrer" href="https://lightgbm.readthedocs.io/en/latest/Parameters-Tuning.html" class="">ReadTheDocs</a> of the package.</p></div><div id="UEtcGngir0" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># load sampled eopatches
eopatches = []
path_out_sampled = &#x27;./eopatches_sampled_small/&#x27; if use_smaller_patches else &#x27;./eopatches_sampled_large/&#x27;

for i in range(9):
    eopatches.append(EOPatch.load(&#x27;{}/eopatch_{}&#x27;.format(path_out_sampled, i), lazy_loading=True))    

eopatches = np.array(eopatches)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="GxSFWl_oOzEhNlJlziJaa" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Nz0MO1drJq" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Definition of the train and test patch IDs
train_ID = [0,2,3,4,5,6,7,8] if use_smaller_patches else [0,1,3,4,5,6,7,8]
test_ID = [1] if use_smaller_patches else [2]

# Set the features and the labels for train and test sets
features_train = np.array([eopatch.data[&#x27;FEATURES_SAMPLED&#x27;] for eopatch in eopatches[train_ID]])
labels_train = np.array([eopatch.mask_timeless[&#x27;LULC_ERODED_SAMPLED&#x27;] for eopatch in eopatches[train_ID]])
features_test = np.array([eopatch.data[&#x27;FEATURES_SAMPLED&#x27;] for eopatch in eopatches[test_ID]])
labels_test = np.array([eopatch.mask_timeless[&#x27;LULC_ERODED_SAMPLED&#x27;] for eopatch in eopatches[test_ID]])

# get shape
p1, t, w, h, f = features_train.shape
p2, t, w, h, f = features_test.shape
p = p1 + p2

# reshape to n x m
features_train = np.moveaxis(features_train, 1, 3).reshape(p1 * w * h, t * f)
labels_train = np.moveaxis(labels_train, 1, 2).reshape(p1 * w * h, 1).squeeze()
features_test = np.moveaxis(features_test, 1, 3).reshape(p2 * w * h, t * f)
labels_test = np.moveaxis(labels_test, 1, 2).reshape(p2 * w * h, 1).squeeze()

# remove points with no reference from training (so we dont train to recognize &quot;no data&quot;)
mask_train = labels_train == 0
features_train = features_train[~mask_train]
labels_train = labels_train[~mask_train]

# remove points with no reference from test (so we dont validate on &quot;no data&quot;, which doesn&#x27;t make sense)
mask_test = labels_test == 0
features_test = features_test[~mask_test]
labels_test = labels_test[~mask_test]</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="HpfA71LmF5qJLVwX5ePFE" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Vlt7v0Y2f4" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">%%time

# Set up training classes
labels_unique = np.unique(labels_train)

# Set up the model
model = lgb.LGBMClassifier(
    objective=&#x27;multiclass&#x27;, 
    num_class=len(labels_unique), 
    metric=&#x27;multi_logloss&#x27;
)

# train the model
model.fit(features_train, labels_train)

# uncomment to save the model
model_base_name = &#x27;model_SI_LULC_smaller&#x27; if use_smaller_patches else &#x27;model_SI_LULC_larger&#x27;
joblib.dump(model, &#x27;./{}.pkl&#x27;.format(model_base_name))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="C_HgPjazwoztG7I_FCZb7" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Wall time: 48.2 s
</span></code></pre></div><div class="font-mono text-sm whitespace-pre-wrap"><code><span>[&#x27;./model_SI_LULC_smaller.pkl&#x27;]</span></code></div></div></div><div id="aPVeKsqRvF" class="relative group/block"><h3 id="validation" class="relative group"><span class="heading-text">Validation</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#validation" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="vgIkXPcO0S" class="relative group/block"><p>Validation of the model is a crucial step in data science. All models are wrong, but some are less wrong than others, so model evaluation is important.</p><p>In order to validate the model, we use the training set to predict the classes, and then compare the predicted set of labels to the “ground truth”.</p><p>Unfortunately, ground truth in the scope of EO is a term that should be taken lightly. Usually, it is not 100 % reliable due to several reasons:</p><ul><li>Labels are determined at specific time, but land use can change (<em>what was once a field, may now be a house</em>)</li><li>Labels are overly generalized (<em>a city is an artificial surface, but it also contains parks, forests etc.</em>)</li><li>Some classes can have an overlap or similar definitions (<em>part of a continuum, and not discrete distributions</em>)</li><li>Human error (<em>mistakes made when producing the reference map</em>)</li></ul><p>The validation is performed by evaluating various metrics, such as accuracy, precision, recall, <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">F_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> score, some of which are nicely described <a target="_blank" rel="noreferrer" href="https://medium.com/greyatom/performance-metrics-for-classification-problems-in-machine-learning-part-i-b085d432082b" class="">in this blog post</a></p></div><div id="PR8uvcPPBh" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># uncomment to load the model and replace with your file, usually just correct the date
model_path = &#x27;./model_SI_LULC_smaller.pkl&#x27; if use_smaller_patches else &#x27;./model_SI_LULC_larger.pkl&#x27;
model = joblib.load(model_path)

# predict the test labels
plabels_test = model.predict(features_test)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="9F5HXCumW_zWz-rbNNWCd" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="bF7lm5bjpQ" class="relative group/block"><p>Get the overall accuracy (OA) and the weighted <span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">F_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> score</p></div><div id="Z4mgYLzOfm" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">print(&#x27;Classification accuracy {:.1f}%&#x27;.format(100 * metrics.accuracy_score(labels_test, plabels_test)))
print(&#x27;Classification F1-score {:.1f}%&#x27;.format(100 * metrics.f1_score(labels_test, plabels_test, average=&#x27;weighted&#x27;)))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="2bt-RL7MBcEuuJJqxiBZF" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>Classification accuracy 93.4%
Classification F1-score 93.2%
</span></code></pre></div></div></div><div id="bEnkbKGUy4" class="relative group/block"><p><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">F_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3011em;"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span> score, precision, and recall for each class separately</p></div><div id="FIukyeQHDU" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class_labels_test = set(np.unique(labels_test))
class_labels_train = set(np.unique(labels_train))
class_labels = list(class_labels_test.union(class_labels_train))
class_names = [entry[&quot;name&quot;] for entry in lulcMapping.values()]

f1_scores = metrics.f1_score(labels_test, plabels_test, labels=class_labels, average=None)
recall = metrics.recall_score(labels_test, plabels_test, labels=class_labels, average=None)
precision = metrics.precision_score(labels_test, plabels_test, labels=class_labels, average=None) 

print(&#x27;             Class              =  F1  | Recall | Precision&#x27;)
print(&#x27;         --------------------------------------------------&#x27;)
for idx, lulctype in enumerate([class_names[idx] for idx in class_labels]):
    print(&#x27;         * {0:20s} = {1:2.1f} |  {2:2.1f}  | {3:2.1f}&#x27;.format(lulctype, 
                                                                         f1_scores[idx] * 100, 
                                                                         recall[idx] * 100, 
                                                                         precision[idx] * 100))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="gTNKjtVTa3Kcub-0T0qdj" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>             Class              =  F1  | Recall | Precision
         --------------------------------------------------
         * Cultivated Land      = 93.9 |  93.5  | 94.3
         * Forest               = 98.0 |  98.7  | 97.4
         * Grassland            = 80.3 |  80.9  | 79.8
         * Shrubland            = 37.5 |  34.0  | 41.7
         * Water                = 50.0 |  100.0  | 33.3
         * Artificial Surface   = 89.6 |  85.2  | 94.6
</span></code></pre></div></div></div><div id="OzCG92Fp04" class="relative group/block"><h3 id="plot-the-standard-and-transposed-confusion-matrix" class="relative group"><span class="heading-text">Plot the standard and transposed Confusion Matrix</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-the-standard-and-transposed-confusion-matrix" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="O87aehDJvY" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Define the plotting function
def plot_confusion_matrix(cm, classes,
                          normalize=False,
                          title=&#x27;Confusion matrix&#x27;,
                          cmap=plt.cm.Blues, ylabel=&#x27;True label&#x27;, xlabel=&#x27;Predicted label&#x27;, filename=None):
    &quot;&quot;&quot;
    This function prints and plots the confusion matrix.
    Normalization can be applied by setting `normalize=True`.
    &quot;&quot;&quot;
    np.set_printoptions(precision=2, suppress=True)
    
    if normalize:
        cm = cm.astype(&#x27;float&#x27;) / (cm.sum(axis=1)[:, np.newaxis] + np.finfo(np.float).eps)
    
    plt.imshow(cm, interpolation=&#x27;nearest&#x27;, cmap=cmap, vmin=0, vmax=1)
    plt.title(title, fontsize=20)
    # plt.colorbar()
    tick_marks = np.arange(len(classes)+1)-0.5
    plt.xticks(tick_marks, classes, rotation=45, fontsize=20)
    plt.yticks(tick_marks, classes, fontsize=20)
    
    fmt = &#x27;.2f&#x27; if normalize else &#x27;d&#x27;
    thresh = cm.max() / 2.
    for i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])):
        plt.text(j, i, format(cm[i, j], fmt),
                 horizontalalignment=&quot;center&quot;,
                 color=&quot;white&quot; if cm[i, j] &gt; thresh else &quot;black&quot;,
                 fontsize=12)

    plt.tight_layout()
    plt.ylabel(ylabel, fontsize=20)
    plt.xlabel(xlabel, fontsize=20)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="J-7HceY5UYTcQi4nijimt" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="nS4FWLefD6" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(20, 20))

plt.subplot(1, 2, 1)
conf_matrix_gbm = metrics.confusion_matrix(labels_test, plabels_test)
plot_confusion_matrix(conf_matrix_gbm, 
                      classes=[name for idx, name in enumerate(class_names) if idx in class_labels], 
                      normalize=True, 
                      ylabel=&#x27;Truth (LAND COVER)&#x27;, 
                      xlabel=&#x27;Predicted (GBM)&#x27;,
                      title=&#x27;Confusion matrix&#x27;);

plt.subplot(1, 2, 2)
conf_matrix_gbm = metrics.confusion_matrix(plabels_test, labels_test)
plot_confusion_matrix(conf_matrix_gbm, 
                      classes=[name for idx, name in enumerate(class_names) if idx in class_labels], 
                      normalize=True, 
                      xlabel=&#x27;Truth (LAND COVER)&#x27;, 
                      ylabel=&#x27;Predicted (GBM)&#x27;,
                      title=&#x27;Transposed Confusion matrix&#x27;);

plt.tight_layout()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="gc1m_4I63fH7t9-EBBqrg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/c9351b035419f5ee5c21435f73666d36.png" alt="&lt;Figure size 1440x1440 with 2 Axes&gt;"/></div></div><div id="X99bP776lF" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">fig = plt.figure(figsize=(20, 5))

label_ids, label_counts = np.unique(labels_train, return_counts=True)

plt.bar(range(len(label_ids)), label_counts/100)
plt.xticks(range(len(label_ids)), [class_names[i] for i in label_ids], rotation=45, fontsize=20);
plt.yticks(fontsize=20);
plt.ylabel(&quot;Area [ha] &quot;, size=18)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="K9eqm-AG_hY7VD9rzenCn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/183822a8cd276cadf57b72b62a893737.png" alt="&lt;Figure size 1440x360 with 1 Axes&gt;"/></div></div><div id="AGD5dtH6CW" class="relative group/block"><h3 id="predict-lulc" class="relative group"><span class="heading-text">Predict LULC</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#predict-lulc" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="EE4GXSpUVQ" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class PredictPatch(EOTask):
    &quot;&quot;&quot;
    Task to make model predictions on a patch. Provide the model and the feature, 
    and the output names of labels and scores (optional)
    &quot;&quot;&quot;
    def __init__(self, model, features_feature, predicted_labels_name, predicted_scores_name=None):
        self.model = model
        self.features_feature = features_feature
        self.predicted_labels_name = predicted_labels_name
        self.predicted_scores_name = predicted_scores_name
        
    def execute(self, eopatch):
        ftrs = eopatch[self.features_feature[0]][self.features_feature[1]]
        
        t, w, h, f = ftrs.shape
        ftrs = np.moveaxis(ftrs, 0, 2).reshape(w * h, t * f)
        
        plabels = self.model.predict(ftrs)
        plabels = plabels.reshape(w, h)
        plabels = plabels[..., np.newaxis]
        eopatch.add_feature(FeatureType.MASK_TIMELESS, self.predicted_labels_name, plabels)
        
        if self.predicted_scores_name:
            pscores = self.model.predict_proba(ftrs)
            _, d = pscores.shape
            pscores = pscores.reshape(w, h, d)
            eopatch.add_feature(FeatureType.DATA_TIMELESS, self.predicted_scores_name, pscores)
        
        return eopatch</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="iugWeiOjRA5OasCnKSSN2" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Ar3wx53T7T" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class ConvertToCOGTiff(EOTask):
    def execute(self, eopatch, src_filename, dest_filename):
        subprocess.run(&quot;gdaladdo -r average --config GDAL_TIFF_OVR_BLOCKSIZE 1024 &quot; + src_filename + &quot; 2 4 8 16 32&quot;, shell=True, check=True)
        subprocess.run(&quot;gdal_translate -co TILED=YES -co COPY_SRC_OVERVIEWS=YES -co BLOCKXSIZE=1024 -co BLOCKYSIZE=1024 -co COMPRESS=DEFLATE --config GDAL_TIFF_OVR_BLOCKSIZE 1024 &quot; + src_filename + &quot; &quot; + dest_filename, shell=True, check=True)
        return eopatch
</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="fFbwW6AHZiDa5mLSJUqhk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="LrAsKd2Z1z" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class UploadAmazonS3File(EOTask):
    def __init__(self, bucket, s3_client = None, aws_access_key_id = None, aws_secret_access_key = None):
        if not s3_client is None:
            self.s3_client = s3_client
        elif not aws_access_key_id is None and not aws_secret_access_key is None:
            self.s3_client = UploadAmazonS3File.createClient(aws_access_key_id, aws_secret_access_key)
        else:
            raise ValueError(&quot;Either s3_client must be defined, or both aws_access_key_id and aws_secret_access_key&quot;)
        self.bucket = bucket
    
    def execute(self, eopatch, src_filename, dest_filename):
        with open(src_filename, &quot;rb&quot;) as f:
            self.s3_client.upload_fileobj(f, self.bucket, dest_filename)
        return eopatch
    
    def createClient(aws_access_key_id, aws_secret_access_key):
        return boto3.client(&#x27;s3&#x27;,
            aws_access_key_id = aws_access_key_id, aws_secret_access_key = aws_secret_access_key)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WvjA-VAmRuNpFObMXigPr" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="OdyOczYHFW" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">class CreateSHCollectionFromS3(EOTask):
    def __init__(self, sh_oauth_session, s3_bucket, collection_id):
        self.sh_client = SentinelHubClient(sh_oauth_session, s3_bucket)
        self.s3_bucket = s3_bucket
        self.collection_id = collection_id
        
    def execute(self, eopatch, s3_file_path):
        tile_id = self.sh_client.getTileByPath(self.collection_id, s3_file_path)
        if not tile_id is None:
            self.sh_client.deleteTile(self.collection_id, tile_id)
        
        self.sh_client.ingestTile(self.collection_id, s3_file_path, eopatch.bbox)
        
        return eopatch</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Ywpf66RO1lH2w4kKDeWU_" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="B2eMdYYtVg" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># TASK TO LOAD EXISTING EOPATCHES
load = LoadTask(path_out_sampled)

# TASK FOR PREDICTION
predict = PredictPatch(model, (FeatureType.DATA, &#x27;FEATURES&#x27;), &#x27;LBL_GBM&#x27;, &#x27;SCR_GBM&#x27;)

# TASK FOR SAVING
save = SaveTask(str(path_out_sampled), overwrite_permission=OverwritePermission.OVERWRITE_PATCH)

# TASK TO EXPORT TIFF
export_tiff = ExportToTiff((FeatureType.MASK_TIMELESS, &#x27;LBL_GBM&#x27;))

# Convert generated TIFF to COG
convert_prediction_to_cog_tiff = ConvertToCOGTiff()
convert_land_use_to_cog_tiff = ConvertToCOGTiff()
convert_lpis_to_cog_tiff = ConvertToCOGTiff()

# Upload to Amazon S3
s3_upload_prediction = UploadAmazonS3File(aws_s3_bucket, None, aws_access_key_id, aws_secret_access_key)
s3_upload_land_use = UploadAmazonS3File(aws_s3_bucket, None, aws_access_key_id, aws_secret_access_key)
s3_upload_lpis = UploadAmazonS3File(aws_s3_bucket, None, aws_access_key_id, aws_secret_access_key)


# Ingest in SentinelHub
sh_oauth_session = OAuth2Session(client = BackendApplicationClient(client_id = sentinelhub_client_id))
sh_oauth_token = sh_oauth_session.fetch_token(token_url = sentinelhub_url + &#x27;/oauth/token&#x27;,
    client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)

sh_client = SentinelHubClient(sh_oauth_session, aws_s3_bucket)

sentinelhub_collection_id = sh_client.getCollectionByName(sentinelhub_collection_name)
if sentinelhub_collection_id is None:
    sentinelhub_collection_id = sh_client.createCollection(sentinelhub_collection_name)

print(&quot;SH collection ID:&quot;, sentinelhub_collection_id)

sh_create_collection = CreateSHCollectionFromS3(sh_oauth_session, aws_s3_bucket, sentinelhub_collection_id)


workflow = LinearWorkflow(
    load,
    predict,
    export_tiff,
    convert_prediction_to_cog_tiff,
    convert_land_use_to_cog_tiff,
    convert_lpis_to_cog_tiff,
    s3_upload_prediction,
    s3_upload_land_use,
    s3_upload_lpis,
    sh_create_collection,
    save
)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="5zY25EqJZmnLdXXQEMRSn" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>SH collection ID: dd4c4949-02ef-41b1-8548-1058ba132544
</span></code></pre></div></div></div><div id="AatuUzh5iS" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">predicted_tiff_location = &#x27;./predicted_tiff&#x27;
if not os.path.isdir(predicted_tiff_location):
    os.makedirs(predicted_tiff_location)
    
source_tiff_location = &#x27;./source_tiff&#x27;

# create a list of execution arguments for each patch
execution_args = []
for i in range(len(patchIDs)):
    bbox = bbox_list[i]
    eopath_subfolder_name = &quot;{0:.0f}_{1:.0f}_{2:.0f}_{3:.0f}__epsg{crs}&quot;.format(
        bbox.min_x, bbox.min_y, bbox.max_x, bbox.max_y, crs = bbox.crs.value)
    
    execution_args.append(
        {
            load: {&#x27;eopatch_folder&#x27;: &#x27;eopatch_{}&#x27;.format(i)},
            export_tiff: {&#x27;filename&#x27;: &#x27;{}/prediction_eopatch_{}_original.tiff&#x27;.format(predicted_tiff_location, i)},
            convert_prediction_to_cog_tiff: {&#x27;src_filename&#x27;: &#x27;{}/prediction_eopatch_{}_original.tiff&#x27;.format(predicted_tiff_location, i), 
                &#x27;dest_filename&#x27;: &#x27;{}/prediction_eopatch_{}.tiff&#x27;.format(predicted_tiff_location, i)},
            convert_land_use_to_cog_tiff: {&#x27;src_filename&#x27;: &#x27;{}/land_use_eopatch_{}_original.tiff&#x27;.format(source_tiff_location, i),
                &#x27;dest_filename&#x27;: &#x27;{}/land_use_eopatch_{}.tiff&#x27;.format(source_tiff_location, i)},
            convert_lpis_to_cog_tiff: {&#x27;src_filename&#x27;: &#x27;{}/lpis_eopatch_{}_original.tiff&#x27;.format(source_tiff_location, i),
                &#x27;dest_filename&#x27;: &#x27;{}/lpis_eopatch_{}.tiff&#x27;.format(source_tiff_location, i)},
            s3_upload_prediction: {&#x27;src_filename&#x27;: &#x27;{}/prediction_eopatch_{}.tiff&#x27;.format(predicted_tiff_location, i), 
                &#x27;dest_filename&#x27;: aws_s3_path.format(eopath_subfolder_name, value_name = &quot;prediction&quot;)},
            s3_upload_land_use: {&#x27;src_filename&#x27;: &#x27;{}/land_use_eopatch_{}.tiff&#x27;.format(source_tiff_location, i), 
                &#x27;dest_filename&#x27;: aws_s3_path.format(eopath_subfolder_name, value_name = &quot;land_use&quot;)},
            s3_upload_lpis: {&#x27;src_filename&#x27;: &#x27;{}/lpis_eopatch_{}.tiff&#x27;.format(source_tiff_location, i), 
                &#x27;dest_filename&#x27;: aws_s3_path.format(eopath_subfolder_name, value_name = &quot;lpis&quot;)},
            sh_create_collection: {&#x27;s3_file_path&#x27;: aws_s3_path.format(eopath_subfolder_name, value_name = &quot;(BAND)&quot;)},
            save: {&#x27;eopatch_folder&#x27;: &#x27;eopatch_{}&#x27;.format(i)}
        }
    )

# run the executor on 2 cores
executor = EOExecutor(workflow, execution_args)

# uncomment below save the logs in the current directory and produce a report!
#executor = EOExecutor(workflow, execution_args, save_logs=True)

executor.run(workers=2, multiprocess=False)
executor.make_report()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="aDeMyJUttA53zrgjGN3G6" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="ZCIBpxKyDb" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># %%time
# merge with gdal_merge.py (with compression) using bash command magic
#!gdal_merge.py -o predicted_tiff/merged_prediction.tiff -co compress=LZW predicted_tiff/prediction_eopatch_*</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="g05so7yojdASUoc0VNYSI" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="TWzzzyExDz" class="relative group/block"><h2 id="part-3-visualize-the-prediction" class="relative group"><span class="heading-text">Part 3: Visualize the prediction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#part-3-visualize-the-prediction" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="YlXIp7wynv" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">path_out_sampled = &#x27;./eopatches_sampled_small/&#x27; if use_smaller_patches else &#x27;./eopatches_sampled_large/&#x27;

fig, axes = plt.subplots(figsize=(20, 20 * aspect_ratio), nrows=3, ncols=3)

cmapValues = [color for id, color in lulcColorMapping.items()]
normValues = list(lulcColorMapping.keys())
normValues.append(20)
cmap = colors.ListedColormap(cmapValues)
norm = colors.BoundaryNorm(normValues, cmap.N + 1)

pbar = tqdm(total=9)
for i, ax in enumerate(axes.flat):
    eopatch = EOPatch.load(&#x27;{}/eopatch_{}&#x27;.format(path_out_sampled, i), lazy_loading=True)
    im = ax.imshow(eopatch.mask_timeless[&#x27;LBL_GBM&#x27;].squeeze(), cmap=cmap, norm=norm)
    ax.set_xticks([])
    ax.set_yticks([])
    ax.set_aspect(&quot;auto&quot;)
    pbar.update(1)

fig.subplots_adjust(wspace=0, hspace=0)

cb = fig.colorbar(im, ax=axes.ravel().tolist(), orientation=&#x27;horizontal&#x27;, pad=0.01, aspect=100)
cb.ax.tick_params(labelsize=20) 
cb.set_ticks([id for id in lulcMapping.keys()])
cb.ax.set_xticklabels([entry[&quot;name&quot;] for entry in lulcMapping.values()], rotation=45, fontsize=15)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="k9Mn7zkgTfZHO_jaCRwOR" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="fc36jjCxEz" class="relative group/block"><h3 id="visual-inspection-of-patches" class="relative group"><span class="heading-text">Visual inspection of patches</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visual-inspection-of-patches" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Here is just a simple piece of code that allows a closer inspection of the predicted labels.</p><p>Random subsets of patches are chosen, where prediction and ground truth are compared. For visual aid the mask of differences and the true color image are also provided.</p><p>In majority of the cases, differences seem to lie on the border of different structures.</p></div><div id="AHAAxYRZEm" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Draw the Reference map

fig = plt.figure(figsize=(20, 20))

idx = np.random.choice(range(9))
inspect_size = 100

eopatch = EOPatch.load(&#x27;{}/eopatch_{}&#x27;.format(path_out_sampled, idx), lazy_loading=True)

w, h = eopatch.mask_timeless[&#x27;LULC&#x27;].squeeze().shape

w_min = np.random.choice(range(w - inspect_size))
h_min = np.random.choice(range(h - inspect_size))

cmap = colors.ListedColormap([color for id, color in lulcColorMapping.items()])
norm = colors.BoundaryNorm(range(cmap.N), cmap.N)

ax = plt.subplot(2, 2, 1)
plt.imshow(eopatch.mask_timeless[&#x27;LULC&#x27;].squeeze()[w_min: w_min + inspect_size, h_min : h_min + inspect_size], cmap=cmap, norm=norm)
plt.xticks([])
plt.yticks([])
ax.set_aspect(&quot;auto&quot;)
plt.title(&#x27;Ground Truth&#x27;, fontsize=20)

ax = plt.subplot(2, 2, 2)
plt.imshow(eopatch.mask_timeless[&#x27;LBL_GBM&#x27;].squeeze()[w_min: w_min + inspect_size, h_min: h_min + inspect_size], cmap=cmap, norm=norm)
plt.xticks([])
plt.yticks([])
ax.set_aspect(&quot;auto&quot;)
plt.title(&#x27;Prediction&#x27;, fontsize=20)

ax = plt.subplot(2, 2, 3)
mask = eopatch.mask_timeless[&#x27;LBL_GBM&#x27;].squeeze() != eopatch.mask_timeless[&#x27;LULC&#x27;].squeeze()
plt.imshow(mask[w_min: w_min + inspect_size, h_min: h_min + inspect_size], cmap=&#x27;gray&#x27;)
plt.xticks([])
plt.yticks([]);
ax.set_aspect(&quot;auto&quot;)
plt.title(&#x27;Difference&#x27;, fontsize=20)

ax = plt.subplot(2, 2, 4)
image = np.clip(eopatch.data[&#x27;FEATURES&#x27;][8][..., [2, 1, 0]] * 3.5, 0, 1)
plt.imshow(image[w_min: w_min + inspect_size, h_min: h_min + inspect_size])
plt.xticks([])
plt.yticks([]);
ax.set_aspect(&quot;auto&quot;)
plt.title(&#x27;True Color&#x27;, fontsize=20)

fig.subplots_adjust(wspace=0.1, hspace=0.1)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="C_aqADuuotDeR-QR6wHgx" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/0ebbad16a4c666bce2c60f88b86b829e.png" alt="&lt;Figure size 1440x1440 with 4 Axes&gt;"/></div></div><div id="lOiYvqC1iY" class="relative group/block"><h3 id="land-use-vs-prediction" class="relative group"><span class="heading-text">Land Use vs Prediction</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#land-use-vs-prediction" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="f8T5QVJzxf" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Get SH collection ID
sh_oauth_session = OAuth2Session(client = BackendApplicationClient(client_id = sentinelhub_client_id))
sh_oauth_token = sh_oauth_session.fetch_token(token_url = sentinelhub_url + &#x27;/oauth/token&#x27;,
    client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)

sh_client = SentinelHubClient(sh_oauth_session, aws_s3_bucket)

sentinelhub_collection_id = sh_client.getCollectionByName(sentinelhub_collection_name)

print(&quot;SH collection ID:&quot;, sentinelhub_collection_id)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="i5bz81OsmsCU5LsQzmN2I" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>SH collection ID: dd4c4949-02ef-41b1-8548-1058ba132544
</span></code></pre></div></div></div><div id="YbmnfKjsF2" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">## Plot utility functions

def createColorMapAndNorm(colorMapping, insertZero: bool, extraVal: int):
    cmapValues = list(colorMapping.values())
    normValues = list(colorMapping.keys())
    
    if insertZero:
        normValues.insert(0, 0)
        cmapValues.insert(0, [1, 1, 1])
        
    if not extraVal is None:
        normValues.append(extraVal) # need to add a value, so the real last value can be used
    
    cmap = colors.ListedColormap(cmapValues)
    norm = colors.BoundaryNorm(normValues, cmap.N)  
    return cmap, norm

def plotMap(data, title, colorMapping, legendTexts, insertZero: bool, extraVal: int, 
    cbarHorizontal: bool, cbarPad: float, cbarAspect: float, 
    cbarTextSize: float, cbarTextRotation: float, hasLegend = True): 
    
    figure, ax = plt.subplots(figsize=(20, 16))
    ax.set_title(title, fontsize=25)
    
    bounds = xcube.core.geom.get_dataset_bounds(data)
    cmap, norm = createColorMapAndNorm(colorMapping, insertZero, extraVal)
    img = plt.imshow(data.values, cmap=cmap, norm=norm, extent=(bounds[0], bounds[2], bounds[1], bounds[3]))

    if hasLegend:
        cb = figure.colorbar(img, ax=ax, orientation=&#x27;horizontal&#x27; if cbarHorizontal else &#x27;vertical&#x27;, pad=cbarPad, aspect=cbarAspect)

        #cb = figure.colorbar(img)
        cb.set_ticks(list(colorMapping.keys()))
        if not legendTexts is None:
            if cbarHorizontal:
                cb.ax.set_xticklabels(legendTexts, fontsize=cbarTextSize, rotation=cbarTextRotation)
            else:
                cb.ax.set_yticklabels(legendTexts, fontsize=cbarTextSize, rotation=cbarTextRotation)

    return figure, ax, img</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="DsIkCA_iacRXUNnAfVZuR" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="CGwTpFIgaI" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># DB parcel loading utility functions

def addLineStringToPath(pathCoords, pathCommands, lineString, isReverse):
    isFirst = True
    for xy in lineString.coords:
        pathCoords.append(xy)
        pathCommands.append(patches.Path.MOVETO if isFirst else patches.Path.LINETO)
        isFirst = False
    
def geometryToPatch(geometry, lineColor, fillColor):
    pathCoords = []
    pathCommands = []
    
    addLineStringToPath(pathCoords, pathCommands, geometry.exterior, False)
    for interior in geometry.interiors:
        addLineStringToPath(pathCoords, pathCommands, interior, True)

    if len(pathCoords) &lt;= 0 or len(pathCommands) &lt;= 0:
        return None
    return patches.PathPatch(patches.Path(pathCoords, pathCommands), fc = fillColor, ec = lineColor, lw = 0.5)

def addPatchToPlot(ax, patch):
    if not patch is None:
        ax.add_patch(patch)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="0SHlvnUaou9AgNSp_VHvk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="fvqrAZnh8I" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Read prediction form SH BYOC to xcube
# Rearange selected EOPatches into bbox, which can be used for xcube definition
patches_geometries = [Polygon(bbox.get_polygon()) for bbox in bbox_list[patchIDs]]
bbox_of_patches = gpd.GeoSeries(cascaded_union(patches_geometries))

x1 = bbox_of_patches.bounds[&#x27;minx&#x27;][0].item()
y1 = bbox_of_patches.bounds[&#x27;miny&#x27;][0].item()
x2 = bbox_of_patches.bounds[&#x27;maxx&#x27;][0].item()
y2 = bbox_of_patches.bounds[&#x27;maxy&#x27;][0].item()
cube_bbox = x1, y1, x2, y2

spatial_res_meters = 10

cube_pred_config = CubeConfig(dataset_name=&#x27;CUSTOM&#x27;,
                         band_names=[&quot;prediction&quot;],                        
                         chunk_size=[512, 512],
                         crs=&quot;http://www.opengis.net/def/crs/EPSG/0/32633&quot;,
                         geometry=cube_bbox,
                         time_range=[&#x27;2019-01-01&#x27;, &#x27;2020-01-01&#x27;],
                         time_period=&#x27;1y&#x27;,
                         spatial_res=spatial_res_meters,
                         band_sample_types=&#x27;UINT8&#x27;,
                         collection_id=sentinelhub_collection_id)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="aPcFLZUZ-J0cDlIx3CVAk" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="e3KP03KVQI" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># So we can print some SentinelHub usage stats
request_collector = Observers.request_collector()

cube_prediction = open_cube(cube_pred_config, request_collector, client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)
# cube_prediction</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="vz65MmD7FnbELmlfN0kjF" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\xcube_sh\store.py:73: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future
  t_array = np.array([s + 0.5 * (e - s) for s, e in self._time_ranges]).astype(&#x27;datetime64[s]&#x27;).astype(np.int64)
E:\Python\DCFS\lib\site-packages\xcube_sh\store.py:74: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future
  t_bnds_array = np.array(self._time_ranges).astype(&#x27;datetime64[s]&#x27;).astype(np.int64)
</span></code></pre></div></div></div><div id="QlZ4EOOg0w" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">data = cube_prediction[&quot;prediction&quot;][0,:,:]
plotMap(data, &#x27;Prediction&#x27;, lulcColorMapping, lulcLegendTexts.values(), False, 20, 
    True, 0.03, 100, 15, 45)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="1hCfysYXr9sgotCKsO_zy" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
</span></code></pre></div><img src="/notebooks_test/build/1d67d8fff30bc12ec225214f4a192c9b.png" alt="&lt;Figure size 1440x1152 with 2 Axes&gt;"/></div></div><div id="wzf4yaQ4F5" class="relative group/block"><h4 id="land-use-visualization" class="relative group"><span class="heading-text">Land use visualization</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#land-use-visualization" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="VZlxj3AptS" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Add land use to cube_prediction

cube_pred_config = CubeConfig(dataset_name=&#x27;CUSTOM&#x27;,
                         band_names=[&quot;land_use&quot;],                        
                         chunk_size=[512, 512],
                         crs=&quot;http://www.opengis.net/def/crs/EPSG/0/32633&quot;,
                         geometry=cube_bbox,
                         time_range=[&#x27;2019-01-01&#x27;, &#x27;2020-01-01&#x27;],
                         time_period=&#x27;1y&#x27;,
                         spatial_res=10,
                         band_sample_types=&#x27;UINT16&#x27;,
                         collection_id=sentinelhub_collection_id)

request_collector = Observers.request_collector()

cube_land_use = open_cube(cube_pred_config, request_collector, client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)
cube_prediction[&quot;land_use&quot;] = cube_land_use[&quot;land_use&quot;]
# cube_prediction</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="uEKz9kOLgm6548ssrMAZM" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\xcube_sh\store.py:73: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future
  t_array = np.array([s + 0.5 * (e - s) for s, e in self._time_ranges]).astype(&#x27;datetime64[s]&#x27;).astype(np.int64)
E:\Python\DCFS\lib\site-packages\xcube_sh\store.py:74: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future
  t_bnds_array = np.array(self._time_ranges).astype(&#x27;datetime64[s]&#x27;).astype(np.int64)
</span></code></pre></div></div></div><div id="kUdWXApaQ1" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">data = cube_prediction[&quot;land_use&quot;][0,:,:]
plotMap(data, &#x27;Land use&#x27;, landUseColorMapping, landUseLegendTexts.values(), True, 10000, False, 0.03, 50, 12, 0)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="mF1G_eMuRoSjqKdrHBlm1" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
</span></code></pre></div><img src="/notebooks_test/build/3f6e01412f172c238b53865eedb3da62.png" alt="&lt;Figure size 1440x1152 with 2 Axes&gt;"/></div></div><div id="StKJjdLpcO" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Add mapped land use data
dimensions = cube_prediction[&quot;prediction&quot;].values[0].shape
land_use_map = np.zeros((1, dimensions[0], dimensions[1]), &#x27;uint8&#x27;)
land_use_map[0, :, :] = np.array([np.array([landUseToLulcMapping[val] for val in val_arr]) for val_arr in cube_prediction[&quot;land_use&quot;].values[0]])
land_use_map_xa = xr.DataArray(land_use_map,
                  dims=cube_prediction[&quot;prediction&quot;].dims,
                  coords=cube_prediction[&quot;prediction&quot;].coords)
land_use_map_xa_chunk = xcube.core.chunk.chunk_dataset(land_use_map_xa, chunk_sizes=(1, 512, 512))
cube_prediction[&quot;land_use_mapped&quot;] = cube_land_use[&quot;land_use&quot;]
cube_prediction[&quot;land_use_mapped&quot;] = land_use_map_xa_chunk
# cube_prediction</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ZG8mkdb28UeAPknqzJ1LD" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="sDAOpeDi9X" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># compute difference between prediction and land use
cube_prediction[&quot;diff_prediction_land_use&quot;] = cube_prediction[&quot;prediction&quot;] - cube_prediction.land_use_mapped</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="5-M_Hfgg9J036cAUpw9qg" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="w9p0MlKFcB" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">data = cube_prediction.diff_prediction_land_use[0,:,:]
plotMap(data, &#x27;Prediction vs. land use difference&#x27;, diffColorMapping, None, False, 100, False, 0.03, 50, 12, 0, hasLegend = False)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="VqaCY-vGnoDJSRUovRnRK" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
</span></code></pre></div><img src="/notebooks_test/build/1fd8cce4cecf54aeb0a9759d6d034bb4.png" alt="&lt;Figure size 1440x1152 with 1 Axes&gt;"/></div></div><div id="bcojj5AfuD" class="relative group/block"><h4 id="lpis-visualization" class="relative group"><span class="heading-text">LPIS visualization</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#lpis-visualization" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="Kmgzr67Ib1" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Add LPIS to cube_prediction

cube_pred_config = CubeConfig(dataset_name=&#x27;CUSTOM&#x27;,
                         band_names=[&quot;lpis&quot;],                        
                         chunk_size=[512, 512],
                         crs=&quot;http://www.opengis.net/def/crs/EPSG/0/32633&quot;,
                         geometry=cube_bbox,
                         time_range=[&#x27;2019-01-01&#x27;, &#x27;2020-01-01&#x27;],
                         time_period=&#x27;1y&#x27;,
                         spatial_res=10,
                         band_sample_types=&#x27;UINT16&#x27;,
                         collection_id=sentinelhub_collection_id)

request_collector = Observers.request_collector()

cube_lpis = open_cube(cube_pred_config, request_collector, client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)
cube_prediction[&quot;lpis&quot;] = cube_lpis[&quot;lpis&quot;]
# cube_prediction</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ORKk2wHOgPT4Gf6rroD1v" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\xcube_sh\store.py:73: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future
  t_array = np.array([s + 0.5 * (e - s) for s, e in self._time_ranges]).astype(&#x27;datetime64[s]&#x27;).astype(np.int64)
E:\Python\DCFS\lib\site-packages\xcube_sh\store.py:74: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future
  t_bnds_array = np.array(self._time_ranges).astype(&#x27;datetime64[s]&#x27;).astype(np.int64)
</span></code></pre></div></div></div><div id="gdU5tW2tE7" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">data = cube_prediction[&quot;lpis&quot;][0,:,:]
plotMap(data, &#x27;LPIS&#x27;, landUseColorMapping, landUseLegendTexts.values(), True, 10000, False, 0.03, 25, 12, 0)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="GWdpzNyOkxkZSTwLGyiBi" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
</span></code></pre></div><img src="/notebooks_test/build/a395a8e9b6c5282fe01ff927757a2e7c.png" alt="&lt;Figure size 1440x1152 with 2 Axes&gt;"/></div></div><div id="LIPLaftqzA" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># Add mapped land use data
dimensions = cube_prediction[&quot;prediction&quot;].values[0].shape
lpis_map = np.zeros((1, dimensions[0], dimensions[1]), &#x27;uint8&#x27;)

# Note! We must offset data, to clearly recognize in the difference, where LPIS has no data
lpis_map[0, :, :] = np.array([np.array([(50 + landUseToLulcMapping[val] if val &gt; 0 else 25) for val in val_arr]) for val_arr in cube_prediction[&quot;lpis&quot;].values[0]])

lpis_map_xa = xr.DataArray(lpis_map,
                  dims=cube_prediction[&quot;prediction&quot;].dims,
                  coords=cube_prediction[&quot;prediction&quot;].coords)
lpis_map_xa_chunk = xcube.core.chunk.chunk_dataset(lpis_map_xa, chunk_sizes=(1, 512, 512))
cube_prediction[&quot;lpis_mapped&quot;] = lpis_map_xa_chunk
# cube_prediction</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="hGoDa3dpN5-Y9qwTRV_40" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="MRGETbU45Q" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">cube_prediction[&quot;diff_prediction_lpis&quot;] = cube_prediction.lpis_mapped - cube_prediction[&quot;prediction&quot;]
data = cube_prediction.diff_prediction_lpis[0,:,:]

# add &quot;out-of-range&quot; values as black
colorMapping = {50 - len(lulcMapping): [0, 0, 0]} 
colorMapping.update({(id + 50): color for id, color in diffColorMapping.items()})
legendTexts = [str(i) for i in range(-len(lulcMapping) + 1, +len(lulcMapping) + 1)]
legendTexts.insert(0, &#x27;No data&#x27;)

plotMap(data, &#x27;Prediction vs. LPIS difference&#x27;, colorMapping, legendTexts, False, None, False, 0.03, 50, 12, 0, hasLegend = False)
plt.show()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="aSQo0oMkBT5AQNe-aJTv8" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
</span></code></pre></div><img src="/notebooks_test/build/bb3d8f8a717f1ce890d4e192724d133e.png" alt="&lt;Figure size 1440x1152 with 1 Axes&gt;"/></div></div><div id="dzyBwbzevC" class="relative group/block"><h4 id="select-smaller-aoi-ask-bc" class="relative group"><span class="heading-text">Select smaller AOI (ask BC)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#select-smaller-aoi-ask-bc" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="ipVAUAVSSX" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">subset_size_ratio = 0.3 # regarding the full extent

bounds = xcube.core.geom.get_dataset_bounds(cube_prediction)
bounds_center_x = (bounds[0] + bounds[2]) / 2
bounds_center_y = (bounds[1] + bounds[3]) / 2
bounds_width = (bounds[2] - bounds[0])
bounds_height = (bounds[3] - bounds[1])

subset_bbox = (
    bounds_center_x - bounds_width * subset_size_ratio / 2,
    bounds_center_y - bounds_height * subset_size_ratio / 2,
    bounds_center_x + bounds_width * subset_size_ratio / 2,
    bounds_center_y + bounds_height * subset_size_ratio / 2
)

subset_cube_prediction = xcube.core.geom.clip_dataset_by_geometry(cube_prediction, subset_bbox)
subset_cube_prediction_data = subset_cube_prediction[&quot;prediction&quot;][0,:,:]
subset_cube_land_use_data = subset_cube_prediction[&quot;land_use&quot;][0,:,:]
subset_cube_diff_data = subset_cube_prediction[&quot;diff_prediction_land_use&quot;][0,:,:]

figurePrediction, axPrediction, imgPrediction = plotMap(subset_cube_prediction_data, &#x27;Prediction&#x27;, lulcColorMapping, lulcLegendTexts.values(), False, 20, False, 0.03, 50, 12, 0)
figureLandUse, axLandUse, imgLandUse = plotMap(subset_cube_land_use_data, &#x27;Land use&#x27;, landUseColorMapping, landUseLegendTexts.values(), True, 10000, False, 0.03, 50, 12, 0)
figureDiff, axDiff, imgDiff = plotMap(subset_cube_diff_data, &#x27;Difference&#x27;, diffColorMapping, None, False, 100, False, 0.03, 50, 12, 0, hasLegend = False)

geodb = GeoDBClient()
land_use = loadFromDatabaseWithLulcMapping(geodb, &quot;Land use&quot;, db_land_use_table, db_land_use_class_column, None,
    BBox(subset_bbox, crs = country_crs), country_crs, selected_db_records_time, selected_db_records_time)

for row in land_use.iterrows():
    addPatchToPlot(axPrediction, geometryToPatch(row[1][&#x27;geometry&#x27;], (1, 0, 0, 1), (0, 0, 0, 0)))
    addPatchToPlot(axLandUse, geometryToPatch(row[1][&#x27;geometry&#x27;], (1, 0, 0, 1), (0, 0, 0, 0)))
    addPatchToPlot(axDiff, geometryToPatch(row[1][&#x27;geometry&#x27;], (0, 1, 0, 1), (0, 0, 0, 0)))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="fFQdwV_kal5gJnV58vyoa" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>Land use: 1081 DB records for bbox = 590364.0,5173024.0,593436.0,5176096.0
</span></code></pre></div><img src="/notebooks_test/build/0615fcb4ddf9d1e447793aeda1d4e9d5.png" alt="&lt;Figure size 1440x1152 with 2 Axes&gt;"/><img src="/notebooks_test/build/db7a8750ff6479a85a5ba286a8bea6d9.png" alt="&lt;Figure size 1440x1152 with 2 Axes&gt;"/><img src="/notebooks_test/build/cec9c6e6d393cd272cc66ee36ed546fd.png" alt="&lt;Figure size 1440x1152 with 1 Axes&gt;"/></div></div><div id="kzs4tWK4Mb" class="relative group/block"><h3 id="visualizations-per-parcel-ask-bc" class="relative group"><span class="heading-text">Visualizations per parcel (ask BC)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#visualizations-per-parcel-ask-bc" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="tQULpKKyoM" class="relative group/block"><h4 id="list-of-parcels-to-select-from" class="relative group"><span class="heading-text">List of parcels to select from</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#list-of-parcels-to-select-from" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="P02mvMxVtt" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">x1 = bbox_of_patches.bounds[&#x27;minx&#x27;][0].item()
y1 = bbox_of_patches.bounds[&#x27;miny&#x27;][0].item()
x2 = bbox_of_patches.bounds[&#x27;maxx&#x27;][0].item()
y2 = bbox_of_patches.bounds[&#x27;maxy&#x27;][0].item()
cubeBBox = BBox((x1, y1, x2, y2), country_crs)

fromWgs84Transform = pyproj.Transformer.from_crs(str(CRS.WGS84), str(country_crs))
toWgs84Transform = pyproj.Transformer.from_crs(str(country_crs), str(CRS.WGS84))

selectedParcelId = None
    
def computeLeafletScaleLevel(bbox):
    return math.floor(1 + math.log(40000000 / max(bbox.max_x - bbox.min_x, bbox.max_y - bbox.min_y), 2))

def createLeafletMap(bbox):
    mapCenter = toWgs84Transform.transform((bbox.min_x + bbox.max_x) / 2, (bbox.min_y + bbox.max_y) / 2)

    terrainLayer = basemap_to_tiles(basemaps.Stamen.Terrain) 
    terrainLayer.name = &quot;Background&quot;
    scaleLevel = computeLeafletScaleLevel(bbox)
    leafletMap = LeafletMap(layers = (terrainLayer, ), center = mapCenter, zoom = scaleLevel)
    return leafletMap

def lineStringToLeafletLocations(lineString):
    return [toWgs84Transform.transform(xy[0], xy[1]) for xy in lineString.coords]

def addGeometryToLeafletMap(leafletMap, geomId, geometry, lineColor, fillColor, clickFunc):
    locations = [lineStringToLeafletLocations(geometry.exterior)]
    for interior in geometry.interiors:
        locations.extend([lineStringToLeafletLocations(interior)])
    if len(locations) &gt; 0:
        layer = LeafletPolygon(locations = locations, 
            color = lineColor, opacity = 0.5, fill_color = fillColor, fill_opacity = 0.6, weight = 1)
        leafletMap.add_layer(layer)
        def layerClickFunc(**kwargs):
            clickFunc(**kwargs, geomId = geomId)
        layer.on_click(layerClickFunc)
        
def loadParcelsToLeafletMap(leafletMap, bbox, tableName, landUseColumnName, clickFunc):
    geodb = GeoDBClient()
    
    data = loadFromDatabaseWithLulcMapping(geodb, &quot;&quot;, tableName, landUseColumnName, None, bbox, bbox.crs,  
        selected_db_records_time, selected_db_records_time, maxRows = None, logging = False)

    for row in data.iterrows():
        color = lulcColorMapping[row[1][&#x27;lulcid&#x27;]]
        colorHtml = &quot;#{:02x}{:02x}{:02x}&quot;.format(int(color[0] * 255), int(color[1] * 255), int(color[2] * 255))
        addGeometryToLeafletMap(leafletMap, row[1][&#x27;id&#x27;], row[1][&#x27;geometry&#x27;], &quot;#FF0000&quot;, colorHtml, clickFunc)

def createLeafletMapSentinelWmsLayer(leafletMap, instanceId, name, layer, bbox, resolution, visible, opacity):
    bboxWgs84 = toWgs84Transform.transform(bbox.min_x, bbox.min_y), toWgs84Transform.transform(bbox.max_x, bbox.max_y)
    
    wmsUrl = &#x27;http://services.sentinel-hub.com/ogc/wms/{instanceId}?&#x27; \
        + &#x27;request=GetMap&amp;layers={layer}&amp;bbox={x1},{y1},{x2},{y2}&amp;crs={crs}&amp;format=image/png&amp;width={w}&amp;height={h}&#x27;
    wmsUrl = wmsUrl.format(instanceId = instanceId, layer = layer, 
        x1 = bbox.min_x, y1 = bbox.min_y, x2 = bbox.max_x, y2 = bbox.max_y, crs = str(country_crs), 
        w = int((bbox.max_x - bbox.min_x) / resolution), h = int((bbox.max_y - bbox.min_y) / resolution))

    return LeafletImageOverlay(url = wmsUrl, name = name, bounds = bboxWgs84, on = visible, opacity = opacity)

def addLeafletRectangleDrawControl(leafletMap):
    drawControls = LeafletDrawControl()
    drawControls.rectangle = {
        &quot;shapeOptions&quot;: {
            &quot;fillColor&quot;: &quot;#ff0000&quot;,
            &quot;color&quot;: &quot;#ff0000&quot;,
            &quot;fillOpacity&quot;: 0.75
        }
    }
    drawControls.polygon = {}
    drawControls.polyline =  {}
    drawControls.circle = {}
    drawControls.circlemarker = {}
    leafletMap.add_control(drawControls)
    return drawControls

def leafletParcelSelectionClickFunc(**kwargs):  
    global selectedParcelId
    selectedParcelId = kwargs[&#x27;geomId&#x27;]
    print(&quot;Selected parcel &quot; + str(selectedParcelId))

def leafletOverviewDrawFunc(self, action, geo_json):  
    geometry = geo_json[&#x27;geometry&#x27;]
    if (geometry[&#x27;type&#x27;] == &#x27;Polygon&#x27;) and len(geometry[&#x27;coordinates&#x27;]) == 1 and len(geometry[&#x27;coordinates&#x27;][0]) == 5:
        coords = geometry[&#x27;coordinates&#x27;][0]
        x1y1 = fromWgs84Transform.transform(coords[0][1], coords[0][0])
        x2y2 = fromWgs84Transform.transform(coords[2][1], coords[2][0])
        bbox = BBox((
            min(cubeBBox.max_x, max(cubeBBox.min_x, x1y1[0])), 
            min(cubeBBox.max_y, max(cubeBBox.min_y, x1y1[1])),
            min(cubeBBox.max_x, max(cubeBBox.min_x, x2y2[0])), 
            min(cubeBBox.max_y, max(cubeBBox.min_y, x2y2[1]))), country_crs)
        
        for layer in leafletMapParcelSelection.layers:
            if isinstance(layer, LeafletPolygon):
                leafletMapParcelSelection.remove_layer(layer)
        
        leafletMapParcelSelection.center = (coords[0][1] + coords[2][1]) * 0.5, (coords[0][0] + coords[2][0]) * 0.5
        leafletMapParcelSelection.zoom = computeLeafletScaleLevel(bbox)
        loadParcelsToLeafletMap(leafletMapParcelSelection, bbox, db_land_use_table, db_land_use_class_column, leafletParcelSelectionClickFunc)


leafletMapOverview = createLeafletMap(cubeBBox)

leafletMapOverview.add_layer(createLeafletMapSentinelWmsLayer(leafletMapOverview, sentinelhub_instance_id, &quot;Difference&quot;, sentinelhub_prediction_diff_layer, cubeBBox, 10, False, 0.85))
leafletMapOverview.add_layer(createLeafletMapSentinelWmsLayer(leafletMapOverview, sentinelhub_instance_id, &quot;Land use&quot;, sentinelhub_land_use_layer, cubeBBox, 10, False, 0.85))
leafletMapOverview.add_layer(createLeafletMapSentinelWmsLayer(leafletMapOverview, sentinelhub_instance_id, &quot;Prediction&quot;, sentinelhub_prediction_layer, cubeBBox, 10, True, 0.85))

drawControls = addLeafletRectangleDrawControl(leafletMapOverview)
drawControls.on_draw(leafletOverviewDrawFunc)
leafletMapOverview.add_control(LeafletLayersControl())
leafletMapOverview.layout.height = &#x27;800px&#x27;
display(leafletMapOverview)

leafletMapParcelSelection = createLeafletMap(cubeBBox)
leafletMapParcelSelection.layout.height = &#x27;800px&#x27;
display(leafletMapParcelSelection)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="9O0rJCSRap-UIxwYDqK32" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="DNEI18Mqwh" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">def loadSingleRecordFromDatabase(recordId):
    geodb = GeoDBClient()
    data = loadFromDatabaseWithLulcMapping(geodb, &quot;Land use&quot;, db_land_use_table, db_land_use_class_column, recordId, None, country_crs, None, None)

    for row in data.iterrows():
        return row[1]
    return None

def addLineStringToPath(pathCoords, pathCommands, lineString, isReverse):
    isFirst = True
    for xy in lineString.coords:
        pathCoords.append(xy)
        pathCommands.append(patches.Path.MOVETO if isFirst else patches.Path.LINETO)
        isFirst = False
    
def geometryToPatch(geometry, lineColor, fillColor):
    pathCoords = []
    pathCommands = []
    
    addLineStringToPath(pathCoords, pathCommands, geometry.exterior, False)
    for interior in geometry.interiors:
        addLineStringToPath(pathCoords, pathCommands, interior, True)

    if len(pathCoords) &lt;= 0 or len(pathCommands) &lt;= 0:
        return None
    return patches.PathPatch(patches.Path(pathCoords, pathCommands), fc = fillColor, ec = lineColor, lw = 2)

if selectedParcelId is None:
    print(&quot;Select first the parcel in the above details map!&quot;)
else:
    selectedParcelData = loadSingleRecordFromDatabase(selectedParcelId)

    selectedParcelCubePrediction = xcube.core.geom.mask_dataset_by_geometry(cube_prediction, selectedParcelData[&#x27;geometry&#x27;])
    selectedParcelCubePredictionData = selectedParcelCubePrediction[&quot;prediction&quot;][0,:,:]
    selectedParcelCubeLandUseData = selectedParcelCubePrediction[&quot;land_use&quot;][0,:,:]
    selectedParcelCubeDiffData = selectedParcelCubePrediction[&quot;diff_prediction_land_use&quot;][0,:,:]

    figurePrediction, axPrediction, imgPrediction = plotMap(selectedParcelCubePredictionData, &#x27;Prediction&#x27;, lulcColorMapping, lulcLegendTexts.values(), False, 20, False, 0.03, 50, 12, 0)
    figureLandUse, axLandUse, imgLandUse = plotMap(selectedParcelCubeLandUseData, &#x27;Land use&#x27;, landUseColorMapping, landUseLegendTexts.values(), True, 10000, False, 0.03, 50, 12, 0)
    figureDiff, axDiff, imgDiff = plotMap(selectedParcelCubeDiffData, &#x27;Difference&#x27;, diffColorMapping, None, False, 100, False, 0.03, 50, 12, 0)

    addPatchToPlot(axPrediction, geometryToPatch(selectedParcelData[&#x27;geometry&#x27;], (1, 0, 0, 1), (0, 0, 0, 0)))
    addPatchToPlot(axLandUse, geometryToPatch(selectedParcelData[&#x27;geometry&#x27;], (1, 0, 0, 1), (0, 0, 0, 0)))
    addPatchToPlot(axDiff, geometryToPatch(selectedParcelData[&#x27;geometry&#x27;], (0, 1, 0, 1), (0, 0, 0, 0)))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="W6NqXwrszVeKTMerVHJzU" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
E:\Python\DCFS\lib\site-packages\dask\array\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison
  o = func(*args, **kwargs)
</span></code></pre></div><img src="/notebooks_test/build/2dd442bc58cd3c9b84fa982fd3d70ae9.png" alt="&lt;Figure size 1440x1152 with 2 Axes&gt;"/><img src="/notebooks_test/build/252e95b83942ea71ebc51beea7baf276.png" alt="&lt;Figure size 1440x1152 with 2 Axes&gt;"/><img src="/notebooks_test/build/6fad23e588b20b0edf703dc55ba9b28a.png" alt="&lt;Figure size 1440x1152 with 2 Axes&gt;"/></div></div><div id="FD1SHYbupc" class="relative group/block"><h4 id="todo-calculate-of-wrongly-predicted-area-for-this-parcel" class="relative group"><span class="heading-text">TODO: calculate % of wrongly predicted area for this parcel</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#todo-calculate-of-wrongly-predicted-area-for-this-parcel" title="Link to this Section" aria-label="Link to this Section">¶</a></h4></div><div id="IY6QLGfCae" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">    </code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="zPkL4wMUIL4QXdd1ZSIYs" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/notebooks_test/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-IZFMW3M4.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-CPTH56EW.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-S4SWV34C.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/notebooks_test/build/root-QGLRP2PL.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-CB3BH7WY.js"/><link rel="modulepreload" href="/notebooks_test/build/routes/$-7JYT5576.js"/><script>window.__remixContext = {"url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/lpis-lulc-slo","state":{"loaderData":{"root":{"config":{"version":1,"myst":"1.3.25","options":{"hide_toc":true,"hide_footer_links":true,"folders":true},"nav":[],"actions":[],"projects":[{"github":"https://github.com/eoxhub-workspaces/documentation/","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"title":"Location for eodashboard notebooks","index":"readme","pages":[{"title":"External Notebooks","level":1},{"title":"Eurodatacube","level":2},{"title":"Notebooks","level":3},{"slug":"external-notebooks.eurodatacube.notebooks.readme","title":"Jupyter notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Notebooks","level":4},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.readme","title":"Euro Data Cube Notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Contributions","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-ai4arctic-sea-ice","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-biomass-forest-observation-sys","title":"AIREO pilot dataset - Biomass (Forest Observation System)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-cap","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-spacenet7","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aot-covid19","title":"Aerosol Optical Thickness (AOT) Anomaly Detection Using Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.batch-zarr-output","title":"Generating Zarr data cubes with Sentinel Hub Batch API","description":"","date":"","thumbnail":"/notebooks_test/build/68dffbf744fa42f4bf3d35e55684984e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.client-side-processing-using-mass-sh","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.cmems-data-download","title":"Cmems Data Download","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.detect-trucks-sentinel2","title":"Detect Trucks using Sentinel-2 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.drought-monitoring","title":"Drought impact monitoring platform","description":"","date":"","thumbnail":"/notebooks_test/build/ad5c19782b006f72352ae57794305840.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-africa-cube-africa-custom-contest","title":"Custom Script Contest – Urban Growth in Africa","description":"","date":"","thumbnail":"/notebooks_test/build/e9275f3fe80a704e2f5aa1ec1220e48a.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-byoc-tutorial","title":"How to bring your own data to EDC: Using Sentinel Hub Python package","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-demo-phi-week-v2","title":"xcube-gen and xcube-geodb Hands-On Workshop Φ-Week 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-geodb-4-eurocrops-demo","title":"Demonstration of Eurocrops data use in geoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-notebook-lstm","title":"South Africa Crop Type Classification on Euro Data Cube (EDC)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-usecase-lpis-crop-type-classification","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.eurocrops-crop-classification-example","title":"Crop-classification using Sentinel-2 time-series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ghsl-urban-delineation","title":"\u003cb\u003eUrban delineation\u003cb\u003e","description":"","date":"","thumbnail":"/notebooks_test/build/7bbf545a5eae1d9ebdb91ae42b261063.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.globalearthmonitor-example","title":"Pre-requisites","description":"","date":"","thumbnail":"/notebooks_test/build/205c1ded6bd59771975a9fbd3753fd3b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gpu-support-eoxhub","title":"GPU-Support on EOxHub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gran-chaco-phiweek","title":"ESA EO \\phi- week 2020","description":"","date":"","thumbnail":"/notebooks_test/build/80cee7db6cdc7002ceedda5689f889fa.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.howtolulc-batch-updated-210621","title":"How To: Land-Use-Land-Cover Prediction for Slovenia - using the Batch Processing API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lpis-lulc-slo","title":"LPIS Use Case for Land Use / Land Cover Classification","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lps2022-leverage-euro-data-cube-services","title":"Living Planet Symposium 2022 Training Session","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-analysis-covid19-lockdowns","title":"Impact of Covid19 induced lockdown on NO2 levels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-so2-trend-veda-api-igarss-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ogc-edc","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.openeo-client-demo","title":"openEO Client Demo","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.race-finishedgoodsinventory-inidcator","title":"Finished Goods Inventory indicator for RACE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.third-party-planetscope","title":"Third Party Data Import - PlanetScope","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-access-datasets","title":"Using xcube to access non-commercial and commercial data sets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-viewer-as-a-service-in-edc1","title":"Visualizing data with xcube viewer in EuroDataCube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-evaluation-workshop","title":"DAPA Evaluation Workshop: Introduction \u0026 Documentation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-1-cube-sentinel-2","title":"DAPA Tutorial #1: Cube - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-2-area-sentinel-2","title":"DAPA Tutorial #2: Area - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-3-timeseries-sentinel-2","title":"DAPA Tutorial #3: Timeseries - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-4-value-sentinel-2","title":"DAPA Tutorial #4: Value - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-5-dem","title":"DAPA Tutorial #5: DEM","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.fairicube.fairicube-data-access-demonstration","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-australian-bushfires","title":"Australian Bushfires","description":"","date":"","thumbnail":"/notebooks_test/build/ab194b4f8c40a2b9d64d8a85e37ce1fd.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["IGARSS-22","EO Dashboard"],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-data-access","title":"Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-detect-trucks-sentinel2","title":"Truck Detection Exercise","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-lockdown-in-venice","title":"Environmental Impacts of Lockdown in Venice, Italy during 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-nasa-api-lockdown-in-venice","title":"Lockdown in Venice","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-no2-timeseries-analysis","title":"NO2 timeseries analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-timeseries-stac-api-single-vs-multi","title":"Time series using STAC API statistics endpoints","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Curated","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.access-iacs-data","title":"How to access IACS Spatial Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-access-cci-data","title":"Access CCI data with xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-first-steps","title":"First steps on the Euro Data Cube platform","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-1-manage-datasets-v11","title":"Manage Collections in your GeoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-2-explore-datasets-2","title":"Exploring Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-3-share-datasets1","title":"Sharing Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-access-urban-atlas-data-v1","title":"[xcube-geodb] How to accesss EEA Urban Atlas Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-data-access","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-basic","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-ndvi","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-datasets","title":"EDC Sentinel Hub - using xcube to access different data sets in Sentinel Hub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-setup","title":"Setup for EDC core API access using xcube client library","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-xcube-integration","title":"EDC Sentinel Hub - XCUBE integration","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-usecase-ndvi-timeline","title":"NDVI timeline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.eo-learn","title":"Using eo-learn in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/5a1f8475f0c3652f4630d03d72891b98.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.esdl-edc-v0-2","title":"Earth System Data Lab Tutorial @ Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.exploring-time-and-space-with-edc","title":"Exploring Time and Space: A guide to accessing, analysing and visualising data in the Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.how-to-access-dem-data-through-sentinel-hub-api","title":"How to access DEM data through Sentinel Hub API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.sentinelhub-py","title":"Using Sentinel Hub Process API in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/01e22903839391bc356ac886ec2b2fa7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Notebooks","level":1},{"slug":"notebooks.example1","title":"📘 Example Notebook 1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.example2","title":"📘 Example Notebook 2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/notebooks_test"},"routes/$":{"config":{"version":1,"myst":"1.3.25","options":{"hide_toc":true,"hide_footer_links":true,"folders":true},"nav":[],"actions":[],"projects":[{"github":"https://github.com/eoxhub-workspaces/documentation/","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"title":"Location for eodashboard notebooks","index":"readme","pages":[{"title":"External Notebooks","level":1},{"title":"Eurodatacube","level":2},{"title":"Notebooks","level":3},{"slug":"external-notebooks.eurodatacube.notebooks.readme","title":"Jupyter notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Notebooks","level":4},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.readme","title":"Euro Data Cube Notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Contributions","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-ai4arctic-sea-ice","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-biomass-forest-observation-sys","title":"AIREO pilot dataset - Biomass (Forest Observation System)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-cap","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-spacenet7","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aot-covid19","title":"Aerosol Optical Thickness (AOT) Anomaly Detection Using Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.batch-zarr-output","title":"Generating Zarr data cubes with Sentinel Hub Batch API","description":"","date":"","thumbnail":"/notebooks_test/build/68dffbf744fa42f4bf3d35e55684984e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.client-side-processing-using-mass-sh","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.cmems-data-download","title":"Cmems Data Download","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.detect-trucks-sentinel2","title":"Detect Trucks using Sentinel-2 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.drought-monitoring","title":"Drought impact monitoring platform","description":"","date":"","thumbnail":"/notebooks_test/build/ad5c19782b006f72352ae57794305840.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-africa-cube-africa-custom-contest","title":"Custom Script Contest – Urban Growth in Africa","description":"","date":"","thumbnail":"/notebooks_test/build/e9275f3fe80a704e2f5aa1ec1220e48a.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-byoc-tutorial","title":"How to bring your own data to EDC: Using Sentinel Hub Python package","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-demo-phi-week-v2","title":"xcube-gen and xcube-geodb Hands-On Workshop Φ-Week 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-geodb-4-eurocrops-demo","title":"Demonstration of Eurocrops data use in geoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-notebook-lstm","title":"South Africa Crop Type Classification on Euro Data Cube (EDC)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-usecase-lpis-crop-type-classification","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.eurocrops-crop-classification-example","title":"Crop-classification using Sentinel-2 time-series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ghsl-urban-delineation","title":"\u003cb\u003eUrban delineation\u003cb\u003e","description":"","date":"","thumbnail":"/notebooks_test/build/7bbf545a5eae1d9ebdb91ae42b261063.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.globalearthmonitor-example","title":"Pre-requisites","description":"","date":"","thumbnail":"/notebooks_test/build/205c1ded6bd59771975a9fbd3753fd3b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gpu-support-eoxhub","title":"GPU-Support on EOxHub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gran-chaco-phiweek","title":"ESA EO \\phi- week 2020","description":"","date":"","thumbnail":"/notebooks_test/build/80cee7db6cdc7002ceedda5689f889fa.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.howtolulc-batch-updated-210621","title":"How To: Land-Use-Land-Cover Prediction for Slovenia - using the Batch Processing API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lpis-lulc-slo","title":"LPIS Use Case for Land Use / Land Cover Classification","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lps2022-leverage-euro-data-cube-services","title":"Living Planet Symposium 2022 Training Session","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-analysis-covid19-lockdowns","title":"Impact of Covid19 induced lockdown on NO2 levels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-so2-trend-veda-api-igarss-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ogc-edc","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.openeo-client-demo","title":"openEO Client Demo","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.race-finishedgoodsinventory-inidcator","title":"Finished Goods Inventory indicator for RACE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.third-party-planetscope","title":"Third Party Data Import - PlanetScope","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-access-datasets","title":"Using xcube to access non-commercial and commercial data sets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-viewer-as-a-service-in-edc1","title":"Visualizing data with xcube viewer in EuroDataCube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-evaluation-workshop","title":"DAPA Evaluation Workshop: Introduction \u0026 Documentation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-1-cube-sentinel-2","title":"DAPA Tutorial #1: Cube - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-2-area-sentinel-2","title":"DAPA Tutorial #2: Area - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-3-timeseries-sentinel-2","title":"DAPA Tutorial #3: Timeseries - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-4-value-sentinel-2","title":"DAPA Tutorial #4: Value - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-5-dem","title":"DAPA Tutorial #5: DEM","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.fairicube.fairicube-data-access-demonstration","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-australian-bushfires","title":"Australian Bushfires","description":"","date":"","thumbnail":"/notebooks_test/build/ab194b4f8c40a2b9d64d8a85e37ce1fd.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["IGARSS-22","EO Dashboard"],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-data-access","title":"Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-detect-trucks-sentinel2","title":"Truck Detection Exercise","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-lockdown-in-venice","title":"Environmental Impacts of Lockdown in Venice, Italy during 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-nasa-api-lockdown-in-venice","title":"Lockdown in Venice","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-no2-timeseries-analysis","title":"NO2 timeseries analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-timeseries-stac-api-single-vs-multi","title":"Time series using STAC API statistics endpoints","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Curated","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.access-iacs-data","title":"How to access IACS Spatial Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-access-cci-data","title":"Access CCI data with xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-first-steps","title":"First steps on the Euro Data Cube platform","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-1-manage-datasets-v11","title":"Manage Collections in your GeoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-2-explore-datasets-2","title":"Exploring Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-3-share-datasets1","title":"Sharing Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-access-urban-atlas-data-v1","title":"[xcube-geodb] How to accesss EEA Urban Atlas Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-data-access","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-basic","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-ndvi","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-datasets","title":"EDC Sentinel Hub - using xcube to access different data sets in Sentinel Hub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-setup","title":"Setup for EDC core API access using xcube client library","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-xcube-integration","title":"EDC Sentinel Hub - XCUBE integration","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-usecase-ndvi-timeline","title":"NDVI timeline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.eo-learn","title":"Using eo-learn in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/5a1f8475f0c3652f4630d03d72891b98.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.esdl-edc-v0-2","title":"Earth System Data Lab Tutorial @ Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.exploring-time-and-space-with-edc","title":"Exploring Time and Space: A guide to accessing, analysing and visualising data in the Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.how-to-access-dem-data-through-sentinel-hub-api","title":"How to access DEM data through Sentinel Hub API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.sentinelhub-py","title":"Using Sentinel Hub Process API in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/01e22903839391bc356ac886ec2b2fa7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Notebooks","level":1},{"slug":"notebooks.example1","title":"📘 Example Notebook 1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.example2","title":"📘 Example Notebook 2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":1,"kind":"Notebook","sha256":"95e9441b18f623a9b3b5f46725206df788a864ae8e3d8eaa73278214f2942173","slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lpis-lulc-slo","location":"/external_notebooks/eurodatacube/notebooks/notebooks/contributions/LPIS_LULC-Slo.ipynb","dependencies":[],"frontmatter":{"title":"LPIS Use Case for Land Use / Land Cover Classification","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"github":"https://github.com/eoxhub-workspaces/documentation/","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eoxhub-workspaces/documentation//blob/main/external_notebooks/eurodatacube/notebooks/notebooks/contributions/LPIS_LULC-Slo.ipynb","exports":[{"format":"ipynb","filename":"LPIS_LULC-Slo.ipynb","url":"/notebooks_test/build/LPIS_LULC-Slo-51b3c19b705802165d127ba253ed20dd.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import setup_environment_variables\nsetup_environment_variables()","key":"rCQb00VlwZ"},{"type":"output","id":"J-UERZaff-9BJ6vI6YDYy","data":[{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"API credentials have automatically been injected for your active subscriptions.  \nThe following environment variables are now available:\n* `SH_CLIENT_NAME`\n* `SH_CLIENT_SECRET`\n* `SH_INSTANCE_ID`\n* `SH_CLIENT_ID`\n","content_type":"text/markdown"},"text/plain":{"content":"\u003cIPython.core.display.Markdown object\u003e","content_type":"text/plain"}}}],"key":"KIw4JLJyQo"}],"key":"z1YGy4FGGC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"LPIS Use Case for Land Use / Land Cover Classification","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oseVlb2z9D"}],"identifier":"lpis-use-case-for-land-use-land-cover-classification","label":"LPIS Use Case for Land Use / Land Cover Classification","html_id":"lpis-use-case-for-land-use-land-cover-classification","implicit":true,"key":"EjXNiC0cSm"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This notebook demonstrates how Euro Data Cube (EDC) tools can be utilized for an exploratory analysis and manipulation of data in Land Parcel Identification System (LPIS). The most important part is the example of using satellite imagery and machine learning algorithms to provide additional information about the area of interest, which should be a valuable support for decisions related with LPIS controls.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NLHgz1aGUY"}],"key":"wEZuRucD66"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"A workflow consist of three parts:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XyvnFKWTEb"}],"key":"Nddmt17N03"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Prepare and explore LPIS data, reference land use data and satellite imagery","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"xE61zxYdMC"}],"key":"Sz6w3UMI4k"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Run Machine Learning for Land Cover Land Use (LULC) prediction","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"T6I8IbMzjp"}],"key":"DWHTLa58Io"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Visualize results and extract information to support LPIS controls","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"F60MsgTgMR"}],"key":"j94TByuBBD"}],"key":"HhbanEiExR"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Step 2. is based on machine learning pipeline developed for LULC prediction in ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"tU05F0rSdE"},{"type":"link","url":"https://eo-learn.readthedocs.io/en/latest/examples/land-cover-map/SI_LULC_pipeline.html","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Slovenia","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"sVHVPJdZC0"}],"urlSource":"https://eo-learn.readthedocs.io/en/latest/examples/land-cover-map/SI_LULC_pipeline.html","key":"Z9uykrVRw5"},{"type":"text","value":". The workflow in this notebook is simplified and focused less on machine learning algorithm and more on usefulness of the results. It allows the user to change settings such as: area of interest, time range, mapping of classes.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"Rg8el9WYpU"}],"key":"mCeW1rpv4S"}],"key":"QTmvx4pA78"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"AWS: S3 bucket, SentinelHub and database access parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Jmb5fetZ6z"}],"identifier":"aws-s3-bucket-sentinelhub-and-database-access-parameters","label":"AWS: S3 bucket, SentinelHub and database access parameters","html_id":"aws-s3-bucket-sentinelhub-and-database-access-parameters","implicit":true,"key":"G2GWqtGzNy"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"You need to replace the placeholder values with your own database Amazon S3 and SentinelHub parameters:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x2X8QVqBQT"}],"key":"V6Cow8Dsgf"}],"key":"P8xSIeXYs7"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# S3 parameters\naws_access_key_id = \"\u003caws_access_key\u003e\"\naws_secret_access_key = \"\u003caws_secret_key\u003e\"\naws_s3_bucket = \"\u003caws_s3_bucket_name\u003e\" # Bucket must be configured as described here:\n                                       # https://docs.sentinel-hub.com/api/latest/#/API/byoc?id=configuring-the-bucket\naws_s3_path = \"\u003caws_s3_path_prediction\u003e\" # path on the bucket for the reference data, example: \"DCFS/{0}/{value_name}.tiff\", where {0} represents patch index\n                                        # where {0} represents patch index.\n\n# SentinelHub\nsentinelhub_prediction_layer = '\u003csentinelhub_prediction_layer\u003e' # name of the \"Prediction\" layer within the above defined SentinelHub instance ID\nsentinelhub_land_use_layer = '\u003csentinelhub_prediction_layer\u003e' # name of the \"Land use\" layer within the above defined SentinelHub instance ID\nsentinelhub_prediction_diff_layer = '\u003csentinelhub_prediction_layer\u003e' # name of the \"Prediction vs. Land use difference\" layer within the above defined SentinelHub instance ID\n \n# BYOC collections\nsentinelhub_collection_name = \"DCFS\"\n\n\n# This notebook uses the EO-Learn ML library which requires configuration passed via the 'sentinel.config' tool\n!sentinelhub.config --sh_base_url 'https://services.sentinel-hub.com'\n!sentinelhub.config --sh_client_id $SH_CLIENT_ID\n!sentinelhub.config --sh_client_secret $SH_CLIENT_SECRET\n!sentinelhub.config --instance_id $SH_INSTANCE_ID","key":"WJADDluAoV"},{"type":"output","id":"Oa3ZAjqvHI8XA1lc9gKoW","data":[],"key":"kDtVk6elEf"}],"key":"Y6lCnbB8rv"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"User constants","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mcfOR3Y9Kn"}],"identifier":"user-constants","label":"User constants","html_id":"user-constants","implicit":true,"key":"T0vTYL4N3U"}],"key":"CfdWjmu3IC"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"country_name = \"slovenia\"\ncountry_crs_code = \"EPSG:32633\"\ncountry_border_file = 'svn_buffered.geojson'\n\ndb_srid = 3794\ndb_land_use_table = \"land_use_slo\"\ndb_land_use_class_column = \"raba_id\"\ndb_lpis_table = \"lpis_slo\"\ndb_lpis_class_column = \"raba_id\"\n\nselected_db_records_time = '2019-09-30' # records that are used as a reference to compare with prediction\nselected_patch_center = (16.1977, 46.7299) # 15.1664, 46.2498) # (13.860377, 46.283196) # longitude, latitude\nselected_patch_displayed_time = '2019-09-15' #User's input. Must be a value in cube.time","key":"htsn8F0mDA"},{"type":"output","id":"M5UXTET4IuYRrlf-VhYzW","data":[],"key":"YLduNVcYxl"}],"key":"esCdD0OmXu"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Import packages","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sZ5dLcP6uq"}],"identifier":"import-packages","label":"Import packages","html_id":"import-packages","implicit":true,"key":"bo233BWbNO"}],"key":"A9Y6zAFz5T"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# Firstly, some necessary imports\n\n# Jupyter notebook related\n%reload_ext autoreload\n%autoreload 2\n%matplotlib inline\n\n# Built-in modules\nimport pickle\nimport sys\nimport os\nimport datetime\nimport time\nimport itertools\nimport math\nimport subprocess\nimport json\nimport fiona\nfrom geojson import Polygon as geoJsonPolygon\nfrom enum import Enum\n\n# interactive map\nfrom ipyleaflet import Map as LeafletMap, Marker as LeafletMarker, Polygon as LeafletPolygon\nfrom ipyleaflet import ImageOverlay as LeafletImageOverlay, DrawControl as LeafletDrawControl\nfrom ipyleaflet import LayersControl as LeafletLayersControl, LayerGroup as LeafletLayerGroup\nfrom ipyleaflet import basemaps, basemap_to_tiles\n\n# Basics of Python data handling and visualization\nimport numpy as np\nimport geopandas as gpd\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nimport matplotlib.gridspec as gridspec\nimport matplotlib.patches as patches\nfrom matplotlib.transforms import Bbox as plotBbox\nfrom matplotlib import colors\nfrom mpl_toolkits.axes_grid1 import make_axes_locatable\nfrom shapely.geometry import Polygon\nfrom tqdm import tqdm_notebook as tqdm\n\n# Machine learning \nimport lightgbm as lgb\nfrom sklearn.externals import joblib\nfrom sklearn import metrics\nfrom sklearn import preprocessing\n\n# Imports from eo-learn and sentinelhub-py\nfrom eolearn.core import EOTask, EOPatch, LinearWorkflow, FeatureType, OverwritePermission, \\\n    LoadTask, SaveTask, EOExecutor\nfrom eolearn.io import S2L1CWCSInput, ExportToTiff\nfrom eolearn.mask import AddCloudMaskTask, get_s2_pixel_cloud_detector, AddValidDataMaskTask\nfrom eolearn.geometry import VectorToRaster, PointSamplingTask, ErosionTask\nfrom eolearn.features import LinearInterpolation, SimpleFilterTask\nfrom sentinelhub import BBoxSplitter, BBox, CRS, CustomUrlParam, UtmGridSplitter\n\n# OAuth2\nfrom oauthlib.oauth2 import BackendApplicationClient\nfrom requests_oauthlib import OAuth2Session\n\n# DB and raw geometry\nfrom xcube_geodb.core.geodb import GeoDBClient\nimport psycopg2\nfrom psycopg2._psycopg import AsIs\nfrom psycopg2.extensions import register_adapter\nimport shapely.wkt\nfrom shapely.geometry import Polygon, MultiPolygon\nfrom geopandas import GeoDataFrame\nimport pyproj\n\n# imports for xcube\nimport xarray as xr\nimport shapely.geometry\nfrom shapely.ops import cascaded_union\nimport zarr\n\nfrom xcube_sh.cube import open_cube\nfrom xcube_sh.observers import Observers\nfrom xcube_sh.config import CubeConfig\nfrom xcube_sh.viewer import ViewerServer\nimport xcube.core.geom\nimport xcube.core.chunk\n\n# Amazon S3\nimport boto3\n\nimport logging\nglobalLogger = logging.getLogger()\nglobalLogger.setLevel(logging.CRITICAL)","key":"sNTaDDOsHh"},{"type":"output","id":"PSaFnJjBHMeSwIIyj7pUH","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\sklearn\\externals\\joblib\\__init__.py:15: DeprecationWarning: sklearn.externals.joblib is deprecated in 0.21 and will be removed in 0.23. Please import this functionality directly from joblib, which can be installed with: pip install joblib. If this warning is raised when loading pickled models, you may need to re-serialize those models with scikit-learn 0.21+.\n  warnings.warn(msg, category=DeprecationWarning)\nE:\\Python\\DCFS\\lib\\site-packages\\pywt\\_utils.py:6: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\n  from collections import Iterable\nE:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\cube.py:22: DeprecationWarning: Using or importing the ABCs from 'collections' instead of from 'collections.abc' is deprecated, and in 3.8 it will stop working\n  from collections import Callable\n"}],"key":"azvH1j3ZAj"}],"key":"Xg5oQ8cXkL"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mappings and colors","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"of7Lwyz01D"}],"identifier":"mappings-and-colors","label":"Mappings and colors","html_id":"mappings-and-colors","implicit":true,"key":"VJoYW6EdYE"}],"key":"etqumZO0hC"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"lulcMapping = {\n    0: {\"name\": 'No Data', \"color\": [1.00, 1.00, 1.00]},\n    1: {\"name\": 'Cultivated Land', \"color\": [0.75, 1.00, 0.00]},\n    2: {\"name\": 'Forest', \"color\": [0.01, 0.21, 0.00]},\n    3: {\"name\": 'Grassland', \"color\": [0.98, 0.45, 0.02]},\n    4: {\"name\": 'Shrubland', \"color\": [0.82, 0.70, 0.44]},\n    5: {\"name\": 'Water', \"color\": [0.02, 0.60, 0.95]},\n    6: {\"name\": 'Wetlands', \"color\": [0.84, 1.00, 1.00]},\n    7: {\"name\": 'Tundra', \"color\": [0.78, 0.62, 0.94]},\n    8: {\"name\": 'Artificial Surface', \"color\": [0.55, 0.00, 0.06]},\n    9: {\"name\": 'Bareland', \"color\": [0.90, 0.85, 0.65]},\n    10: {\"name\": 'Snow and Ice', \"color\": [0.00, 0.00, 0.00]}\n}\n    \nlulcColorMapping = {id: entry[\"color\"] for id, entry in lulcMapping.items()}\nlulcLegendTexts = {id: str(id) + \" = \" + entry[\"name\"] for id, entry in lulcMapping.items()}\n\n## mapping of land use classes into 10 classes that are to be predicted\nlulcToLandUseMapping = {\n    0: [0, 9999, 1411], # NOTE 1411 doesn't match any class\n    1: [1100, 1150, 1160, 1161, 1170, 1180, 1181, 1190, 1191, 1192, 1211, 1212, 1221, 1222, 1230, 1240, 1610],\n    2: [1420, 2000, 1907],\n    3: [1130, 1131, 1300, 1320, 1321, 1330, 1600, 1906, 1800, 1430],\n    4: [5000, 1500, 1410],\n    5: [7000, 1905],\n    6: [4100, 4210, 4220],\n    7: [],\n    8: [3000, 1902, 1903, 1904],\n    9: [6000],\n    10: []\n}\n\nlandUseToLulcMapping = {landUse: lulc for lulc, landUseList in lulcToLandUseMapping.items() for landUse in landUseList}\n\nlandUseMapping = {\n    1100: {\"name\": 'Arable land', \"color\": [0.60, 0.40, 0.40]},\n    1130: {\"name\": 'Temporary grassland (not in use anymore)', \"color\": [0.11, 0.56, 0.56]},\n    1131: {\"name\": 'Temporary grassland', \"color\": [0.11, 0.56, 0.56]},\n    1150: {\"name\": 'Field for snail farming', \"color\": [0.60, 0.40, 0.40]},\n    1160: {\"name\": 'Hop field', \"color\": [1.00, 0.20, 1.00]},\n    1161: {\"name\": 'Hop field in rotation', \"color\": [1.00, 0.20, 1.00]},\n    1170: {\"name\": 'Strawberry field', \"color\": [0.60, 0.40, 0.40]},\n    1180: {\"name\": 'Permanent crops on arable land', \"color\": [1.00, 0.73, 0.60]},\n    1181: {\"name\": 'Permanent crops on arable land where production is not in soil (not eligible)', \"color\": [1.00, 0.73, 0.60]},\n    1190: {\"name\": 'Greenhouse', \"color\": [0.60, 0.40, 0.40]},\n    1191: {\"name\": 'Greenhouse where production is not in soil (not eligible)', \"color\": [0.60, 0.40, 0.40]},\n    1192: {\"name\": 'Greenhouse with fruit plants', \"color\": [1.00, 0.73, 0.60]},\n    1211: {\"name\": 'Vineyard', \"color\": [1.00, 1.00, 0.20]},\n    1212: {\"name\": 'Nursery', \"color\": [1.00, 0.68, 0.68]},\n    1221: {\"name\": 'Intensive orchard', \"color\": [1.00, 0.73, 0.20]},\n    1222: {\"name\": 'Extensive orchard', \"color\": [1.00, 0.60, 0.20]},\n    1230: {\"name\": 'Olive grove', \"color\": [0.73, 0.73, 0.20]},\n    1240: {\"name\": 'Other permanent crop', \"color\": [1.00, 0.73, 0.60]},\n    1300: {\"name\": 'Permanent grassland', \"color\": [0.20, 1.00, 0.20]},\n    1320: {\"name\": 'Permanent grassland with scattered ineligible features (Pro-rata)', \"color\": [0.20, 0.78, 0.80]},\n    1321: {\"name\": 'Swampy meadows', \"color\": [0.04, 0.96, 0.85]},\n    1330: {\"name\": 'Mountain pasture (not in use anymore)', \"color\": [0.50, 1.00, 0.20]},\n    1410: {\"name\": 'Overgrown agricultural area', \"color\": [1.00, 0.37, 0.37]},\n    1411: {\"name\": 'Area for removing overgrowth', \"color\": [0.21, 0.58, 0.45]},\n    1420: {\"name\": 'Forest plantation', \"color\": [0.20, 0.80, 0.60]},\n    1430: {\"name\": 'Extensive karst pasture', \"color\": [0.58, 0.98, 0.67]},\n    1500: {\"name\": 'Trees and shrubs', \"color\": [0.15, 0.84, 0.24]},\n    1600: {\"name\": 'Uncultivated agricultural land  ', \"color\": [0.50, 0.25, 0.25]},\n    1610: {\"name\": 'Agricultural land being prepared for cultivation', \"color\": [0.20, 0.73, 0.20]},\n    1800: {\"name\": 'Forest trees on agricultural land', \"color\": [0.15, 0.84, 0.24]},\n    1902: {\"name\": 'Hayrack', \"color\": [0.72, 0.52, 0.05]},\n    1903: {\"name\": 'Dirt road', \"color\": [0.85, 0.77, 0.65]},\n    1904: {\"name\": 'Dry stone', \"color\": [0.75, 0.75, 0.75]},\n    1905: {\"name\": 'Trench', \"color\": [0.75, 0.75, 0.75]},\n    1906: {\"name\": 'Grassy border between fields', \"color\": [0.20, 1.00, 0.20]},\n    1907: {\"name\": 'Trees in line', \"color\": [0.15, 0.84, 0.24]},\n    2000: {\"name\": 'Forest', \"color\": [0.15, 0.84, 0.24]},\n    3000: {\"name\": 'Built-up area and related surface', \"color\": [1.00, 0.20, 0.50]},\n    4100: {\"name\": 'Swamp', \"color\": [0.04, 0.96, 0.85]},\n    4210: {\"name\": 'Reed', \"color\": [0.04, 0.96, 0.85]},\n    4220: {\"name\": 'Other marshy areas', \"color\": [0.04, 0.96, 0.85]},\n    5000: {\"name\": 'Dried open area with special vegetation', \"color\": [0.50, 0.50, 1.00]},\n    6000: {\"name\": 'Open area with little or no vegetation', \"color\": [0.84, 1.00, 0.67]},\n    7000: {\"name\": 'Water', \"color\": [0.50, 1.00, 1.00]},\n    9999: {\"name\": 'No data', \"color\": [0.00, 0.00, 0.00]}\n}\n\nlandUseColorMapping = {id: entry[\"color\"] for id, entry in landUseMapping.items()}\nlandUseLegendTexts = {id: str(id) + \" = \" + ((entry[\"name\"][:15] + '..') if len(entry[\"name\"]) \u003e 15 else entry[\"name\"]) for id, entry in landUseMapping.items()}\n\ndiffColorMapping = { # Blue through yellow to red\n    -10: [0.19, 0.21, 0.58], \n    -9: [0.27, 0.29, 0.60], \n    -8: [0.35, 0.37, 0.62], \n    -7: [0.43, 0.45, 0.63], \n    -6: [0.52, 0.53, 0.65],\n    -5: [0.60, 0.61, 0.67], \n    -4: [0.68, 0.68, 0.69], \n    -3: [0.76, 0.76, 0.70], \n    -2: [0.84, 0.84, 0.72], \n    -1: [0.92, 0.92, 0.74],\n    0: [1.00, 1.00, 0.75], \n    1: [0.97, 0.90, 0.69], \n    2: [0.93, 0.80, 0.63], \n    3: [0.90, 0.70, 0.57], \n    4: [0.86, 0.60, 0.51],\n    5: [0.83, 0.50, 0.45], \n    6: [0.80, 0.40, 0.39], \n    7: [0.76, 0.30, 0.33], \n    8: [0.73, 0.20, 0.27], \n    9: [0.69, 0.10, 0.21],\n    10: [0.66, 0.00, 0.15]\n}","key":"YyK7azqqqG"},{"type":"output","id":"SnyVXI9llTZfi-xqTmfpQ","data":[],"key":"PtG4Hwwf5t"}],"key":"pFyJXooCFw"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Database loading functionality","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SBtd1fKKCu"}],"identifier":"database-loading-functionality","label":"Database loading functionality","html_id":"database-loading-functionality","implicit":true,"key":"ds9wnYLHFU"}],"key":"xymvz2QEyt"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# needed for DB mapping\nregister_adapter(np.int64, AsIs)\nregister_adapter(Polygon, AsIs)\nregister_adapter(MultiPolygon, AsIs)\n\ndef loadFromDatabase(geodb, taskName, tableName, landUseColumnName, recordId, bbox, crs, \n    dateFilterMin, dateFilterMax, maxRows = None, logging = True, mappedColumnName = None, mappingLambdaFunc = None):\n    \n    conditions = []\n    if not dateFilterMin is None:\n        conditions.append(\"d_update \u003e= '{}'\".format(dateFilterMin));\n\n    if not dateFilterMax is None:\n        conditions.append(\"d_update \u003c= '{}'\".format(dateFilterMax));\n\n    if not recordId is None:\n        conditions.append(\"id=eq.{}\".format(recordId));\n        \n    if len(conditions) == 0:\n        conditions.append(\"id \u003e= -1\")\n        \n    if not bbox is None:\n        transformer = pyproj.Transformer.from_crs(str(crs), \"EPSG:\" + str(db_srid), always_xy=True)\n        bbox_x1y1 = transformer.transform(bbox.min_x, bbox.min_y)\n        bbox_x2y2 = transformer.transform(bbox.max_x, bbox.max_y)\n        bbox_native = BBox((bbox_x1y1[0], bbox_x1y1[1], bbox_x2y2[0], bbox_x2y2[1]), crs)\n    \n        gdf = geodb.get_collection_by_bbox(collection = tableName, \n            bbox = (bbox_native.min_x, bbox_native.min_y, bbox_native.max_x, bbox_native.max_y), \n            where = \" AND \".join(conditions),\n            comparison_mode = \"intersects\", bbox_crs = db_srid, \n            limit = 0 if maxRows is None else maxRows, offset = 0)\n    else:\n        gdf = geodb.get_collection(collection = tableName, query = \" AND \".join(conditions))\n        \n    gdf.crs = fiona.crs.from_epsg(db_srid)\n    gdf = gdf.to_crs(str(crs))\n    gdf.crs = {\"init\": \"epsg:{}\".format(crs.value)}\n    \n    # Map the specific \"raba_id\" column to the general \"land_use\". Also add a mapped column name if needed.\n    gdf[\"land_use\"] = gdf[\"raba_id\"]\n    if (mappedColumnName and mappingLambdaFunc):\n        gdf[mappedColumnName] = gdf.apply(lambda row: mappingLambdaFunc(row[\"raba_id\"]), axis = 1)\n    \n    if logging and not bbox is None:\n        print(taskName + \": \" + str(len(gdf)) + ' DB records for bbox = ' + str(bbox))\n\n    return gdf\n\n\ndef loadFromDatabaseWithLulcMapping(geodb, taskName, tableName, landUseColumnName, recordId, bbox, crs, \n    dateFilterMin, dateFilterMax, maxRows = None, logging = True):\n    \n    return loadFromDatabase(geodb, taskName, tableName, landUseColumnName, recordId, bbox, crs, \n        dateFilterMin, dateFilterMax, maxRows, logging,\n        \"lulcid\", lambda lulc: landUseToLulcMapping[lulc] if lulc in landUseToLulcMapping else 0)","key":"a5j5GZ7GyH"},{"type":"output","id":"FTTJXgIABP7hPmiRd-J2i","data":[],"key":"CYpBdJ0Gh9"}],"key":"i9PW37gtwr"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"SentinelHub client functionality","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aitGrLRXuW"}],"identifier":"sentinelhub-client-functionality","label":"SentinelHub client functionality","html_id":"sentinelhub-client-functionality","implicit":true,"key":"DoQlhJ91He"}],"key":"iSiTAXWQOj"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"class SentinelHubClient():\n    def __init__(self, sh_oauth_session, s3_bucket):\n        self.sh_oauth_session = sh_oauth_session\n        self.s3_bucket = s3_bucket\n        \n    def getCollectionByName(self, name):\n        try:\n            url = \"{base_url}/byoc/collections\"\n            url = url.format(base_url = sentinelhub_url)\n            response = self.sh_oauth_session.get(url = url)\n            response.raise_for_status()\n\n            for collection_data in response.json()[\"data\"]:\n                if collection_data[\"name\"] == name:\n                    return collection_data[\"id\"]\n            return None\n        except Exception as e:\n            print(e)\n            raise\n    \n    def createCollection(self, name):\n        try:\n            url = \"{base_url}/byoc/collections\"\n            url = url.format(base_url = sentinelhub_url)\n            response = self.sh_oauth_session.post(url = url, json = {'name': name, 's3Bucket': self.s3_bucket})\n            response.raise_for_status()\n            return response.json()[\"data\"][\"id\"]\n        except Exception as e:\n            print(e)\n            raise\n            \n    def getTileByPath(self, collection_id, s3_file_path):\n        try:\n            url = \"{base_url}/byoc/collections/{collection_id}/tiles\"\n            url = url.format(base_url = sentinelhub_url, collection_id = collection_id)\n            response = self.sh_oauth_session.get(url = url)\n            response.raise_for_status()\n\n            for tile_data in response.json()[\"data\"]:\n                if tile_data[\"path\"] == s3_file_path:\n                    return tile_data[\"id\"]\n            return None\n        except Exception as e:\n            print(e)\n            raise\n            \n    def deleteTile(self, collection_id, tile_id):\n        try:\n            url = \"{base_url}/byoc/collections/{collection_id}/tiles/{tile_id}\"\n            url = url.format(base_url = sentinelhub_url, collection_id = collection_id, tile_id = tile_id)\n            response = self.sh_oauth_session.delete(url = url)\n            response.raise_for_status()\n        except Exception as e:\n            print(e)\n            raise\n            \n    def ingestTile(self, collection_id, s3_file_path, bbox):\n        try:\n            crs = {\"type\": \"name\", \"properties\": {\"name\": \"urn:ogc:def:crs:EPSG::{}\".format(bbox.crs.value)}}\n            cover_geometry = geoJsonPolygon([bbox.get_polygon()], crs = crs)\n            json = json = {\"path\": s3_file_path, \"coverGeometry\": cover_geometry, \"tileGeometry\": cover_geometry}\n            \n            url = \"{base_url}/byoc/collections/{collection_id}/tiles\"\n            url = url.format(base_url = sentinelhub_url, collection_id = collection_id)\n            response = self.sh_oauth_session.post(url = url, json = json)\n            response.raise_for_status()\n            tile_id = response.json()[\"data\"][\"id\"]\n\n            # wait until tile ingested\n            url = \"{base_url}/byoc/collections/{collection_id}/tiles/{tile_id}\"\n            url = url.format(base_url = sentinelhub_url, collection_id = collection_id, tile_id = tile_id)\n            while True:\n                response = self.sh_oauth_session.get(url = url)\n                response.raise_for_status()\n                status = response.json()[\"data\"][\"status\"]\n                if status != 'INGESTING' and status != 'WAITING':\n                    if status == 'FAILED':\n                        print(\"Failed to ingest tile \" + s3_file_path + \": \" + response.json()[\"data\"][\"failedIngestionCause\"])\n                    break\n                time.sleep(1)\n            \n            return tile_id\n        except Exception as e:\n            print(e)\n            raise","key":"g9u8YKv9DN"},{"type":"output","id":"F0towkSRgbq0SLwsMZyFe","data":[],"key":"xTFGtoqYNE"}],"key":"oz6t9jp94c"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Part 1: Exploratory Analysis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZfRc7WJMm3"}],"identifier":"part-1-exploratory-analysis","label":"Part 1: Exploratory Analysis","html_id":"part-1-exploratory-analysis","implicit":true,"key":"YdF7PKMraD"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Define the Area-of-Interest (AOI):","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eMNv81KEPr"}],"identifier":"define-the-area-of-interest-aoi","label":"Define the Area-of-Interest (AOI):","html_id":"define-the-area-of-interest-aoi","implicit":true,"key":"R8SUSt1ZUV"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The whole territory of a country is splited into patches which makes the processing more efficient. The process is run on are of 3x3 patches for demonstration purposes.  AOI can be selected as the id of the patch in the middle.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"NCnAtS33W6"}],"key":"DCes7BxzrX"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Main steps in this part of the notebook:","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"f0NzQ53Tnc"}],"key":"pLU2ovKQ0K"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":8,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"A geographical shape of Slovenia was taken from ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Lzz7QcSrzA"},{"type":"link","url":"http://www.naturalearthdata.com/downloads/10m-cultural-vectors/","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Natural Earth database","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"uQ7leCXbKN"}],"urlSource":"http://www.naturalearthdata.com/downloads/10m-cultural-vectors/","key":"FduyztaHeg"},{"type":"text","value":" and a buffer was applied. The shape is available in repository: ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"UuqdBMJHjK"},{"type":"inlineCode","value":"example_data/svn_buffered.geojson","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ifaGEZ88rl"}],"key":"ZGC8mWca7i"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Convert it to selected CRS: taken to be the CRS of central UTM tile (UTM_33N)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jNu146w4kW"}],"key":"beOWWBZqlo"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Split it into smaller, manageable, non-overlapping rectangular tiles (patches)","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"SNnrVAjHID"}],"key":"spfNCpBe35"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"Select a small 3x3 area for classification","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"XWMpvdvudD"}],"key":"T2XOUW15Sz"}],"key":"cGuTFSJSLo"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Be sure that your choice of CRS is the same as the CRS of your reference data.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"tYF9PmVQTx"}],"key":"QYa7nbiPra"},{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"In the case that you are having problems with empty data being downloaded, try changing the CRS to something that suits the location of the AOI better.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"NtYKuru6wn"}],"key":"XGnN4g24ZF"}],"key":"vqBp2kLlaN"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"country_crs = CRS(country_crs_code)\n\n# Folder where data for running the notebook is stored\nDATA_FOLDER = os.path.join('example_data')\n\n# Load geojson file\ncountry = gpd.read_file(os.path.join(DATA_FOLDER, country_border_file))\n\n# Convert CRS\ncountry = country.to_crs(crs={'init': CRS.ogc_string(country_crs)})\n\n# Get the country's shape in polygon format\ncountry_shape = country.geometry.values[-1]\n\n# Create the splitter to obtain a list of bboxes\nuse_smaller_patches = True\nbbox_splitter_large = BBoxSplitter([country_shape], country_crs, (25, 17))\nbbox_splitter_small = BBoxSplitter([country_shape], country_crs, (25 * 3, 17 * 3))\n\nbbox_splitter = bbox_splitter_small if use_smaller_patches else bbox_splitter_large\nbbox_list_aligned = [BBox((10 * math.floor(bbox.min_x / 10), 10 * math.floor(bbox.min_y / 10), \n                           10 * math.floor(bbox.max_x / 10), 10 * math.floor(bbox.max_y / 10)), country_crs) \n                     for bbox in bbox_splitter.get_bbox_list()]\n\nbbox_list = np.array(bbox_list_aligned)\ninfo_list = np.array(bbox_splitter.get_info_list())\n\n\n# For the future examples, we will be using a specific set of patches,\n# Select a central patch\n\nfrom_wgs84_transformer = pyproj.Transformer.from_crs(str(CRS.WGS84), str(country_crs), always_xy=True)\ncenter_x, center_y = from_wgs84_transformer.transform(selected_patch_center[0], selected_patch_center[1])\n\ndef bboxContains(bbox, x, y):\n    return (x \u003e= bbox.min_x) and (x \u003c bbox.max_x) and (y \u003e= bbox.min_y) and (y \u003c bbox.max_y)\n\n# find index of the patch that contains user-defined central coordinate\ncenter_patch_index = next((index for index, bbox in enumerate(bbox_list) if bboxContains(bbox, center_x, center_y)), None)\n\n# Obtain surrounding patches\npatchIDs = []\nfor idx, [bbox, info] in enumerate(zip(bbox_list, info_list)):\n    if (abs(info['index_x'] - info_list[center_patch_index]['index_x']) \u003c= 1 and\n        abs(info['index_y'] - info_list[center_patch_index]['index_y']) \u003c= 1):\n        patchIDs.append(idx)\n\n# Check if final size is 3x3\nif len(patchIDs) \u003c 9:\n    print('Warning! Use a different central patch ID, this one is on the border.')\n    \n# Change the order of the patches (used for plotting later)\npatchIDs = np.transpose(np.fliplr(np.array(patchIDs).reshape(3, 3))).ravel()\n\n# Prepare info of selected EOPatches\ngeometry = [Polygon(bbox.get_polygon()) for bbox in bbox_list[patchIDs]]\nidxs_x = [info['index_x'] for info in info_list[patchIDs]]\nidxs_y = [info['index_y'] for info in info_list[patchIDs]]\n\ngdf = gpd.GeoDataFrame({'index_x': idxs_x, 'index_y': idxs_y}, \n                       crs={'init': CRS.ogc_string(country_crs)}, \n                       geometry=geometry)\n\n## NOTE: save to shapefile, uncomment if needed\n# shapefile_name = './selected_3x3_bboxes_' + country_name + '_small.shp' if use_smaller_patches \\\n#    else './selected_3x3_bboxes_' + country_name + '_large.shp'\n# gdf.to_file(shapefile_name)\n\n# Visualize the selection\npoly = gdf['geometry'][0]\nx1, y1, x2, y2 = poly.bounds\naspect_ratio = (y1 - y2) / (x1 - x2)\n\nfontdict = {'family': 'monospace', 'weight': 'normal', 'size': 11}\n\n# if bboxes have all same size, estimate offset\nxl, yl, xu, yu = gdf.geometry[0].bounds\nxoff, yoff = (xu - xl) / 3, (yu - yl) / 5\n\n# figure\nfig, ax = plt.subplots(figsize=(20, 20));\ngdf.plot(ax=ax,facecolor='w',edgecolor='r',alpha=0.5);\ncountry.plot(ax=ax, facecolor='w',edgecolor='b',alpha=0.5);\nax.set_title('Selected 3x3 patches within the border');\nplt.axis('off');","key":"bFt36YwLqW"},{"type":"output","id":"WZUCuhUVjyXjtHBjfhc5c","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"a244e8a112c015709cadea38019b9f50","path":"/notebooks_test/build/a244e8a112c015709cadea38019b9f50.png"},"text/plain":{"content":"\u003cFigure size 1440x1440 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"xZ6LCTmxE9"}],"key":"pZvFGhMUIg"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualization of land use (reference) data in selected AOI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EtOTSnyuu0"}],"identifier":"visualization-of-land-use-reference-data-in-selected-aoi","label":"Visualization of land use (reference) data in selected AOI","html_id":"visualization-of-land-use-reference-data-in-selected-aoi","implicit":true,"key":"IUrK48upqe"}],"key":"kTwkVHwGIt"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Rearange selected EOPatches into bbox, which can be used for xcube definition\npatches_geometries = [Polygon(bbox.transform(CRS.WGS84).get_polygon()) for bbox in bbox_list[patchIDs]]\nbbox_of_patches = gpd.GeoSeries(cascaded_union(patches_geometries))\n\nx1 = bbox_of_patches.bounds['minx'][0].item()\ny1 = bbox_of_patches.bounds['miny'][0].item()\nx2 = bbox_of_patches.bounds['maxx'][0].item()\ny2 = bbox_of_patches.bounds['maxy'][0].item()\ntotal_bbox_wgs84 = x1, y1, x2, y2","key":"e464zzN19c"},{"type":"output","id":"ajDI49383-erNOXRlWtq2","data":[],"key":"NmEH6jKJ9X"}],"key":"SXaVGAxRhA"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Rearange selected EOPatches into bbox, which can be used for xcube definition\npatches_geometries = [Polygon(bbox.get_polygon()) for bbox in bbox_list[patchIDs]]\nbbox_of_patches = gpd.GeoSeries(cascaded_union(patches_geometries))\n\nx1 = bbox_of_patches.bounds['minx'][0].item()\ny1 = bbox_of_patches.bounds['miny'][0].item()\nx2 = bbox_of_patches.bounds['maxx'][0].item()\ny2 = bbox_of_patches.bounds['maxy'][0].item()\ntotal_bbox = x1, y1, x2, y2","key":"XbpD7wkQLG"},{"type":"output","id":"8PMsXznKFrfrGPdtnfkIk","data":[],"key":"D315KKFwI9"}],"key":"KXBhIuOoSJ"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Land use (reference) data for selected AOI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Do13RPaPrY"}],"identifier":"land-use-reference-data-for-selected-aoi","label":"Land use (reference) data for selected AOI","html_id":"land-use-reference-data-for-selected-aoi","implicit":true,"key":"zmmYx1ToSa"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Land use data are public in Slovenia, you can download the full dataset ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ajezP8TVdo"},{"type":"link","url":"http://rkg.gov.si/GERK/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"here","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vfrtLR5MSs"}],"urlSource":"http://rkg.gov.si/GERK/","key":"RTJer72eAu"},{"type":"text","value":", selecting the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"MjuhAhjEhR"},{"type":"inlineCode","value":"Grafični podatki RABA za celo Slovenijo (shape.rar ~ 500 MB) KoordSistem: D96/TM","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"o4HH7SHqV3"},{"type":"text","value":". The dataset is provided in the national ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"pcir53fnzg"},{"type":"inlineCode","value":"D96/TM","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"M910BGtG8P"},{"type":"text","value":" coordinate system. It was stored ingeo database. Transformation of reference data to ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SqaSfkqxCp"},{"type":"inlineCode","value":"UTM_33N","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Cd5DNZN9b2"},{"type":"text","value":" is preformed while reading the data from the database.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"rHIKOTmgxS"}],"key":"dmT35nb3ou"}],"key":"E5iJagiDhy"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Distinct \"d_update\":\ndistinct_d_update = [    \n    \"2019-09-30\",\n    \"2019-06-30\",\n    \"2019-03-31\",\n    \"2019-01-03\",\n    \"2018-09-30\",\n    \"2018-06-30\",\n    \"2018-03-31\",\n    \"2017-12-31\",\n    \"2017-09-30\",\n    \"2017-06-30\",\n    \"2017-03-31\",\n    \"2016-12-31\",\n    \"2016-09-30\",\n    \"2016-06-30\",\n    \"2016-03-31\",\n    \"2015-12-31\",\n    \"2015-09-30\",\n    \"2015-06-30\",\n    \"2015-03-31\",\n    \"2015-01-13\"\n]","key":"QfxHHt0YGM"},{"type":"output","id":"Gz1rWQfsN3ATkCv6verKa","data":[],"key":"qI8LlZtxWZ"}],"key":"PIk8DFYkFm"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot time series of land use and mapped land use for selected bbox","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xYig53QO17"}],"identifier":"plot-time-series-of-land-use-and-mapped-land-use-for-selected-bbox","label":"Plot time series of land use and mapped land use for selected bbox","html_id":"plot-time-series-of-land-use-and-mapped-land-use-for-selected-bbox","implicit":true,"key":"LF3Spxtgm7"}],"key":"HuZS9Wexsv"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"selected_timeseries_times = [distinct_d_update[0], distinct_d_update[5], distinct_d_update[8]]\nselected_timeseries_center = (15.5250405633, 46.5505120371) # longitude, latitude\nselected_timeseries_size = 900 # meters\n\ndef displayPlot(title, ax, data, dataColumn, bbox, colorMapping, legendMapping):\n    ax.set_xlim([bbox.min_x, bbox.max_x])\n    ax.set_ylim([bbox.min_y, bbox.max_y])\n\n    # since geopandas does its own normalization, we need to find used values,\n    # to properly map the colors and legend texts to the actual values\n    uniqueVals = data[dataColumn].unique()\n    uniqueVals.sort()\n    cmap = colors.ListedColormap([colorMapping[val] for val in uniqueVals])\n    norm = colors.BoundaryNorm(range(cmap.N), cmap.N)\n    \n    data.plot(ax=ax, column=dataColumn, edgecolor='w', alpha=1, categorical=True, legend=True, cmap=cmap, norm=norm)\n    ax.set_title(title);\n    for text, label in zip(ax.get_legend().get_texts(), [legendMapping[val] for val in uniqueVals]):\n        text.set_text(label)\n\ngeodb = GeoDBClient()\nfrom_wgs84_transformer = pyproj.Transformer.from_crs(str(CRS.WGS84), str(country_crs), always_xy=True)\nx, y = from_wgs84_transformer.transform(selected_timeseries_center[0], selected_timeseries_center[1])\nsize = selected_timeseries_size\nbbox = (x - size * 0.5, y - size * 0.5, x + size * 0.5, y + size * 0.5)\nbbox = BBox(bbox=list(bbox), crs=country_crs)\n\nfor d_update in selected_timeseries_times:\n    # Plot time series of land use for selected bbox\n    land_use = loadFromDatabaseWithLulcMapping(geodb, \"Land use\", db_land_use_table, db_land_use_class_column, \n        None, bbox, bbox.crs, d_update, d_update)\n    \n    fig, axes = plt.subplots(1, 2, figsize=(20, 20))\n\n    displayPlot('Land Use ({})'.format(d_update), axes[0], land_use, 'land_use', bbox, landUseColorMapping, landUseLegendTexts)\n    displayPlot('Mapped land use ({})'.format(d_update), axes[1], land_use, 'lulcid', bbox, lulcColorMapping, lulcLegendTexts)","key":"nxOm0ANgxr"},{"type":"output","id":"72PP8wLBRgEpuJKnvyWtQ","data":[{"name":"stdout","output_type":"stream","text":"Land use: 115 DB records for bbox = 539799.9999979775,5154900.000002044,540699.9999979775,5155800.000002044\nLand use: 90 DB records for bbox = 539799.9999979775,5154900.000002044,540699.9999979775,5155800.000002044\nLand use: 91 DB records for bbox = 539799.9999979775,5154900.000002044,540699.9999979775,5155800.000002044\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"d8dd8414a5537a5af414501dd25538aa","path":"/notebooks_test/build/d8dd8414a5537a5af414501dd25538aa.png"},"text/plain":{"content":"\u003cFigure size 1440x1440 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"4b80ec4aac5fb11fdeb847be93cbed4e","path":"/notebooks_test/build/4b80ec4aac5fb11fdeb847be93cbed4e.png"},"text/plain":{"content":"\u003cFigure size 1440x1440 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"592c048f9433b1dab1713b68cae511d6","path":"/notebooks_test/build/592c048f9433b1dab1713b68cae511d6.png"},"text/plain":{"content":"\u003cFigure size 1440x1440 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"dhUneJH4jK"}],"key":"C72xv0Ty4F"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Satellite imagery for selected AOI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wysMYBJ7YF"}],"identifier":"satellite-imagery-for-selected-aoi","label":"Satellite imagery for selected AOI","html_id":"satellite-imagery-for-selected-aoi","implicit":true,"key":"rgDlPfTnsQ"}],"key":"Ols4cxaD7d"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Configure xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZV2gYYJzHP"}],"identifier":"configure-xcube","label":"Configure xcube","html_id":"configure-xcube","implicit":true,"key":"nsTh0ZvyjH"}],"key":"rhDV962TyJ"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"## Plot time series of satellite images for bbox\nspatial_res_meters = 10\npixx = (total_bbox[2] - total_bbox[0]) / spatial_res_meters; pixy = (total_bbox[3] - total_bbox[1]) / spatial_res_meters;\nspatial_res = float(np.mean([(total_bbox_wgs84[2] - total_bbox_wgs84[0]) / pixx, (total_bbox_wgs84[3] - total_bbox_wgs84[1]) / pixy]))\n\ncube_config = CubeConfig(dataset_name='S2L1C',\n                         band_names=[\"B02\", \"B03\", \"B04\", \"B08\", \"B11\", \"B12\"],\n                         chunk_size=[512, 512],\n                         geometry=total_bbox_wgs84,\n                         spatial_res=spatial_res,\n                         time_range=['2019-02-01', '2019-09-30'],\n                         time_period='4D')  \n\n# So we can print some SentinelHub usage stats\nrequest_collector = Observers.request_collector()\ncube = open_cube(cube_config, request_collector, client_id=sentinelhub_client_id, client_secret=sentinelhub_client_secret)\n\n# Add Indecies\n## NDVI\nb_red = cube.B04\nb_nir = cube.B08\nndvi = (b_nir - b_red) / (b_nir + b_red)\nndvi.attrs['long_name'] = 'Normalized Difference Vegetation Index'\nndvi.attrs['units'] = 'unitless'\ncube[\"ndvi\"] = ndvi\n\n## NDWI\nb_green = cube.B03\nb_nir = cube.B08\nndwi = (b_green - b_nir) / (b_green + b_nir)\nndwi.attrs['long_name'] = 'Normalized Difference Water Index'\nndwi.attrs['units'] = 'unitless'\ncube[\"ndwi\"] = ndwi\n\n# cube.time","key":"yME9aotZVJ"},{"type":"output","id":"PJavRiB-0QxD2bFwv_oS9","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\store.py:73: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future\n  t_array = np.array([s + 0.5 * (e - s) for s, e in self._time_ranges]).astype('datetime64[s]').astype(np.int64)\nE:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\store.py:74: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future\n  t_bnds_array = np.array(self._time_ranges).astype('datetime64[s]').astype(np.int64)\n"}],"key":"ErQbHPtzmu"}],"key":"OovEyc9kbR"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot True Color image from selected date","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"w8jVoS1OU6"}],"identifier":"plot-true-color-image-from-selected-date","label":"Plot True Color image from selected date","html_id":"plot-true-color-image-from-selected-date","implicit":true,"key":"C0wdZ29JXH"}],"key":"rYVI0lv23I"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# True color image\nfactor = 2.5\nR = cube.B04.sel(time=selected_patch_displayed_time)*factor\nG = cube.B03.sel(time=selected_patch_displayed_time)*factor\nB = cube.B02.sel(time=selected_patch_displayed_time)*factor\nRGB = np.dstack([R, G, B])\nrgb_array = xr.DataArray(RGB, dims=('lat', 'lon', 'b'), coords=dict(lat=cube.B04.lat, lon=cube.B04.lon))\nimg = rgb_array.plot.imshow(rgb='b', figsize=(16, 16))","key":"d0y1sh10dU"},{"type":"output","id":"25VymRRyMzVZtPbT2fA0S","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"c35d33c5e9c6c128b1c0a25549664868","path":"/notebooks_test/build/c35d33c5e9c6c128b1c0a25549664868.png"},"text/plain":{"content":"\u003cFigure size 1152x1152 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"goBPTtqwPn"}],"key":"ergWnyT8oj"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot time series of satellite images for selected band","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lY8YuPEK80"}],"identifier":"plot-time-series-of-satellite-images-for-selected-band","label":"Plot time series of satellite images for selected band","html_id":"plot-time-series-of-satellite-images-for-selected-band","implicit":true,"key":"Iclx3A8vcU"}],"key":"jT1pEzAghh"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot time series of band B04\nimg = cube.B04.plot.imshow(col='time', col_wrap=4, vmin=0, vmax=0.2, cmap='Greys_r')","key":"ankZcvLsUJ"},{"type":"output","id":"czhaLiRubR2qXtkXH33Ph","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"71e7fa94e688b44fb5a4110052898aab","path":"/notebooks_test/build/71e7fa94e688b44fb5a4110052898aab.png"},"text/plain":{"content":"\u003cFigure size 936x3456 with 65 Axes\u003e","content_type":"text/plain"}}}],"key":"cLM3CEDILF"}],"key":"snvj0E66GS"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot time series of NDVI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"UDPVUlWDwZ"}],"identifier":"plot-time-series-of-ndvi","label":"Plot time series of NDVI","html_id":"plot-time-series-of-ndvi","implicit":true,"key":"pjlJ5KuHFf"}],"key":"aOv09qBmhf"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot time series of NDVI\nimg = cube.ndvi.plot.imshow(col='time', col_wrap=4, vmin=-0.2, vmax=0.8, cmap='YlGn')","key":"AjUv2qkT7R"},{"type":"output","id":"qa7tRTpdtOYdlx97mNHwl","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"8ea762ec607d77a2c72d772a403c5ecc","path":"/notebooks_test/build/8ea762ec607d77a2c72d772a403c5ecc.png"},"text/plain":{"content":"\u003cFigure size 936x3456 with 65 Axes\u003e","content_type":"text/plain"}}}],"key":"bh0KF5pEsK"}],"key":"EmRklimPHi"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot all bands and data in xcube for given date","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tggcU1jLWL"}],"identifier":"plot-all-bands-and-data-in-xcube-for-given-date","label":"Plot all bands and data in xcube for given date","html_id":"plot-all-bands-and-data-in-xcube-for-given-date","implicit":true,"key":"omOWGHE66r"}],"key":"OoJBdNPI9A"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot all bands and data in xcube for given date\nfor band in cube.data_vars:\n    cube[band].sel(time=selected_patch_displayed_time).plot.imshow(vmin=0, vmax=0.4, cmap='Greys_r', figsize=(16, 14))","key":"DxVc6yfurx"},{"type":"output","id":"-5prGvERAdffOuw92X0t5","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"0276853a4959f604fcbdc34ea38b0fbc","path":"/notebooks_test/build/0276853a4959f604fcbdc34ea38b0fbc.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"e6a234ef4bb9765c0b03a9f8f7fd3dbf","path":"/notebooks_test/build/e6a234ef4bb9765c0b03a9f8f7fd3dbf.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"2f479856efa2fa75e91df1a5eb373f0e","path":"/notebooks_test/build/2f479856efa2fa75e91df1a5eb373f0e.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"0b169413d5c8ff7cac37a4cce0175bfa","path":"/notebooks_test/build/0b169413d5c8ff7cac37a4cce0175bfa.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"f16cb8018bd9c16661bbd66d20c0b112","path":"/notebooks_test/build/f16cb8018bd9c16661bbd66d20c0b112.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"23055f7706170a3fbc819f5173b226aa","path":"/notebooks_test/build/23055f7706170a3fbc819f5173b226aa.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"b9bba6e79c3e87e4b83f59722da0263a","path":"/notebooks_test/build/b9bba6e79c3e87e4b83f59722da0263a.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"0bce00ea5d2cc1882dac1d655f27e974","path":"/notebooks_test/build/0bce00ea5d2cc1882dac1d655f27e974.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"VKr6Pkqu2d"}],"key":"hZSwH1qbWC"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":5,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Zoom closer to user defined area (mask xcube)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RJTcehluev"}],"identifier":"zoom-closer-to-user-defined-area-mask-xcube","label":"Zoom closer to user defined area (mask xcube)","html_id":"zoom-closer-to-user-defined-area-mask-xcube","implicit":true,"key":"Zykx6lyeq4"}],"key":"EilKpXj8iX"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# Mask original cube with smaller bbox\n#zoomed_center = (15.1645, 46.2495) # (13.860377, 46.283196) # longitude, latitude\nzoomed_center = (0.5 * (total_bbox_wgs84[0] + total_bbox_wgs84[2]), 0.5 * (total_bbox_wgs84[1] + total_bbox_wgs84[3]))\nzoomed_size = 0.25 # ratio to the original 3x3 patches cube\n\nzoomed_size_degrees = zoomed_size\nselected_bbox = (\n    zoomed_center[0] - zoomed_size * 0.5 * (total_bbox_wgs84[2] - total_bbox_wgs84[0]), \n    zoomed_center[1] - zoomed_size * 0.5 * (total_bbox_wgs84[3] - total_bbox_wgs84[1]),\n    zoomed_center[0] + zoomed_size * 0.5 * (total_bbox_wgs84[2] - total_bbox_wgs84[0]), \n    zoomed_center[1] + zoomed_size * 0.5 * (total_bbox_wgs84[3] - total_bbox_wgs84[1])\n)\nsmall_cube = xcube.core.geom.mask_dataset_by_geometry(cube, selected_bbox, no_clip=False, save_geometry_wkt=True)","key":"mtuCcF9vQ3"},{"type":"output","id":"nsP4BWOfd3IFN9w6IF356","data":[],"key":"bDVrYppF2J"}],"key":"u0AyEZPaGX"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# True color\nfactor = 2.5\nR = small_cube.B04.sel(time=selected_patch_displayed_time)*factor\nG = small_cube.B03.sel(time=selected_patch_displayed_time)*factor\nB = small_cube.B02.sel(time=selected_patch_displayed_time)*factor\nRGB = np.dstack([R, G, B])\nrgb_array = xr.DataArray(RGB, dims=('lat', 'lon', 'b'), coords=dict(lat=small_cube.B04.lat, lon=small_cube.B04.lon))\nimg = rgb_array.plot.imshow(rgb='b', figsize=(16, 16))","key":"MAO8RypV0A"},{"type":"output","id":"D6lIXHSLtdLUFlChmX8iB","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"a86f7615242354a67a7a69d997c08f58","path":"/notebooks_test/build/a86f7615242354a67a7a69d997c08f58.png"},"text/plain":{"content":"\u003cFigure size 1152x1152 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"IqYBwQp7mc"}],"key":"GSVdzg85vy"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot all bands for selected time\nfor band in small_cube.data_vars:\n    small_cube[band].sel(time=selected_patch_displayed_time).plot.imshow(vmin=0, vmax=0.4, cmap='Greys_r', figsize=(16, 14))","key":"HQM954iBa8"},{"type":"output","id":"9tfKGUfUuloabOX9LxR4k","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"ed4c46c6fb9b6aa9dacc5242b82b5e12","path":"/notebooks_test/build/ed4c46c6fb9b6aa9dacc5242b82b5e12.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"55f2b80d40a208e23e79b2945f2bfc4f","path":"/notebooks_test/build/55f2b80d40a208e23e79b2945f2bfc4f.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"2beb2d9ae0220a4ad20f991dd7cb8811","path":"/notebooks_test/build/2beb2d9ae0220a4ad20f991dd7cb8811.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"b243af6ba1f386e965b5ee769c3394bb","path":"/notebooks_test/build/b243af6ba1f386e965b5ee769c3394bb.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"e932ce9e4278737dbe714412a0da058c","path":"/notebooks_test/build/e932ce9e4278737dbe714412a0da058c.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"f8d06bfddd9b577f59a8a9532bda6d46","path":"/notebooks_test/build/f8d06bfddd9b577f59a8a9532bda6d46.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"386f3be2bebb9471157010dfea647d09","path":"/notebooks_test/build/386f3be2bebb9471157010dfea647d09.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"0dd143e55e18992a14f62625ae35fb88","path":"/notebooks_test/build/0dd143e55e18992a14f62625ae35fb88.png"},"text/plain":{"content":"\u003cFigure size 1152x1008 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"QAjRcgFyvo"}],"key":"fgSj4UJ6il"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Part 2: LULC prediction with Machine Learning","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tkeJeqLdeP"}],"identifier":"part-2-lulc-prediction-with-machine-learning","label":"Part 2: LULC prediction with Machine Learning","html_id":"part-2-lulc-prediction-with-machine-learning","implicit":true,"key":"KaqrSY8Fio"}],"key":"W8QXQVe1Ea"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set some of the inputs for prediction with ML","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SxwJWNRrbG"}],"identifier":"set-some-of-the-inputs-for-prediction-with-ml","label":"Set some of the inputs for prediction with ML","html_id":"set-some-of-the-inputs-for-prediction-with-ml","implicit":true,"key":"XqHkYWAhnS"}],"key":"J5RTHYWXwa"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"selected_db_land_use_date = '2019-09-30'\nselected_date_interval_for_satellite_imagery = ['2019-01-01', '2019-09-19']\nselected_max_cc = 0.8","key":"c36x5KuRxx"},{"type":"output","id":"oCNjYhK3D_d-lJo8O9jYm","data":[],"key":"tLDwI6Tzxj"}],"key":"BKyII3l5qr"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Fill EOPatches with data:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wWV0tbkfcn"}],"identifier":"fill-eopatches-with-data","label":"Fill EOPatches with data:","html_id":"fill-eopatches-with-data","implicit":true,"key":"tjzz0qk9KA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Now it’s time to create EOPatches and fill them with Sentinel-2 data using Sentinel Hub services. We will add the following data to each EOPatch:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"jH8CTeDVhn"}],"key":"ULE76LFF47"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"L1C custom list of bands [B02, B03, B04, B08, B11, B12], which corresponds to [B, G, R, NIR, SWIR1, SWIR2] wavelengths.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"AyNRqQ7fnV"}],"key":"zJ6pZo7Sm6"}],"key":"IzY7WiTK2M"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"SentinelHub’s cloud probability map and cloud mask","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ErBg8sqySW"}],"key":"HyoGcvHK6v"}],"key":"EulKbA2XbD"}],"key":"cvFS9rERsf"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Additionally, we will add:","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"CUSYevObCG"}],"key":"CBI6GM3doX"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":11,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Calculated NDVI, NDWI, euclidean NORM information","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"JPtKaZtmZZ"}],"key":"XY12M79Izd"}],"key":"vZ8gvJXqVx"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"A mask of validity, based on acquired data from Sentinel and cloud coverage. Valid pixel is if:","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"FFU2K5xZNK"}],"key":"hf6yjqXSwN"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"IS_DATA == True","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"uJqPpJ9Wo9"}],"key":"FEB3QZ4HbR"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"CLOUD_MASK == 0 (1 indicates that pixel was identified to be covered with cloud)","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"dCfS8Z4QSO"}],"key":"hAdND4tiiP"}],"key":"YmOBXGzZsc"}],"key":"jpxWydmc5i"}],"key":"oB8oZdlYFv"},{"type":"paragraph","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"An EOPatch is created and manipulated using EOTasks, which are chained in an EOWorkflow. In this example the final workflow is executed on all patches, which are saved to the specified directory.","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"nqh5uRQB9C"}],"key":"U2iPbcO76s"}],"key":"qokegdURO7"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define some needed custom EOTasks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iBEToDLm1u"}],"identifier":"define-some-needed-custom-eotasks","label":"Define some needed custom EOTasks","html_id":"define-some-needed-custom-eotasks","implicit":true,"key":"fUAzTAtIKj"}],"key":"sZJABF8D4o"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"class SentinelHubValidData:\n    \"\"\"\n    Combine Sen2Cor's classification map with `IS_DATA` to define a `VALID_DATA_SH` mask\n    The SentinelHub's cloud mask is asumed to be found in eopatch.mask['CLM']\n    \"\"\"\n    def __call__(self, eopatch):        \n        return np.logical_and(eopatch.mask['IS_DATA'].astype(np.bool), \n                              np.logical_not(eopatch.mask['CLM'].astype(np.bool)))\n    \nclass CountValid(EOTask):   \n    \"\"\"\n    The task counts number of valid observations in time-series and stores the results in the timeless mask.\n    \"\"\"\n    def __init__(self, count_what, feature_name):\n        self.what = count_what\n        self.name = feature_name\n        \n    def execute(self, eopatch):\n        eopatch.add_feature(FeatureType.MASK_TIMELESS, self.name, np.count_nonzero(eopatch.mask[self.what],axis=0))\n        \n        return eopatch\n\n\nclass NormalizedDifferenceIndex(EOTask):   \n    \"\"\"\n    The tasks calculates user defined Normalised Difference Index (NDI) between two bands A and B as:\n    NDI = (A-B)/(A+B).\n    \"\"\"\n    def __init__(self, feature_name, band_a, band_b):\n        self.feature_name = feature_name\n        self.band_a_fetaure_name = band_a.split('/')[0]\n        self.band_b_fetaure_name = band_b.split('/')[0]\n        self.band_a_fetaure_idx = int(band_a.split('/')[-1])\n        self.band_b_fetaure_idx = int(band_b.split('/')[-1])\n        \n    def execute(self, eopatch):\n        band_a = eopatch.data[self.band_a_fetaure_name][..., self.band_a_fetaure_idx]\n        band_b = eopatch.data[self.band_b_fetaure_name][..., self.band_b_fetaure_idx]\n        \n        ndi = (band_a - band_b) / (band_a  + band_b)\n        \n        eopatch.add_feature(FeatureType.DATA, self.feature_name, ndi[..., np.newaxis])\n        \n        return eopatch\n\n    \nclass EuclideanNorm(EOTask):   \n    \"\"\"\n    The tasks calculates Euclidian Norm of all bands within an array:\n    norm = sqrt(sum_i Bi**2),\n    where Bi are the individual bands within user-specified feature array.\n    \"\"\"\n    def __init__(self, feature_name, in_feature_name):\n        self.feature_name = feature_name\n        self.in_feature_name = in_feature_name\n    \n    def execute(self, eopatch):\n        arr = eopatch.data[self.in_feature_name]\n        norm = np.sqrt(np.sum(arr**2, axis=-1))\n        \n        eopatch.add_feature(FeatureType.DATA, self.feature_name, norm[..., np.newaxis])\n        return eopatch","key":"sTEBV7Iq3M"},{"type":"output","id":"FFWjvSPcuVLVkgM7a5s-8","data":[],"key":"vds4KKwqoK"}],"key":"OHLdswAh4y"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the workflow tasks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VhyfANet6V"}],"identifier":"define-the-workflow-tasks","label":"Define the workflow tasks","html_id":"define-the-workflow-tasks","implicit":true,"key":"q4Wz8GXnLz"}],"key":"HTuAr6uBpW"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# TASK FOR BAND DATA\n# add a request for B(B02), G(B03), R(B04), NIR (B08), SWIR1(B11), SWIR2(B12) \n# from default layer 'ALL_BANDS' at 10m resolution\n# Here we also do a simple filter of cloudy scenes. A detailed cloud cover \n# detection is performed in the next step\ncustom_script = 'return [B02, B03, B04, B08, B11, B12];'\nadd_data = S2L1CWCSInput(\n    layer='BANDS-S2-L1C', \n    feature=(FeatureType.DATA, 'BANDS'), # save under name 'BANDS'\n    custom_url_params={CustomUrlParam.EVALSCRIPT: custom_script}, # custom url for 6 specific bands\n    resx='10m', # resolution x\n    resy='10m', # resolution y\n    maxcc=selected_max_cc # maximum allowed cloud cover of original ESA tiles\n)\n\n# TASK FOR CLOUD INFO\n# cloud detection is performed at 80m resolution \n# and the resulting cloud probability map and mask \n# are scaled to EOPatch's resolution\ncloud_classifier = get_s2_pixel_cloud_detector(average_over=2, dilation_size=1, all_bands=False)\nadd_clm = AddCloudMaskTask(cloud_classifier, 'BANDS-S2CLOUDLESS', cm_size_y='80m', cm_size_x='80m', \n                           cmask_feature='CLM', # cloud mask name\n                           cprobs_feature='CLP' # cloud prob. map name\n                          )\n\n# TASKS FOR CALCULATING NEW FEATURES\n# NDVI: (B08 - B04)/(B08 + B04)\n# NDWI: (B03 - B08)/(B03 + B08)\n# NORM: sqrt(B02^2 + B03^2 + B04^2 + B08^2 + B11^2 + B12^2)\nndvi = NormalizedDifferenceIndex('NDVI', 'BANDS/3', 'BANDS/2')\nndwi = NormalizedDifferenceIndex('NDWI', 'BANDS/1', 'BANDS/3')\nnorm = EuclideanNorm('NORM','BANDS')\n\n# TASK FOR VALID MASK\n# validate pixels using SentinelHub's cloud detection mask and region of acquisition \nadd_sh_valmask = AddValidDataMaskTask(SentinelHubValidData(), \n                                      'IS_VALID' # name of output mask\n                                     )\n\n# TASK FOR COUNTING VALID PIXELS\n# count number of valid observations per pixel using valid data mask \ncount_val_sh = CountValid('IS_VALID', # name of existing mask\n                          'VALID_COUNT' # name of output scalar\n                         )\n\n# TASK FOR SAVING TO OUTPUT (if needed)\npath_out = './eopatches_small/' if use_smaller_patches else './eopatches_large/'\nif not os.path.isdir(path_out):\n    os.makedirs(path_out)\nsave = SaveTask(path_out, overwrite_permission=OverwritePermission.OVERWRITE_PATCH)","key":"vRwkFxiPAt"},{"type":"output","id":"-eh2dSj4gkw3DlpJj0OVz","data":[],"key":"fTrHVau02D"}],"key":"WHCeCI6Slb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Reference map task","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ceP9GEGZtu"}],"identifier":"reference-map-task","label":"Reference map task","html_id":"reference-map-task","implicit":true,"key":"o4TAuGcDGR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"For this example, a subset of the country-wide reference for land-use-land-cover is provided. It is available in the form of a shapefile, which contains polygons and their corresponding labels. The labels represent the 10 classes from the lulcMapping.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Lgt0RXXQA9"}],"key":"cuKtjC4jk1"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The main point of this task is to create a raster mask from the vector polygons and add it to the eopatch. With this procedure, any kind of a labeled shapefile can be transformed into a raster reference map. This result is achieved with the existing task ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IYThWspCbI"},{"type":"inlineCode","value":"VectorToRaster","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lZ7gy5YEJ1"},{"type":"text","value":" from the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Wf96pmn6O9"},{"type":"inlineCode","value":"eolearn.geometry","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QCzytXugSq"},{"type":"text","value":" package. All polygons belonging to the each of the classes are separately burned to the raster mask.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"XujOTSKKvh"}],"key":"NibceRgay4"}],"key":"ZgMNUNfbsj"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"class LoadFromDatabaseTask(EOTask):\n    def __init__(self, feature, taskName, crs, tableName, landUseColumneName, \n        dateFilterMin, dateFilterMax, mappedColumnName = None, mappingLambdaFunc = None):\n        \n        self.feature_type, self.feature_name = next(self._parse_features(feature)())\n        self.taskName = taskName\n        self.crs = crs\n        self.tableName = tableName\n        self.landUseColumneName = landUseColumneName\n        self.dateFilterMin = dateFilterMin\n        self.dateFilterMax = dateFilterMax\n        self.mappedColumnName = mappedColumnName\n        self.mappingLambdaFunc = mappingLambdaFunc\n\n    def execute(self, eopatch, geodb):\n        eopatch[self.feature_type][self.feature_name] = loadFromDatabase(geodb, \n            self.taskName, self.tableName, self.landUseColumneName, None, eopatch.bbox, eopatch.bbox.crs,\n            self.dateFilterMin, self.dateFilterMax, None, True,\n            self.mappedColumnName, self.mappingLambdaFunc)\n        return eopatch\n    \n\n# LPIS\nload_lpis_db_task = LoadFromDatabaseTask((FeatureType.VECTOR_TIMELESS, 'LPIS_GDF'), \n    \"LPIS\", country_crs, db_lpis_table, db_lpis_class_column, selected_db_land_use_date, selected_db_land_use_date)\n\nlpis_rasterization_task = VectorToRaster((FeatureType.VECTOR_TIMELESS, 'LPIS_GDF'), (FeatureType.MASK_TIMELESS, 'LPIS'),\n    values_column='land_use', raster_shape=None, raster_resolution = 10,\n    raster_dtype=np.uint16)\n\nlpis_export_tiff = ExportToTiff((FeatureType.MASK_TIMELESS, 'LPIS'))\n\n\n# Land use\nload_land_use_db_task = LoadFromDatabaseTask((FeatureType.VECTOR_TIMELESS, 'LAND_USE_GDF'), \n    \"Land use\", country_crs, db_land_use_table, db_land_use_class_column, selected_db_land_use_date, selected_db_land_use_date, \n    \"lulcid\", lambda lulc: landUseToLulcMapping[lulc] if lulc in landUseToLulcMapping else 0)\n\nland_use_rasterization_task = VectorToRaster((FeatureType.VECTOR_TIMELESS, 'LAND_USE_GDF'), (FeatureType.MASK_TIMELESS, 'LAND_USE'),\n    values_column='land_use', raster_shape=None, raster_resolution = 10,\n    raster_dtype=np.uint16)\n\nland_use_export_tiff = ExportToTiff((FeatureType.MASK_TIMELESS, 'LAND_USE'))\n\n\n# LULC, uses the previously loaded LAND_USE_GDF\nlulc_rasterization_task = VectorToRaster((FeatureType.VECTOR_TIMELESS, 'LAND_USE_GDF'), (FeatureType.MASK_TIMELESS, 'LULC'),\n    values_column='lulcid', raster_shape=(FeatureType.MASK, 'IS_VALID'),\n    raster_dtype=np.uint8)\n","key":"UtlSFXJ8sZ"},{"type":"output","id":"WnQyJ8VRJMTXkHlRx-v_3","data":[],"key":"mKN5qK1nLC"}],"key":"KpNbaKqjUb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the workflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AjDO0MYTjq"}],"identifier":"define-the-workflow","label":"Define the workflow","html_id":"define-the-workflow","implicit":true,"key":"U9sbHyHjuF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"All the tasks that were defined so far create and fill the EOPatches. The tasks need to be put in some order and executed one by one. This can be achieved by manually executing the tasks, or more conveniently, defining an ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"B8wimfzdT5"},{"type":"inlineCode","value":"EOWorkflow","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"sH7niVwc7C"},{"type":"text","value":" which does this for you.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GqcFcnNaff"}],"key":"YMAYaKOU1v"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The following workflow is created and executed:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"FqdY5CM4g6"}],"key":"G1CWk1BQVl"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Create EOPatches with band data","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"SrvIg4CVjd"}],"key":"bvAvIZEqpT"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Add cloud info","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"UFDV42Hq3X"}],"key":"nvqfpQ9Pnv"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Calculate and add NDVI, NDWI, NORM","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GbGPIFcpll"}],"key":"UfNoqWhDd6"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Add mask of valid pixels","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"JkhLRs2dRo"}],"key":"XYhmJ4KN1n"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Add scalar feature representing the cound of valid pixels","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"Pfbf2bRtrK"}],"key":"V8g6v8Ulrc"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Save eopatches","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"rAVHIW0vAC"}],"key":"u1nYG8jWbz"}],"key":"ZFMvSWwKRi"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"An EOWorkflow can be linear or more complex, but it should be acyclic. Here we will use the linear case of the EOWorkflow, available as ","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"JfEA42rcCh"},{"type":"inlineCode","value":"LinearWorkflow","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"TrXuANwGaZ"}],"key":"tw02oKfQJk"}],"key":"SIIXiYoK9J"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define the workflow","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BCIbHEIo5y"}],"key":"CgJ6uKmjI2"}],"key":"qxPLhV3UD4"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the workflow\nworkflow = LinearWorkflow(\n    add_data,\n    add_clm,\n    ndvi,\n    ndwi,\n    norm,\n    add_sh_valmask,\n    count_val_sh,\n    load_lpis_db_task,\n    lpis_rasterization_task,\n    lpis_export_tiff,\n    load_land_use_db_task,\n    land_use_rasterization_task,\n    land_use_export_tiff,\n    lulc_rasterization_task,\n    save\n)\n\n# Let's visualize it\nworkflow.dependency_graph()","key":"pOyD93dKSy"},{"type":"output","id":"REtLoqoWh9JD7LjzYWBWR","data":[{"output_type":"execute_result","execution_count":25,"metadata":{},"data":{"image/svg+xml":{"content":"\u003c?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?\u003e\r\n\u003c!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\"\r\n \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\"\u003e\r\n\u003c!-- Generated by graphviz version 2.38.0 (20140413.2041)\r\n --\u003e\r\n\u003c!-- Title: %3 Pages: 1 --\u003e\r\n\u003csvg width=\"2967pt\" height=\"44pt\"\r\n viewBox=\"0.00 0.00 2967.48 44.00\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"\u003e\r\n\u003cg id=\"graph0\" class=\"graph\" transform=\"scale(1 1) rotate(0) translate(4 40)\"\u003e\r\n\u003ctitle\u003e%3\u003c/title\u003e\r\n\u003cpolygon fill=\"white\" stroke=\"none\" points=\"-4,4 -4,-40 2963.48,-40 2963.48,4 -4,4\"/\u003e\r\n\u003c!-- S2L1CWCSInput --\u003e\r\n\u003cg id=\"node1\" class=\"node\"\u003e\u003ctitle\u003eS2L1CWCSInput\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"76.0433\" cy=\"-18\" rx=\"76.0865\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"76.0433\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eS2L1CWCSInput\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- AddCloudMaskTask --\u003e\r\n\u003cg id=\"node2\" class=\"node\"\u003e\u003ctitle\u003eAddCloudMaskTask\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"275.179\" cy=\"-18\" rx=\"87.1846\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"275.179\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eAddCloudMaskTask\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- S2L1CWCSInput\u0026#45;\u0026gt;AddCloudMaskTask --\u003e\r\n\u003cg id=\"edge1\" class=\"edge\"\u003e\u003ctitle\u003eS2L1CWCSInput\u0026#45;\u0026gt;AddCloudMaskTask\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M152.134,-18C160.58,-18 169.271,-18 177.938,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"178.084,-21.5001 188.084,-18 178.084,-14.5001 178.084,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- NormalizedDifferenceIndex --\u003e\r\n\u003cg id=\"node3\" class=\"node\"\u003e\u003ctitle\u003eNormalizedDifferenceIndex\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"508.761\" cy=\"-18\" rx=\"110.48\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"508.761\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eNormalizedDifferenceIndex\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- AddCloudMaskTask\u0026#45;\u0026gt;NormalizedDifferenceIndex --\u003e\r\n\u003cg id=\"edge2\" class=\"edge\"\u003e\u003ctitle\u003eAddCloudMaskTask\u0026#45;\u0026gt;NormalizedDifferenceIndex\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M362.412,-18C370.73,-18 379.267,-18 387.834,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"387.894,-21.5001 397.894,-18 387.894,-14.5001 387.894,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- NormalizedDifferenceIndex_1 --\u003e\r\n\u003cg id=\"node4\" class=\"node\"\u003e\u003ctitle\u003eNormalizedDifferenceIndex_1\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"774.841\" cy=\"-18\" rx=\"119.679\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"774.841\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eNormalizedDifferenceIndex_1\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- NormalizedDifferenceIndex\u0026#45;\u0026gt;NormalizedDifferenceIndex_1 --\u003e\r\n\u003cg id=\"edge3\" class=\"edge\"\u003e\u003ctitle\u003eNormalizedDifferenceIndex\u0026#45;\u0026gt;NormalizedDifferenceIndex_1\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M619.461,-18C627.914,-18 636.494,-18 645.056,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"645.089,-21.5001 655.089,-18 645.089,-14.5001 645.089,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- EuclideanNorm --\u003e\r\n\u003cg id=\"node5\" class=\"node\"\u003e\u003ctitle\u003eEuclideanNorm\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"997.374\" cy=\"-18\" rx=\"66.8882\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"997.374\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eEuclideanNorm\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- NormalizedDifferenceIndex_1\u0026#45;\u0026gt;EuclideanNorm --\u003e\r\n\u003cg id=\"edge4\" class=\"edge\"\u003e\u003ctitle\u003eNormalizedDifferenceIndex_1\u0026#45;\u0026gt;EuclideanNorm\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M894.5,-18C903.197,-18 911.825,-18 920.164,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"920.179,-21.5001 930.179,-18 920.179,-14.5001 920.179,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- AddValidDataMaskTask --\u003e\r\n\u003cg id=\"node6\" class=\"node\"\u003e\u003ctitle\u003eAddValidDataMaskTask\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"1201.06\" cy=\"-18\" rx=\"100.983\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"1201.06\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eAddValidDataMaskTask\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- EuclideanNorm\u0026#45;\u0026gt;AddValidDataMaskTask --\u003e\r\n\u003cg id=\"edge5\" class=\"edge\"\u003e\u003ctitle\u003eEuclideanNorm\u0026#45;\u0026gt;AddValidDataMaskTask\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M1064.41,-18C1072.67,-18 1081.28,-18 1089.99,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"1090.23,-21.5001 1100.23,-18 1090.23,-14.5001 1090.23,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- CountValid --\u003e\r\n\u003cg id=\"node7\" class=\"node\"\u003e\u003ctitle\u003eCountValid\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"1389.8\" cy=\"-18\" rx=\"51.9908\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"1389.8\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eCountValid\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- AddValidDataMaskTask\u0026#45;\u0026gt;CountValid --\u003e\r\n\u003cg id=\"edge6\" class=\"edge\"\u003e\u003ctitle\u003eAddValidDataMaskTask\u0026#45;\u0026gt;CountValid\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M1301.99,-18C1310.65,-18 1319.23,-18 1327.44,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"1327.61,-21.5001 1337.61,-18 1327.61,-14.5001 1327.61,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- LoadFromDatabaseTask --\u003e\r\n\u003cg id=\"node8\" class=\"node\"\u003e\u003ctitle\u003eLoadFromDatabaseTask\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"1578.53\" cy=\"-18\" rx=\"100.983\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"1578.53\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eLoadFromDatabaseTask\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- CountValid\u0026#45;\u0026gt;LoadFromDatabaseTask --\u003e\r\n\u003cg id=\"edge7\" class=\"edge\"\u003e\u003ctitle\u003eCountValid\u0026#45;\u0026gt;LoadFromDatabaseTask\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M1441.82,-18C1449.98,-18 1458.69,-18 1467.6,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"1467.74,-21.5001 1477.74,-18 1467.74,-14.5001 1467.74,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- VectorToRaster --\u003e\r\n\u003cg id=\"node9\" class=\"node\"\u003e\u003ctitle\u003eVectorToRaster\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"1784.82\" cy=\"-18\" rx=\"69.5877\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"1784.82\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eVectorToRaster\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- LoadFromDatabaseTask\u0026#45;\u0026gt;VectorToRaster --\u003e\r\n\u003cg id=\"edge8\" class=\"edge\"\u003e\u003ctitle\u003eLoadFromDatabaseTask\u0026#45;\u0026gt;VectorToRaster\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M1679.28,-18C1687.92,-18 1696.59,-18 1705.02,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"1705.19,-21.5001 1715.19,-18 1705.19,-14.5001 1705.19,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- ExportToTiff --\u003e\r\n\u003cg id=\"node10\" class=\"node\"\u003e\u003ctitle\u003eExportToTiff\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"1950.16\" cy=\"-18\" rx=\"59.5901\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"1950.16\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eExportToTiff\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- VectorToRaster\u0026#45;\u0026gt;ExportToTiff --\u003e\r\n\u003cg id=\"edge9\" class=\"edge\"\u003e\u003ctitle\u003eVectorToRaster\u0026#45;\u0026gt;ExportToTiff\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M1854.61,-18C1863.04,-18 1871.66,-18 1880.1,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"1880.27,-21.5001 1890.27,-18 1880.27,-14.5001 1880.27,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- LoadFromDatabaseTask_1 --\u003e\r\n\u003cg id=\"node11\" class=\"node\"\u003e\u003ctitle\u003eLoadFromDatabaseTask_1\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"2156.44\" cy=\"-18\" rx=\"110.48\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"2156.44\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eLoadFromDatabaseTask_1\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- ExportToTiff\u0026#45;\u0026gt;LoadFromDatabaseTask_1 --\u003e\r\n\u003cg id=\"edge10\" class=\"edge\"\u003e\u003ctitle\u003eExportToTiff\u0026#45;\u0026gt;LoadFromDatabaseTask_1\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M2009.97,-18C2018.19,-18 2026.87,-18 2035.74,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"2035.8,-21.5001 2045.8,-18 2035.8,-14.5001 2035.8,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- VectorToRaster_1 --\u003e\r\n\u003cg id=\"node12\" class=\"node\"\u003e\u003ctitle\u003eVectorToRaster_1\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"2382.22\" cy=\"-18\" rx=\"79.0865\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"2382.22\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eVectorToRaster_1\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- LoadFromDatabaseTask_1\u0026#45;\u0026gt;VectorToRaster_1 --\u003e\r\n\u003cg id=\"edge11\" class=\"edge\"\u003e\u003ctitle\u003eLoadFromDatabaseTask_1\u0026#45;\u0026gt;VectorToRaster_1\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M2267.04,-18C2275.62,-18 2284.22,-18 2292.63,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"2292.8,-21.5001 2302.8,-18 2292.79,-14.5001 2292.8,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- ExportToTiff_1 --\u003e\r\n\u003cg id=\"node13\" class=\"node\"\u003e\u003ctitle\u003eExportToTiff_1\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"2567.06\" cy=\"-18\" rx=\"69.5877\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"2567.06\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eExportToTiff_1\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- VectorToRaster_1\u0026#45;\u0026gt;ExportToTiff_1 --\u003e\r\n\u003cg id=\"edge12\" class=\"edge\"\u003e\u003ctitle\u003eVectorToRaster_1\u0026#45;\u0026gt;ExportToTiff_1\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M2461.56,-18C2470.03,-18 2478.66,-18 2487.15,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"2487.4,-21.5001 2497.4,-18 2487.4,-14.5001 2487.4,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- VectorToRaster_2 --\u003e\r\n\u003cg id=\"node14\" class=\"node\"\u003e\u003ctitle\u003eVectorToRaster_2\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"2751.9\" cy=\"-18\" rx=\"79.0865\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"2751.9\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eVectorToRaster_2\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- ExportToTiff_1\u0026#45;\u0026gt;VectorToRaster_2 --\u003e\r\n\u003cg id=\"edge13\" class=\"edge\"\u003e\u003ctitle\u003eExportToTiff_1\u0026#45;\u0026gt;VectorToRaster_2\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M2636.66,-18C2645.04,-18 2653.69,-18 2662.3,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"2662.38,-21.5001 2672.38,-18 2662.38,-14.5001 2662.38,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c!-- SaveTask --\u003e\r\n\u003cg id=\"node15\" class=\"node\"\u003e\u003ctitle\u003eSaveTask\u003c/title\u003e\r\n\u003cellipse fill=\"none\" stroke=\"black\" cx=\"2913.34\" cy=\"-18\" rx=\"46.2923\" ry=\"18\"/\u003e\r\n\u003ctext text-anchor=\"middle\" x=\"2913.34\" y=\"-14.3\" font-family=\"Times New Roman,serif\" font-size=\"14.00\"\u003eSaveTask\u003c/text\u003e\r\n\u003c/g\u003e\r\n\u003c!-- VectorToRaster_2\u0026#45;\u0026gt;SaveTask --\u003e\r\n\u003cg id=\"edge14\" class=\"edge\"\u003e\u003ctitle\u003eVectorToRaster_2\u0026#45;\u0026gt;SaveTask\u003c/title\u003e\r\n\u003cpath fill=\"none\" stroke=\"black\" d=\"M2831.22,-18C2839.85,-18 2848.51,-18 2856.79,-18\"/\u003e\r\n\u003cpolygon fill=\"black\" stroke=\"black\" points=\"2857.04,-21.5001 2867.04,-18 2857.04,-14.5001 2857.04,-21.5001\"/\u003e\r\n\u003c/g\u003e\r\n\u003c/g\u003e\r\n\u003c/svg\u003e\r\n","content_type":"image/svg+xml"},"text/plain":{"content":"\u003cgraphviz.dot.Digraph at 0x2620f6c8\u003e","content_type":"text/plain"}}}],"key":"RbOqTgOVU1"}],"key":"e1R7NaR0jD"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This may take some time, so go grab a cup of coffee ...","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pm0sKkYGOT"}],"key":"LcaJYH5aQ0"}],"key":"SEQssoIChf"}],"key":"LlzzxTRdky"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\n# Execute the workflow\n\nsource_tiff_location = './source_tiff'\nif not os.path.isdir(source_tiff_location):\n    os.makedirs(source_tiff_location)\n\n# define additional parameters of the workflow\ngeodb = GeoDBClient()\nexecution_args = []\nfor idx, bbox in enumerate(bbox_list[patchIDs]):\n    execution_args.append({\n        add_data: {'bbox': bbox, 'time_interval': selected_date_interval_for_satellite_imagery},\n        load_land_use_db_task: {'geodb': geodb},\n        load_lpis_db_task: {'geodb': geodb},\n        lpis_export_tiff: {'filename': '{}/lpis_eopatch_{}_original.tiff'.format(source_tiff_location, idx)},\n        land_use_export_tiff: {'filename': '{}/land_use_eopatch_{}_original.tiff'.format(source_tiff_location, idx)},\n        save: {'eopatch_folder': 'eopatch_{}'.format(idx)}\n    })\n    \nglobalLogger.setLevel(logging.CRITICAL)\n\nexecutor = EOExecutor(workflow, execution_args, save_logs=True)\nexecutor.run(workers=1, multiprocess=False)\n\nexecutor.make_report()","key":"rKeufXXiY8"},{"type":"output","id":"Jvsk08CU8xjorgTAx-mY9","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"cedeaf70f7904d60b8324cbd27e9fb30\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"HBox(children=(IntProgress(value=0, max=9), HTML(value='')))","content_type":"text/plain"}}},{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipykernel_launcher.py:40: RuntimeWarning: invalid value encountered in true_divide\n"},{"name":"stdout","output_type":"stream","text":"LPIS: 1243 DB records for bbox = 586780.0,5176180.0,590110.0,5179540.0\nLand use: 1915 DB records for bbox = 586780.0,5176180.0,590110.0,5179540.0\n"},{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipykernel_launcher.py:40: RuntimeWarning: invalid value encountered in true_divide\n"},{"name":"stdout","output_type":"stream","text":"LPIS: 817 DB records for bbox = 590110.0,5176180.0,593440.0,5179540.0\nLand use: 1546 DB records for bbox = 590110.0,5176180.0,593440.0,5179540.0\n"},{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipykernel_launcher.py:40: RuntimeWarning: invalid value encountered in true_divide\n"},{"name":"stdout","output_type":"stream","text":"LPIS: 891 DB records for bbox = 593440.0,5176180.0,596770.0,5179540.0\nLand use: 1923 DB records for bbox = 593440.0,5176180.0,596770.0,5179540.0\n"},{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipykernel_launcher.py:40: RuntimeWarning: invalid value encountered in true_divide\n"},{"name":"stdout","output_type":"stream","text":"LPIS: 1171 DB records for bbox = 586780.0,5172810.0,590110.0,5176180.0\nLand use: 1423 DB records for bbox = 586780.0,5172810.0,590110.0,5176180.0\n"},{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipykernel_launcher.py:40: RuntimeWarning: invalid value encountered in true_divide\n"},{"name":"stdout","output_type":"stream","text":"LPIS: 970 DB records for bbox = 590110.0,5172810.0,593440.0,5176180.0\nLand use: 1230 DB records for bbox = 590110.0,5172810.0,593440.0,5176180.0\n"},{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipykernel_launcher.py:40: RuntimeWarning: invalid value encountered in true_divide\n"},{"name":"stdout","output_type":"stream","text":"LPIS: 1008 DB records for bbox = 593440.0,5172810.0,596770.0,5176180.0\nLand use: 1572 DB records for bbox = 593440.0,5172810.0,596770.0,5176180.0\nLPIS: 758 DB records for bbox = 586780.0,5169440.0,590110.0,5172810.0\nLand use: 888 DB records for bbox = 586780.0,5169440.0,590110.0,5172810.0\n"},{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipykernel_launcher.py:40: RuntimeWarning: invalid value encountered in true_divide\n"},{"name":"stdout","output_type":"stream","text":"LPIS: 904 DB records for bbox = 590110.0,5169440.0,593440.0,5172810.0\nLand use: 771 DB records for bbox = 590110.0,5169440.0,593440.0,5172810.0\n"},{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipykernel_launcher.py:40: RuntimeWarning: invalid value encountered in true_divide\n"},{"name":"stdout","output_type":"stream","text":"LPIS: 725 DB records for bbox = 593440.0,5169440.0,596770.0,5172810.0\nLand use: 804 DB records for bbox = 593440.0,5169440.0,596770.0,5172810.0\n\nWall time: 3min 28s\n"}],"key":"BHZwM5U3Gk"}],"key":"FDbo3FZh8H"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In this case, all patches come from a small region, so all of them have the same dates of acquisition for at least a few dates, so we can inspect the area without interpolation at this point.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vuzUbAipJH"}],"key":"F8a4RIGR3I"}],"key":"DPfNkYWNDk"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the true color image","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DxVki0FZ2Z"}],"identifier":"visualize-the-true-color-image","label":"Visualize the true color image","html_id":"visualize-the-true-color-image","implicit":true,"key":"h2cXGi335N"}],"key":"s2hY14zPNt"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"selected_timestamp = datetime.datetime.strptime('2019-05-01', \"%Y-%m-%d\") # or None\n\n# Draw the RGB image\npath_out = './eopatches_small/' if use_smaller_patches else './eopatches_large/'\nfig = plt.figure(figsize=(20, 20 * aspect_ratio))\n\npbar = tqdm(total=9)\nfor i in range(9):\n    eopatch = EOPatch.load('{}/eopatch_{}'.format(path_out, i), lazy_loading=True)\n    timeIndex = next(i for i, time in enumerate(eopatch.timestamp) if time.date() == selected_timestamp.date()) if not selected_timestamp is None else None\n    if timeIndex is None:\n        timeIndex = 0\n        \n    ax = plt.subplot(3, 3, i + 1)\n    plt.imshow(np.clip(eopatch.data['BANDS'][timeIndex][..., [2, 1, 0]] * 3.5, 0, 1))\n    plt.xticks([])\n    plt.yticks([])\n    ax.set_aspect(\"auto\")\n    pbar.update(1)\n    del eopatch\n\nfig.subplots_adjust(wspace=0, hspace=0)","key":"BVL2qfY9qU"},{"type":"output","id":"NQE4P7zWwsUUC8MgHE4f8","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\tqdm\\__init__.py:27: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\nPlease use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n  TqdmDeprecationWarning)\n"},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"2d5ed8f4a3cf48d3a77f27db838253fa\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"HBox(children=(IntProgress(value=0, max=9), HTML(value='')))","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f454d17a6c0774644ae011206e55df1a","path":"/notebooks_test/build/f454d17a6c0774644ae011206e55df1a.png"},"text/plain":{"content":"\u003cFigure size 1440x1452.97 with 9 Axes\u003e","content_type":"text/plain"}}}],"key":"uf9mfYxjHQ"}],"key":"cjmczLQ2tA"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualize the reference map","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WSz13ZIUfa"}],"identifier":"visualize-the-reference-map","label":"Visualize the reference map","html_id":"visualize-the-reference-map","implicit":true,"key":"iAdau829rB"}],"key":"cEJcCtrFdp"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"path_out = './eopatches_small/' if use_smaller_patches else './eopatches_large/'\nfig, axes = plt.subplots(figsize=(20, 20 * aspect_ratio), nrows=3, ncols=3)\n\ncmapValues = [color for id, color in lulcColorMapping.items()]\nnormValues = list(lulcColorMapping.keys())\nnormValues.append(20)\ncmap = colors.ListedColormap(cmapValues)\nnorm = colors.BoundaryNorm(normValues, cmap.N + 1)\n    \npbar = tqdm(total=9)\nfor i, ax in enumerate(axes.flat):\n    eopatch = EOPatch.load('{}/eopatch_{}'.format(path_out, i), lazy_loading=True)\n    im = ax.imshow(eopatch.mask_timeless['LULC'].squeeze(), cmap=cmap, norm=norm)\n    ax.set_xticks([])\n    ax.set_yticks([])\n    ax.set_aspect(\"auto\")\n    pbar.update(1)\n    del eopatch\n\nfig.subplots_adjust(wspace=0, hspace=0)\n\ncb = fig.colorbar(im, ax=axes.ravel().tolist(), orientation='horizontal', pad=0.01, aspect=100)\ncb.ax.tick_params(labelsize=20) \ncb.set_ticks([id for id in lulcMapping.keys()])\ncb.ax.set_xticklabels([entry[\"name\"] for entry in lulcMapping.values()], rotation=45, fontsize=15)\nplt.show()","key":"N6JJIuDJbI"},{"type":"output","id":"hogSNwACD0_pVmkmJuYUa","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"06421eddf5ee416693a2bd0e1b009eee\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"HBox(children=(IntProgress(value=0, max=9), HTML(value='')))","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"ed8d280e698c0b7ed02627705bb36e48","path":"/notebooks_test/build/ed8d280e698c0b7ed02627705bb36e48.png"},"text/plain":{"content":"\u003cFigure size 1440x1452.97 with 10 Axes\u003e","content_type":"text/plain"}}}],"key":"ZwkH4kbUT5"}],"key":"GGP49joX0P"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Prepare the training data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"N89ccTJHsB"}],"identifier":"prepare-the-training-data","label":"Prepare the training data","html_id":"prepare-the-training-data","implicit":true,"key":"d25VRqVMhF"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We will create a new workflow that processes the data:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UpNRRJbKlB"}],"key":"wQfDYkzoi3"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Remove too cloudy scenes","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"CmPLs43YZJ"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Check the ratio of the valid data for each patch and for each time frame","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"gEqhZUQGEu"}],"key":"QlH8RT31WG"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Keep only time frames with \u003e 80 % valid coverage (no clouds)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"xj7RjTU5bM"}],"key":"H7CfuqokXU"}],"key":"xPmse0ip2W"}],"key":"h3OHQcdhDL"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Concatenate BAND, NDVI, NDWI, NORM info into a single feature called FEATURES","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"q02R1hwjrK"}],"key":"Sm0mrpu3BP"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Perform temporal interpolation (filling gaps and resampling to the same dates)","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"qVqA3qWkbb"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Create a task for linear interpolation in the temporal dimension","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"rNQNTuWjVS"}],"key":"BV82BiaFIU"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Provide the cloud mask to tell the interpolating function which values to update","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"KqvFYhyqKY"}],"key":"cWqjOz6rBA"}],"key":"vdDAXUzvik"}],"key":"cvBfjdKTOc"},{"type":"listItem","spread":true,"position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Perform erosion","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"Rj1p8GoImM"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"This removes artefacts with a width of 1 px, and also removes the edges between polygons of different classes","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"MMKYuNpb6R"}],"key":"ON7x8yu1yS"}],"key":"XdsXI2nWFC"}],"key":"dcGUaoagDt"},{"type":"listItem","spread":true,"position":{"start":{"line":14,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Random spatial sampling of the EOPatches","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"bahoUlzEhy"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"Randomly take a subset of pixels from a patch to use in the machine learning training","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"RdXqQXV2st"}],"key":"VaeCErBwUT"}],"key":"Ik3x79iRmo"}],"key":"txwCH7ZEMa"},{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Split patches for training/validation","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"cXwxblZ2Ha"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Split the patches into a training and validation set","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"PWlnunc9eM"}],"key":"qIm8l4wH2i"}],"key":"NMs0P5njYC"}],"key":"XHICUWCFTK"}],"key":"YZvxjiNk2E"}],"key":"KVgsTh7e0c"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define EOTasks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aHLAwjNuGR"}],"identifier":"define-eotasks","label":"Define EOTasks","html_id":"define-eotasks","implicit":true,"key":"J8xfdqJWX1"}],"key":"uIBA6OJS6q"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"class ConcatenateData(EOTask):\n    \"\"\" Task to concatenate data arrays along the last dimension\n    \"\"\"\n    def __init__(self, feature_name, feature_names_to_concatenate):\n        self.feature_name = feature_name\n        self.feature_names_to_concatenate = feature_names_to_concatenate\n\n    def execute(self, eopatch):\n        arrays = [eopatch.data[name] for name in self.feature_names_to_concatenate]\n\n        eopatch.add_feature(FeatureType.DATA, self.feature_name, np.concatenate(arrays, axis=-1))\n\n        return eopatch\n    \n    \nclass ValidDataFractionPredicate:\n    \"\"\" Predicate that defines if a frame from EOPatch's time-series is valid or not. Frame is valid, if the \n    valid data fraction is above the specified threshold.\n    \"\"\"\n    def __init__(self, threshold):\n        self.threshold = threshold\n        \n    def __call__(self, array):\n        coverage = np.sum(array.astype(np.uint8)) / np.prod(array.shape)\n        return coverage \u003e self.threshold\n    \n# TASK TO LOAD EXISTING EOPATCHES\nload = LoadTask(path_out)\n\n# TASK FOR CONCATENATION\nconcatenate = ConcatenateData('FEATURES', ['BANDS', 'NDVI', 'NDWI', 'NORM'])\n\n# TASK FOR FILTERING OUT TOO CLOUDY SCENES\n# keep frames with \u003e 80 % valid coverage\nvalid_data_predicate = ValidDataFractionPredicate(0.8)\nfilter_task = SimpleFilterTask((FeatureType.MASK, 'IS_VALID'), valid_data_predicate)\n\n# TASK FOR LINEAR INTERPOLATION\n# linear interpolation of full time-series and date resampling\nrangeParams = selected_date_interval_for_satellite_imagery.copy()\nrangeParams.append(16) # step of 16 days between key values\nresampled_range = tuple(rangeParams)\nlinear_interp = LinearInterpolation(\n    'FEATURES', # name of field to interpolate\n    mask_feature=(FeatureType.MASK, 'IS_VALID'), # mask to be used in interpolation\n    copy_features=[(FeatureType.MASK_TIMELESS, 'LULC')], # features to keep\n    resample_range=resampled_range, # set the resampling range\n    bounds_error=False # extrapolate with NaN's\n)\n\n# TASK FOR EROSION\n# erode each class of the reference map\nerosion = ErosionTask(mask_feature=(FeatureType.MASK_TIMELESS,'LULC','LULC_ERODED'), disk_radius=1)\n\n# TASK FOR SPATIAL SAMPLING\n# Uniformly sample about pixels from patches\nn_samples = int(4e4) if use_smaller_patches else int(1e5) # no. of pixels to sample\nref_labels = list(range(11)) # reference labels to take into account when sampling\nspatial_sampling = PointSamplingTask(\n    n_samples=n_samples, \n    ref_mask_feature='LULC_ERODED', \n    ref_labels=ref_labels, \n    sample_features=[  # tag fields to sample\n        (FeatureType.DATA, 'FEATURES'),\n        (FeatureType.MASK_TIMELESS, 'LULC_ERODED')\n    ])\n\npath_out_sampled = './eopatches_sampled_small/' if use_smaller_patches else './eopatches_sampled_large/'\nif not os.path.isdir(path_out_sampled):\n    os.makedirs(path_out_sampled)\nsave = SaveTask(path_out_sampled, overwrite_permission=OverwritePermission.OVERWRITE_PATCH)\n\n# Define the workflow\nworkflow = LinearWorkflow(\n    load,\n    concatenate,\n    filter_task,\n    linear_interp,\n    erosion,\n    spatial_sampling,\n    save\n)","key":"PSM5ZrIyDU"},{"type":"output","id":"8u9VlWggG2FpExtXIuYwj","data":[],"key":"f6wFezkcyN"}],"key":"V2aqCTOIbW"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Run the EOWorkflow over all EOPatches","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RRKo2VxOCo"}],"identifier":"run-the-eoworkflow-over-all-eopatches","label":"Run the EOWorkflow over all EOPatches","html_id":"run-the-eoworkflow-over-all-eopatches","implicit":true,"key":"gP7q5t3m2z"}],"key":"tvbAwHSoCg"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n   \nexecution_args = []\nfor idx in range(len(patchIDs)):\n    execution_args.append({\n        load: {'eopatch_folder': 'eopatch_{}'.format(idx)},\n        save: {'eopatch_folder': 'eopatch_{}'.format(idx)}\n    })\n    \nexecutor = EOExecutor(workflow, execution_args, save_logs=True)\n\nexecutor.run(workers=1, multiprocess=True)\n\nexecutor.make_report()","key":"ciLwylacFR"},{"type":"output","id":"3VMQSGpEPss16wdA7VD83","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"0b3930272d56490f83acf75460a4a7d4\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"HBox(children=(IntProgress(value=0, max=9), HTML(value='')))","content_type":"text/plain"}}},{"name":"stdout","output_type":"stream","text":"\n\nWall time: 43.7 s\n"}],"key":"YDWDZOK1mt"}],"key":"jQBQtMrolE"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Model construction and training","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qqiWFo3ifl"}],"identifier":"model-construction-and-training","label":"Model construction and training","html_id":"model-construction-and-training","implicit":true,"key":"pG9IS3zh8p"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The patches are split into a train and test subset, where we take the patch with ID = 1 for testing, since it seems a good representative of the area.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"KXE0U8oPB7"}],"key":"ctVGs5YSXN"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"The test sample is hand picked because of the small set of patches, otherwise with a larged overall set, the training and testing patches should be randomly chosen.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QOwak1SBP3"}],"key":"ceuCk8Bg1f"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"The sampled features and labels are loaded and reshaped into ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"rley8qJTGg"},{"type":"inlineMath","value":"n \\times m","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmi\u003em\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en \\times m\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"aIrp6eAFVE"},{"type":"text","value":", where ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"P09Msg5APw"},{"type":"inlineMath","value":"n","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003en\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003en\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003en\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"q1kESAXUCt"},{"type":"text","value":" represents the number of training pixels, and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"WSHNYmt6gO"},{"type":"inlineMath","value":"m = f \\times t","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003em\u003c/mi\u003e\u003cmo\u003e=\u003c/mo\u003e\u003cmi\u003ef\u003c/mi\u003e\u003cmo\u003e×\u003c/mo\u003e\u003cmi\u003et\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003em = f \\times t\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.4306em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003em\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003cspan class=\"mrel\"\u003e=\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2778em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003cspan class=\"mbin\"\u003e×\u003c/span\u003e\u003cspan class=\"mspace\" style=\"margin-right:0.2222em;\"\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6151em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"M1BC03Ic3k"},{"type":"text","value":" the number of all features (in this example 207), with ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TkQaruzpH2"},{"type":"inlineMath","value":"f","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003ef\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003ef\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.10764em;\"\u003ef\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"yKo3gjGkU3"},{"type":"text","value":" the size of bands and band combinations (in this example 9) and ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"h4w1bnWKNQ"},{"type":"inlineMath","value":"t","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmi\u003et\u003c/mi\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003et\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.6151em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord mathnormal\"\u003et\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"Vx6fWWIErA"},{"type":"text","value":" the length of the resampled time-series (in this example 23)","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"lX2dqjKRgP"}],"key":"Ea8PaEUdtU"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"link","url":"https://github.com/Microsoft/LightGBM","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"LightGBM","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"s6R7iaZKwJ"}],"urlSource":"https://github.com/Microsoft/LightGBM","error":true,"key":"vtnEWxIgI3"},{"type":"text","value":" is used as a ML model. It is a fast, distributed, high performance gradient boosting framework based on decision tree algorithms, used for many machine learning tasks.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"SVMh8Ew7HZ"}],"key":"zhtvCcZmaY"},{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"The default hyper-parameters are used in this example. For more info on parameter tuning, check the ","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"GOk874FqGj"},{"type":"link","url":"https://lightgbm.readthedocs.io/en/latest/Parameters-Tuning.html","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"ReadTheDocs","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"PhYTZBiQPL"}],"urlSource":"https://lightgbm.readthedocs.io/en/latest/Parameters-Tuning.html","key":"Sq25k0pqTf"},{"type":"text","value":" of the package.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"epYxDHpVYZ"}],"key":"EBqUzOqa9m"}],"key":"ZeKB2m7N3K"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# load sampled eopatches\neopatches = []\npath_out_sampled = './eopatches_sampled_small/' if use_smaller_patches else './eopatches_sampled_large/'\n\nfor i in range(9):\n    eopatches.append(EOPatch.load('{}/eopatch_{}'.format(path_out_sampled, i), lazy_loading=True))    \n\neopatches = np.array(eopatches)","key":"jiy7NEZD8f"},{"type":"output","id":"GxSFWl_oOzEhNlJlziJaa","data":[],"key":"LxbfYgGu83"}],"key":"UEtcGngir0"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Definition of the train and test patch IDs\ntrain_ID = [0,2,3,4,5,6,7,8] if use_smaller_patches else [0,1,3,4,5,6,7,8]\ntest_ID = [1] if use_smaller_patches else [2]\n\n# Set the features and the labels for train and test sets\nfeatures_train = np.array([eopatch.data['FEATURES_SAMPLED'] for eopatch in eopatches[train_ID]])\nlabels_train = np.array([eopatch.mask_timeless['LULC_ERODED_SAMPLED'] for eopatch in eopatches[train_ID]])\nfeatures_test = np.array([eopatch.data['FEATURES_SAMPLED'] for eopatch in eopatches[test_ID]])\nlabels_test = np.array([eopatch.mask_timeless['LULC_ERODED_SAMPLED'] for eopatch in eopatches[test_ID]])\n\n# get shape\np1, t, w, h, f = features_train.shape\np2, t, w, h, f = features_test.shape\np = p1 + p2\n\n# reshape to n x m\nfeatures_train = np.moveaxis(features_train, 1, 3).reshape(p1 * w * h, t * f)\nlabels_train = np.moveaxis(labels_train, 1, 2).reshape(p1 * w * h, 1).squeeze()\nfeatures_test = np.moveaxis(features_test, 1, 3).reshape(p2 * w * h, t * f)\nlabels_test = np.moveaxis(labels_test, 1, 2).reshape(p2 * w * h, 1).squeeze()\n\n# remove points with no reference from training (so we dont train to recognize \"no data\")\nmask_train = labels_train == 0\nfeatures_train = features_train[~mask_train]\nlabels_train = labels_train[~mask_train]\n\n# remove points with no reference from test (so we dont validate on \"no data\", which doesn't make sense)\nmask_test = labels_test == 0\nfeatures_test = features_test[~mask_test]\nlabels_test = labels_test[~mask_test]","key":"Y3RseGdtES"},{"type":"output","id":"HpfA71LmF5qJLVwX5ePFE","data":[],"key":"UkYhLR0KIr"}],"key":"Nz0MO1drJq"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"%%time\n\n# Set up training classes\nlabels_unique = np.unique(labels_train)\n\n# Set up the model\nmodel = lgb.LGBMClassifier(\n    objective='multiclass', \n    num_class=len(labels_unique), \n    metric='multi_logloss'\n)\n\n# train the model\nmodel.fit(features_train, labels_train)\n\n# uncomment to save the model\nmodel_base_name = 'model_SI_LULC_smaller' if use_smaller_patches else 'model_SI_LULC_larger'\njoblib.dump(model, './{}.pkl'.format(model_base_name))","key":"ZIcH8PhaHa"},{"type":"output","id":"C_HgPjazwoztG7I_FCZb7","data":[{"name":"stdout","output_type":"stream","text":"Wall time: 48.2 s\n"},{"output_type":"execute_result","execution_count":33,"metadata":{},"data":{"text/plain":{"content":"['./model_SI_LULC_smaller.pkl']","content_type":"text/plain"}}}],"key":"SiPD6i88HI"}],"key":"Vlt7v0Y2f4"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Validation","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WZN0xioOX0"}],"identifier":"validation","label":"Validation","html_id":"validation","implicit":true,"key":"YUmpvfg1aM"}],"key":"aPVeKsqRvF"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Validation of the model is a crucial step in data science. All models are wrong, but some are less wrong than others, so model evaluation is important.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wbGZsb81cb"}],"key":"scPPrC2n55"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In order to validate the model, we use the training set to predict the classes, and then compare the predicted set of labels to the “ground truth”.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"skfDSreNxl"}],"key":"tGAVT6wZpI"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Unfortunately, ground truth in the scope of EO is a term that should be taken lightly. Usually, it is not 100 % reliable due to several reasons:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"K2iyZSZAsS"}],"key":"kk8zvTo3L2"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Labels are determined at specific time, but land use can change (","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"sYmik073oU"},{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"what was once a field, may now be a house","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DcL5iCP42G"}],"key":"aKWNmyE668"},{"type":"text","value":")","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"sn4qU2a6Lj"}],"key":"wSxI3fMpd0"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Labels are overly generalized (","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Ct2i0cdkw0"},{"type":"emphasis","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"a city is an artificial surface, but it also contains parks, forests etc.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"IQ2vJCUJTo"}],"key":"z61C6y0GPJ"},{"type":"text","value":")","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"A593P3FS02"}],"key":"GYoKKccxmc"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Some classes can have an overlap or similar definitions (","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"GmWg878YPr"},{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"part of a continuum, and not discrete distributions","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"JjyUEjvWMh"}],"key":"v9LFHRBvGS"},{"type":"text","value":")","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ru3Qv7tQgg"}],"key":"dXpHYgMnyv"},{"type":"listItem","spread":true,"position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"Human error (","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"SnPXqvjI6x"},{"type":"emphasis","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"mistakes made when producing the reference map","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"dl6M30krP7"}],"key":"CXAoERECdO"},{"type":"text","value":")","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"xk2yJzx86m"}],"key":"w0hpwY7yHw"}],"key":"petyiKi2do"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"The validation is performed by evaluating various metrics, such as accuracy, precision, recall, ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"gjjy5UcVb7"},{"type":"inlineMath","value":"F_1","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eF\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eF_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.13889em;\"\u003eF\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"IuYsiJ6GX8"},{"type":"text","value":" score, some of which are nicely described ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"s7tPWoX606"},{"type":"link","url":"https://medium.com/greyatom/performance-metrics-for-classification-problems-in-machine-learning-part-i-b085d432082b","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"in this blog post","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"wR51Uva1UD"}],"urlSource":"https://medium.com/greyatom/performance-metrics-for-classification-problems-in-machine-learning-part-i-b085d432082b","key":"q4dL02GlXX"}],"key":"BfQeSsxJE4"}],"key":"vgIkXPcO0S"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# uncomment to load the model and replace with your file, usually just correct the date\nmodel_path = './model_SI_LULC_smaller.pkl' if use_smaller_patches else './model_SI_LULC_larger.pkl'\nmodel = joblib.load(model_path)\n\n# predict the test labels\nplabels_test = model.predict(features_test)","key":"vwjYGLOCtx"},{"type":"output","id":"9F5HXCumW_zWz-rbNNWCd","data":[],"key":"Y6UNUQwCgY"}],"key":"PR8uvcPPBh"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get the overall accuracy (OA) and the weighted ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iK0cFF2MiX"},{"type":"inlineMath","value":"F_1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eF\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eF_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.13889em;\"\u003eF\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"tMkFdUMNtF"},{"type":"text","value":" score","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ZZ7B0hTBy3"}],"key":"tZrReERUEY"}],"key":"bF7lm5bjpQ"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"print('Classification accuracy {:.1f}%'.format(100 * metrics.accuracy_score(labels_test, plabels_test)))\nprint('Classification F1-score {:.1f}%'.format(100 * metrics.f1_score(labels_test, plabels_test, average='weighted')))","key":"ErE3izU9Nq"},{"type":"output","id":"2bt-RL7MBcEuuJJqxiBZF","data":[{"name":"stdout","output_type":"stream","text":"Classification accuracy 93.4%\nClassification F1-score 93.2%\n"}],"key":"VodcTjfuC8"}],"key":"Z4mgYLzOfm"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"inlineMath","value":"F_1","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"html":"\u003cspan class=\"katex\"\u003e\u003cspan class=\"katex-mathml\"\u003e\u003cmath xmlns=\"http://www.w3.org/1998/Math/MathML\"\u003e\u003csemantics\u003e\u003cmrow\u003e\u003cmsub\u003e\u003cmi\u003eF\u003c/mi\u003e\u003cmn\u003e1\u003c/mn\u003e\u003c/msub\u003e\u003c/mrow\u003e\u003cannotation encoding=\"application/x-tex\"\u003eF_1\u003c/annotation\u003e\u003c/semantics\u003e\u003c/math\u003e\u003c/span\u003e\u003cspan class=\"katex-html\" aria-hidden=\"true\"\u003e\u003cspan class=\"base\"\u003e\u003cspan class=\"strut\" style=\"height:0.8333em;vertical-align:-0.15em;\"\u003e\u003c/span\u003e\u003cspan class=\"mord\"\u003e\u003cspan class=\"mord mathnormal\" style=\"margin-right:0.13889em;\"\u003eF\u003c/span\u003e\u003cspan class=\"msupsub\"\u003e\u003cspan class=\"vlist-t vlist-t2\"\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.3011em;\"\u003e\u003cspan style=\"top:-2.55em;margin-left:-0.1389em;margin-right:0.05em;\"\u003e\u003cspan class=\"pstrut\" style=\"height:2.7em;\"\u003e\u003c/span\u003e\u003cspan class=\"sizing reset-size6 size3 mtight\"\u003e\u003cspan class=\"mord mtight\"\u003e1\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-s\"\u003e​\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"vlist-r\"\u003e\u003cspan class=\"vlist\" style=\"height:0.15em;\"\u003e\u003cspan\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/span\u003e","key":"WP1x4gW4KQ"},{"type":"text","value":" score, precision, and recall for each class separately","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OTx9YXQQxn"}],"key":"KuKlxvOkss"}],"key":"bEnkbKGUy4"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"class_labels_test = set(np.unique(labels_test))\nclass_labels_train = set(np.unique(labels_train))\nclass_labels = list(class_labels_test.union(class_labels_train))\nclass_names = [entry[\"name\"] for entry in lulcMapping.values()]\n\nf1_scores = metrics.f1_score(labels_test, plabels_test, labels=class_labels, average=None)\nrecall = metrics.recall_score(labels_test, plabels_test, labels=class_labels, average=None)\nprecision = metrics.precision_score(labels_test, plabels_test, labels=class_labels, average=None) \n\nprint('             Class              =  F1  | Recall | Precision')\nprint('         --------------------------------------------------')\nfor idx, lulctype in enumerate([class_names[idx] for idx in class_labels]):\n    print('         * {0:20s} = {1:2.1f} |  {2:2.1f}  | {3:2.1f}'.format(lulctype, \n                                                                         f1_scores[idx] * 100, \n                                                                         recall[idx] * 100, \n                                                                         precision[idx] * 100))","key":"ZRmPMsDuAY"},{"type":"output","id":"gTNKjtVTa3Kcub-0T0qdj","data":[{"name":"stdout","output_type":"stream","text":"             Class              =  F1  | Recall | Precision\n         --------------------------------------------------\n         * Cultivated Land      = 93.9 |  93.5  | 94.3\n         * Forest               = 98.0 |  98.7  | 97.4\n         * Grassland            = 80.3 |  80.9  | 79.8\n         * Shrubland            = 37.5 |  34.0  | 41.7\n         * Water                = 50.0 |  100.0  | 33.3\n         * Artificial Surface   = 89.6 |  85.2  | 94.6\n"}],"key":"BVeGjy9EJg"}],"key":"FIukyeQHDU"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot the standard and transposed Confusion Matrix","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YtfT5klf2z"}],"identifier":"plot-the-standard-and-transposed-confusion-matrix","label":"Plot the standard and transposed Confusion Matrix","html_id":"plot-the-standard-and-transposed-confusion-matrix","implicit":true,"key":"BNRFFJ9ZSW"}],"key":"OzCG92Fp04"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define the plotting function\ndef plot_confusion_matrix(cm, classes,\n                          normalize=False,\n                          title='Confusion matrix',\n                          cmap=plt.cm.Blues, ylabel='True label', xlabel='Predicted label', filename=None):\n    \"\"\"\n    This function prints and plots the confusion matrix.\n    Normalization can be applied by setting `normalize=True`.\n    \"\"\"\n    np.set_printoptions(precision=2, suppress=True)\n    \n    if normalize:\n        cm = cm.astype('float') / (cm.sum(axis=1)[:, np.newaxis] + np.finfo(np.float).eps)\n    \n    plt.imshow(cm, interpolation='nearest', cmap=cmap, vmin=0, vmax=1)\n    plt.title(title, fontsize=20)\n    # plt.colorbar()\n    tick_marks = np.arange(len(classes)+1)-0.5\n    plt.xticks(tick_marks, classes, rotation=45, fontsize=20)\n    plt.yticks(tick_marks, classes, fontsize=20)\n    \n    fmt = '.2f' if normalize else 'd'\n    thresh = cm.max() / 2.\n    for i, j in itertools.product(range(cm.shape[0]), range(cm.shape[1])):\n        plt.text(j, i, format(cm[i, j], fmt),\n                 horizontalalignment=\"center\",\n                 color=\"white\" if cm[i, j] \u003e thresh else \"black\",\n                 fontsize=12)\n\n    plt.tight_layout()\n    plt.ylabel(ylabel, fontsize=20)\n    plt.xlabel(xlabel, fontsize=20)","key":"ZQqFssh2rn"},{"type":"output","id":"J-7HceY5UYTcQi4nijimt","data":[],"key":"LBwzMGV76G"}],"key":"O87aehDJvY"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(20, 20))\n\nplt.subplot(1, 2, 1)\nconf_matrix_gbm = metrics.confusion_matrix(labels_test, plabels_test)\nplot_confusion_matrix(conf_matrix_gbm, \n                      classes=[name for idx, name in enumerate(class_names) if idx in class_labels], \n                      normalize=True, \n                      ylabel='Truth (LAND COVER)', \n                      xlabel='Predicted (GBM)',\n                      title='Confusion matrix');\n\nplt.subplot(1, 2, 2)\nconf_matrix_gbm = metrics.confusion_matrix(plabels_test, labels_test)\nplot_confusion_matrix(conf_matrix_gbm, \n                      classes=[name for idx, name in enumerate(class_names) if idx in class_labels], \n                      normalize=True, \n                      xlabel='Truth (LAND COVER)', \n                      ylabel='Predicted (GBM)',\n                      title='Transposed Confusion matrix');\n\nplt.tight_layout()","key":"AVPohJK30i"},{"type":"output","id":"gc1m_4I63fH7t9-EBBqrg","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"c9351b035419f5ee5c21435f73666d36","path":"/notebooks_test/build/c9351b035419f5ee5c21435f73666d36.png"},"text/plain":{"content":"\u003cFigure size 1440x1440 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"PXPRcu5Opf"}],"key":"nS4FWLefD6"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"fig = plt.figure(figsize=(20, 5))\n\nlabel_ids, label_counts = np.unique(labels_train, return_counts=True)\n\nplt.bar(range(len(label_ids)), label_counts/100)\nplt.xticks(range(len(label_ids)), [class_names[i] for i in label_ids], rotation=45, fontsize=20);\nplt.yticks(fontsize=20);\nplt.ylabel(\"Area [ha] \", size=18)","key":"Av7oqjGMg3"},{"type":"output","id":"K9eqm-AG_hY7VD9rzenCn","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"183822a8cd276cadf57b72b62a893737","path":"/notebooks_test/build/183822a8cd276cadf57b72b62a893737.png"},"text/plain":{"content":"\u003cFigure size 1440x360 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"EIVU9iixP6"}],"key":"X99bP776lF"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Predict LULC","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nsgnkI5ECf"}],"identifier":"predict-lulc","label":"Predict LULC","html_id":"predict-lulc","implicit":true,"key":"YM7lwIElfu"}],"key":"AGD5dtH6CW"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"class PredictPatch(EOTask):\n    \"\"\"\n    Task to make model predictions on a patch. Provide the model and the feature, \n    and the output names of labels and scores (optional)\n    \"\"\"\n    def __init__(self, model, features_feature, predicted_labels_name, predicted_scores_name=None):\n        self.model = model\n        self.features_feature = features_feature\n        self.predicted_labels_name = predicted_labels_name\n        self.predicted_scores_name = predicted_scores_name\n        \n    def execute(self, eopatch):\n        ftrs = eopatch[self.features_feature[0]][self.features_feature[1]]\n        \n        t, w, h, f = ftrs.shape\n        ftrs = np.moveaxis(ftrs, 0, 2).reshape(w * h, t * f)\n        \n        plabels = self.model.predict(ftrs)\n        plabels = plabels.reshape(w, h)\n        plabels = plabels[..., np.newaxis]\n        eopatch.add_feature(FeatureType.MASK_TIMELESS, self.predicted_labels_name, plabels)\n        \n        if self.predicted_scores_name:\n            pscores = self.model.predict_proba(ftrs)\n            _, d = pscores.shape\n            pscores = pscores.reshape(w, h, d)\n            eopatch.add_feature(FeatureType.DATA_TIMELESS, self.predicted_scores_name, pscores)\n        \n        return eopatch","key":"tDLVZDnJb8"},{"type":"output","id":"iugWeiOjRA5OasCnKSSN2","data":[],"key":"AcEUQDCvCI"}],"key":"EE4GXSpUVQ"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"class ConvertToCOGTiff(EOTask):\n    def execute(self, eopatch, src_filename, dest_filename):\n        subprocess.run(\"gdaladdo -r average --config GDAL_TIFF_OVR_BLOCKSIZE 1024 \" + src_filename + \" 2 4 8 16 32\", shell=True, check=True)\n        subprocess.run(\"gdal_translate -co TILED=YES -co COPY_SRC_OVERVIEWS=YES -co BLOCKXSIZE=1024 -co BLOCKYSIZE=1024 -co COMPRESS=DEFLATE --config GDAL_TIFF_OVR_BLOCKSIZE 1024 \" + src_filename + \" \" + dest_filename, shell=True, check=True)\n        return eopatch\n","key":"sBKHD7NLut"},{"type":"output","id":"fFbwW6AHZiDa5mLSJUqhk","data":[],"key":"yIULaExRHb"}],"key":"Ar3wx53T7T"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"class UploadAmazonS3File(EOTask):\n    def __init__(self, bucket, s3_client = None, aws_access_key_id = None, aws_secret_access_key = None):\n        if not s3_client is None:\n            self.s3_client = s3_client\n        elif not aws_access_key_id is None and not aws_secret_access_key is None:\n            self.s3_client = UploadAmazonS3File.createClient(aws_access_key_id, aws_secret_access_key)\n        else:\n            raise ValueError(\"Either s3_client must be defined, or both aws_access_key_id and aws_secret_access_key\")\n        self.bucket = bucket\n    \n    def execute(self, eopatch, src_filename, dest_filename):\n        with open(src_filename, \"rb\") as f:\n            self.s3_client.upload_fileobj(f, self.bucket, dest_filename)\n        return eopatch\n    \n    def createClient(aws_access_key_id, aws_secret_access_key):\n        return boto3.client('s3',\n            aws_access_key_id = aws_access_key_id, aws_secret_access_key = aws_secret_access_key)","key":"fbpt2yZYDu"},{"type":"output","id":"WvjA-VAmRuNpFObMXigPr","data":[],"key":"RDRnwtb1wW"}],"key":"LrAsKd2Z1z"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"class CreateSHCollectionFromS3(EOTask):\n    def __init__(self, sh_oauth_session, s3_bucket, collection_id):\n        self.sh_client = SentinelHubClient(sh_oauth_session, s3_bucket)\n        self.s3_bucket = s3_bucket\n        self.collection_id = collection_id\n        \n    def execute(self, eopatch, s3_file_path):\n        tile_id = self.sh_client.getTileByPath(self.collection_id, s3_file_path)\n        if not tile_id is None:\n            self.sh_client.deleteTile(self.collection_id, tile_id)\n        \n        self.sh_client.ingestTile(self.collection_id, s3_file_path, eopatch.bbox)\n        \n        return eopatch","key":"yiPP2NLj4l"},{"type":"output","id":"Ywpf66RO1lH2w4kKDeWU_","data":[],"key":"ddi4h4Ncaj"}],"key":"OdyOczYHFW"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# TASK TO LOAD EXISTING EOPATCHES\nload = LoadTask(path_out_sampled)\n\n# TASK FOR PREDICTION\npredict = PredictPatch(model, (FeatureType.DATA, 'FEATURES'), 'LBL_GBM', 'SCR_GBM')\n\n# TASK FOR SAVING\nsave = SaveTask(str(path_out_sampled), overwrite_permission=OverwritePermission.OVERWRITE_PATCH)\n\n# TASK TO EXPORT TIFF\nexport_tiff = ExportToTiff((FeatureType.MASK_TIMELESS, 'LBL_GBM'))\n\n# Convert generated TIFF to COG\nconvert_prediction_to_cog_tiff = ConvertToCOGTiff()\nconvert_land_use_to_cog_tiff = ConvertToCOGTiff()\nconvert_lpis_to_cog_tiff = ConvertToCOGTiff()\n\n# Upload to Amazon S3\ns3_upload_prediction = UploadAmazonS3File(aws_s3_bucket, None, aws_access_key_id, aws_secret_access_key)\ns3_upload_land_use = UploadAmazonS3File(aws_s3_bucket, None, aws_access_key_id, aws_secret_access_key)\ns3_upload_lpis = UploadAmazonS3File(aws_s3_bucket, None, aws_access_key_id, aws_secret_access_key)\n\n\n# Ingest in SentinelHub\nsh_oauth_session = OAuth2Session(client = BackendApplicationClient(client_id = sentinelhub_client_id))\nsh_oauth_token = sh_oauth_session.fetch_token(token_url = sentinelhub_url + '/oauth/token',\n    client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)\n\nsh_client = SentinelHubClient(sh_oauth_session, aws_s3_bucket)\n\nsentinelhub_collection_id = sh_client.getCollectionByName(sentinelhub_collection_name)\nif sentinelhub_collection_id is None:\n    sentinelhub_collection_id = sh_client.createCollection(sentinelhub_collection_name)\n\nprint(\"SH collection ID:\", sentinelhub_collection_id)\n\nsh_create_collection = CreateSHCollectionFromS3(sh_oauth_session, aws_s3_bucket, sentinelhub_collection_id)\n\n\nworkflow = LinearWorkflow(\n    load,\n    predict,\n    export_tiff,\n    convert_prediction_to_cog_tiff,\n    convert_land_use_to_cog_tiff,\n    convert_lpis_to_cog_tiff,\n    s3_upload_prediction,\n    s3_upload_land_use,\n    s3_upload_lpis,\n    sh_create_collection,\n    save\n)","key":"lMcPhppkdg"},{"type":"output","id":"5zY25EqJZmnLdXXQEMRSn","data":[{"name":"stdout","output_type":"stream","text":"SH collection ID: dd4c4949-02ef-41b1-8548-1058ba132544\n"}],"key":"TmkZssdeS6"}],"key":"B2eMdYYtVg"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"predicted_tiff_location = './predicted_tiff'\nif not os.path.isdir(predicted_tiff_location):\n    os.makedirs(predicted_tiff_location)\n    \nsource_tiff_location = './source_tiff'\n\n# create a list of execution arguments for each patch\nexecution_args = []\nfor i in range(len(patchIDs)):\n    bbox = bbox_list[i]\n    eopath_subfolder_name = \"{0:.0f}_{1:.0f}_{2:.0f}_{3:.0f}__epsg{crs}\".format(\n        bbox.min_x, bbox.min_y, bbox.max_x, bbox.max_y, crs = bbox.crs.value)\n    \n    execution_args.append(\n        {\n            load: {'eopatch_folder': 'eopatch_{}'.format(i)},\n            export_tiff: {'filename': '{}/prediction_eopatch_{}_original.tiff'.format(predicted_tiff_location, i)},\n            convert_prediction_to_cog_tiff: {'src_filename': '{}/prediction_eopatch_{}_original.tiff'.format(predicted_tiff_location, i), \n                'dest_filename': '{}/prediction_eopatch_{}.tiff'.format(predicted_tiff_location, i)},\n            convert_land_use_to_cog_tiff: {'src_filename': '{}/land_use_eopatch_{}_original.tiff'.format(source_tiff_location, i),\n                'dest_filename': '{}/land_use_eopatch_{}.tiff'.format(source_tiff_location, i)},\n            convert_lpis_to_cog_tiff: {'src_filename': '{}/lpis_eopatch_{}_original.tiff'.format(source_tiff_location, i),\n                'dest_filename': '{}/lpis_eopatch_{}.tiff'.format(source_tiff_location, i)},\n            s3_upload_prediction: {'src_filename': '{}/prediction_eopatch_{}.tiff'.format(predicted_tiff_location, i), \n                'dest_filename': aws_s3_path.format(eopath_subfolder_name, value_name = \"prediction\")},\n            s3_upload_land_use: {'src_filename': '{}/land_use_eopatch_{}.tiff'.format(source_tiff_location, i), \n                'dest_filename': aws_s3_path.format(eopath_subfolder_name, value_name = \"land_use\")},\n            s3_upload_lpis: {'src_filename': '{}/lpis_eopatch_{}.tiff'.format(source_tiff_location, i), \n                'dest_filename': aws_s3_path.format(eopath_subfolder_name, value_name = \"lpis\")},\n            sh_create_collection: {'s3_file_path': aws_s3_path.format(eopath_subfolder_name, value_name = \"(BAND)\")},\n            save: {'eopatch_folder': 'eopatch_{}'.format(i)}\n        }\n    )\n\n# run the executor on 2 cores\nexecutor = EOExecutor(workflow, execution_args)\n\n# uncomment below save the logs in the current directory and produce a report!\n#executor = EOExecutor(workflow, execution_args, save_logs=True)\n\nexecutor.run(workers=2, multiprocess=False)\nexecutor.make_report()","key":"atz6v54ein"},{"type":"output","id":"aDeMyJUttA53zrgjGN3G6","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"0180c823768249ca88a74af2d59aff6d\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"HBox(children=(IntProgress(value=0, max=9), HTML(value='')))","content_type":"text/plain"}}},{"name":"stdout","output_type":"stream","text":"\n"}],"key":"R1FFFclyBb"}],"key":"AatuUzh5iS"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# %%time\n# merge with gdal_merge.py (with compression) using bash command magic\n#!gdal_merge.py -o predicted_tiff/merged_prediction.tiff -co compress=LZW predicted_tiff/prediction_eopatch_*","key":"G2ccQZCXzN"},{"type":"output","id":"g05so7yojdASUoc0VNYSI","data":[],"key":"NqzDQAjEPK"}],"key":"ZCIBpxKyDb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Part 3: Visualize the prediction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"lD2pzDu4hm"}],"identifier":"part-3-visualize-the-prediction","label":"Part 3: Visualize the prediction","html_id":"part-3-visualize-the-prediction","implicit":true,"key":"FrFT1ovUDs"}],"key":"TWzzzyExDz"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"path_out_sampled = './eopatches_sampled_small/' if use_smaller_patches else './eopatches_sampled_large/'\n\nfig, axes = plt.subplots(figsize=(20, 20 * aspect_ratio), nrows=3, ncols=3)\n\ncmapValues = [color for id, color in lulcColorMapping.items()]\nnormValues = list(lulcColorMapping.keys())\nnormValues.append(20)\ncmap = colors.ListedColormap(cmapValues)\nnorm = colors.BoundaryNorm(normValues, cmap.N + 1)\n\npbar = tqdm(total=9)\nfor i, ax in enumerate(axes.flat):\n    eopatch = EOPatch.load('{}/eopatch_{}'.format(path_out_sampled, i), lazy_loading=True)\n    im = ax.imshow(eopatch.mask_timeless['LBL_GBM'].squeeze(), cmap=cmap, norm=norm)\n    ax.set_xticks([])\n    ax.set_yticks([])\n    ax.set_aspect(\"auto\")\n    pbar.update(1)\n\nfig.subplots_adjust(wspace=0, hspace=0)\n\ncb = fig.colorbar(im, ax=axes.ravel().tolist(), orientation='horizontal', pad=0.01, aspect=100)\ncb.ax.tick_params(labelsize=20) \ncb.set_ticks([id for id in lulcMapping.keys()])\ncb.ax.set_xticklabels([entry[\"name\"] for entry in lulcMapping.values()], rotation=45, fontsize=15)\nplt.show()","key":"ANycThQUv9"},{"type":"output","id":"k9Mn7zkgTfZHO_jaCRwOR","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\tqdm\\__init__.py:27: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0\nPlease use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`\n  TqdmDeprecationWarning)\n"},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"6cfa384149314bf6a8ea6f04ab7d41ef\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"HBox(children=(IntProgress(value=0, max=9), HTML(value='')))","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"b8ce081d40b5931825c9f0c149e89dad","path":"/notebooks_test/build/b8ce081d40b5931825c9f0c149e89dad.png"},"text/plain":{"content":"\u003cFigure size 1440x1452.97 with 10 Axes\u003e","content_type":"text/plain"}}}],"key":"SFfe9EWui0"}],"key":"YlXIp7wynv"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visual inspection of patches","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AIU7xPKY4a"}],"identifier":"visual-inspection-of-patches","label":"Visual inspection of patches","html_id":"visual-inspection-of-patches","implicit":true,"key":"jew4pQwZcV"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Here is just a simple piece of code that allows a closer inspection of the predicted labels.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"nsVrSrv98d"}],"key":"dAGBMNuh80"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Random subsets of patches are chosen, where prediction and ground truth are compared. For visual aid the mask of differences and the true color image are also provided.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"wQt1BKLlpA"}],"key":"eqm8mnvj8j"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"In majority of the cases, differences seem to lie on the border of different structures.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"CSDWGt0R8f"}],"key":"R35AqbXcSB"}],"key":"fc36jjCxEz"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# Draw the Reference map\n\nfig = plt.figure(figsize=(20, 20))\n\nidx = np.random.choice(range(9))\ninspect_size = 100\n\neopatch = EOPatch.load('{}/eopatch_{}'.format(path_out_sampled, idx), lazy_loading=True)\n\nw, h = eopatch.mask_timeless['LULC'].squeeze().shape\n\nw_min = np.random.choice(range(w - inspect_size))\nh_min = np.random.choice(range(h - inspect_size))\n\ncmap = colors.ListedColormap([color for id, color in lulcColorMapping.items()])\nnorm = colors.BoundaryNorm(range(cmap.N), cmap.N)\n\nax = plt.subplot(2, 2, 1)\nplt.imshow(eopatch.mask_timeless['LULC'].squeeze()[w_min: w_min + inspect_size, h_min : h_min + inspect_size], cmap=cmap, norm=norm)\nplt.xticks([])\nplt.yticks([])\nax.set_aspect(\"auto\")\nplt.title('Ground Truth', fontsize=20)\n\nax = plt.subplot(2, 2, 2)\nplt.imshow(eopatch.mask_timeless['LBL_GBM'].squeeze()[w_min: w_min + inspect_size, h_min: h_min + inspect_size], cmap=cmap, norm=norm)\nplt.xticks([])\nplt.yticks([])\nax.set_aspect(\"auto\")\nplt.title('Prediction', fontsize=20)\n\nax = plt.subplot(2, 2, 3)\nmask = eopatch.mask_timeless['LBL_GBM'].squeeze() != eopatch.mask_timeless['LULC'].squeeze()\nplt.imshow(mask[w_min: w_min + inspect_size, h_min: h_min + inspect_size], cmap='gray')\nplt.xticks([])\nplt.yticks([]);\nax.set_aspect(\"auto\")\nplt.title('Difference', fontsize=20)\n\nax = plt.subplot(2, 2, 4)\nimage = np.clip(eopatch.data['FEATURES'][8][..., [2, 1, 0]] * 3.5, 0, 1)\nplt.imshow(image[w_min: w_min + inspect_size, h_min: h_min + inspect_size])\nplt.xticks([])\nplt.yticks([]);\nax.set_aspect(\"auto\")\nplt.title('True Color', fontsize=20)\n\nfig.subplots_adjust(wspace=0.1, hspace=0.1)","key":"Cew3GjvDBg"},{"type":"output","id":"C_aqADuuotDeR-QR6wHgx","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"0ebbad16a4c666bce2c60f88b86b829e","path":"/notebooks_test/build/0ebbad16a4c666bce2c60f88b86b829e.png"},"text/plain":{"content":"\u003cFigure size 1440x1440 with 4 Axes\u003e","content_type":"text/plain"}}}],"key":"wGYWkaCQKA"}],"key":"AHAAxYRZEm"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Land Use vs Prediction","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VkqQrxCQPi"}],"identifier":"land-use-vs-prediction","label":"Land Use vs Prediction","html_id":"land-use-vs-prediction","implicit":true,"key":"GeubDSBz3y"}],"key":"lOiYvqC1iY"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get SH collection ID\nsh_oauth_session = OAuth2Session(client = BackendApplicationClient(client_id = sentinelhub_client_id))\nsh_oauth_token = sh_oauth_session.fetch_token(token_url = sentinelhub_url + '/oauth/token',\n    client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)\n\nsh_client = SentinelHubClient(sh_oauth_session, aws_s3_bucket)\n\nsentinelhub_collection_id = sh_client.getCollectionByName(sentinelhub_collection_name)\n\nprint(\"SH collection ID:\", sentinelhub_collection_id)","key":"nA5SUMFRJq"},{"type":"output","id":"i5bz81OsmsCU5LsQzmN2I","data":[{"name":"stdout","output_type":"stream","text":"SH collection ID: dd4c4949-02ef-41b1-8548-1058ba132544\n"}],"key":"uI4GDf00V2"}],"key":"f8T5QVJzxf"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"## Plot utility functions\n\ndef createColorMapAndNorm(colorMapping, insertZero: bool, extraVal: int):\n    cmapValues = list(colorMapping.values())\n    normValues = list(colorMapping.keys())\n    \n    if insertZero:\n        normValues.insert(0, 0)\n        cmapValues.insert(0, [1, 1, 1])\n        \n    if not extraVal is None:\n        normValues.append(extraVal) # need to add a value, so the real last value can be used\n    \n    cmap = colors.ListedColormap(cmapValues)\n    norm = colors.BoundaryNorm(normValues, cmap.N)  \n    return cmap, norm\n\ndef plotMap(data, title, colorMapping, legendTexts, insertZero: bool, extraVal: int, \n    cbarHorizontal: bool, cbarPad: float, cbarAspect: float, \n    cbarTextSize: float, cbarTextRotation: float, hasLegend = True): \n    \n    figure, ax = plt.subplots(figsize=(20, 16))\n    ax.set_title(title, fontsize=25)\n    \n    bounds = xcube.core.geom.get_dataset_bounds(data)\n    cmap, norm = createColorMapAndNorm(colorMapping, insertZero, extraVal)\n    img = plt.imshow(data.values, cmap=cmap, norm=norm, extent=(bounds[0], bounds[2], bounds[1], bounds[3]))\n\n    if hasLegend:\n        cb = figure.colorbar(img, ax=ax, orientation='horizontal' if cbarHorizontal else 'vertical', pad=cbarPad, aspect=cbarAspect)\n\n        #cb = figure.colorbar(img)\n        cb.set_ticks(list(colorMapping.keys()))\n        if not legendTexts is None:\n            if cbarHorizontal:\n                cb.ax.set_xticklabels(legendTexts, fontsize=cbarTextSize, rotation=cbarTextRotation)\n            else:\n                cb.ax.set_yticklabels(legendTexts, fontsize=cbarTextSize, rotation=cbarTextRotation)\n\n    return figure, ax, img","key":"ErHIWMq3SF"},{"type":"output","id":"DsIkCA_iacRXUNnAfVZuR","data":[],"key":"HYjbn1pfJL"}],"key":"YbmnfKjsF2"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# DB parcel loading utility functions\n\ndef addLineStringToPath(pathCoords, pathCommands, lineString, isReverse):\n    isFirst = True\n    for xy in lineString.coords:\n        pathCoords.append(xy)\n        pathCommands.append(patches.Path.MOVETO if isFirst else patches.Path.LINETO)\n        isFirst = False\n    \ndef geometryToPatch(geometry, lineColor, fillColor):\n    pathCoords = []\n    pathCommands = []\n    \n    addLineStringToPath(pathCoords, pathCommands, geometry.exterior, False)\n    for interior in geometry.interiors:\n        addLineStringToPath(pathCoords, pathCommands, interior, True)\n\n    if len(pathCoords) \u003c= 0 or len(pathCommands) \u003c= 0:\n        return None\n    return patches.PathPatch(patches.Path(pathCoords, pathCommands), fc = fillColor, ec = lineColor, lw = 0.5)\n\ndef addPatchToPlot(ax, patch):\n    if not patch is None:\n        ax.add_patch(patch)","key":"IUjqv75sxn"},{"type":"output","id":"0SHlvnUaou9AgNSp_VHvk","data":[],"key":"Alm5VVAyCX"}],"key":"CGwTpFIgaI"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# Read prediction form SH BYOC to xcube\n# Rearange selected EOPatches into bbox, which can be used for xcube definition\npatches_geometries = [Polygon(bbox.get_polygon()) for bbox in bbox_list[patchIDs]]\nbbox_of_patches = gpd.GeoSeries(cascaded_union(patches_geometries))\n\nx1 = bbox_of_patches.bounds['minx'][0].item()\ny1 = bbox_of_patches.bounds['miny'][0].item()\nx2 = bbox_of_patches.bounds['maxx'][0].item()\ny2 = bbox_of_patches.bounds['maxy'][0].item()\ncube_bbox = x1, y1, x2, y2\n\nspatial_res_meters = 10\n\ncube_pred_config = CubeConfig(dataset_name='CUSTOM',\n                         band_names=[\"prediction\"],                        \n                         chunk_size=[512, 512],\n                         crs=\"http://www.opengis.net/def/crs/EPSG/0/32633\",\n                         geometry=cube_bbox,\n                         time_range=['2019-01-01', '2020-01-01'],\n                         time_period='1y',\n                         spatial_res=spatial_res_meters,\n                         band_sample_types='UINT8',\n                         collection_id=sentinelhub_collection_id)","key":"MJo8wixp0S"},{"type":"output","id":"aPcFLZUZ-J0cDlIx3CVAk","data":[],"key":"lzeXlXGw0r"}],"key":"fvqrAZnh8I"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"# So we can print some SentinelHub usage stats\nrequest_collector = Observers.request_collector()\n\ncube_prediction = open_cube(cube_pred_config, request_collector, client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)\n# cube_prediction","key":"ETreo1wfGp"},{"type":"output","id":"vz65MmD7FnbELmlfN0kjF","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\store.py:73: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future\n  t_array = np.array([s + 0.5 * (e - s) for s, e in self._time_ranges]).astype('datetime64[s]').astype(np.int64)\nE:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\store.py:74: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future\n  t_bnds_array = np.array(self._time_ranges).astype('datetime64[s]').astype(np.int64)\n"}],"key":"svedbicuqo"}],"key":"e3KP03KVQI"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"data = cube_prediction[\"prediction\"][0,:,:]\nplotMap(data, 'Prediction', lulcColorMapping, lulcLegendTexts.values(), False, 20, \n    True, 0.03, 100, 15, 45)\nplt.show()","key":"sxTZBx49ZO"},{"type":"output","id":"1hCfysYXr9sgotCKsO_zy","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"1d67d8fff30bc12ec225214f4a192c9b","path":"/notebooks_test/build/1d67d8fff30bc12ec225214f4a192c9b.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"xtLVRGZHoQ"}],"key":"QlZ4EOOg0w"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Land use visualization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HK4GtbIMf1"}],"identifier":"land-use-visualization","label":"Land use visualization","html_id":"land-use-visualization","implicit":true,"key":"G5Tsx0Iz0A"}],"key":"wzf4yaQ4F5"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add land use to cube_prediction\n\ncube_pred_config = CubeConfig(dataset_name='CUSTOM',\n                         band_names=[\"land_use\"],                        \n                         chunk_size=[512, 512],\n                         crs=\"http://www.opengis.net/def/crs/EPSG/0/32633\",\n                         geometry=cube_bbox,\n                         time_range=['2019-01-01', '2020-01-01'],\n                         time_period='1y',\n                         spatial_res=10,\n                         band_sample_types='UINT16',\n                         collection_id=sentinelhub_collection_id)\n\nrequest_collector = Observers.request_collector()\n\ncube_land_use = open_cube(cube_pred_config, request_collector, client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)\ncube_prediction[\"land_use\"] = cube_land_use[\"land_use\"]\n# cube_prediction","key":"PSlmMT8NrM"},{"type":"output","id":"uEKz9kOLgm6548ssrMAZM","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\store.py:73: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future\n  t_array = np.array([s + 0.5 * (e - s) for s, e in self._time_ranges]).astype('datetime64[s]').astype(np.int64)\nE:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\store.py:74: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future\n  t_bnds_array = np.array(self._time_ranges).astype('datetime64[s]').astype(np.int64)\n"}],"key":"VhpQMRczkg"}],"key":"VZlxj3AptS"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"data = cube_prediction[\"land_use\"][0,:,:]\nplotMap(data, 'Land use', landUseColorMapping, landUseLegendTexts.values(), True, 10000, False, 0.03, 50, 12, 0)\nplt.show()","key":"LFysZ61SVG"},{"type":"output","id":"mF1G_eMuRoSjqKdrHBlm1","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"3f6e01412f172c238b53865eedb3da62","path":"/notebooks_test/build/3f6e01412f172c238b53865eedb3da62.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"sRRkLgDQma"}],"key":"kUdWXApaQ1"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add mapped land use data\ndimensions = cube_prediction[\"prediction\"].values[0].shape\nland_use_map = np.zeros((1, dimensions[0], dimensions[1]), 'uint8')\nland_use_map[0, :, :] = np.array([np.array([landUseToLulcMapping[val] for val in val_arr]) for val_arr in cube_prediction[\"land_use\"].values[0]])\nland_use_map_xa = xr.DataArray(land_use_map,\n                  dims=cube_prediction[\"prediction\"].dims,\n                  coords=cube_prediction[\"prediction\"].coords)\nland_use_map_xa_chunk = xcube.core.chunk.chunk_dataset(land_use_map_xa, chunk_sizes=(1, 512, 512))\ncube_prediction[\"land_use_mapped\"] = cube_land_use[\"land_use\"]\ncube_prediction[\"land_use_mapped\"] = land_use_map_xa_chunk\n# cube_prediction","key":"NuW4J5X8Dx"},{"type":"output","id":"ZG8mkdb28UeAPknqzJ1LD","data":[],"key":"vZgaHAAuiV"}],"key":"StKJjdLpcO"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# compute difference between prediction and land use\ncube_prediction[\"diff_prediction_land_use\"] = cube_prediction[\"prediction\"] - cube_prediction.land_use_mapped","key":"bWuugnDiEc"},{"type":"output","id":"5-M_Hfgg9J036cAUpw9qg","data":[],"key":"pFrCrserQb"}],"key":"sDAOpeDi9X"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"data = cube_prediction.diff_prediction_land_use[0,:,:]\nplotMap(data, 'Prediction vs. land use difference', diffColorMapping, None, False, 100, False, 0.03, 50, 12, 0, hasLegend = False)\nplt.show()","key":"abRjNVB8u8"},{"type":"output","id":"VqaCY-vGnoDJSRUovRnRK","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"1fd8cce4cecf54aeb0a9759d6d034bb4","path":"/notebooks_test/build/1fd8cce4cecf54aeb0a9759d6d034bb4.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"kvUiUE9EY9"}],"key":"w9p0MlKFcB"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"LPIS visualization","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EA0TlMkAAt"}],"identifier":"lpis-visualization","label":"LPIS visualization","html_id":"lpis-visualization","implicit":true,"key":"g6kxh5ASof"}],"key":"bcojj5AfuD"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add LPIS to cube_prediction\n\ncube_pred_config = CubeConfig(dataset_name='CUSTOM',\n                         band_names=[\"lpis\"],                        \n                         chunk_size=[512, 512],\n                         crs=\"http://www.opengis.net/def/crs/EPSG/0/32633\",\n                         geometry=cube_bbox,\n                         time_range=['2019-01-01', '2020-01-01'],\n                         time_period='1y',\n                         spatial_res=10,\n                         band_sample_types='UINT16',\n                         collection_id=sentinelhub_collection_id)\n\nrequest_collector = Observers.request_collector()\n\ncube_lpis = open_cube(cube_pred_config, request_collector, client_id = sentinelhub_client_id, client_secret = sentinelhub_client_secret)\ncube_prediction[\"lpis\"] = cube_lpis[\"lpis\"]\n# cube_prediction","key":"rvPMewbVp2"},{"type":"output","id":"ORKk2wHOgPT4Gf6rroD1v","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\store.py:73: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future\n  t_array = np.array([s + 0.5 * (e - s) for s, e in self._time_ranges]).astype('datetime64[s]').astype(np.int64)\nE:\\Python\\DCFS\\lib\\site-packages\\xcube_sh\\store.py:74: DeprecationWarning: parsing timezone aware datetimes is deprecated; this will raise an error in the future\n  t_bnds_array = np.array(self._time_ranges).astype('datetime64[s]').astype(np.int64)\n"}],"key":"cbikAvwEBy"}],"key":"Kmgzr67Ib1"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"data = cube_prediction[\"lpis\"][0,:,:]\nplotMap(data, 'LPIS', landUseColorMapping, landUseLegendTexts.values(), True, 10000, False, 0.03, 25, 12, 0)\nplt.show()","key":"T0j2F9xXLm"},{"type":"output","id":"GWdpzNyOkxkZSTwLGyiBi","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"a395a8e9b6c5282fe01ff927757a2e7c","path":"/notebooks_test/build/a395a8e9b6c5282fe01ff927757a2e7c.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"JtnvivDY2m"}],"key":"gdU5tW2tE7"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"# Add mapped land use data\ndimensions = cube_prediction[\"prediction\"].values[0].shape\nlpis_map = np.zeros((1, dimensions[0], dimensions[1]), 'uint8')\n\n# Note! We must offset data, to clearly recognize in the difference, where LPIS has no data\nlpis_map[0, :, :] = np.array([np.array([(50 + landUseToLulcMapping[val] if val \u003e 0 else 25) for val in val_arr]) for val_arr in cube_prediction[\"lpis\"].values[0]])\n\nlpis_map_xa = xr.DataArray(lpis_map,\n                  dims=cube_prediction[\"prediction\"].dims,\n                  coords=cube_prediction[\"prediction\"].coords)\nlpis_map_xa_chunk = xcube.core.chunk.chunk_dataset(lpis_map_xa, chunk_sizes=(1, 512, 512))\ncube_prediction[\"lpis_mapped\"] = lpis_map_xa_chunk\n# cube_prediction","key":"VxtmXbJHqn"},{"type":"output","id":"hGoDa3dpN5-Y9qwTRV_40","data":[],"key":"ltRdqdSzth"}],"key":"LIPLaftqzA"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"cube_prediction[\"diff_prediction_lpis\"] = cube_prediction.lpis_mapped - cube_prediction[\"prediction\"]\ndata = cube_prediction.diff_prediction_lpis[0,:,:]\n\n# add \"out-of-range\" values as black\ncolorMapping = {50 - len(lulcMapping): [0, 0, 0]} \ncolorMapping.update({(id + 50): color for id, color in diffColorMapping.items()})\nlegendTexts = [str(i) for i in range(-len(lulcMapping) + 1, +len(lulcMapping) + 1)]\nlegendTexts.insert(0, 'No data')\n\nplotMap(data, 'Prediction vs. LPIS difference', colorMapping, legendTexts, False, None, False, 0.03, 50, 12, 0, hasLegend = False)\nplt.show()","key":"tJd0UIJ2hN"},{"type":"output","id":"aSQo0oMkBT5AQNe-aJTv8","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"bb3d8f8a717f1ce890d4e192724d133e","path":"/notebooks_test/build/bb3d8f8a717f1ce890d4e192724d133e.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"fATBF4vRRW"}],"key":"MRGETbU45Q"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select smaller AOI (ask BC)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ws3OsXO9Wz"}],"identifier":"select-smaller-aoi-ask-bc","label":"Select smaller AOI (ask BC)","html_id":"select-smaller-aoi-ask-bc","implicit":true,"key":"lt7SyUBxRp"}],"key":"dzyBwbzevC"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"subset_size_ratio = 0.3 # regarding the full extent\n\nbounds = xcube.core.geom.get_dataset_bounds(cube_prediction)\nbounds_center_x = (bounds[0] + bounds[2]) / 2\nbounds_center_y = (bounds[1] + bounds[3]) / 2\nbounds_width = (bounds[2] - bounds[0])\nbounds_height = (bounds[3] - bounds[1])\n\nsubset_bbox = (\n    bounds_center_x - bounds_width * subset_size_ratio / 2,\n    bounds_center_y - bounds_height * subset_size_ratio / 2,\n    bounds_center_x + bounds_width * subset_size_ratio / 2,\n    bounds_center_y + bounds_height * subset_size_ratio / 2\n)\n\nsubset_cube_prediction = xcube.core.geom.clip_dataset_by_geometry(cube_prediction, subset_bbox)\nsubset_cube_prediction_data = subset_cube_prediction[\"prediction\"][0,:,:]\nsubset_cube_land_use_data = subset_cube_prediction[\"land_use\"][0,:,:]\nsubset_cube_diff_data = subset_cube_prediction[\"diff_prediction_land_use\"][0,:,:]\n\nfigurePrediction, axPrediction, imgPrediction = plotMap(subset_cube_prediction_data, 'Prediction', lulcColorMapping, lulcLegendTexts.values(), False, 20, False, 0.03, 50, 12, 0)\nfigureLandUse, axLandUse, imgLandUse = plotMap(subset_cube_land_use_data, 'Land use', landUseColorMapping, landUseLegendTexts.values(), True, 10000, False, 0.03, 50, 12, 0)\nfigureDiff, axDiff, imgDiff = plotMap(subset_cube_diff_data, 'Difference', diffColorMapping, None, False, 100, False, 0.03, 50, 12, 0, hasLegend = False)\n\ngeodb = GeoDBClient()\nland_use = loadFromDatabaseWithLulcMapping(geodb, \"Land use\", db_land_use_table, db_land_use_class_column, None,\n    BBox(subset_bbox, crs = country_crs), country_crs, selected_db_records_time, selected_db_records_time)\n\nfor row in land_use.iterrows():\n    addPatchToPlot(axPrediction, geometryToPatch(row[1]['geometry'], (1, 0, 0, 1), (0, 0, 0, 0)))\n    addPatchToPlot(axLandUse, geometryToPatch(row[1]['geometry'], (1, 0, 0, 1), (0, 0, 0, 0)))\n    addPatchToPlot(axDiff, geometryToPatch(row[1]['geometry'], (0, 1, 0, 1), (0, 0, 0, 0)))","key":"Uqde3tDUtX"},{"type":"output","id":"fFQdwV_kal5gJnV58vyoa","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\nE:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\nE:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\n"},{"name":"stdout","output_type":"stream","text":"Land use: 1081 DB records for bbox = 590364.0,5173024.0,593436.0,5176096.0\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"0615fcb4ddf9d1e447793aeda1d4e9d5","path":"/notebooks_test/build/0615fcb4ddf9d1e447793aeda1d4e9d5.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"db7a8750ff6479a85a5ba286a8bea6d9","path":"/notebooks_test/build/db7a8750ff6479a85a5ba286a8bea6d9.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"cec9c6e6d393cd272cc66ee36ed546fd","path":"/notebooks_test/build/cec9c6e6d393cd272cc66ee36ed546fd.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 1 Axes\u003e","content_type":"text/plain"}}}],"key":"AiEkYB0s6L"}],"key":"ipVAUAVSSX"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualizations per parcel (ask BC)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"T7hgaE5DsC"}],"identifier":"visualizations-per-parcel-ask-bc","label":"Visualizations per parcel (ask BC)","html_id":"visualizations-per-parcel-ask-bc","implicit":true,"key":"Rp62Z5C422"}],"key":"kzs4tWK4Mb"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"List of parcels to select from","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LIvRbVNgCQ"}],"identifier":"list-of-parcels-to-select-from","label":"List of parcels to select from","html_id":"list-of-parcels-to-select-from","implicit":true,"key":"ieLKFVhLuQ"}],"key":"tQULpKKyoM"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"x1 = bbox_of_patches.bounds['minx'][0].item()\ny1 = bbox_of_patches.bounds['miny'][0].item()\nx2 = bbox_of_patches.bounds['maxx'][0].item()\ny2 = bbox_of_patches.bounds['maxy'][0].item()\ncubeBBox = BBox((x1, y1, x2, y2), country_crs)\n\nfromWgs84Transform = pyproj.Transformer.from_crs(str(CRS.WGS84), str(country_crs))\ntoWgs84Transform = pyproj.Transformer.from_crs(str(country_crs), str(CRS.WGS84))\n\nselectedParcelId = None\n    \ndef computeLeafletScaleLevel(bbox):\n    return math.floor(1 + math.log(40000000 / max(bbox.max_x - bbox.min_x, bbox.max_y - bbox.min_y), 2))\n\ndef createLeafletMap(bbox):\n    mapCenter = toWgs84Transform.transform((bbox.min_x + bbox.max_x) / 2, (bbox.min_y + bbox.max_y) / 2)\n\n    terrainLayer = basemap_to_tiles(basemaps.Stamen.Terrain) \n    terrainLayer.name = \"Background\"\n    scaleLevel = computeLeafletScaleLevel(bbox)\n    leafletMap = LeafletMap(layers = (terrainLayer, ), center = mapCenter, zoom = scaleLevel)\n    return leafletMap\n\ndef lineStringToLeafletLocations(lineString):\n    return [toWgs84Transform.transform(xy[0], xy[1]) for xy in lineString.coords]\n\ndef addGeometryToLeafletMap(leafletMap, geomId, geometry, lineColor, fillColor, clickFunc):\n    locations = [lineStringToLeafletLocations(geometry.exterior)]\n    for interior in geometry.interiors:\n        locations.extend([lineStringToLeafletLocations(interior)])\n    if len(locations) \u003e 0:\n        layer = LeafletPolygon(locations = locations, \n            color = lineColor, opacity = 0.5, fill_color = fillColor, fill_opacity = 0.6, weight = 1)\n        leafletMap.add_layer(layer)\n        def layerClickFunc(**kwargs):\n            clickFunc(**kwargs, geomId = geomId)\n        layer.on_click(layerClickFunc)\n        \ndef loadParcelsToLeafletMap(leafletMap, bbox, tableName, landUseColumnName, clickFunc):\n    geodb = GeoDBClient()\n    \n    data = loadFromDatabaseWithLulcMapping(geodb, \"\", tableName, landUseColumnName, None, bbox, bbox.crs,  \n        selected_db_records_time, selected_db_records_time, maxRows = None, logging = False)\n\n    for row in data.iterrows():\n        color = lulcColorMapping[row[1]['lulcid']]\n        colorHtml = \"#{:02x}{:02x}{:02x}\".format(int(color[0] * 255), int(color[1] * 255), int(color[2] * 255))\n        addGeometryToLeafletMap(leafletMap, row[1]['id'], row[1]['geometry'], \"#FF0000\", colorHtml, clickFunc)\n\ndef createLeafletMapSentinelWmsLayer(leafletMap, instanceId, name, layer, bbox, resolution, visible, opacity):\n    bboxWgs84 = toWgs84Transform.transform(bbox.min_x, bbox.min_y), toWgs84Transform.transform(bbox.max_x, bbox.max_y)\n    \n    wmsUrl = 'http://services.sentinel-hub.com/ogc/wms/{instanceId}?' \\\n        + 'request=GetMap\u0026layers={layer}\u0026bbox={x1},{y1},{x2},{y2}\u0026crs={crs}\u0026format=image/png\u0026width={w}\u0026height={h}'\n    wmsUrl = wmsUrl.format(instanceId = instanceId, layer = layer, \n        x1 = bbox.min_x, y1 = bbox.min_y, x2 = bbox.max_x, y2 = bbox.max_y, crs = str(country_crs), \n        w = int((bbox.max_x - bbox.min_x) / resolution), h = int((bbox.max_y - bbox.min_y) / resolution))\n\n    return LeafletImageOverlay(url = wmsUrl, name = name, bounds = bboxWgs84, on = visible, opacity = opacity)\n\ndef addLeafletRectangleDrawControl(leafletMap):\n    drawControls = LeafletDrawControl()\n    drawControls.rectangle = {\n        \"shapeOptions\": {\n            \"fillColor\": \"#ff0000\",\n            \"color\": \"#ff0000\",\n            \"fillOpacity\": 0.75\n        }\n    }\n    drawControls.polygon = {}\n    drawControls.polyline =  {}\n    drawControls.circle = {}\n    drawControls.circlemarker = {}\n    leafletMap.add_control(drawControls)\n    return drawControls\n\ndef leafletParcelSelectionClickFunc(**kwargs):  \n    global selectedParcelId\n    selectedParcelId = kwargs['geomId']\n    print(\"Selected parcel \" + str(selectedParcelId))\n\ndef leafletOverviewDrawFunc(self, action, geo_json):  \n    geometry = geo_json['geometry']\n    if (geometry['type'] == 'Polygon') and len(geometry['coordinates']) == 1 and len(geometry['coordinates'][0]) == 5:\n        coords = geometry['coordinates'][0]\n        x1y1 = fromWgs84Transform.transform(coords[0][1], coords[0][0])\n        x2y2 = fromWgs84Transform.transform(coords[2][1], coords[2][0])\n        bbox = BBox((\n            min(cubeBBox.max_x, max(cubeBBox.min_x, x1y1[0])), \n            min(cubeBBox.max_y, max(cubeBBox.min_y, x1y1[1])),\n            min(cubeBBox.max_x, max(cubeBBox.min_x, x2y2[0])), \n            min(cubeBBox.max_y, max(cubeBBox.min_y, x2y2[1]))), country_crs)\n        \n        for layer in leafletMapParcelSelection.layers:\n            if isinstance(layer, LeafletPolygon):\n                leafletMapParcelSelection.remove_layer(layer)\n        \n        leafletMapParcelSelection.center = (coords[0][1] + coords[2][1]) * 0.5, (coords[0][0] + coords[2][0]) * 0.5\n        leafletMapParcelSelection.zoom = computeLeafletScaleLevel(bbox)\n        loadParcelsToLeafletMap(leafletMapParcelSelection, bbox, db_land_use_table, db_land_use_class_column, leafletParcelSelectionClickFunc)\n\n\nleafletMapOverview = createLeafletMap(cubeBBox)\n\nleafletMapOverview.add_layer(createLeafletMapSentinelWmsLayer(leafletMapOverview, sentinelhub_instance_id, \"Difference\", sentinelhub_prediction_diff_layer, cubeBBox, 10, False, 0.85))\nleafletMapOverview.add_layer(createLeafletMapSentinelWmsLayer(leafletMapOverview, sentinelhub_instance_id, \"Land use\", sentinelhub_land_use_layer, cubeBBox, 10, False, 0.85))\nleafletMapOverview.add_layer(createLeafletMapSentinelWmsLayer(leafletMapOverview, sentinelhub_instance_id, \"Prediction\", sentinelhub_prediction_layer, cubeBBox, 10, True, 0.85))\n\ndrawControls = addLeafletRectangleDrawControl(leafletMapOverview)\ndrawControls.on_draw(leafletOverviewDrawFunc)\nleafletMapOverview.add_control(LeafletLayersControl())\nleafletMapOverview.layout.height = '800px'\ndisplay(leafletMapOverview)\n\nleafletMapParcelSelection = createLeafletMap(cubeBBox)\nleafletMapParcelSelection.layout.height = '800px'\ndisplay(leafletMapParcelSelection)","key":"dSbFEz2wrk"},{"type":"output","id":"9O0rJCSRap-UIxwYDqK32","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\ipywidgets\\widgets\\widget.py:412: DeprecationWarning: Passing unrecoginized arguments to super(ImageOverlay).__init__(on=False).\nobject.__init__() takes exactly one argument (the instance to initialize)\nThis is deprecated in traitlets 4.2.This error will be raised in a future release of traitlets.\n  super(Widget, self).__init__(**kwargs)\nE:\\Python\\DCFS\\lib\\site-packages\\ipywidgets\\widgets\\widget.py:412: DeprecationWarning: Passing unrecoginized arguments to super(ImageOverlay).__init__(on=True).\nobject.__init__() takes exactly one argument (the instance to initialize)\nThis is deprecated in traitlets 4.2.This error will be raised in a future release of traitlets.\n  super(Widget, self).__init__(**kwargs)\n"},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"96653090c1e5404b889de483a71ac71b\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Map(basemap={'url': 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 'max_zoom': 19, 'attribution': 'Map …","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"a10fcaa4f61d4c0f812983828dbb2d22\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Map(basemap={'url': 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', 'max_zoom': 19, 'attribution': 'Map …","content_type":"text/plain"}}}],"key":"GYdoAjxO6p"}],"key":"P02mvMxVtt"},{"type":"block","kind":"notebook-code","data":{},"children":[{"type":"code","lang":"python","executable":true,"value":"def loadSingleRecordFromDatabase(recordId):\n    geodb = GeoDBClient()\n    data = loadFromDatabaseWithLulcMapping(geodb, \"Land use\", db_land_use_table, db_land_use_class_column, recordId, None, country_crs, None, None)\n\n    for row in data.iterrows():\n        return row[1]\n    return None\n\ndef addLineStringToPath(pathCoords, pathCommands, lineString, isReverse):\n    isFirst = True\n    for xy in lineString.coords:\n        pathCoords.append(xy)\n        pathCommands.append(patches.Path.MOVETO if isFirst else patches.Path.LINETO)\n        isFirst = False\n    \ndef geometryToPatch(geometry, lineColor, fillColor):\n    pathCoords = []\n    pathCommands = []\n    \n    addLineStringToPath(pathCoords, pathCommands, geometry.exterior, False)\n    for interior in geometry.interiors:\n        addLineStringToPath(pathCoords, pathCommands, interior, True)\n\n    if len(pathCoords) \u003c= 0 or len(pathCommands) \u003c= 0:\n        return None\n    return patches.PathPatch(patches.Path(pathCoords, pathCommands), fc = fillColor, ec = lineColor, lw = 2)\n\nif selectedParcelId is None:\n    print(\"Select first the parcel in the above details map!\")\nelse:\n    selectedParcelData = loadSingleRecordFromDatabase(selectedParcelId)\n\n    selectedParcelCubePrediction = xcube.core.geom.mask_dataset_by_geometry(cube_prediction, selectedParcelData['geometry'])\n    selectedParcelCubePredictionData = selectedParcelCubePrediction[\"prediction\"][0,:,:]\n    selectedParcelCubeLandUseData = selectedParcelCubePrediction[\"land_use\"][0,:,:]\n    selectedParcelCubeDiffData = selectedParcelCubePrediction[\"diff_prediction_land_use\"][0,:,:]\n\n    figurePrediction, axPrediction, imgPrediction = plotMap(selectedParcelCubePredictionData, 'Prediction', lulcColorMapping, lulcLegendTexts.values(), False, 20, False, 0.03, 50, 12, 0)\n    figureLandUse, axLandUse, imgLandUse = plotMap(selectedParcelCubeLandUseData, 'Land use', landUseColorMapping, landUseLegendTexts.values(), True, 10000, False, 0.03, 50, 12, 0)\n    figureDiff, axDiff, imgDiff = plotMap(selectedParcelCubeDiffData, 'Difference', diffColorMapping, None, False, 100, False, 0.03, 50, 12, 0)\n\n    addPatchToPlot(axPrediction, geometryToPatch(selectedParcelData['geometry'], (1, 0, 0, 1), (0, 0, 0, 0)))\n    addPatchToPlot(axLandUse, geometryToPatch(selectedParcelData['geometry'], (1, 0, 0, 1), (0, 0, 0, 0)))\n    addPatchToPlot(axDiff, geometryToPatch(selectedParcelData['geometry'], (0, 1, 0, 1), (0, 0, 0, 0)))","key":"xx0wa2Ardo"},{"type":"output","id":"W6NqXwrszVeKTMerVHJzU","data":[{"name":"stderr","output_type":"stream","text":"E:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\nE:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\nE:\\Python\\DCFS\\lib\\site-packages\\dask\\array\\core.py:350: FutureWarning: elementwise comparison failed; returning scalar instead, but in the future will perform elementwise comparison\n  o = func(*args, **kwargs)\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"2dd442bc58cd3c9b84fa982fd3d70ae9","path":"/notebooks_test/build/2dd442bc58cd3c9b84fa982fd3d70ae9.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"252e95b83942ea71ebc51beea7baf276","path":"/notebooks_test/build/252e95b83942ea71ebc51beea7baf276.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 2 Axes\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"6fad23e588b20b0edf703dc55ba9b28a","path":"/notebooks_test/build/6fad23e588b20b0edf703dc55ba9b28a.png"},"text/plain":{"content":"\u003cFigure size 1440x1152 with 2 Axes\u003e","content_type":"text/plain"}}}],"key":"nrOPHqvWi5"}],"key":"DNEI18Mqwh"},{"type":"block","kind":"notebook-content","data":{},"children":[{"type":"heading","depth":4,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"TODO: calculate % of wrongly predicted area for this parcel","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MPzhdJ9Dth"}],"identifier":"todo-calculate-of-wrongly-predicted-area-for-this-parcel","label":"TODO: calculate % of wrongly predicted area for this parcel","html_id":"todo-calculate-of-wrongly-predicted-area-for-this-parcel","implicit":true,"key":"Q45hiJj2vn"}],"key":"FD1SHYbupc"},{"type":"block","kind":"notebook-code","data":{"scrolled":true},"children":[{"type":"code","lang":"python","executable":true,"value":"    ","key":"Xuc8fcaF9t"},{"type":"output","id":"zPkL4wMUIL4QXdd1ZSIYs","data":[],"key":"oIhcoeyfHa"}],"key":"IY6QLGfCae"}],"key":"Itc3E4KFKY"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"How To: Land-Use-Land-Cover Prediction for Slovenia - using the Batch Processing API","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/howtolulc-batch-updated-210621","group":"Contributions"},"next":{"title":"Living Planet Symposium 2022 Training Session","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/lps2022-leverage-euro-data-cube-services","group":"Contributions"}}},"domain":"http://localhost:3000"},"project":{"github":"https://github.com/eoxhub-workspaces/documentation/","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"title":"Location for eodashboard notebooks","index":"readme","pages":[{"title":"External Notebooks","level":1},{"title":"Eurodatacube","level":2},{"title":"Notebooks","level":3},{"slug":"external-notebooks.eurodatacube.notebooks.readme","title":"Jupyter notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Notebooks","level":4},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.readme","title":"Euro Data Cube Notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Contributions","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-ai4arctic-sea-ice","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-biomass-forest-observation-sys","title":"AIREO pilot dataset - Biomass (Forest Observation System)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-cap","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-spacenet7","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aot-covid19","title":"Aerosol Optical Thickness (AOT) Anomaly Detection Using Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.batch-zarr-output","title":"Generating Zarr data cubes with Sentinel Hub Batch API","description":"","date":"","thumbnail":"/notebooks_test/build/68dffbf744fa42f4bf3d35e55684984e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.client-side-processing-using-mass-sh","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.cmems-data-download","title":"Cmems Data Download","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.detect-trucks-sentinel2","title":"Detect Trucks using Sentinel-2 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.drought-monitoring","title":"Drought impact monitoring platform","description":"","date":"","thumbnail":"/notebooks_test/build/ad5c19782b006f72352ae57794305840.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-africa-cube-africa-custom-contest","title":"Custom Script Contest – Urban Growth in Africa","description":"","date":"","thumbnail":"/notebooks_test/build/e9275f3fe80a704e2f5aa1ec1220e48a.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-byoc-tutorial","title":"How to bring your own data to EDC: Using Sentinel Hub Python package","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-demo-phi-week-v2","title":"xcube-gen and xcube-geodb Hands-On Workshop Φ-Week 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-geodb-4-eurocrops-demo","title":"Demonstration of Eurocrops data use in geoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-notebook-lstm","title":"South Africa Crop Type Classification on Euro Data Cube (EDC)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-usecase-lpis-crop-type-classification","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.eurocrops-crop-classification-example","title":"Crop-classification using Sentinel-2 time-series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ghsl-urban-delineation","title":"\u003cb\u003eUrban delineation\u003cb\u003e","description":"","date":"","thumbnail":"/notebooks_test/build/7bbf545a5eae1d9ebdb91ae42b261063.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.globalearthmonitor-example","title":"Pre-requisites","description":"","date":"","thumbnail":"/notebooks_test/build/205c1ded6bd59771975a9fbd3753fd3b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gpu-support-eoxhub","title":"GPU-Support on EOxHub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gran-chaco-phiweek","title":"ESA EO \\phi- week 2020","description":"","date":"","thumbnail":"/notebooks_test/build/80cee7db6cdc7002ceedda5689f889fa.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.howtolulc-batch-updated-210621","title":"How To: Land-Use-Land-Cover Prediction for Slovenia - using the Batch Processing API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lpis-lulc-slo","title":"LPIS Use Case for Land Use / Land Cover Classification","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lps2022-leverage-euro-data-cube-services","title":"Living Planet Symposium 2022 Training Session","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-analysis-covid19-lockdowns","title":"Impact of Covid19 induced lockdown on NO2 levels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-so2-trend-veda-api-igarss-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ogc-edc","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.openeo-client-demo","title":"openEO Client Demo","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.race-finishedgoodsinventory-inidcator","title":"Finished Goods Inventory indicator for RACE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.third-party-planetscope","title":"Third Party Data Import - PlanetScope","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-access-datasets","title":"Using xcube to access non-commercial and commercial data sets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-viewer-as-a-service-in-edc1","title":"Visualizing data with xcube viewer in EuroDataCube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-evaluation-workshop","title":"DAPA Evaluation Workshop: Introduction \u0026 Documentation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-1-cube-sentinel-2","title":"DAPA Tutorial #1: Cube - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-2-area-sentinel-2","title":"DAPA Tutorial #2: Area - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-3-timeseries-sentinel-2","title":"DAPA Tutorial #3: Timeseries - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-4-value-sentinel-2","title":"DAPA Tutorial #4: Value - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-5-dem","title":"DAPA Tutorial #5: DEM","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.fairicube.fairicube-data-access-demonstration","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-australian-bushfires","title":"Australian Bushfires","description":"","date":"","thumbnail":"/notebooks_test/build/ab194b4f8c40a2b9d64d8a85e37ce1fd.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["IGARSS-22","EO Dashboard"],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-data-access","title":"Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-detect-trucks-sentinel2","title":"Truck Detection Exercise","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-lockdown-in-venice","title":"Environmental Impacts of Lockdown in Venice, Italy during 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-nasa-api-lockdown-in-venice","title":"Lockdown in Venice","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-no2-timeseries-analysis","title":"NO2 timeseries analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-timeseries-stac-api-single-vs-multi","title":"Time series using STAC API statistics endpoints","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Curated","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.access-iacs-data","title":"How to access IACS Spatial Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-access-cci-data","title":"Access CCI data with xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-first-steps","title":"First steps on the Euro Data Cube platform","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-1-manage-datasets-v11","title":"Manage Collections in your GeoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-2-explore-datasets-2","title":"Exploring Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-3-share-datasets1","title":"Sharing Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-access-urban-atlas-data-v1","title":"[xcube-geodb] How to accesss EEA Urban Atlas Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-data-access","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-basic","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-ndvi","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-datasets","title":"EDC Sentinel Hub - using xcube to access different data sets in Sentinel Hub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-setup","title":"Setup for EDC core API access using xcube client library","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-xcube-integration","title":"EDC Sentinel Hub - XCUBE integration","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-usecase-ndvi-timeline","title":"NDVI timeline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.eo-learn","title":"Using eo-learn in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/5a1f8475f0c3652f4630d03d72891b98.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.esdl-edc-v0-2","title":"Earth System Data Lab Tutorial @ Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.exploring-time-and-space-with-edc","title":"Exploring Time and Space: A guide to accessing, analysing and visualising data in the Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.how-to-access-dem-data-through-sentinel-hub-api","title":"How to access DEM data through Sentinel Hub API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.sentinelhub-py","title":"Using Sentinel Hub Process API in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/01e22903839391bc356ac886ec2b2fa7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Notebooks","level":1},{"slug":"notebooks.example1","title":"📘 Example Notebook 1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.example2","title":"📘 Example Notebook 2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/notebooks_test/build/manifest-B4831781.js";
import * as route0 from "/notebooks_test/build/root-QGLRP2PL.js";
import * as route1 from "/notebooks_test/build/routes/$-7JYT5576.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/notebooks_test/build/entry.client-UNPC4GT3.js");</script></body></html>