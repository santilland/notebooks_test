<!DOCTYPE html><html lang="en" class="" style="scroll-padding:60px"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Detect Trucks using Sentinel-2 data - Location for eodashboard notebooks</title><meta property="og:title" content="Detect Trucks using Sentinel-2 data - Location for eodashboard notebooks"/><meta name="generator" content="mystmd"/><meta name="keywords" content=""/><link rel="stylesheet" href="/notebooks_test/build/_assets/app-HG4THSM4.css"/><link rel="stylesheet" href="/notebooks_test/build/_assets/thebe-core-VKVHG5VY.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jupyter-matplotlib@0.11.3/css/mpl_widget.css"/><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css" integrity="sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ" crossorigin="anonymous"/><link rel="icon" href="/notebooks_test/favicon.ico"/><link rel="stylesheet" href="/notebooks_test/myst-theme.css"/><script>
  const savedTheme = localStorage.getItem("myst:theme");
  const theme = window.matchMedia("(prefers-color-scheme: light)").matches ? 'light' : 'dark';
  const classes = document.documentElement.classList;
  const hasAnyTheme = classes.contains('light') || classes.contains('dark');
  if (!hasAnyTheme) classes.add(savedTheme ?? theme);
</script></head><body class="m-0 transition-colors duration-500 bg-white dark:bg-stone-900"><div class="fixed top-1 left-1 h-[0px] w-[0px] focus-within:z-40 focus-within:h-auto focus-within:w-auto bg-white overflow-hidden focus-within:p-2 focus-within:ring-1" aria-label="skip to content options"><a href="#skip-to-frontmatter" class="block px-2 py-1 text-black underline">Skip to article frontmatter</a><a href="#skip-to-article" class="block px-2 py-1 text-black underline">Skip to article content</a></div><div class="bg-white/80 backdrop-blur dark:bg-stone-900/80 shadow dark:shadow-stone-700 p-3 md:px-8 sticky w-screen top-0 z-30 h-[60px]"><nav class="flex items-center justify-between flex-nowrap max-w-[1440px] mx-auto"><div class="flex flex-row xl:min-w-[19.5rem] mr-2 sm:mr-7 justify-start items-center shrink-0"><a class="flex items-center ml-3 dark:text-white w-fit md:ml-5 xl:ml-7" href="/notebooks_test/"><span class="text-md sm:text-xl tracking-tight sm:mr-5">Made with MyST</span></a></div><div class="flex items-center flex-grow w-auto"><div class="flex-grow hidden text-md lg:block"></div><div class="flex-grow block"></div><button type="button" aria-haspopup="dialog" aria-expanded="false" aria-controls="radix-:R3iop:" data-state="closed" class="flex items-center h-10 aspect-square sm:w-64 text-left text-gray-400 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-700 hover:ring-blue-500 dark:hover:ring-blue-500 hover:border-blue-500 dark:hover:border-blue-500"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="p-2.5 h-10 w-10 aspect-square"><path fill-rule="evenodd" d="M10.5 3.75a6.75 6.75 0 1 0 0 13.5 6.75 6.75 0 0 0 0-13.5ZM2.25 10.5a8.25 8.25 0 1 1 14.59 5.28l4.69 4.69a.75.75 0 1 1-1.06 1.06l-4.69-4.69A8.25 8.25 0 0 1 2.25 10.5Z" clip-rule="evenodd"></path></svg><span class="hidden sm:block grow">Search</span><div aria-hidden="true" class="items-center hidden mx-1 font-mono text-sm text-gray-400 sm:flex gap-x-1"><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none hide-mac">CTRL</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none show-mac">⌘</kbd><kbd class="px-2 py-1 border border-gray-300 dark:border-gray-600 rounded-md shadow-[0px_2px_0px_0px_rgba(0,0,0,0.08)] dark:shadow-none ">K</kbd><script>
;(() => {
const script = document.currentScript;
const root = script.parentElement;

const isMac = /mac/i.test(
      window.navigator.userAgentData?.platform ?? window.navigator.userAgent,
    );
root.querySelectorAll(".hide-mac").forEach(node => {node.classList.add(isMac ? "hidden" : "block")});
root.querySelectorAll(".show-mac").forEach(node => {node.classList.add(!isMac ? "hidden" : "block")});
})()</script></div></button><button class="theme rounded-full aspect-square border border-stone-700 dark:border-white hover:bg-neutral-100 border-solid overflow-hidden text-stone-700 dark:text-white hover:text-stone-500 dark:hover:text-neutral-800 w-8 h-8 mx-3" title="Toggle theme between light and dark mode." aria-label="Toggle theme between light and dark mode."><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 hidden dark:block"><path fill-rule="evenodd" d="M9.528 1.718a.75.75 0 0 1 .162.819A8.97 8.97 0 0 0 9 6a9 9 0 0 0 9 9 8.97 8.97 0 0 0 3.463-.69.75.75 0 0 1 .981.98 10.503 10.503 0 0 1-9.694 6.46c-5.799 0-10.5-4.7-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 0 1 .818.162Z" clip-rule="evenodd"></path></svg><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" class="h-full w-full p-0.5 dark:hidden"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z"></path></svg></button><div class="block sm:hidden"></div><div class="hidden sm:block"></div></div></nav></div><article class="article content article-grid grid-gap"><main class="article-grid subgrid-gap col-screen"><div class="hidden"></div><div id="skip-to-frontmatter" aria-label="article frontmatter" class="mb-8 pt-9"><div class="flex items-center h-6 mb-5 text-sm font-light"><div class="flex-grow"></div><a href="https://github.com/eoxhub-workspaces/documentation/" title="GitHub Repository: eoxhub-workspaces/documentation/" target="_blank" rel="noopener noreferrer" class="text-inherit hover:text-inherit"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block mr-1 opacity-60 hover:opacity-100"><path d="M12 2.5c-5.4 0-9.8 4.4-9.8 9.7 0 4.3 2.8 8 6.7 9.2.5.1.7-.2.7-.5v-1.8c-2.4.5-3.1-.6-3.3-1.1-.1-.3-.6-1.1-1-1.4-.3-.2-.8-.6 0-.6s1.3.7 1.5 1c.9 1.5 2.3 1.1 2.8.8.1-.6.3-1.1.6-1.3-2.2-.2-4.4-1.1-4.4-4.8 0-1.1.4-1.9 1-2.6-.1-.2-.4-1.2.1-2.6 0 0 .8-.3 2.7 1 .8-.2 1.6-.3 2.4-.3.8 0 1.7.1 2.4.3 1.9-1.3 2.7-1 2.7-1 .5 1.3.2 2.3.1 2.6.6.7 1 1.5 1 2.6 0 3.7-2.3 4.6-4.4 4.8.4.3.7.9.7 1.8V21c0 .3.2.6.7.5 3.9-1.3 6.6-4.9 6.6-9.2 0-5.4-4.4-9.8-9.8-9.8z"></path></svg></a><div class="inline-block mr-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" width="1.25rem" height="1.25rem" class="inline-block"><title>Jupyter Notebook</title><path d="M20.2 1.7c0 .8-.5 1.4-1.3 1.5-.8 0-1.4-.5-1.5-1.3 0-.8.5-1.4 1.3-1.5.8-.1 1.5.5 1.5 1.3zM12 17.9c-3.7 0-7-1.3-8.7-3.3 1.8 4.8 7.1 7.3 11.9 5.5 2.5-.9 4.5-2.9 5.5-5.5-1.7 2-4.9 3.3-8.7 3.3zM12 5.1c3.7 0 7 1.3 8.7 3.3-1.8-4.8-7.1-7.3-11.9-5.5-2.5.9-4.5 2.9-5.5 5.5 1.7-2 5-3.3 8.7-3.3zM6.9 21.8c.1 1-.7 1.8-1.7 1.9-1 .1-1.8-.7-1.9-1.7 0-1 .7-1.8 1.7-1.9 1-.1 1.8.7 1.9 1.7zM3.7 4.6c-.6 0-1-.4-1-1s.4-1 1-1 1 .4 1 1c0 .5-.4 1-1 1z"></path></svg></div><div class="relative flex inline-block mx-1 grow-0" data-headlessui-state=""><button class="relative ml-2 -mr-1" id="headlessui-menu-button-:Rd4fop:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Downloads</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="1.25rem" height="1.25rem"><path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"></path></svg></button></div></div><h1 class="mb-0">Detect Trucks using Sentinel-2 data</h1></div><div class="block my-10 lg:sticky lg:z-10 lg:h-0 lg:pt-0 lg:my-0 lg:ml-10 lg:col-margin-right" style="top:60px"><nav></nav></div><div id="skip-to-article"></div><div id="AsYCeiJNaP" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">from edc import check_compatibility
check_compatibility(&quot;user-0.24.5&quot;, dependencies=[&quot;SH&quot;])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Fw_hTz88bEWRYyNaEfPAW" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="wFyPQT07t1" class="relative group/block"><h1 id="detect-trucks-using-sentinel-2-data" class="relative group"><span class="heading-text">Detect Trucks using Sentinel-2 data</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#detect-trucks-using-sentinel-2-data" title="Link to this Section" aria-label="Link to this Section">¶</a></h1><h2 id="parallax-based-truck-detection" class="relative group"><span class="heading-text">Parallax-based truck detection</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#parallax-based-truck-detection" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><hr class="py-2 my-5 translate-y-2"/><p>This notebook is a comprehensive script for detecting trucks with Sentinel-2 data. In order to run the detection in your area of interest you will have to modify two cells:</p><ol start="1"><li>Area of Interest (specify the aoi as bounding box)</li><li>Date (specify an acquisition date)</li></ol><p>Afterwards, you may simply run all cells and check the result at the end of the script where you can also write the detections as points.</p><p>Ensure that you have access to the Sentinel Hub resources for retrieving Sentinel-2 data through its API (via xcube_sh).</p><p>Author: Henrik Fisser, 2020<br/>Explanations on the truck detection on GitHub: <a target="_blank" rel="noreferrer" href="https://github.com/hfisser/Truck_Detection_Sentinel2_COVID19" class="">https://<wbr/>github<wbr/>.com<wbr/>/hfisser<wbr/>/Truck<wbr/>_Detection<wbr/>_Sentinel2<wbr/>_COVID19</a></p></div><div id="zOtjNLgPT6" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">import os
import subprocess
import sys

# installations
def install_package(pkg):
    subprocess.check_call([sys.executable, &quot;-m&quot;, &quot;pip&quot;, &quot;install&quot;, pkg])
install_package(&quot;OSMPythonTools&quot;)
install_package(&quot;geocube&quot;)

# OSM API
from OSMPythonTools.overpass import overpassQueryBuilder, Overpass

import numpy as np
import xarray as xr
import geocube
import geopandas as gpd
import pandas as pd
from xcube_sh.cube import open_cube
from xcube_sh.config import CubeConfig
from xcube.core.maskset import MaskSet
from rasterio import features
from affine import Affine
from shapely import geometry, coords
from shapely.geometry import Polygon, Point, box
from numba import jit

import IPython.display
%matplotlib inline</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="RoQ1WWM3N-IYsfU_Ap29g" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="qVseRKMx0Z" class="relative group/block"><h2 id="area-of-interest" class="relative group"><span class="heading-text">Area of Interest</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#area-of-interest" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Specify an area of interest as bounding box in format:<br/>xmin, ymin, ymax, ymax</p></div><div id="eBdXBXCejL" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">bbox = -3.85, 40.3, -3.55, 40.5 # Madrid
IPython.display.GeoJSON(box(*bbox).__geo_interface__)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Itk9ZLVX4RfLZTk_ctycP" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><div class="p-2.5">Loading...</div></div></div></div><div id="jgXO1XcGbD" class="relative group/block"><h2 id="date" class="relative group"><span class="heading-text">Date</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#date" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Select a cloud-free acquisition and provide the date as “YYYY-MM-DD”.
You may select data e.g. here:<br/><strong>Copernicus Open Access Hub</strong>
<a target="_blank" rel="noreferrer" href="https://scihub.copernicus.eu/dhus/#/home" class="">https://<wbr/>scihub<wbr/>.copernicus<wbr/>.eu<wbr/>/dhus<wbr/>/<wbr/>#<wbr/>/home</a> <br/><strong>EO Browser</strong>
<a target="_blank" rel="noreferrer" href="https://apps.sentinel-hub.com/eo-browser/?zoom=10&amp;lat=41.9&amp;lng=12.5&amp;themeId=DEFAULT-THEME" class="">https://<wbr/>apps<wbr/>.sentinel<wbr/>-hub<wbr/>.com<wbr/>/eo<wbr/>-browser<wbr/>/<wbr/>?zoom<wbr/>=<wbr/>10<wbr/>&amp;<wbr/>lat<wbr/>=<wbr/>41<wbr/>.9<wbr/>&amp;<wbr/>lng<wbr/>=<wbr/>12<wbr/>.5<wbr/>&amp;<wbr/>themeId<wbr/>=<wbr/>DEFAULT<wbr/>-THEME</a></p></div><div id="MW3VdyiQim" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">date_start = &quot;2020-05-18&quot;
date_end = &quot;2020-05-19&quot;</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Slb7yAzrYVsl2Ml0feZlB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="fLDpi7rXog" class="relative group/block"><h2 id="open-street-maps-osm" class="relative group"><span class="heading-text">Open Street Maps (OSM)</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#open-street-maps-osm" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>Trucks are only detected on roads obtained from OSM.
You may specify road types to include. Their descriptions can be found here:<br/><a target="_blank" rel="noreferrer" href="https://wiki.openstreetmap.org/wiki/Key:highway" class="">https://<wbr/>wiki<wbr/>.openstreetmap<wbr/>.org<wbr/>/wiki<wbr/>/Key:highway</a></p></div><div id="WirBAKAQ80" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">osm_values = [&quot;motorway&quot;, &quot;trunk&quot;, &quot;primary&quot;] # all of key &quot;highway&quot;
roads_buffer = 0.00022 # degree, OSM road vectors are buffered, for motorway, the others lower</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="bKRZs7uY4yALZPqUwqlDA" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="fbXqKlCSyk" class="relative group/block"><hr class="py-2 my-5 translate-y-2"/><h2 id="processing-methods" class="relative group"><span class="heading-text">Processing methods</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#processing-methods" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In the following cells all needed methods are defined. They will be invoked further below.</p></div><div id="LAk4zPpfjc" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># re-order bbox from W,S,E,N to S,W,N,E
def convert_bbox_osm(bbox):
    offset = 0.05 # add a buffer to bbox in order to be sure cube is entirely covered
    bbox_osm = [bbox[1], bbox[0], bbox[3], bbox[2]]
    bbox_osm[0] -= offset # min lat
    bbox_osm[1] -= offset # min lon
    bbox_osm[2] += offset # max lat
    bbox_osm[3] += offset # max lon
    return bbox_osm

# bbox List of four coords
# osm_value String OSM value
# osm_key String OSM key
# element_type List of String
# returns GeoDataFrame
def get_osm(bbox, 
            osm_value,
            element_type = [&quot;way&quot;, &quot;relation&quot;]):
    osm_key = &quot;highway&quot;
    bbox_osm = convert_bbox_osm(bbox)
    quot = &#x27;&quot;&#x27;
    select = quot+osm_key+quot + &#x27;=&#x27; + quot+osm_value+quot
    select_link = select.replace(osm_value, osm_value + &quot;_link&quot;) # also get road links
    select_junction = select.replace(osm_value, osm_value + &quot;_junction&quot;)
    geoms = []
    for selector in [select, select_link, select_junction]:  
        try:
            query = overpassQueryBuilder(bbox=bbox_osm, 
                                         elementType=element_type, 
                                         selector=selector, 
                                         out=&#x27;body&#x27;,
                                         includeGeometry=True)
            elements = Overpass().query(query, timeout=60).elements()
            # create multiline of all elements
            if len(elements) &gt; 0:
                for i in range(len(elements)):
                    elem = elements[i]
                    geoms.append(elem.geometry())
        except:
            Warning(&quot;Could not retrieve &quot; + select)
    try:
        lines = gpd.GeoDataFrame(crs = &quot;EPSG:4326&quot;, geometry = geoms)
        n = len(geoms)
        lines[&quot;osm_value&quot;] = [osm_value]*n # add road type
        return lines
    except:
        Warning(&quot;Could not merge &quot; + osm_value)
        
# buffer Float road buffer distance [m]
# bbox List of four coords
# bbox_id Integer processing id of bbox
# osm_values List of String OSM values
# osm_key String OSM key
# roads_buffer Float buffer width
# returns GeoDataFrame
def get_roads(bbox, osm_values, roads_buffer):
    osm_key = &quot;highway&quot;
    roads = []
    has_error = []
    offset = 0.00002
    buffer_dist = &quot;buffer_distance&quot;
    # buffer according to road type
    m,t,p,s,ter = &quot;motorway&quot;, &quot;trunk&quot;, &quot;primary&quot;, &quot;secondary&quot;, &quot;tertiary&quot;
    buffers = {m:roads_buffer, t:roads_buffer-offset, p:roads_buffer-(2*offset), s:roads_buffer-(3*offset), ter:roads_buffer-(4*offset)}
    osm_values_int = {m:1, t:2, p:3, s:4, ter:5}
    for osm_value in osm_values:
        roads_osm = get_osm(bbox, osm_value)
        try:
            roads_osm = get_osm(bbox, osm_value)
            roads_osm[buffer_dist] = [buffers[osm_value]] * len(roads_osm)
            roads_osm[&quot;osm_value_int&quot;] = osm_values_int[osm_value]
            roads.append(roads_osm)
        except:
            has_error.append(1)
            print(&quot;&#x27;get_osm&#x27;&quot; + &quot;failed for bbox_id osm_value &quot; + osm_value + &quot;osm_key&quot; + osm_key)
    if len(roads) &gt; len(has_error):
        roads_merge = gpd.GeoDataFrame(pd.concat(roads, ignore_index=True), crs=roads[0].crs)
        buffered = roads_merge.buffer(distance=roads_merge[buffer_dist])
        roads_merge.geometry = buffered
        return roads_merge

# osm geodataframe of polygons
# reference_raster xarray with lat and lon
# returns numpy array
def rasterize_osm(osm, reference_raster):
    osm_values = list(set(osm[&quot;osm_value&quot;]))
    nan_placeholder = 100
    road_rasters = []
    for osm_value in osm_values:
        osm_subset = osm[osm[&quot;osm_value&quot;] == osm_value]
        raster = rasterize(osm_subset, reference_raster.lat, reference_raster.lon)
        cond = np.isfinite(raster)
        raster_osm = np.where(cond, list(osm_subset.osm_value_int)[0], nan_placeholder) # use placeholder instead of nan first
        raster_osm = raster_osm.astype(np.float)
        road_rasters.append(raster_osm)        
    # merge road types in one layer
    road_raster_np = np.array(road_rasters).min(axis=0) # now use the lowest value (highest road level) because some intersect
    road_raster_np[road_raster_np == nan_placeholder] = 0
    return road_raster_np # 0=no_road 1=motorway, 2=trunk, ...

def transform_lat_lon(lat, lon):
    lat = np.asarray(lat)
    lon = np.asarray(lon)
    trans = Affine.translation(lon[0], lat[0])
    scale = Affine.scale(lon[1] - lon[0], lat[1] - lat[0])
    return trans * scale

def rasterize(polygons, lat, lon, fill=np.nan):
    transform = transform_lat_lon(lat, lon)
    out_shape = (len(lat), len(lon))
    raster = features.rasterize(polygons.geometry, out_shape=out_shape,
                                fill=fill, transform=transform,
                                dtype=float)
    return xr.DataArray(raster, coords={&quot;lat&quot;:lat, &quot;lon&quot;:lon}, dims=(&quot;lat&quot;, &quot;lon&quot;))</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="WU37UZtG7SNGhHq5AU51B" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="NVcbgyFqLv" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># TruckDetector detects trucks at acquisition-level
class TruckDetector():   
    def __init__(self, band_stack):
        is_none = band_stack is None
        self.band_stack = band_stack.chunk(band_stack.dims[&quot;lat&quot;], band_stack.dims[&quot;lon&quot;]) if not is_none else None
        self.no_truck_mask = None
        self.trucks = None
    
    def detect(self):
        B02 = self.band_stack.B02.persist().values
        B03 = self.band_stack.B03.persist().values
        B04 = self.band_stack.B04.persist().values
        B08 = self.band_stack.B08.persist().values
        B11 = self.band_stack.B11.persist().values
        no_truck_mask = calc_no_trucks(B02, B03, B04, B08, B11)
        trucks = detect_trucks(B02, B03, B04, no_truck_mask)
        lon_lat = {&quot;lat&quot;:self.band_stack.lat, &quot;lon&quot;:self.band_stack.lon}
        self.no_truck_mask = xr.DataArray(no_truck_mask, coords=lon_lat, dims=(&quot;lat&quot;, &quot;lon&quot;))
        self.trucks = xr.DataArray(trucks, coords=lon_lat, dims=(&quot;lat&quot;, &quot;lon&quot;)).astype(np.int)
        self.filter_trucks()
                            
    def filter_trucks(self):
        self.trucks = filter_spatial_3x3_extended(self.trucks)
        
# take xarray and ensure each value with 1 in data has no neighbor with 1 in an extended 3x3 block. Extended means: horizontally and vertically
# it is also checked for the second-next pixel
# Method checks only surrounding of values equal 1
# arr xarray DataArray with values and lat lon
def filter_spatial_3x3_extended(arr):
    values = arr.values
    lon = arr.lon
    lat = arr.lat
    valid = np.where(arr == 1)
    for y,x in zip(valid[0], valid[1]):
        y_above = y - 1
        y_above_next = y - 2
        x_left = x - 1
        x_right = x + 1
        x_left_next = x - 2
        space_left = x_left &gt;= 0
        space_right = x_right &gt;= 0 and x_right &lt; len(lon)
        space_above = y_above &gt;= 0
        val_left_above = values[y_above, x_left] if space_left and space_above else 0
        val_right_above = values[y_above, x_right] if space_right and space_above else 0
        val_left = values[y, x_left] if space_left else 0
        val_above = values[y_above, x] if space_above else 0
        val_left_next = values[y, x_left_next] if x_left_next &gt;= 0 else 0
        val_above_next = values[y_above_next, x] if y_above_next &gt;= 0 else 0
        # if any of the values left, above and left above has 1 set current value 0
        if (val_left_above + val_right_above + val_left + val_above + val_left_next + val_above_next) &gt;= 1:
            values[y,x] = 0
    arr.values = values
    return arr

# extracts coordinates at value in np array and returns points as GeoDataFrame
# data 2d np array
# match_value Float value in data where point coordinates are extracted
# lon_lat dict of:
### &quot;lon&quot;: np array longitude values&quot;
### &quot;lat&quot;: np array latitude values&quot;
# crs String EPSG:XXXX
def points_from_np(data, match_value, lon_lat, crs):
    indices = np.argwhere(data == match_value)
    if len(indices) &gt; 0:
        lat_indices = indices[:,[0]]
        lon_indices = indices[:,[1]]
        lat_coords = lon_lat[&quot;lat&quot;][lat_indices]
        lon_coords = lon_lat[&quot;lon&quot;][lon_indices]
        points = gpd.GeoDataFrame(geometry = gpd.points_from_xy(lon_coords, lat_coords))
        points.crs = crs
        return points
    
def raster_to_points(raster, lon_lat, field_name, crs):
    points_list = []
    match_values = np.unique(raster[(raster != 0) * ~np.isnan(raster)]) # by pixel value
    for x in match_values:
        points = points_from_np(raster, x, lon_lat, crs=crs)
        points[field_name] = [x] * len(points)
        points_list.append(points)
    return gpd.GeoDataFrame(pd.concat(points_list, ignore_index=True))
        
# Calculate a binary mask where pixels that are definitely no trucks are represented as 0.
# thresholds Dict with at least:
### max_ndvi Float above this val: no trucks. For Vegetation
### max_ndwi Float above this val: no trucks. For Water
### max_ndsi Float above this val: no_trucks. For Snow
### min_rgb Float above this val: no_trucks. For dark surfaces, e.g. shadows
### max_blue Float above this val: no_trucks
### max_green Float above this val: no trucks
### max_red Float above this val: no trucks
### min_b11 Float below this val: no trucks. For dark surfaces, e.g. shadows
### max_b11 Float below this val: no trucks. For bright (sealed) surfaces, e.g. buildings
@jit(nopython=True, parallel=True)
def calc_no_trucks(B02, B03, B04, B08, B11):
    th = {&quot;min_blue&quot;:0.06, 
          &quot;min_green&quot;:0.04, 
          &quot;min_red&quot;:0.04,
          &quot;max_red&quot;:0.15,
          &quot;max_green&quot;:0.15,
          &quot;max_blue&quot;:0.2,
          &quot;max_ndvi&quot;:0.5,
          &quot;max_ndwi&quot;:0.0001,
          &quot;max_ndsi&quot;:0.0001,
          &quot;min_blue_green_ratio&quot;:0.03,
          &quot;min_blue_red_ratio&quot;:0.05, 
          &quot;max_blue_green_ratio&quot;:0.17, 
          &quot;max_blue_red_ratio&quot;:0.2}
    ndvi_mask = ratio(B08, B04) &lt; th[&quot;max_ndvi&quot;]
    ndwi_mask = ratio(B02, B11) &lt; th[&quot;max_ndwi&quot;]
    ndsi_mask = ratio(B03, B11) &lt; th[&quot;max_ndsi&quot;]
    low_rgb_mask = (B02 &gt; th[&quot;min_blue&quot;]) * (B03 &gt; th[&quot;min_green&quot;]) * (B04 &gt; th[&quot;min_red&quot;])
    high_rgb_mask = (B02 &lt; th[&quot;max_blue&quot;]) * (B03 &lt; th[&quot;max_green&quot;]) * (B04 &lt; th[&quot;max_red&quot;])
    no_truck_mask = ndvi_mask * ndwi_mask * ndsi_mask * low_rgb_mask * high_rgb_mask
    return no_truck_mask

# Calculate a binary mask where trucks are represented as 1 and no trucks as 0.
# thresholds Dict with at least:
### min_green_ratio Float, minimum value of blue-green ratio
### min_red_ratio Float, minimum value of blue-red ratio
@jit(nopython=True, parallel=True)
def detect_trucks(B02, B03, B04, no_truck_mask):
    th = {&quot;min_blue&quot;:0.06, 
          &quot;min_green&quot;:0.04, 
          &quot;min_red&quot;:0.04,
          &quot;max_red&quot;:0.15,
          &quot;max_green&quot;:0.15,
          &quot;max_blue&quot;:0.2,
          &quot;max_ndvi&quot;:0.5,
          &quot;max_ndwi&quot;:0.0001,
          &quot;max_ndsi&quot;:0.0001,
          &quot;min_blue_green_ratio&quot;:0.03,
          &quot;min_blue_red_ratio&quot;:0.05, 
          &quot;max_blue_green_ratio&quot;:0.17, 
          &quot;max_blue_red_ratio&quot;:0.2}
    bg_ratio = ratio(B02, B03)
    br_ratio = ratio(B02, B04)
    bg = bg_ratio &gt; th[&quot;min_blue_green_ratio&quot;]
    br = br_ratio &gt; th[&quot;min_blue_red_ratio&quot;]
    bg_max = bg_ratio &lt; th[&quot;max_blue_green_ratio&quot;]
    br_max = br_ratio &lt; th[&quot;max_blue_red_ratio&quot;]
    trucks = (bg * br * bg_max * br_max) * no_truck_mask
    return trucks

@jit(nopython=True, parallel=True)
def ratio(a, b):
    return (a-b)/(a+b)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="zz-fFp9CvstQ7Fi-pMGer" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="kl3XH2WDcn" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre"># AcquisitionProcessor processes all valid pixels of a single acquisition in cube
class AcquisitionProcessor():
    def __init__(self, date_np64, cube):
        self.date_np64 = date_np64
        self.cube = cube
        self.band_stack = cube.sel(time = date_np64)
        self.detector = None
        self.no_clouds = None
        self.osm_mask = None
           
    def mask_clouds(self):
        cloud_masking_thresholds = {&quot;rgb&quot;:0.25,&quot;blue_green&quot;:0.2,&quot;blue_red&quot;:0.2}
        scl = MaskSet(self.band_stack.SCL)
        high_prob = scl.clouds_high_probability
        med_prob = scl.clouds_medium_probability
        cirrus = scl.cirrus
        no_data = scl.no_data
        rgb_cloud_mask = calc_rgb_cloud_mask(self.band_stack, cloud_masking_thresholds)
        self.no_clouds = (high_prob + med_prob + cirrus + no_data + rgb_cloud_mask) == 0
        self.band_stack = self.band_stack.where(self.no_clouds)
    
    def mask_with_osm(self, osm_mask):
        self.osm_mask = osm_mask
        self.band_stack = self.band_stack.where(self.osm_mask != 0)
                
    def do_detection(self):
        self.detector = TruckDetector(self.band_stack)
        self.detector.detect()
        
def calc_rgb_cloud_mask(band_stack, cloud_masking_thresholds):
    B02, B03, B04 = band_stack.B02, band_stack.B03, band_stack.B04
    c = cloud_masking_thresholds[&quot;rgb&quot;]
    clouds_rgb = ((B02 &gt; c) + (B03 &gt; c) + (B04 &gt; c)) &gt;= 1
    # attempt to mask haze without masking out truck pixels (similar! higher blue than red and green)
    blue_green_ratio = (B02-B03) / (B02+B03)
    blue_red_ratio = (B02-B04) / (B02+B04)
    clouds_blue_green = blue_green_ratio &gt; cloud_masking_thresholds[&quot;blue_green&quot;]
    clouds_blue_red = blue_red_ratio &gt; cloud_masking_thresholds[&quot;blue_red&quot;]
    clouds = (clouds_rgb + clouds_blue_green + clouds_blue_red) &gt;= 1
    return clouds</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="i_W90_yO2eTUv1jDgEbgB" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="VrXzcxBKQF" class="relative group/block"><hr class="py-2 my-5 translate-y-2"/><h2 id="get-sentinel-2-l2a-xcube" class="relative group"><span class="heading-text">Get Sentinel-2 L2A xcube</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#get-sentinel-2-l2a-xcube" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="ffpO3q9OUZ" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">config = CubeConfig(dataset_name = &quot;S2L2A&quot;,
                    band_names = [&quot;B02&quot;, &quot;B03&quot;, &quot;B04&quot;, &quot;B08&quot;, &quot;B11&quot;, &quot;SCL&quot;],
                    tile_size = [512, 512],
                    geometry = bbox,
                    spatial_res = 0.00009,
                    time_range = [date_start, date_end])
cube = open_cube(config)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="qOwFk6EbbJzGDxR-zDzG3" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>/opt/conda/envs/eurodatacube-0.24.5/lib/python3.8/site-packages/xcube_sh/config.py:99: UserWarning: the geometry parameter is no longer supported, use bbox instead
  warnings.warn(&#x27;the geometry parameter is no longer supported, use bbox instead&#x27;)
/opt/conda/envs/eurodatacube-0.24.5/lib/python3.8/site-packages/pandas/core/tools/timedeltas.py:132: FutureWarning: Units &#x27;M&#x27;, &#x27;Y&#x27; and &#x27;y&#x27; do not represent unambiguous timedelta values and will be removed in a future version
  return _coerce_scalar_to_timedelta_type(arg, unit=unit, errors=errors)
</span></code></pre></div></div></div><div id="L1U2hv0Nbf" class="relative group/block"><h3 id="acquisition" class="relative group"><span class="heading-text">Acquisition</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#acquisition" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="rbupNCkmqa" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">acquisition = AcquisitionProcessor(cube.time.values[0], cube)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="ZzZVYZ13ePn6apaw7YZjC" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="LZpPdOWRgr" class="relative group/block"><h3 id="plot-rgb" class="relative group"><span class="heading-text">Plot RGB</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#plot-rgb" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="AdDUGbbflB" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">rgb_bands = [&quot;B04&quot;, &quot;B03&quot;, &quot;B02&quot;]
coords, dims = [rgb_bands, cube.lat, cube.lon], [&quot;bands&quot;, &quot;lat&quot;, &quot;lon&quot;]
rgb = np.vstack([cube.B04.persist().values, cube.B03.persist().values, cube.B02.persist().values])
rgb_xr = xr.DataArray(rgb, coords=coords, dims=dims)
rgb_xr.plot.imshow(figsize=[12,10], rgb=&quot;bands&quot;, vmin=0, vmax=0.4)
rgb, rgb_xr = None, None</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="78lDm-7ae2AAYQhCdwt8q" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><img src="/notebooks_test/build/450eb58f07d897c1fbcbb6df05a4d5b2.png" alt="&lt;Figure size 864x720 with 1 Axes&gt;"/></div></div><div id="aXUKnhTqsM" class="relative group/block"><p>RGB reflectance</p></div><div id="YngoqNz9p5" class="relative group/block"><h2 id="get-osm-roads" class="relative group"><span class="heading-text">Get OSM roads</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#get-osm-roads" title="Link to this Section" aria-label="Link to this Section">¶</a></h2></div><div id="hRqNRf1Ki2" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">osm_roads = get_roads(bbox, osm_values, roads_buffer)
osm_roads.plot(figsize=[12,10])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Sa5hREyx5P63wQKZ7scGd" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;motorway&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;motorway&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;motorway_link&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;motorway_link&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;motorway_junction&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;motorway_junction&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;trunk&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;trunk&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;trunk_link&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;trunk_link&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;trunk_junction&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;trunk_junction&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;primary&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;primary&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;primary_link&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;primary_link&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>[overpass] downloading data: [timeout:60][out:json];(way[&quot;highway&quot;=&quot;primary_junction&quot;](40.25,-3.9,40.55,-3.5);relation[&quot;highway&quot;=&quot;primary_junction&quot;](40.25,-3.9,40.55,-3.5);); out body geom;
</span></code></pre></div><div><pre class="text-sm font-thin font-system"><code><span>&lt;ipython-input-6-00aa5324d1df&gt;:78: UserWarning: Geometry is in a geographic CRS. Results from &#x27;buffer&#x27; are likely incorrect. Use &#x27;GeoSeries.to_crs()&#x27; to re-project geometries to a projected CRS before this operation.

  buffered = roads_merge.buffer(distance=roads_merge[buffer_dist])
</span></code></pre></div><img src="/notebooks_test/build/3ba5e1b6bbe97ca9561f62fcb70b2a40.png" alt="&lt;Figure size 864x720 with 1 Axes&gt;"/></div></div><div id="vcgd3VA0kM" class="relative group/block"><p>The OSM road vectors are buffered, hence we see polygons here.</p></div><div id="EgqVgKdVk5" class="relative group/block"><h3 id="rasterize-osm-roads-to-s2-cube" class="relative group"><span class="heading-text">Rasterize OSM roads to S2 cube</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#rasterize-osm-roads-to-s2-cube" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="iEbdTj9nYd" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">osm_roads_np = rasterize_osm(osm_roads, cube.B02)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="N8MpuKCWGamszpQFIiee5" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>&lt;ipython-input-6-00aa5324d1df&gt;:94: DeprecationWarning: `np.float` is a deprecated alias for the builtin `float`. To silence this warning, use `float` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.float64` here.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  raster_osm = raster_osm.astype(np.float)
</span></code></pre></div></div></div><div id="BmkXw0FZwU" class="relative group/block"><h2 id="mask" class="relative group"><span class="heading-text">Mask</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#mask" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>In case there are clouds in the imagery, they are masked out here. Furthermore, the data is constrained to the OSM roads.</p></div><div id="d5wcgb1aP4" class="relative group/block"><h3 id="clouds" class="relative group"><span class="heading-text">Clouds</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#clouds" title="Link to this Section" aria-label="Link to this Section">¶</a></h3></div><div id="U1FMID1c7N" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">acquisition.mask_clouds()</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="EDW3IBNxCZnBraEfq_J06" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="Yni7E0N2Mq" class="relative group/block"><h3 id="to-osm-roads" class="relative group"><span class="heading-text">To OSM roads</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#to-osm-roads" title="Link to this Section" aria-label="Link to this Section">¶</a></h3><p>Only pixels within the buffered OSM roads are considered.</p></div><div id="x8bER3zIYn" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">acquisition.mask_with_osm(osm_roads_np)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="M6aZsxU0n1Gza02RuPI4C" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div id="OaToEhRRou" class="relative group/block"><h2 id="detect-trucks" class="relative group"><span class="heading-text">Detect trucks</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#detect-trucks" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>This is the actual detection being invoked in the “do_detection” wrapper. The output is an xarray DataArray, which is afterwards converted to a GeoDataFrame of points.</p></div><div id="wvTZ8IdalY" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">acquisition.do_detection()
# raster detections to points
truck_points = raster_to_points(acquisition.detector.trucks.values, {&quot;lon&quot;:cube.lon.values, &quot;lat&quot;:cube.lat.values}, &quot;trucks&quot;, &quot;EPSG:4326&quot;)
truck_points.plot(figsize=[12,10])</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="Gd6AFwH9DvjGPPEJKzewT" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left mb-5"><div><pre class="text-sm font-thin font-system"><code><span>&lt;ipython-input-7-916cb7c1a86e&gt;:19: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  self.trucks = xr.DataArray(trucks, coords=lon_lat, dims=(&quot;lat&quot;, &quot;lon&quot;)).astype(np.int)
</span></code></pre></div><img src="/notebooks_test/build/9fb78da59c102b50bb91c070a0c70e5c.png" alt="&lt;Figure size 864x720 with 1 Axes&gt;"/></div></div><div id="a1A4DasARQ" class="relative group/block"><h2 id="write-detections" class="relative group"><span class="heading-text">Write detections</span><a class="no-underline text-inherit hover:text-inherit inline-block w-0 px-0 translate-x-[10px] font-normal select-none transition-opacity opacity-0 focus:opacity-100 group-hover:opacity-70" href="#write-detections" title="Link to this Section" aria-label="Link to this Section">¶</a></h2><p>If you would like to write the truck points, simply modify the file path here</p></div><div id="h2U45VNttt" class="relative group/block"><div class="flex sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:hidden"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="hidden sticky top-[80px] z-10 opacity-70 group-hover/block:opacity-100 group-hover/block:flex"><div class="absolute top-0 -right-[28px] flex md:flex-col"></div></div><div class="relative group not-prose overflow-auto shadow hover:shadow-md dark:shadow-2xl dark:shadow-neutral-900 my-5 text-sm border border-l-4 border-l-blue-400 border-gray-200 dark:border-l-blue-400 dark:border-gray-800"><pre class="block p-3 hljs" style="background-color:unset"><code class="language-python" style="white-space:pre">truck_points.to_file(&quot;trucks.gpkg&quot;, driver=&quot;GPKG&quot;)</code></pre><button title="Copy to Clipboard" class="inline-flex items-center opacity-0 group-hover:opacity-100 hover:opacity-100 focus:opacity-100 active:opacity-100 cursor-pointer ml-2 transition-color duration-200 ease-in-out text-blue-400 hover:text-blue-500 absolute right-1 top-1" aria-pressed="false" aria-label="Copy code to clipboard"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" data-slot="icon" width="24" height="24"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 17.25v3.375c0 .621-.504 1.125-1.125 1.125h-9.75a1.125 1.125 0 0 1-1.125-1.125V7.875c0-.621.504-1.125 1.125-1.125H6.75a9.06 9.06 0 0 1 1.5.124m7.5 10.376h3.375c.621 0 1.125-.504 1.125-1.125V11.25c0-4.46-3.243-8.161-7.5-8.876a9.06 9.06 0 0 0-1.5-.124H9.375c-.621 0-1.125.504-1.125 1.125v3.5m7.5 10.375H9.375a1.125 1.125 0 0 1-1.125-1.125v-9.25m12 6.625v-1.875a3.375 3.375 0 0 0-3.375-3.375h-1.5a1.125 1.125 0 0 1-1.125-1.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H9.75"></path></svg></button></div><div data-mdast-node-id="AYCp9G_ONiueXKtHYhUtb" class="max-w-full overflow-y-visible overflow-x-auto m-0 group not-prose relative text-left"></div></div><div></div></main></article><script>((a,d)=>{if(!window.history.state||!window.history.state.key){let h=Math.random().toString(32).slice(2);window.history.replaceState({key:h},"")}try{let f=JSON.parse(sessionStorage.getItem(a)||"{}")[d||window.history.state.key];typeof f=="number"&&window.scrollTo(0,f)}catch(h){console.error(h),sessionStorage.removeItem(a)}})("positions", null)</script><link rel="modulepreload" href="/notebooks_test/build/entry.client-UNPC4GT3.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-OCTKKCIL.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-UAI5KRM7.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-2NH4LW52.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-IZFMW3M4.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-HBJK6BW3.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-HYMQ7M2K.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-OHOXABTA.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-OCWQY3HK.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-CPTH56EW.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-3CVK3PYF.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-J6FHCSRC.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-S4SWV34C.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-GUCIBHGO.js"/><link rel="modulepreload" href="/notebooks_test/build/root-QGLRP2PL.js"/><link rel="modulepreload" href="/notebooks_test/build/_shared/chunk-CB3BH7WY.js"/><link rel="modulepreload" href="/notebooks_test/build/routes/$-7JYT5576.js"/><script>window.__remixContext = {"url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/detect-trucks-sentinel2","state":{"loaderData":{"root":{"config":{"version":1,"myst":"1.3.25","options":{"hide_toc":true,"hide_footer_links":true,"folders":true},"nav":[],"actions":[],"projects":[{"github":"https://github.com/eoxhub-workspaces/documentation/","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"title":"Location for eodashboard notebooks","index":"readme","pages":[{"title":"External Notebooks","level":1},{"title":"Eurodatacube","level":2},{"title":"Notebooks","level":3},{"slug":"external-notebooks.eurodatacube.notebooks.readme","title":"Jupyter notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Notebooks","level":4},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.readme","title":"Euro Data Cube Notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Contributions","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-ai4arctic-sea-ice","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-biomass-forest-observation-sys","title":"AIREO pilot dataset - Biomass (Forest Observation System)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-cap","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-spacenet7","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aot-covid19","title":"Aerosol Optical Thickness (AOT) Anomaly Detection Using Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.batch-zarr-output","title":"Generating Zarr data cubes with Sentinel Hub Batch API","description":"","date":"","thumbnail":"/notebooks_test/build/68dffbf744fa42f4bf3d35e55684984e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.client-side-processing-using-mass-sh","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.cmems-data-download","title":"Cmems Data Download","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.detect-trucks-sentinel2","title":"Detect Trucks using Sentinel-2 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.drought-monitoring","title":"Drought impact monitoring platform","description":"","date":"","thumbnail":"/notebooks_test/build/ad5c19782b006f72352ae57794305840.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-africa-cube-africa-custom-contest","title":"Custom Script Contest – Urban Growth in Africa","description":"","date":"","thumbnail":"/notebooks_test/build/e9275f3fe80a704e2f5aa1ec1220e48a.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-byoc-tutorial","title":"How to bring your own data to EDC: Using Sentinel Hub Python package","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-demo-phi-week-v2","title":"xcube-gen and xcube-geodb Hands-On Workshop Φ-Week 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-geodb-4-eurocrops-demo","title":"Demonstration of Eurocrops data use in geoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-notebook-lstm","title":"South Africa Crop Type Classification on Euro Data Cube (EDC)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-usecase-lpis-crop-type-classification","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.eurocrops-crop-classification-example","title":"Crop-classification using Sentinel-2 time-series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ghsl-urban-delineation","title":"\u003cb\u003eUrban delineation\u003cb\u003e","description":"","date":"","thumbnail":"/notebooks_test/build/7bbf545a5eae1d9ebdb91ae42b261063.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.globalearthmonitor-example","title":"Pre-requisites","description":"","date":"","thumbnail":"/notebooks_test/build/205c1ded6bd59771975a9fbd3753fd3b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gpu-support-eoxhub","title":"GPU-Support on EOxHub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gran-chaco-phiweek","title":"ESA EO \\phi- week 2020","description":"","date":"","thumbnail":"/notebooks_test/build/80cee7db6cdc7002ceedda5689f889fa.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.howtolulc-batch-updated-210621","title":"How To: Land-Use-Land-Cover Prediction for Slovenia - using the Batch Processing API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lpis-lulc-slo","title":"LPIS Use Case for Land Use / Land Cover Classification","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lps2022-leverage-euro-data-cube-services","title":"Living Planet Symposium 2022 Training Session","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-analysis-covid19-lockdowns","title":"Impact of Covid19 induced lockdown on NO2 levels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-so2-trend-veda-api-igarss-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ogc-edc","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.openeo-client-demo","title":"openEO Client Demo","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.race-finishedgoodsinventory-inidcator","title":"Finished Goods Inventory indicator for RACE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.third-party-planetscope","title":"Third Party Data Import - PlanetScope","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-access-datasets","title":"Using xcube to access non-commercial and commercial data sets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-viewer-as-a-service-in-edc1","title":"Visualizing data with xcube viewer in EuroDataCube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-evaluation-workshop","title":"DAPA Evaluation Workshop: Introduction \u0026 Documentation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-1-cube-sentinel-2","title":"DAPA Tutorial #1: Cube - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-2-area-sentinel-2","title":"DAPA Tutorial #2: Area - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-3-timeseries-sentinel-2","title":"DAPA Tutorial #3: Timeseries - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-4-value-sentinel-2","title":"DAPA Tutorial #4: Value - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-5-dem","title":"DAPA Tutorial #5: DEM","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.fairicube.fairicube-data-access-demonstration","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-australian-bushfires","title":"Australian Bushfires","description":"","date":"","thumbnail":"/notebooks_test/build/ab194b4f8c40a2b9d64d8a85e37ce1fd.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["IGARSS-22","EO Dashboard"],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-data-access","title":"Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-detect-trucks-sentinel2","title":"Truck Detection Exercise","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-lockdown-in-venice","title":"Environmental Impacts of Lockdown in Venice, Italy during 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-nasa-api-lockdown-in-venice","title":"Lockdown in Venice","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-no2-timeseries-analysis","title":"NO2 timeseries analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-timeseries-stac-api-single-vs-multi","title":"Time series using STAC API statistics endpoints","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Curated","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.access-iacs-data","title":"How to access IACS Spatial Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-access-cci-data","title":"Access CCI data with xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-first-steps","title":"First steps on the Euro Data Cube platform","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-1-manage-datasets-v11","title":"Manage Collections in your GeoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-2-explore-datasets-2","title":"Exploring Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-3-share-datasets1","title":"Sharing Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-access-urban-atlas-data-v1","title":"[xcube-geodb] How to accesss EEA Urban Atlas Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-data-access","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-basic","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-ndvi","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-datasets","title":"EDC Sentinel Hub - using xcube to access different data sets in Sentinel Hub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-setup","title":"Setup for EDC core API access using xcube client library","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-xcube-integration","title":"EDC Sentinel Hub - XCUBE integration","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-usecase-ndvi-timeline","title":"NDVI timeline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.eo-learn","title":"Using eo-learn in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/5a1f8475f0c3652f4630d03d72891b98.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.esdl-edc-v0-2","title":"Earth System Data Lab Tutorial @ Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.exploring-time-and-space-with-edc","title":"Exploring Time and Space: A guide to accessing, analysing and visualising data in the Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.how-to-access-dem-data-through-sentinel-hub-api","title":"How to access DEM data through Sentinel Hub API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.sentinelhub-py","title":"Using Sentinel Hub Process API in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/01e22903839391bc356ac886ec2b2fa7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Notebooks","level":1},{"slug":"notebooks.example1","title":"📘 Example Notebook 1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.example2","title":"📘 Example Notebook 2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"CONTENT_CDN_PORT":"3100","MODE":"static","BASE_URL":"/notebooks_test"},"routes/$":{"config":{"version":1,"myst":"1.3.25","options":{"hide_toc":true,"hide_footer_links":true,"folders":true},"nav":[],"actions":[],"projects":[{"github":"https://github.com/eoxhub-workspaces/documentation/","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"title":"Location for eodashboard notebooks","index":"readme","pages":[{"title":"External Notebooks","level":1},{"title":"Eurodatacube","level":2},{"title":"Notebooks","level":3},{"slug":"external-notebooks.eurodatacube.notebooks.readme","title":"Jupyter notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Notebooks","level":4},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.readme","title":"Euro Data Cube Notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Contributions","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-ai4arctic-sea-ice","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-biomass-forest-observation-sys","title":"AIREO pilot dataset - Biomass (Forest Observation System)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-cap","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-spacenet7","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aot-covid19","title":"Aerosol Optical Thickness (AOT) Anomaly Detection Using Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.batch-zarr-output","title":"Generating Zarr data cubes with Sentinel Hub Batch API","description":"","date":"","thumbnail":"/notebooks_test/build/68dffbf744fa42f4bf3d35e55684984e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.client-side-processing-using-mass-sh","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.cmems-data-download","title":"Cmems Data Download","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.detect-trucks-sentinel2","title":"Detect Trucks using Sentinel-2 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.drought-monitoring","title":"Drought impact monitoring platform","description":"","date":"","thumbnail":"/notebooks_test/build/ad5c19782b006f72352ae57794305840.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-africa-cube-africa-custom-contest","title":"Custom Script Contest – Urban Growth in Africa","description":"","date":"","thumbnail":"/notebooks_test/build/e9275f3fe80a704e2f5aa1ec1220e48a.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-byoc-tutorial","title":"How to bring your own data to EDC: Using Sentinel Hub Python package","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-demo-phi-week-v2","title":"xcube-gen and xcube-geodb Hands-On Workshop Φ-Week 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-geodb-4-eurocrops-demo","title":"Demonstration of Eurocrops data use in geoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-notebook-lstm","title":"South Africa Crop Type Classification on Euro Data Cube (EDC)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-usecase-lpis-crop-type-classification","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.eurocrops-crop-classification-example","title":"Crop-classification using Sentinel-2 time-series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ghsl-urban-delineation","title":"\u003cb\u003eUrban delineation\u003cb\u003e","description":"","date":"","thumbnail":"/notebooks_test/build/7bbf545a5eae1d9ebdb91ae42b261063.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.globalearthmonitor-example","title":"Pre-requisites","description":"","date":"","thumbnail":"/notebooks_test/build/205c1ded6bd59771975a9fbd3753fd3b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gpu-support-eoxhub","title":"GPU-Support on EOxHub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gran-chaco-phiweek","title":"ESA EO \\phi- week 2020","description":"","date":"","thumbnail":"/notebooks_test/build/80cee7db6cdc7002ceedda5689f889fa.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.howtolulc-batch-updated-210621","title":"How To: Land-Use-Land-Cover Prediction for Slovenia - using the Batch Processing API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lpis-lulc-slo","title":"LPIS Use Case for Land Use / Land Cover Classification","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lps2022-leverage-euro-data-cube-services","title":"Living Planet Symposium 2022 Training Session","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-analysis-covid19-lockdowns","title":"Impact of Covid19 induced lockdown on NO2 levels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-so2-trend-veda-api-igarss-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ogc-edc","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.openeo-client-demo","title":"openEO Client Demo","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.race-finishedgoodsinventory-inidcator","title":"Finished Goods Inventory indicator for RACE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.third-party-planetscope","title":"Third Party Data Import - PlanetScope","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-access-datasets","title":"Using xcube to access non-commercial and commercial data sets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-viewer-as-a-service-in-edc1","title":"Visualizing data with xcube viewer in EuroDataCube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-evaluation-workshop","title":"DAPA Evaluation Workshop: Introduction \u0026 Documentation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-1-cube-sentinel-2","title":"DAPA Tutorial #1: Cube - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-2-area-sentinel-2","title":"DAPA Tutorial #2: Area - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-3-timeseries-sentinel-2","title":"DAPA Tutorial #3: Timeseries - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-4-value-sentinel-2","title":"DAPA Tutorial #4: Value - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-5-dem","title":"DAPA Tutorial #5: DEM","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.fairicube.fairicube-data-access-demonstration","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-australian-bushfires","title":"Australian Bushfires","description":"","date":"","thumbnail":"/notebooks_test/build/ab194b4f8c40a2b9d64d8a85e37ce1fd.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["IGARSS-22","EO Dashboard"],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-data-access","title":"Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-detect-trucks-sentinel2","title":"Truck Detection Exercise","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-lockdown-in-venice","title":"Environmental Impacts of Lockdown in Venice, Italy during 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-nasa-api-lockdown-in-venice","title":"Lockdown in Venice","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-no2-timeseries-analysis","title":"NO2 timeseries analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-timeseries-stac-api-single-vs-multi","title":"Time series using STAC API statistics endpoints","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Curated","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.access-iacs-data","title":"How to access IACS Spatial Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-access-cci-data","title":"Access CCI data with xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-first-steps","title":"First steps on the Euro Data Cube platform","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-1-manage-datasets-v11","title":"Manage Collections in your GeoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-2-explore-datasets-2","title":"Exploring Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-3-share-datasets1","title":"Sharing Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-access-urban-atlas-data-v1","title":"[xcube-geodb] How to accesss EEA Urban Atlas Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-data-access","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-basic","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-ndvi","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-datasets","title":"EDC Sentinel Hub - using xcube to access different data sets in Sentinel Hub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-setup","title":"Setup for EDC core API access using xcube client library","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-xcube-integration","title":"EDC Sentinel Hub - XCUBE integration","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-usecase-ndvi-timeline","title":"NDVI timeline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.eo-learn","title":"Using eo-learn in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/5a1f8475f0c3652f4630d03d72891b98.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.esdl-edc-v0-2","title":"Earth System Data Lab Tutorial @ Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.exploring-time-and-space-with-edc","title":"Exploring Time and Space: A guide to accessing, analysing and visualising data in the Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.how-to-access-dem-data-through-sentinel-hub-api","title":"How to access DEM data through Sentinel Hub API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.sentinelhub-py","title":"Using Sentinel Hub Process API in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/01e22903839391bc356ac886ec2b2fa7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Notebooks","level":1},{"slug":"notebooks.example1","title":"📘 Example Notebook 1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.example2","title":"📘 Example Notebook 2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}]},"page":{"version":1,"kind":"Notebook","sha256":"6c67087e42ba4cb7be4c15602e17cd16f355fa1d8c577d1f713498b33524fe5a","slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.detect-trucks-sentinel2","location":"/external_notebooks/eurodatacube/notebooks/notebooks/contributions/Detect_Trucks_Sentinel2.ipynb","dependencies":[],"frontmatter":{"title":"Detect Trucks using Sentinel-2 data","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"github":"https://github.com/eoxhub-workspaces/documentation/","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eoxhub-workspaces/documentation//blob/main/external_notebooks/eurodatacube/notebooks/notebooks/contributions/Detect_Trucks_Sentinel2.ipynb","exports":[{"format":"ipynb","filename":"Detect_Trucks_Sentinel2.ipynb","url":"/notebooks_test/build/Detect_Trucks_Sentin-7df0e6edd0f10c03859bf8450e2cb4c8.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:28.112398Z","iopub.status.busy":"2021-05-11T14:43:28.111869Z","iopub.status.idle":"2021-05-11T14:43:28.163604Z","shell.execute_reply":"2021-05-11T14:43:28.163983Z"},"papermill":{"duration":0.068733,"end_time":"2021-05-11T14:43:28.164146","exception":false,"start_time":"2021-05-11T14:43:28.095413","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-0.24.5\", dependencies=[\"SH\"])","visibility":"show","key":"VvaE4ay87s"},{"type":"output","id":"Fw_hTz88bEWRYyNaEfPAW","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"\u003cscript type=\"text/javascript\"\u003e\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    \u003c/script\u003e","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-0.24.5).","content_type":"text/html"},"text/plain":{"content":"\u003cIPython.core.display.HTML object\u003e","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"\n\n---------\n\nThe following environment variables are available:\n\n* `SH_CLIENT_ID`, `SH_INSTANCE_ID`, `SH_CLIENT_NAME`, `SH_CLIENT_SECRET`\n","content_type":"text/markdown"},"text/plain":{"content":"\u003cIPython.core.display.Markdown object\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"FEuosBI5JQ"}],"visibility":"show","key":"AsYCeiJNaP"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.013611,"end_time":"2021-05-11T14:43:28.191572","exception":false,"start_time":"2021-05-11T14:43:28.177961","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Detect Trucks using Sentinel-2 data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gYhz9AHW7a"}],"identifier":"detect-trucks-using-sentinel-2-data","label":"Detect Trucks using Sentinel-2 data","html_id":"detect-trucks-using-sentinel-2-data","implicit":true,"key":"iEiqzBFpNA"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Parallax-based truck detection","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Jiame9NLNc"}],"identifier":"parallax-based-truck-detection","label":"Parallax-based truck detection","html_id":"parallax-based-truck-detection","implicit":true,"key":"WZTeeAvMKS"},{"type":"thematicBreak","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Umz9pIBlmn"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"This notebook is a comprehensive script for detecting trucks with Sentinel-2 data. In order to run the detection in your area of interest you will have to modify two cells:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"gFehGJJEmG"}],"key":"KXqb8QIUaR"},{"type":"list","ordered":true,"start":1,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Area of Interest (specify the aoi as bounding box)","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Y7uKyCOu69"}],"key":"AKLl9Th4zq"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Date (specify an acquisition date)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"wDdfRJLfYm"}],"key":"MH0cpvDeB9"}],"key":"Ip6rR6mzM4"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Afterwards, you may simply run all cells and check the result at the end of the script where you can also write the detections as points.","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"U9IO2kCkDn"}],"key":"MpjxbmY7lF"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Ensure that you have access to the Sentinel Hub resources for retrieving Sentinel-2 data through its API (via xcube_sh).","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"h7GYvyi2Z9"}],"key":"CKCVDfmyhi"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"Author: Henrik Fisser, 2020","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"zVf5pmUjVO"},{"type":"break","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"A7DGiLbJ5H"},{"type":"text","value":"Explanations on the truck detection on GitHub: ","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"ilbzBrG5dE"},{"type":"link","url":"https://github.com/hfisser/Truck_Detection_Sentinel2_COVID19","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"https://​github​.com​/hfisser​/Truck​_Detection​_Sentinel2​_COVID19","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"W6jgHSVlPS"}],"urlSource":"https://github.com/hfisser/Truck_Detection_Sentinel2_COVID19","error":true,"key":"u4EiCN0dD5"}],"key":"xC9tlyfe63"}],"visibility":"show","key":"wFyPQT07t1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:28.224815Z","iopub.status.busy":"2021-05-11T14:43:28.224274Z","iopub.status.idle":"2021-05-11T14:43:37.090945Z","shell.execute_reply":"2021-05-11T14:43:37.091394Z"},"papermill":{"duration":8.886861,"end_time":"2021-05-11T14:43:37.091531","exception":false,"start_time":"2021-05-11T14:43:28.204670","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport subprocess\nimport sys\n\n# installations\ndef install_package(pkg):\n    subprocess.check_call([sys.executable, \"-m\", \"pip\", \"install\", pkg])\ninstall_package(\"OSMPythonTools\")\ninstall_package(\"geocube\")\n\n# OSM API\nfrom OSMPythonTools.overpass import overpassQueryBuilder, Overpass\n\nimport numpy as np\nimport xarray as xr\nimport geocube\nimport geopandas as gpd\nimport pandas as pd\nfrom xcube_sh.cube import open_cube\nfrom xcube_sh.config import CubeConfig\nfrom xcube.core.maskset import MaskSet\nfrom rasterio import features\nfrom affine import Affine\nfrom shapely import geometry, coords\nfrom shapely.geometry import Polygon, Point, box\nfrom numba import jit\n\nimport IPython.display\n%matplotlib inline","visibility":"show","key":"TeMLXCIcPX"},{"type":"output","id":"RoQ1WWM3N-IYsfU_Ap29g","data":[],"visibility":"show","key":"EqUoLfreDu"}],"visibility":"show","key":"zOtjNLgPT6"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.013061,"end_time":"2021-05-11T14:43:37.117922","exception":false,"start_time":"2021-05-11T14:43:37.104861","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Area of Interest","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CZDeaPY8mz"}],"identifier":"area-of-interest","label":"Area of Interest","html_id":"area-of-interest","implicit":true,"key":"GdJX05ZPBA"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Specify an area of interest as bounding box in format:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"psF8Mgnz6X"},{"type":"break","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oEHsCFSJS0"},{"type":"text","value":"xmin, ymin, ymax, ymax","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YBMC3y2kdt"}],"key":"v9wjFS0Tqb"}],"visibility":"show","key":"qVseRKMx0Z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.148822Z","iopub.status.busy":"2021-05-11T14:43:37.147805Z","iopub.status.idle":"2021-05-11T14:43:37.152020Z","shell.execute_reply":"2021-05-11T14:43:37.151537Z"},"papermill":{"duration":0.020447,"end_time":"2021-05-11T14:43:37.152132","exception":false,"start_time":"2021-05-11T14:43:37.131685","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"bbox = -3.85, 40.3, -3.55, 40.5 # Madrid\nIPython.display.GeoJSON(box(*bbox).__geo_interface__)","visibility":"show","key":"VJs7kGf27H"},{"type":"output","id":"Itk9ZLVX4RfLZTk_ctycP","data":[{"output_type":"display_data","metadata":{"application/geo+json":{"expanded":false,"root":"root"}},"data":{"application/geo+json":{"content":"{\"coordinates\":[[[-3.55,40.3],[-3.55,40.5],[-3.85,40.5],[-3.85,40.3],[-3.55,40.3]]],\"type\":\"Polygon\"}","content_type":"application/geo+json"},"text/plain":{"content":"\u003cIPython.display.GeoJSON object\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"pil8rC591y"}],"visibility":"show","key":"eBdXBXCejL"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.01399,"end_time":"2021-05-11T14:43:37.179354","exception":false,"start_time":"2021-05-11T14:43:37.165364","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Date","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"o3qXnf1b80"}],"identifier":"date","label":"Date","html_id":"date","implicit":true,"key":"wqaRTkK8iq"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Select a cloud-free acquisition and provide the date as “YYYY-MM-DD”.\nYou may select data e.g. here:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lg9JHMJcu2"},{"type":"break","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"ZOBc3z2eRz"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Copernicus Open Access Hub","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Mc9zMyStgg"}],"key":"zUyqS3CD3M"},{"type":"text","value":"\n","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"OOVx6f8xDd"},{"type":"link","url":"https://scihub.copernicus.eu/dhus/#/home","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​scihub​.copernicus​.eu​/dhus​/​#​/home","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"VAwsmAAF5V"}],"urlSource":"https://scihub.copernicus.eu/dhus/#/home","key":"jbWOWAMFHZ"},{"type":"text","value":" ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lWjr5m5Cux"},{"type":"break","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"OAfJUSmaVp"},{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"EO Browser","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BRwFJy1pd5"}],"key":"Qa8qeldxrc"},{"type":"text","value":"\n","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SWWW5cKCMC"},{"type":"link","url":"https://apps.sentinel-hub.com/eo-browser/?zoom=10\u0026lat=41.9\u0026lng=12.5\u0026themeId=DEFAULT-THEME","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​apps​.sentinel​-hub​.com​/eo​-browser​/​?zoom​=​10​\u0026​lat​=​41​.9​\u0026​lng​=​12​.5​\u0026​themeId​=​DEFAULT​-THEME","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wqjUEjFY1D"}],"urlSource":"https://apps.sentinel-hub.com/eo-browser/?zoom=10\u0026lat=41.9\u0026lng=12.5\u0026themeId=DEFAULT-THEME","key":"gi7kjsFBGP"}],"key":"MffkjZ5ee7"}],"visibility":"show","key":"jgXO1XcGbD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.208587Z","iopub.status.busy":"2021-05-11T14:43:37.208064Z","iopub.status.idle":"2021-05-11T14:43:37.209936Z","shell.execute_reply":"2021-05-11T14:43:37.209517Z"},"papermill":{"duration":0.017346,"end_time":"2021-05-11T14:43:37.210021","exception":false,"start_time":"2021-05-11T14:43:37.192675","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"date_start = \"2020-05-18\"\ndate_end = \"2020-05-19\"","visibility":"show","key":"ycyKdMakeN"},{"type":"output","id":"Slb7yAzrYVsl2Ml0feZlB","data":[],"visibility":"show","key":"f0uYZkI3Tz"}],"visibility":"show","key":"MW3VdyiQim"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.013246,"end_time":"2021-05-11T14:43:37.237199","exception":false,"start_time":"2021-05-11T14:43:37.223953","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open Street Maps (OSM)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ztv1xoUrdl"}],"identifier":"open-street-maps-osm","label":"Open Street Maps (OSM)","html_id":"open-street-maps-osm","implicit":true,"key":"sNdfbWUue6"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Trucks are only detected on roads obtained from OSM.\nYou may specify road types to include. Their descriptions can be found here:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nBwUWmoWMa"},{"type":"break","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"fJBbAU3FBX"},{"type":"link","url":"https://wiki.openstreetmap.org/wiki/Key:highway","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"https://​wiki​.openstreetmap​.org​/wiki​/Key:highway","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"uFlsd594uQ"}],"urlSource":"https://wiki.openstreetmap.org/wiki/Key:highway","key":"kB7kbmUSK8"}],"key":"eBmi79T4sj"}],"visibility":"show","key":"fLDpi7rXog"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.277251Z","iopub.status.busy":"2021-05-11T14:43:37.276736Z","iopub.status.idle":"2021-05-11T14:43:37.278305Z","shell.execute_reply":"2021-05-11T14:43:37.278634Z"},"papermill":{"duration":0.017611,"end_time":"2021-05-11T14:43:37.278728","exception":false,"start_time":"2021-05-11T14:43:37.261117","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"osm_values = [\"motorway\", \"trunk\", \"primary\"] # all of key \"highway\"\nroads_buffer = 0.00022 # degree, OSM road vectors are buffered, for motorway, the others lower","visibility":"show","key":"GNIQpWwJyX"},{"type":"output","id":"bKRZs7uY4yALZPqUwqlDA","data":[],"visibility":"show","key":"ekO2Okcmzi"}],"visibility":"show","key":"WirBAKAQ80"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.013922,"end_time":"2021-05-11T14:43:37.306204","exception":false,"start_time":"2021-05-11T14:43:37.292282","status":"completed"},"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dW3i3NjvHK"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Processing methods","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HpuT7Ag4LK"}],"identifier":"processing-methods","label":"Processing methods","html_id":"processing-methods","implicit":true,"key":"Ue8nkGZ87o"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cells all needed methods are defined. They will be invoked further below.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"akUb0X6O5d"}],"key":"OnvMBxvYm0"}],"visibility":"show","key":"fbXqKlCSyk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.350139Z","iopub.status.busy":"2021-05-11T14:43:37.349505Z","iopub.status.idle":"2021-05-11T14:43:37.351742Z","shell.execute_reply":"2021-05-11T14:43:37.351159Z"},"papermill":{"duration":0.031943,"end_time":"2021-05-11T14:43:37.351835","exception":false,"start_time":"2021-05-11T14:43:37.319892","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# re-order bbox from W,S,E,N to S,W,N,E\ndef convert_bbox_osm(bbox):\n    offset = 0.05 # add a buffer to bbox in order to be sure cube is entirely covered\n    bbox_osm = [bbox[1], bbox[0], bbox[3], bbox[2]]\n    bbox_osm[0] -= offset # min lat\n    bbox_osm[1] -= offset # min lon\n    bbox_osm[2] += offset # max lat\n    bbox_osm[3] += offset # max lon\n    return bbox_osm\n\n# bbox List of four coords\n# osm_value String OSM value\n# osm_key String OSM key\n# element_type List of String\n# returns GeoDataFrame\ndef get_osm(bbox, \n            osm_value,\n            element_type = [\"way\", \"relation\"]):\n    osm_key = \"highway\"\n    bbox_osm = convert_bbox_osm(bbox)\n    quot = '\"'\n    select = quot+osm_key+quot + '=' + quot+osm_value+quot\n    select_link = select.replace(osm_value, osm_value + \"_link\") # also get road links\n    select_junction = select.replace(osm_value, osm_value + \"_junction\")\n    geoms = []\n    for selector in [select, select_link, select_junction]:  \n        try:\n            query = overpassQueryBuilder(bbox=bbox_osm, \n                                         elementType=element_type, \n                                         selector=selector, \n                                         out='body',\n                                         includeGeometry=True)\n            elements = Overpass().query(query, timeout=60).elements()\n            # create multiline of all elements\n            if len(elements) \u003e 0:\n                for i in range(len(elements)):\n                    elem = elements[i]\n                    geoms.append(elem.geometry())\n        except:\n            Warning(\"Could not retrieve \" + select)\n    try:\n        lines = gpd.GeoDataFrame(crs = \"EPSG:4326\", geometry = geoms)\n        n = len(geoms)\n        lines[\"osm_value\"] = [osm_value]*n # add road type\n        return lines\n    except:\n        Warning(\"Could not merge \" + osm_value)\n        \n# buffer Float road buffer distance [m]\n# bbox List of four coords\n# bbox_id Integer processing id of bbox\n# osm_values List of String OSM values\n# osm_key String OSM key\n# roads_buffer Float buffer width\n# returns GeoDataFrame\ndef get_roads(bbox, osm_values, roads_buffer):\n    osm_key = \"highway\"\n    roads = []\n    has_error = []\n    offset = 0.00002\n    buffer_dist = \"buffer_distance\"\n    # buffer according to road type\n    m,t,p,s,ter = \"motorway\", \"trunk\", \"primary\", \"secondary\", \"tertiary\"\n    buffers = {m:roads_buffer, t:roads_buffer-offset, p:roads_buffer-(2*offset), s:roads_buffer-(3*offset), ter:roads_buffer-(4*offset)}\n    osm_values_int = {m:1, t:2, p:3, s:4, ter:5}\n    for osm_value in osm_values:\n        roads_osm = get_osm(bbox, osm_value)\n        try:\n            roads_osm = get_osm(bbox, osm_value)\n            roads_osm[buffer_dist] = [buffers[osm_value]] * len(roads_osm)\n            roads_osm[\"osm_value_int\"] = osm_values_int[osm_value]\n            roads.append(roads_osm)\n        except:\n            has_error.append(1)\n            print(\"'get_osm'\" + \"failed for bbox_id osm_value \" + osm_value + \"osm_key\" + osm_key)\n    if len(roads) \u003e len(has_error):\n        roads_merge = gpd.GeoDataFrame(pd.concat(roads, ignore_index=True), crs=roads[0].crs)\n        buffered = roads_merge.buffer(distance=roads_merge[buffer_dist])\n        roads_merge.geometry = buffered\n        return roads_merge\n\n# osm geodataframe of polygons\n# reference_raster xarray with lat and lon\n# returns numpy array\ndef rasterize_osm(osm, reference_raster):\n    osm_values = list(set(osm[\"osm_value\"]))\n    nan_placeholder = 100\n    road_rasters = []\n    for osm_value in osm_values:\n        osm_subset = osm[osm[\"osm_value\"] == osm_value]\n        raster = rasterize(osm_subset, reference_raster.lat, reference_raster.lon)\n        cond = np.isfinite(raster)\n        raster_osm = np.where(cond, list(osm_subset.osm_value_int)[0], nan_placeholder) # use placeholder instead of nan first\n        raster_osm = raster_osm.astype(np.float)\n        road_rasters.append(raster_osm)        \n    # merge road types in one layer\n    road_raster_np = np.array(road_rasters).min(axis=0) # now use the lowest value (highest road level) because some intersect\n    road_raster_np[road_raster_np == nan_placeholder] = 0\n    return road_raster_np # 0=no_road 1=motorway, 2=trunk, ...\n\ndef transform_lat_lon(lat, lon):\n    lat = np.asarray(lat)\n    lon = np.asarray(lon)\n    trans = Affine.translation(lon[0], lat[0])\n    scale = Affine.scale(lon[1] - lon[0], lat[1] - lat[0])\n    return trans * scale\n\ndef rasterize(polygons, lat, lon, fill=np.nan):\n    transform = transform_lat_lon(lat, lon)\n    out_shape = (len(lat), len(lon))\n    raster = features.rasterize(polygons.geometry, out_shape=out_shape,\n                                fill=fill, transform=transform,\n                                dtype=float)\n    return xr.DataArray(raster, coords={\"lat\":lat, \"lon\":lon}, dims=(\"lat\", \"lon\"))","visibility":"show","key":"wUqs8jhHGC"},{"type":"output","id":"WU37UZtG7SNGhHq5AU51B","data":[],"visibility":"show","key":"vLqYIAsLSM"}],"visibility":"show","key":"LAk4zPpfjc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.394356Z","iopub.status.busy":"2021-05-11T14:43:37.391473Z","iopub.status.idle":"2021-05-11T14:43:37.395870Z","shell.execute_reply":"2021-05-11T14:43:37.396228Z"},"papermill":{"duration":0.030909,"end_time":"2021-05-11T14:43:37.396329","exception":false,"start_time":"2021-05-11T14:43:37.365420","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# TruckDetector detects trucks at acquisition-level\nclass TruckDetector():   \n    def __init__(self, band_stack):\n        is_none = band_stack is None\n        self.band_stack = band_stack.chunk(band_stack.dims[\"lat\"], band_stack.dims[\"lon\"]) if not is_none else None\n        self.no_truck_mask = None\n        self.trucks = None\n    \n    def detect(self):\n        B02 = self.band_stack.B02.persist().values\n        B03 = self.band_stack.B03.persist().values\n        B04 = self.band_stack.B04.persist().values\n        B08 = self.band_stack.B08.persist().values\n        B11 = self.band_stack.B11.persist().values\n        no_truck_mask = calc_no_trucks(B02, B03, B04, B08, B11)\n        trucks = detect_trucks(B02, B03, B04, no_truck_mask)\n        lon_lat = {\"lat\":self.band_stack.lat, \"lon\":self.band_stack.lon}\n        self.no_truck_mask = xr.DataArray(no_truck_mask, coords=lon_lat, dims=(\"lat\", \"lon\"))\n        self.trucks = xr.DataArray(trucks, coords=lon_lat, dims=(\"lat\", \"lon\")).astype(np.int)\n        self.filter_trucks()\n                            \n    def filter_trucks(self):\n        self.trucks = filter_spatial_3x3_extended(self.trucks)\n        \n# take xarray and ensure each value with 1 in data has no neighbor with 1 in an extended 3x3 block. Extended means: horizontally and vertically\n# it is also checked for the second-next pixel\n# Method checks only surrounding of values equal 1\n# arr xarray DataArray with values and lat lon\ndef filter_spatial_3x3_extended(arr):\n    values = arr.values\n    lon = arr.lon\n    lat = arr.lat\n    valid = np.where(arr == 1)\n    for y,x in zip(valid[0], valid[1]):\n        y_above = y - 1\n        y_above_next = y - 2\n        x_left = x - 1\n        x_right = x + 1\n        x_left_next = x - 2\n        space_left = x_left \u003e= 0\n        space_right = x_right \u003e= 0 and x_right \u003c len(lon)\n        space_above = y_above \u003e= 0\n        val_left_above = values[y_above, x_left] if space_left and space_above else 0\n        val_right_above = values[y_above, x_right] if space_right and space_above else 0\n        val_left = values[y, x_left] if space_left else 0\n        val_above = values[y_above, x] if space_above else 0\n        val_left_next = values[y, x_left_next] if x_left_next \u003e= 0 else 0\n        val_above_next = values[y_above_next, x] if y_above_next \u003e= 0 else 0\n        # if any of the values left, above and left above has 1 set current value 0\n        if (val_left_above + val_right_above + val_left + val_above + val_left_next + val_above_next) \u003e= 1:\n            values[y,x] = 0\n    arr.values = values\n    return arr\n\n# extracts coordinates at value in np array and returns points as GeoDataFrame\n# data 2d np array\n# match_value Float value in data where point coordinates are extracted\n# lon_lat dict of:\n### \"lon\": np array longitude values\"\n### \"lat\": np array latitude values\"\n# crs String EPSG:XXXX\ndef points_from_np(data, match_value, lon_lat, crs):\n    indices = np.argwhere(data == match_value)\n    if len(indices) \u003e 0:\n        lat_indices = indices[:,[0]]\n        lon_indices = indices[:,[1]]\n        lat_coords = lon_lat[\"lat\"][lat_indices]\n        lon_coords = lon_lat[\"lon\"][lon_indices]\n        points = gpd.GeoDataFrame(geometry = gpd.points_from_xy(lon_coords, lat_coords))\n        points.crs = crs\n        return points\n    \ndef raster_to_points(raster, lon_lat, field_name, crs):\n    points_list = []\n    match_values = np.unique(raster[(raster != 0) * ~np.isnan(raster)]) # by pixel value\n    for x in match_values:\n        points = points_from_np(raster, x, lon_lat, crs=crs)\n        points[field_name] = [x] * len(points)\n        points_list.append(points)\n    return gpd.GeoDataFrame(pd.concat(points_list, ignore_index=True))\n        \n# Calculate a binary mask where pixels that are definitely no trucks are represented as 0.\n# thresholds Dict with at least:\n### max_ndvi Float above this val: no trucks. For Vegetation\n### max_ndwi Float above this val: no trucks. For Water\n### max_ndsi Float above this val: no_trucks. For Snow\n### min_rgb Float above this val: no_trucks. For dark surfaces, e.g. shadows\n### max_blue Float above this val: no_trucks\n### max_green Float above this val: no trucks\n### max_red Float above this val: no trucks\n### min_b11 Float below this val: no trucks. For dark surfaces, e.g. shadows\n### max_b11 Float below this val: no trucks. For bright (sealed) surfaces, e.g. buildings\n@jit(nopython=True, parallel=True)\ndef calc_no_trucks(B02, B03, B04, B08, B11):\n    th = {\"min_blue\":0.06, \n          \"min_green\":0.04, \n          \"min_red\":0.04,\n          \"max_red\":0.15,\n          \"max_green\":0.15,\n          \"max_blue\":0.2,\n          \"max_ndvi\":0.5,\n          \"max_ndwi\":0.0001,\n          \"max_ndsi\":0.0001,\n          \"min_blue_green_ratio\":0.03,\n          \"min_blue_red_ratio\":0.05, \n          \"max_blue_green_ratio\":0.17, \n          \"max_blue_red_ratio\":0.2}\n    ndvi_mask = ratio(B08, B04) \u003c th[\"max_ndvi\"]\n    ndwi_mask = ratio(B02, B11) \u003c th[\"max_ndwi\"]\n    ndsi_mask = ratio(B03, B11) \u003c th[\"max_ndsi\"]\n    low_rgb_mask = (B02 \u003e th[\"min_blue\"]) * (B03 \u003e th[\"min_green\"]) * (B04 \u003e th[\"min_red\"])\n    high_rgb_mask = (B02 \u003c th[\"max_blue\"]) * (B03 \u003c th[\"max_green\"]) * (B04 \u003c th[\"max_red\"])\n    no_truck_mask = ndvi_mask * ndwi_mask * ndsi_mask * low_rgb_mask * high_rgb_mask\n    return no_truck_mask\n\n# Calculate a binary mask where trucks are represented as 1 and no trucks as 0.\n# thresholds Dict with at least:\n### min_green_ratio Float, minimum value of blue-green ratio\n### min_red_ratio Float, minimum value of blue-red ratio\n@jit(nopython=True, parallel=True)\ndef detect_trucks(B02, B03, B04, no_truck_mask):\n    th = {\"min_blue\":0.06, \n          \"min_green\":0.04, \n          \"min_red\":0.04,\n          \"max_red\":0.15,\n          \"max_green\":0.15,\n          \"max_blue\":0.2,\n          \"max_ndvi\":0.5,\n          \"max_ndwi\":0.0001,\n          \"max_ndsi\":0.0001,\n          \"min_blue_green_ratio\":0.03,\n          \"min_blue_red_ratio\":0.05, \n          \"max_blue_green_ratio\":0.17, \n          \"max_blue_red_ratio\":0.2}\n    bg_ratio = ratio(B02, B03)\n    br_ratio = ratio(B02, B04)\n    bg = bg_ratio \u003e th[\"min_blue_green_ratio\"]\n    br = br_ratio \u003e th[\"min_blue_red_ratio\"]\n    bg_max = bg_ratio \u003c th[\"max_blue_green_ratio\"]\n    br_max = br_ratio \u003c th[\"max_blue_red_ratio\"]\n    trucks = (bg * br * bg_max * br_max) * no_truck_mask\n    return trucks\n\n@jit(nopython=True, parallel=True)\ndef ratio(a, b):\n    return (a-b)/(a+b)","visibility":"show","key":"D7ukK7Ipu5"},{"type":"output","id":"zz-fFp9CvstQ7Fi-pMGer","data":[],"visibility":"show","key":"FNkhZJxGT7"}],"visibility":"show","key":"NVcbgyFqLv"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.429810Z","iopub.status.busy":"2021-05-11T14:43:37.429287Z","iopub.status.idle":"2021-05-11T14:43:37.431384Z","shell.execute_reply":"2021-05-11T14:43:37.430868Z"},"papermill":{"duration":0.021641,"end_time":"2021-05-11T14:43:37.431470","exception":false,"start_time":"2021-05-11T14:43:37.409829","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# AcquisitionProcessor processes all valid pixels of a single acquisition in cube\nclass AcquisitionProcessor():\n    def __init__(self, date_np64, cube):\n        self.date_np64 = date_np64\n        self.cube = cube\n        self.band_stack = cube.sel(time = date_np64)\n        self.detector = None\n        self.no_clouds = None\n        self.osm_mask = None\n           \n    def mask_clouds(self):\n        cloud_masking_thresholds = {\"rgb\":0.25,\"blue_green\":0.2,\"blue_red\":0.2}\n        scl = MaskSet(self.band_stack.SCL)\n        high_prob = scl.clouds_high_probability\n        med_prob = scl.clouds_medium_probability\n        cirrus = scl.cirrus\n        no_data = scl.no_data\n        rgb_cloud_mask = calc_rgb_cloud_mask(self.band_stack, cloud_masking_thresholds)\n        self.no_clouds = (high_prob + med_prob + cirrus + no_data + rgb_cloud_mask) == 0\n        self.band_stack = self.band_stack.where(self.no_clouds)\n    \n    def mask_with_osm(self, osm_mask):\n        self.osm_mask = osm_mask\n        self.band_stack = self.band_stack.where(self.osm_mask != 0)\n                \n    def do_detection(self):\n        self.detector = TruckDetector(self.band_stack)\n        self.detector.detect()\n        \ndef calc_rgb_cloud_mask(band_stack, cloud_masking_thresholds):\n    B02, B03, B04 = band_stack.B02, band_stack.B03, band_stack.B04\n    c = cloud_masking_thresholds[\"rgb\"]\n    clouds_rgb = ((B02 \u003e c) + (B03 \u003e c) + (B04 \u003e c)) \u003e= 1\n    # attempt to mask haze without masking out truck pixels (similar! higher blue than red and green)\n    blue_green_ratio = (B02-B03) / (B02+B03)\n    blue_red_ratio = (B02-B04) / (B02+B04)\n    clouds_blue_green = blue_green_ratio \u003e cloud_masking_thresholds[\"blue_green\"]\n    clouds_blue_red = blue_red_ratio \u003e cloud_masking_thresholds[\"blue_red\"]\n    clouds = (clouds_rgb + clouds_blue_green + clouds_blue_red) \u003e= 1\n    return clouds","visibility":"show","key":"jaDqqLnZnx"},{"type":"output","id":"i_W90_yO2eTUv1jDgEbgB","data":[],"visibility":"show","key":"fVuU9ESjrx"}],"visibility":"show","key":"kl3XH2WDcn"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.013241,"end_time":"2021-05-11T14:43:37.457879","exception":false,"start_time":"2021-05-11T14:43:37.444638","status":"completed"},"tags":[]},"children":[{"type":"thematicBreak","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i49hzlU8ia"},{"type":"heading","depth":2,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Get Sentinel-2 L2A xcube","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RECNVyXEVI"}],"identifier":"get-sentinel-2-l2a-xcube","label":"Get Sentinel-2 L2A xcube","html_id":"get-sentinel-2-l2a-xcube","implicit":true,"key":"oW1Wou16Em"}],"visibility":"show","key":"VrXzcxBKQF"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.488728Z","iopub.status.busy":"2021-05-11T14:43:37.487880Z","iopub.status.idle":"2021-05-11T14:43:37.836341Z","shell.execute_reply":"2021-05-11T14:43:37.836893Z"},"papermill":{"duration":0.365272,"end_time":"2021-05-11T14:43:37.837068","exception":false,"start_time":"2021-05-11T14:43:37.471796","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"config = CubeConfig(dataset_name = \"S2L2A\",\n                    band_names = [\"B02\", \"B03\", \"B04\", \"B08\", \"B11\", \"SCL\"],\n                    tile_size = [512, 512],\n                    geometry = bbox,\n                    spatial_res = 0.00009,\n                    time_range = [date_start, date_end])\ncube = open_cube(config)","visibility":"show","key":"cXg67zm3SU"},{"type":"output","id":"qOwFk6EbbJzGDxR-zDzG3","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/eurodatacube-0.24.5/lib/python3.8/site-packages/xcube_sh/config.py:99: UserWarning: the geometry parameter is no longer supported, use bbox instead\n  warnings.warn('the geometry parameter is no longer supported, use bbox instead')\n/opt/conda/envs/eurodatacube-0.24.5/lib/python3.8/site-packages/pandas/core/tools/timedeltas.py:132: FutureWarning: Units 'M', 'Y' and 'y' do not represent unambiguous timedelta values and will be removed in a future version\n  return _coerce_scalar_to_timedelta_type(arg, unit=unit, errors=errors)\n"}],"visibility":"show","key":"MctG8sXu4h"}],"visibility":"show","key":"ffpO3q9OUZ"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.014459,"end_time":"2021-05-11T14:43:37.866422","exception":false,"start_time":"2021-05-11T14:43:37.851963","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Acquisition","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TiNEOJYdwK"}],"identifier":"acquisition","label":"Acquisition","html_id":"acquisition","implicit":true,"key":"loL79ZACho"}],"visibility":"show","key":"L1U2hv0Nbf"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.899841Z","iopub.status.busy":"2021-05-11T14:43:37.899313Z","iopub.status.idle":"2021-05-11T14:43:37.901255Z","shell.execute_reply":"2021-05-11T14:43:37.900814Z"},"papermill":{"duration":0.021374,"end_time":"2021-05-11T14:43:37.901353","exception":false,"start_time":"2021-05-11T14:43:37.879979","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"acquisition = AcquisitionProcessor(cube.time.values[0], cube)","visibility":"show","key":"kVuvLFEPol"},{"type":"output","id":"ZzZVYZ13ePn6apaw7YZjC","data":[],"visibility":"show","key":"bALzSj9CBN"}],"visibility":"show","key":"rbupNCkmqa"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.013537,"end_time":"2021-05-11T14:43:37.928349","exception":false,"start_time":"2021-05-11T14:43:37.914812","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot RGB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XYnkyYtB4u"}],"identifier":"plot-rgb","label":"Plot RGB","html_id":"plot-rgb","implicit":true,"key":"Kg2CTzx7Ez"}],"visibility":"show","key":"LZpPdOWRgr"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:43:37.969939Z","iopub.status.busy":"2021-05-11T14:43:37.964138Z","iopub.status.idle":"2021-05-11T14:44:20.427154Z","shell.execute_reply":"2021-05-11T14:44:20.427605Z"},"papermill":{"duration":42.485231,"end_time":"2021-05-11T14:44:20.427751","exception":false,"start_time":"2021-05-11T14:43:37.942520","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"rgb_bands = [\"B04\", \"B03\", \"B02\"]\ncoords, dims = [rgb_bands, cube.lat, cube.lon], [\"bands\", \"lat\", \"lon\"]\nrgb = np.vstack([cube.B04.persist().values, cube.B03.persist().values, cube.B02.persist().values])\nrgb_xr = xr.DataArray(rgb, coords=coords, dims=dims)\nrgb_xr.plot.imshow(figsize=[12,10], rgb=\"bands\", vmin=0, vmax=0.4)\nrgb, rgb_xr = None, None","visibility":"show","key":"ScecITNrY9"},{"type":"output","id":"78lDm-7ae2AAYQhCdwt8q","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"450eb58f07d897c1fbcbb6df05a4d5b2","path":"/notebooks_test/build/450eb58f07d897c1fbcbb6df05a4d5b2.png"},"text/plain":{"content":"\u003cFigure size 864x720 with 1 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"wGNo1v4iMe"}],"visibility":"show","key":"AdDUGbbflB"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.039645,"end_time":"2021-05-11T14:44:20.511458","exception":false,"start_time":"2021-05-11T14:44:20.471813","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"RGB reflectance","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l0x2F75hxW"}],"key":"HBgsbYYao6"}],"visibility":"show","key":"aXUKnhTqsM"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.040272,"end_time":"2021-05-11T14:44:20.591662","exception":false,"start_time":"2021-05-11T14:44:20.551390","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get OSM roads","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qpivMIb6m9"}],"identifier":"get-osm-roads","label":"Get OSM roads","html_id":"get-osm-roads","implicit":true,"key":"qySO7OfJBp"}],"visibility":"show","key":"YngoqNz9p5"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:44:20.675399Z","iopub.status.busy":"2021-05-11T14:44:20.674794Z","iopub.status.idle":"2021-05-11T14:45:28.089654Z","shell.execute_reply":"2021-05-11T14:45:28.090058Z"},"papermill":{"duration":67.458815,"end_time":"2021-05-11T14:45:28.090195","exception":false,"start_time":"2021-05-11T14:44:20.631380","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"osm_roads = get_roads(bbox, osm_values, roads_buffer)\nosm_roads.plot(figsize=[12,10])","visibility":"show","key":"M8H75uLIV1"},{"type":"output","id":"Sa5hREyx5P63wQKZ7scGd","data":[{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"motorway\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"motorway\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"motorway_link\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"motorway_link\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"motorway_junction\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"motorway_junction\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"trunk\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"trunk\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"trunk_link\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"trunk_link\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"trunk_junction\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"trunk_junction\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"primary\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"primary\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"primary_link\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"primary_link\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"[overpass] downloading data: [timeout:60][out:json];(way[\"highway\"=\"primary_junction\"](40.25,-3.9,40.55,-3.5);relation[\"highway\"=\"primary_junction\"](40.25,-3.9,40.55,-3.5);); out body geom;\n"},{"name":"stderr","output_type":"stream","text":"\u003cipython-input-6-00aa5324d1df\u003e:78: UserWarning: Geometry is in a geographic CRS. Results from 'buffer' are likely incorrect. Use 'GeoSeries.to_crs()' to re-project geometries to a projected CRS before this operation.\n\n  buffered = roads_merge.buffer(distance=roads_merge[buffer_dist])\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"3ba5e1b6bbe97ca9561f62fcb70b2a40","path":"/notebooks_test/build/3ba5e1b6bbe97ca9561f62fcb70b2a40.png"},"text/plain":{"content":"\u003cFigure size 864x720 with 1 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"WkuonPcAn3"}],"visibility":"show","key":"hRqNRf1Ki2"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.049229,"end_time":"2021-05-11T14:45:28.186436","exception":false,"start_time":"2021-05-11T14:45:28.137207","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The OSM road vectors are buffered, hence we see polygons here.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OXlbCDjUj7"}],"key":"bvmCfODn1f"}],"visibility":"show","key":"vcgd3VA0kM"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.047109,"end_time":"2021-05-11T14:45:28.278506","exception":false,"start_time":"2021-05-11T14:45:28.231397","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Rasterize OSM roads to S2 cube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q6e5wM8GEw"}],"identifier":"rasterize-osm-roads-to-s2-cube","label":"Rasterize OSM roads to S2 cube","html_id":"rasterize-osm-roads-to-s2-cube","implicit":true,"key":"xWZgxKqwdV"}],"visibility":"show","key":"EgqVgKdVk5"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:45:28.374720Z","iopub.status.busy":"2021-05-11T14:45:28.374052Z","iopub.status.idle":"2021-05-11T14:45:30.067967Z","shell.execute_reply":"2021-05-11T14:45:30.067396Z"},"papermill":{"duration":1.743594,"end_time":"2021-05-11T14:45:30.068086","exception":false,"start_time":"2021-05-11T14:45:28.324492","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"osm_roads_np = rasterize_osm(osm_roads, cube.B02)","visibility":"show","key":"tZOX2Ki6ZD"},{"type":"output","id":"N8MpuKCWGamszpQFIiee5","data":[{"name":"stderr","output_type":"stream","text":"\u003cipython-input-6-00aa5324d1df\u003e:94: DeprecationWarning: `np.float` is a deprecated alias for the builtin `float`. To silence this warning, use `float` by itself. Doing this will not modify any behavior and is safe. If you specifically wanted the numpy scalar type, use `np.float64` here.\nDeprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations\n  raster_osm = raster_osm.astype(np.float)\n"}],"visibility":"show","key":"ZNFMxBvUvQ"}],"visibility":"show","key":"iEbdTj9nYd"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.044736,"end_time":"2021-05-11T14:45:30.158551","exception":false,"start_time":"2021-05-11T14:45:30.113815","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Mask","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NKDgINZMWt"}],"identifier":"mask","label":"Mask","html_id":"mask","implicit":true,"key":"pnaPws5zUS"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"In case there are clouds in the imagery, they are masked out here. Furthermore, the data is constrained to the OSM roads.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Qo7rEZOZwb"}],"key":"WQ7wLQQeQi"}],"visibility":"show","key":"BmkXw0FZwU"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.044792,"end_time":"2021-05-11T14:45:30.248490","exception":false,"start_time":"2021-05-11T14:45:30.203698","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Clouds","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"p4gAkFqhIB"}],"identifier":"clouds","label":"Clouds","html_id":"clouds","implicit":true,"key":"C7stiGcJu2"}],"visibility":"show","key":"d5wcgb1aP4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:45:30.349405Z","iopub.status.busy":"2021-05-11T14:45:30.348825Z","iopub.status.idle":"2021-05-11T14:45:30.497221Z","shell.execute_reply":"2021-05-11T14:45:30.496627Z"},"papermill":{"duration":0.202367,"end_time":"2021-05-11T14:45:30.497336","exception":false,"start_time":"2021-05-11T14:45:30.294969","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"acquisition.mask_clouds()","visibility":"show","key":"wFnzxWe17D"},{"type":"output","id":"EDW3IBNxCZnBraEfq_J06","data":[],"visibility":"show","key":"tUFXsaZUVP"}],"visibility":"show","key":"U1FMID1c7N"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.046414,"end_time":"2021-05-11T14:45:30.589994","exception":false,"start_time":"2021-05-11T14:45:30.543580","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To OSM roads","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"oHt8MGEuAj"}],"identifier":"to-osm-roads","label":"To OSM roads","html_id":"to-osm-roads","implicit":true,"key":"OHgPiLLfal"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Only pixels within the buffered OSM roads are considered.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FiWlpQCKXp"}],"key":"EWRcpSV0WM"}],"visibility":"show","key":"Yni7E0N2Mq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:45:30.685556Z","iopub.status.busy":"2021-05-11T14:45:30.684998Z","iopub.status.idle":"2021-05-11T14:45:30.835114Z","shell.execute_reply":"2021-05-11T14:45:30.834582Z"},"papermill":{"duration":0.199833,"end_time":"2021-05-11T14:45:30.835299","exception":false,"start_time":"2021-05-11T14:45:30.635466","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"acquisition.mask_with_osm(osm_roads_np)","visibility":"show","key":"dymoPwlnLC"},{"type":"output","id":"M6aZsxU0n1Gza02RuPI4C","data":[],"visibility":"show","key":"IgFkCX1om3"}],"visibility":"show","key":"x8bER3zIYn"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.045646,"end_time":"2021-05-11T14:45:30.928130","exception":false,"start_time":"2021-05-11T14:45:30.882484","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Detect trucks","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jCEH3hlbv4"}],"identifier":"detect-trucks","label":"Detect trucks","html_id":"detect-trucks","implicit":true,"key":"CmrrnzICFD"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This is the actual detection being invoked in the “do_detection” wrapper. The output is an xarray DataArray, which is afterwards converted to a GeoDataFrame of points.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QOncr7TfpW"}],"key":"n5FhhKlOnE"}],"visibility":"show","key":"OaToEhRRou"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:45:31.048103Z","iopub.status.busy":"2021-05-11T14:45:31.042600Z","iopub.status.idle":"2021-05-11T14:46:19.674650Z","shell.execute_reply":"2021-05-11T14:46:19.675042Z"},"papermill":{"duration":48.70081,"end_time":"2021-05-11T14:46:19.675266","exception":false,"start_time":"2021-05-11T14:45:30.974456","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"acquisition.do_detection()\n# raster detections to points\ntruck_points = raster_to_points(acquisition.detector.trucks.values, {\"lon\":cube.lon.values, \"lat\":cube.lat.values}, \"trucks\", \"EPSG:4326\")\ntruck_points.plot(figsize=[12,10])","visibility":"show","key":"uq1wJ6em3d"},{"type":"output","id":"Gd6AFwH9DvjGPPEJKzewT","data":[{"name":"stderr","output_type":"stream","text":"\u003cipython-input-7-916cb7c1a86e\u003e:19: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.\nDeprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations\n  self.trucks = xr.DataArray(trucks, coords=lon_lat, dims=(\"lat\", \"lon\")).astype(np.int)\n"},{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"9fb78da59c102b50bb91c070a0c70e5c","path":"/notebooks_test/build/9fb78da59c102b50bb91c070a0c70e5c.png"},"text/plain":{"content":"\u003cFigure size 864x720 with 1 Axes\u003e","content_type":"text/plain"}}}],"visibility":"show","key":"FxQ6lLKLVn"}],"visibility":"show","key":"wvTZ8IdalY"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.053156,"end_time":"2021-05-11T14:46:19.775669","exception":false,"start_time":"2021-05-11T14:46:19.722513","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Write detections","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"xqZOA8s0I7"}],"identifier":"write-detections","label":"Write detections","html_id":"write-detections","implicit":true,"key":"wrVsURA9QR"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"If you would like to write the truck points, simply modify the file path here","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"EpYV9hRU6x"}],"key":"tliIpKnWgG"}],"visibility":"show","key":"a1A4DasARQ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:46:19.873331Z","iopub.status.busy":"2021-05-11T14:46:19.872630Z","iopub.status.idle":"2021-05-11T14:46:19.907612Z","shell.execute_reply":"2021-05-11T14:46:19.907087Z"},"papermill":{"duration":0.086424,"end_time":"2021-05-11T14:46:19.907735","exception":false,"start_time":"2021-05-11T14:46:19.821311","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"truck_points.to_file(\"trucks.gpkg\", driver=\"GPKG\")","visibility":"show","key":"mt4jzSLO7b"},{"type":"output","id":"AYCp9G_ONiueXKtHYhUtb","data":[],"visibility":"show","key":"Zw1NtKynqq"}],"visibility":"show","key":"h2U45VNttt"}],"key":"mflTAy6JE6"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Cmems Data Download","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/cmems-data-download","group":"Contributions"},"next":{"title":"Drought impact monitoring platform","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/drought-monitoring","group":"Contributions"}}},"domain":"http://localhost:3000"},"project":{"github":"https://github.com/eoxhub-workspaces/documentation/","id":"5aa0318b-5bc1-41e2-b1d4-053e8b61961b","exports":[],"bibliography":[],"title":"Location for eodashboard notebooks","index":"readme","pages":[{"title":"External Notebooks","level":1},{"title":"Eurodatacube","level":2},{"title":"Notebooks","level":3},{"slug":"external-notebooks.eurodatacube.notebooks.readme","title":"Jupyter notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":4},{"title":"Notebooks","level":4},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.readme","title":"Euro Data Cube Notebooks","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":5},{"title":"Contributions","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-ai4arctic-sea-ice","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-biomass-forest-observation-sys","title":"AIREO pilot dataset - Biomass (Forest Observation System)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-cap","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aireo-pilot-dataset-spacenet7","title":"Introduction","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.aot-covid19","title":"Aerosol Optical Thickness (AOT) Anomaly Detection Using Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.batch-zarr-output","title":"Generating Zarr data cubes with Sentinel Hub Batch API","description":"","date":"","thumbnail":"/notebooks_test/build/68dffbf744fa42f4bf3d35e55684984e.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.client-side-processing-using-mass-sh","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.cmems-data-download","title":"Cmems Data Download","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.detect-trucks-sentinel2","title":"Detect Trucks using Sentinel-2 data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.drought-monitoring","title":"Drought impact monitoring platform","description":"","date":"","thumbnail":"/notebooks_test/build/ad5c19782b006f72352ae57794305840.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-africa-cube-africa-custom-contest","title":"Custom Script Contest – Urban Growth in Africa","description":"","date":"","thumbnail":"/notebooks_test/build/e9275f3fe80a704e2f5aa1ec1220e48a.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-byoc-tutorial","title":"How to bring your own data to EDC: Using Sentinel Hub Python package","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-demo-phi-week-v2","title":"xcube-gen and xcube-geodb Hands-On Workshop Φ-Week 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-geodb-4-eurocrops-demo","title":"Demonstration of Eurocrops data use in geoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-notebook-lstm","title":"South Africa Crop Type Classification on Euro Data Cube (EDC)","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.edc-usecase-lpis-crop-type-classification","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.eurocrops-crop-classification-example","title":"Crop-classification using Sentinel-2 time-series","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ghsl-urban-delineation","title":"\u003cb\u003eUrban delineation\u003cb\u003e","description":"","date":"","thumbnail":"/notebooks_test/build/7bbf545a5eae1d9ebdb91ae42b261063.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.globalearthmonitor-example","title":"Pre-requisites","description":"","date":"","thumbnail":"/notebooks_test/build/205c1ded6bd59771975a9fbd3753fd3b.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gpu-support-eoxhub","title":"GPU-Support on EOxHub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.gran-chaco-phiweek","title":"ESA EO \\phi- week 2020","description":"","date":"","thumbnail":"/notebooks_test/build/80cee7db6cdc7002ceedda5689f889fa.jpeg","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.howtolulc-batch-updated-210621","title":"How To: Land-Use-Land-Cover Prediction for Slovenia - using the Batch Processing API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lpis-lulc-slo","title":"LPIS Use Case for Land Use / Land Cover Classification","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lps2022-leverage-euro-data-cube-services","title":"Living Planet Symposium 2022 Training Session","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-analysis-covid19-lockdowns","title":"Impact of Covid19 induced lockdown on NO2 levels","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-so2-trend-veda-api-igarss-2023","title":"Using the NASA VEDA EOAPI","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.ogc-edc","title":"Important notes","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.openeo-client-demo","title":"openEO Client Demo","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.race-finishedgoodsinventory-inidcator","title":"Finished Goods Inventory indicator for RACE","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.third-party-planetscope","title":"Third Party Data Import - PlanetScope","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-access-datasets","title":"Using xcube to access non-commercial and commercial data sets","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.xcube-viewer-as-a-service-in-edc1","title":"Visualizing data with xcube viewer in EuroDataCube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-evaluation-workshop","title":"DAPA Evaluation Workshop: Introduction \u0026 Documentation","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-1-cube-sentinel-2","title":"DAPA Tutorial #1: Cube - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-2-area-sentinel-2","title":"DAPA Tutorial #2: Area - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-3-timeseries-sentinel-2","title":"DAPA Tutorial #3: Timeseries - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-4-value-sentinel-2","title":"DAPA Tutorial #4: Value - Sentinel-2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-5-dem","title":"DAPA Tutorial #5: DEM","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.fairicube.fairicube-data-access-demonstration","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-australian-bushfires","title":"Australian Bushfires","description":"","date":"","thumbnail":"/notebooks_test/build/ab194b4f8c40a2b9d64d8a85e37ce1fd.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":["IGARSS-22","EO Dashboard"],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-data-access","title":"Data Access","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-detect-trucks-sentinel2","title":"Truck Detection Exercise","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-lockdown-in-venice","title":"Environmental Impacts of Lockdown in Venice, Italy during 2020","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-nasa-api-lockdown-in-venice","title":"Lockdown in Venice","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-no2-timeseries-analysis","title":"NO2 timeseries analysis","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.igarss2022.igarss-22-timeseries-stac-api-single-vs-multi","title":"Time series using STAC API statistics endpoints","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Curated","level":5},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.access-iacs-data","title":"How to access IACS Spatial Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-access-cci-data","title":"Access CCI data with xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-first-steps","title":"First steps on the Euro Data Cube platform","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-1-manage-datasets-v11","title":"Manage Collections in your GeoDB","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-2-explore-datasets-2","title":"Exploring Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-3-share-datasets1","title":"Sharing Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-geodb-access-urban-atlas-data-v1","title":"[xcube-geodb] How to accesss EEA Urban Atlas Data","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-data-access","title":"EDC Sentinel Hub - data access using xcube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-basic","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinelhub-datafusion-ndvi","title":"EDC Sentinel Hub: Data Fusion","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-datasets","title":"EDC Sentinel Hub - using xcube to access different data sets in Sentinel Hub","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-setup","title":"Setup for EDC core API access using xcube client library","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-sentinel-hub-xcube-integration","title":"EDC Sentinel Hub - XCUBE integration","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.edc-usecase-ndvi-timeline","title":"NDVI timeline","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.eo-learn","title":"Using eo-learn in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/5a1f8475f0c3652f4630d03d72891b98.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.esdl-edc-v0-2","title":"Earth System Data Lab Tutorial @ Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.exploring-time-and-space-with-edc","title":"Exploring Time and Space: A guide to accessing, analysing and visualising data in the Euro Data Cube","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.how-to-access-dem-data-through-sentinel-hub-api","title":"How to access DEM data through Sentinel Hub API","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"slug":"external-notebooks.eurodatacube.notebooks.notebooks.curated.sentinelhub-py","title":"Using Sentinel Hub Process API in EDC: a starter’s guide.","description":"","date":"","thumbnail":"/notebooks_test/build/01e22903839391bc356ac886ec2b2fa7.png","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":6},{"title":"Notebooks","level":1},{"slug":"notebooks.example1","title":"📘 Example Notebook 1","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2},{"slug":"notebooks.example2","title":"📘 Example Notebook 2","description":"","date":"","thumbnail":"","thumbnailOptimized":"","banner":"","bannerOptimized":"","tags":[],"level":2}]}}},"actionData":null,"errors":null},"future":{"unstable_dev":false,"unstable_postcss":false,"unstable_tailwind":false,"v2_errorBoundary":true,"v2_headers":true,"v2_meta":true,"v2_normalizeFormMethod":true,"v2_routeConvention":true}};</script><script type="module" async="">import "/notebooks_test/build/manifest-B4831781.js";
import * as route0 from "/notebooks_test/build/root-QGLRP2PL.js";
import * as route1 from "/notebooks_test/build/routes/$-7JYT5576.js";
window.__remixRouteModules = {"root":route0,"routes/$":route1};

import("/notebooks_test/build/entry.client-UNPC4GT3.js");</script></body></html>