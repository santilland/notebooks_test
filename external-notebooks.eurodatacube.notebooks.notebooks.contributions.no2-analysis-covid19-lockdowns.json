{"version":1,"kind":"Notebook","sha256":"2f406c869160f07a848e016ceb38ea025dc8155cbb99b70e46141c0567f0c4e8","slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-analysis-covid19-lockdowns","location":"/external_notebooks/eurodatacube/notebooks/notebooks/contributions/NO2_Analysis_Covid19_Lockdowns.ipynb","dependencies":[],"frontmatter":{"title":"Impact of Covid19 induced lockdown on NO2 levels","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"github":"https://github.com/eoxhub-workspaces/documentation/","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eoxhub-workspaces/documentation//blob/main/external_notebooks/eurodatacube/notebooks/notebooks/contributions/NO2_Analysis_Covid19_Lockdowns.ipynb","exports":[{"format":"ipynb","filename":"NO2_Analysis_Covid19_Lockdowns.ipynb","url":"/notebooks_test/build/NO2_Analysis_Covid19-38f19cd87a2cf735b5a2771eaf87d435.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:01.016931Z","iopub.status.busy":"2021-05-11T14:50:01.016230Z","iopub.status.idle":"2021-05-11T14:50:01.074117Z","shell.execute_reply":"2021-05-11T14:50:01.074470Z"},"papermill":{"duration":0.070554,"end_time":"2021-05-11T14:50:01.074633","exception":false,"start_time":"2021-05-11T14:50:01.004079","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-0.24.5\", dependencies=[\"SH\"])","visibility":"show","key":"dwoFdR5XKY"},{"type":"output","id":"MkKds27V0SrgY48T43HyQ","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<script type=\"text/javascript\">\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    </script>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-0.24.5).","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"\n\n---------\n\nThe following environment variables are available:\n\n* `SH_CLIENT_ID`, `SH_INSTANCE_ID`, `SH_CLIENT_NAME`, `SH_CLIENT_SECRET`\n","content_type":"text/markdown"},"text/plain":{"content":"<IPython.core.display.Markdown object>","content_type":"text/plain"}}}],"visibility":"show","key":"cqOezHIsvM"}],"visibility":"show","key":"HKlKW5HG9L"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008523,"end_time":"2021-05-11T14:50:01.091775","exception":false,"start_time":"2021-05-11T14:50:01.083252","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Impact of Covid19 induced lockdown on NO2 levels","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SaU9RoSApU"}],"identifier":"impact-of-covid19-induced-lockdown-on-no2-levels","label":"Impact of Covid19 induced lockdown on NO2 levels","html_id":"impact-of-covid19-induced-lockdown-on-no2-levels","implicit":true,"key":"RypbbKlCNk"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Countries have initiated lockdown measures to control the spread of the disease","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"cXkzCrOaTj"}],"key":"Jn1tzHr39C"}],"key":"LWysi8wrJ6"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Not all of the measures were successful (Italy)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"QWBpaIEuV1"}],"key":"JzPrfIZLro"}],"key":"Rq37wjQQtu"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Countries (Germany) which successful implemented a lockdown showed a marked decrease in NO2 levels","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"MouXd1Jcvd"}],"key":"AYGPQVKMpL"}],"key":"NVjWwPIEFW"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"NO2 is produced when fossil fuels are burned, as during transportation (cars, trucks etc. ) or","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"ocImz1ES2j"}],"key":"RKNcMtaR93"}],"key":"fDLxePHdx1"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"due to other economic activities (like factories )","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"Yfc4RCtOAe"}],"key":"J3Of4mXIrZ"}],"key":"VfAzHlcVt1"}],"key":"id6wjWfaqR"}],"visibility":"show","key":"q58xmJJyAC"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008378,"end_time":"2021-05-11T14:50:01.108518","exception":false,"start_time":"2021-05-11T14:50:01.100140","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load required dependencies & credentials","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tLfprXKp4m"}],"identifier":"load-required-dependencies-credentials","label":"Load required dependencies & credentials","html_id":"load-required-dependencies-credentials","implicit":true,"key":"dv5oawDbBO"}],"visibility":"show","key":"LpEDZ1AMrK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:01.128846Z","iopub.status.busy":"2021-05-11T14:50:01.128363Z","iopub.status.idle":"2021-05-11T14:50:02.398452Z","shell.execute_reply":"2021-05-11T14:50:02.397917Z"},"papermill":{"duration":1.28161,"end_time":"2021-05-11T14:50:02.398569","exception":false,"start_time":"2021-05-11T14:50:01.116959","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Import required packages\n\nfrom xcube_sh.config import CubeConfig\nfrom xcube_sh.cube import open_cube\nfrom xcube_sh.sentinelhub import SentinelHub\nimport xarray as xr\n\nfrom sentinelhub import BBox, WmsRequest, DataSource, SHConfig\nfrom functools import partial\n\nimport numpy as np\nimport pandas as pd\n\nfrom matplotlib import pyplot as plt\n","visibility":"show","key":"B6aLs2DJSZ"},{"type":"output","id":"Y0kQdhl-Q0auYp7t5f339","data":[],"visibility":"show","key":"yGQhHUVrnl"}],"visibility":"show","key":"jUtwXHHRhh"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.418925Z","iopub.status.busy":"2021-05-11T14:50:02.418424Z","iopub.status.idle":"2021-05-11T14:50:02.420627Z","shell.execute_reply":"2021-05-11T14:50:02.420063Z"},"papermill":{"duration":0.013625,"end_time":"2021-05-11T14:50:02.420756","exception":false,"start_time":"2021-05-11T14:50:02.407131","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set Sentinel Hub credentials\n\nimport os\nsh_credentials = dict(client_id=os.environ['SH_CLIENT_ID'],\n                      client_secret=os.environ['SH_CLIENT_SECRET']) # This is only provided when the Oauth credentials are created\n\n# Sentinel-3 OLCI, Sentinel-3 SLSTR and Sentinel-5 layers are processed on different infrastructure, \n# which requires to used different end-point\n\nsh_credentials.update(api_url='https://creodias.sentinel-hub.com') ","visibility":"show","key":"VmrHyMhUBE"},{"type":"output","id":"GDmPuTb1p3aJf2XcUHU9v","data":[],"visibility":"show","key":"nt7XsZb7Vb"}],"visibility":"show","key":"AiEy0FQDxQ"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008275,"end_time":"2021-05-11T14:50:02.438243","exception":false,"start_time":"2021-05-11T14:50:02.429968","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Core function to calculate NO2 values","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sU7EH3Z3YI"}],"identifier":"core-function-to-calculate-no2-values","label":"Core function to calculate NO2 values","html_id":"core-function-to-calculate-no2-values","implicit":true,"key":"TQBIPD8890"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"NO2 values are calculated over the given period (Jan -May) for 2020 & 2019","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Vdt0Ce5URQ"}],"key":"B9BJ178FxB"}],"visibility":"show","key":"XObO75Oz6N"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.460873Z","iopub.status.busy":"2021-05-11T14:50:02.460186Z","iopub.status.idle":"2021-05-11T14:50:02.461807Z","shell.execute_reply":"2021-05-11T14:50:02.462165Z"},"papermill":{"duration":0.015747,"end_time":"2021-05-11T14:50:02.462271","exception":false,"start_time":"2021-05-11T14:50:02.446524","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def caculateNO2(geometry, timerange):\n    \"\"\"\n    parameters:\n    geometry: BBox object to be passed. This contains the bounding box for the area of interest (AOI)\n    timerange: list giving the start & end of the time range format: YYYY-mm-dd\n    \n    return:\n    a dataframe with two columns: Mean NO2 and Timestamp\n    NO2 mean values for the time span between given timerange \n    \n    \"\"\"\n    cube_config = CubeConfig(dataset_name='S5PL2',\n                         band_names=['NO2'],\n                         tile_size=[512, 512],\n                         geometry=geometry,\n                         spatial_res=abs(bbox[2]-bbox[0])/512,\n                         time_range= timerange,\n                         time_period='3D') \n    cube = open_cube(cube_config, **sh_credentials)\n\n    no2_values = list() \n    timestamp = list()\n\n    for i in range(cube.time.shape[0]):\n        no2_values.append(np.nanmean(cube.NO2.isel(time=i).values[0]))\n        timestamp.append(cube.NO2.isel(time=i).time.values)\n        \n    assert len(no2_values) == len(timestamp)\n    \n    return pd.DataFrame({'DateTime': timestamp, 'Mean NO2': no2_values})","visibility":"show","key":"QsIalpftsb"},{"type":"output","id":"L6IWS-f5DUMQILmBOZ1ZB","data":[],"visibility":"show","key":"QHLZ1otIuT"}],"visibility":"show","key":"RhcSommr6M"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008259,"end_time":"2021-05-11T14:50:02.479255","exception":false,"start_time":"2021-05-11T14:50:02.470996","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read area of interest as a csv file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n4TvJTt5Vq"}],"identifier":"read-area-of-interest-as-a-csv-file","label":"Read area of interest as a csv file","html_id":"read-area-of-interest-as-a-csv-file","implicit":true,"key":"W674MBxlA6"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Uncomment the next code block if you want to read the AOI from a csv file","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nFU3FqE9pP"}],"key":"loXbqcxwet"}],"key":"V5B1xfDWgm"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"File has the following columns:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"lPMrzAXjDc"}],"key":"BER7aZkhB4"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Country: Name of country/territory of interest","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LOfduXF8P6"}],"key":"hnBbti7Xju"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"x1, y1 : Upper left corner co-ordinates (lat/lon)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"Yyzwhji31b"}],"key":"qviLOwUfDG"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"x2, y2 : Lower right corner co-ordinates","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nvMyg01LbP"}],"key":"De5D3g36Yy"}],"key":"bBLCDw93B6"}],"visibility":"show","key":"GiMKlLHiqx"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.498683Z","iopub.status.busy":"2021-05-11T14:50:02.498145Z","iopub.status.idle":"2021-05-11T14:50:02.499883Z","shell.execute_reply":"2021-05-11T14:50:02.500235Z"},"papermill":{"duration":0.012739,"end_time":"2021-05-11T14:50:02.500336","exception":false,"start_time":"2021-05-11T14:50:02.487597","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# aoi = pd.read_csv('AOI.csv')\n# print(aoi.shape)\n# print(aoi.head(8))\n\n# shape = aoi.shape\n# nullCount = sum(aoi.isna().sum())\n# print(f\"Shape of 2020 DF: {shape}, Count of Null values: {nullCount}\".format(shape , nullCount ))","visibility":"show","key":"neGNGOAVvg"},{"type":"output","id":"E5Yfa67ktuX2JjuWpvF-m","data":[],"visibility":"show","key":"GBEHTryCz6"}],"visibility":"show","key":"Kvxnp1AvUn"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008298,"end_time":"2021-05-11T14:50:02.517365","exception":false,"start_time":"2021-05-11T14:50:02.509067","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define AOI as a list","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Ye9t2lz1t2"}],"identifier":"define-aoi-as-a-list","label":"Define AOI as a list","html_id":"define-aoi-as-a-list","implicit":true,"key":"Pa9v6OV6P3"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This is a list of dictionaries with the required information","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"c8HtncrEgS"}],"key":"GdnjqLMyB7"}],"key":"WHH0l2SmjW"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Each dict has the following keys:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"slJR6GHNIi"}],"key":"TDQHCSsHey"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Country: Name of country/territory of interest","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"MvFRkuBSs4"}],"key":"fYgVicwvly"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"x1, y1 : Upper left corner co-ordinates (lat/lon)","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"zy9pc7XYpO"}],"key":"S7rZskKEbJ"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"x2, y2 : Lower right corner co-ordinates","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"VCKP0WYRGt"}],"key":"xi0nQbHpkT"}],"key":"k0aY2fo6yI"}],"visibility":"show","key":"xMG3AtPfHv"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.537911Z","iopub.status.busy":"2021-05-11T14:50:02.537386Z","iopub.status.idle":"2021-05-11T14:50:02.539548Z","shell.execute_reply":"2021-05-11T14:50:02.538933Z"},"papermill":{"duration":0.013931,"end_time":"2021-05-11T14:50:02.539639","exception":false,"start_time":"2021-05-11T14:50:02.525708","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"aoi = list()\n\n#Define two dicts\ncountry1 = dict()\ncountry1['Country'] = 'Italy'\ncountry1['x1'] = 46.28 \ncountry1['y1'] = 6.42\ncountry1['x2'] = 37.25\ncountry1['y2'] = 19.73\naoi.append(country1)\n\ncountry2 = dict()\ncountry2['Country'] = 'Germany'\ncountry2['x1'] = 54.77 \ncountry2['y1'] = 4.70\ncountry2['x2'] = 47.63\ncountry2['y2'] = 15.73\naoi.append(country2)\n\n#print(len(aoi))","visibility":"show","key":"xkzeuHTUVp"},{"type":"output","id":"fxQMnPIT8bC7CTec9qKS9","data":[],"visibility":"show","key":"UZPiFnjvcv"}],"visibility":"show","key":"SQi85YknfW"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008218,"end_time":"2021-05-11T14:50:02.560711","exception":false,"start_time":"2021-05-11T14:50:02.552493","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Main loop","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"osNpGkGWhc"}],"identifier":"main-loop","label":"Main loop","html_id":"main-loop","implicit":true,"key":"vB9wo55b6l"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We iterate over each row in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"GG8KLHfp9Q"},{"type":"inlineCode","value":"aoi.csv","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"SG7wxNc1gB"},{"type":"text","value":" file","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"d3n8FkI3pE"}],"key":"hbTYk0pUaO"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Sentinel-5P data for each defined AOI cube is extracted","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"l84HizeHkn"}],"key":"V77B7QgrYi"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"NO2 values for each tile is then averaged & stored in a list","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"sotV80y3qN"}],"key":"ze3mSRt1hr"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"For the purpose of this demo we will calculate the NO2 values for one AOI and for one month\n(","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IK3H7Ie4Au"},{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"That will ensure that we donâ€™t exceed the timelimit of 10mins!","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"KN4iHsxXiB"}],"key":"ovZyhbQinY"},{"type":"text","value":")","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ipKnfFfPB0"}],"key":"DDOw5BqLEy"}],"visibility":"show","key":"uJzXAkqm1A"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.586845Z","iopub.status.busy":"2021-05-11T14:50:02.583577Z","iopub.status.idle":"2021-05-11T14:50:59.606086Z","shell.execute_reply":"2021-05-11T14:50:59.606453Z"},"papermill":{"duration":57.037651,"end_time":"2021-05-11T14:50:59.606584","exception":false,"start_time":"2021-05-11T14:50:02.568933","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import time \n\nstart = time.time()\naoi_no2 = list()\n\n# Check length of provided aoi list OR dataframe\nlen_aoi = len(aoi)\n\n# Define how many AOIs you want to process. For the demo we will use only one \ncounter = 1\n\nfor idx in range(counter):\n    aoi_dict = dict()\n    \n    # Check if aoi is passed as a list or a dataframe\n    if isinstance(aoi, list):\n        aoi_dict['Country_BBox'] = aoi[idx]['Country']\n        x1 = int(aoi[idx]['x1'])  # degree \n        y1 = int(aoi[idx]['y1'])  # degree\n        x2 = int(aoi[idx]['x2'])  # degree\n        y2 = int(aoi[idx]['y2'])  # degree\n                \n    else:\n        aoi_dict['Country_BBox'] = aoi.loc[idx]['Country']\n        print(\"Processing: \", aoi_dict['Country_BBox'])\n        x1 = int(aoi.loc[idx]['x1'])  # degree \n        y1 = int(aoi.loc[idx]['y1'])  # degree\n        x2 = int(aoi.loc[idx]['x2'])  # degree\n        y2 = int(aoi.loc[idx]['y2'])  # degree\n\n    bbox = x1, y1, x2, y2\n    timerange = ['2020-01-01', '2020-01-31']\n    aoi_dict['NO2_2020'] = caculateNO2(bbox, timerange)\n    shape = aoi_dict['NO2_2020'].shape\n    nullCount = sum(aoi_dict['NO2_2020'].isna().sum())\n    print(f\"Shape of 2020 DF: {shape}, Count of Null values: {nullCount}\".format(shape , nullCount ))    \n    \n    timerange = ['2019-01-01', '2019-01-31']\n    aoi_dict['NO2_2019'] = caculateNO2(bbox, timerange)\n    shape = aoi_dict['NO2_2019'].shape\n    nullCount = sum(aoi_dict['NO2_2019'].isna().sum())\n    print(f\"Shape of 2019 DF: {shape}, Count of Null values: {nullCount}\".format(shape , nullCount ))\n\n    aoi_no2.append(aoi_dict)\n\nend = time.time()\n#print(len(aoi_no2))\n","visibility":"show","key":"PSxfyDeFI6"},{"type":"output","id":"eDu0psHSNEhbvCKAQLCZB","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/eurodatacube-0.24.5/lib/python3.8/site-packages/xcube_sh/config.py:99: UserWarning: the geometry parameter is no longer supported, use bbox instead\n  warnings.warn('the geometry parameter is no longer supported, use bbox instead')\n"},{"name":"stdout","output_type":"stream","text":"Shape of 2020 DF: (11, 2), Count of Null values: 0\n"},{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/eurodatacube-0.24.5/lib/python3.8/site-packages/xcube_sh/config.py:99: UserWarning: the geometry parameter is no longer supported, use bbox instead\n  warnings.warn('the geometry parameter is no longer supported, use bbox instead')\n"},{"name":"stdout","output_type":"stream","text":"Shape of 2019 DF: (11, 2), Count of Null values: 0\n"}],"visibility":"show","key":"BXhTsYYu6j"}],"visibility":"show","key":"TTtW74cy9i"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:59.628023Z","iopub.status.busy":"2021-05-11T14:50:59.627429Z","iopub.status.idle":"2021-05-11T14:50:59.630190Z","shell.execute_reply":"2021-05-11T14:50:59.629647Z"},"papermill":{"duration":0.014541,"end_time":"2021-05-11T14:50:59.630279","exception":false,"start_time":"2021-05-11T14:50:59.615738","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Total processing time: {:.2} mins\".format((end-start)/60)) ","visibility":"show","key":"gmwXi4znPv"},{"type":"output","id":"5A45g3O3XsnMUsiRPNi23","data":[{"name":"stdout","output_type":"stream","text":"Total processing time: 0.95 mins\n"}],"visibility":"show","key":"NuaV2kqZ1T"}],"visibility":"show","key":"d3HcoDBMft"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010733,"end_time":"2021-05-11T14:50:59.651663","exception":false,"start_time":"2021-05-11T14:50:59.640930","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The list is then pickled so that the information can then be reused in another run","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nXMkUxdson"}],"key":"EIr2eZe0e0"}],"visibility":"show","key":"H1QKRntnXO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:59.676303Z","iopub.status.busy":"2021-05-11T14:50:59.675776Z","iopub.status.idle":"2021-05-11T14:50:59.678245Z","shell.execute_reply":"2021-05-11T14:50:59.677764Z"},"papermill":{"duration":0.015061,"end_time":"2021-05-11T14:50:59.678331","exception":false,"start_time":"2021-05-11T14:50:59.663270","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pickle \n#print(len(aoi_no2))\nwith open('aoi_list_no2.pkl', 'wb') as f:\n    pickle.dump(aoi_no2, f)","visibility":"show","key":"JM3K7p8Yb3"},{"type":"output","id":"p0IUXgH9E_VPO8zmShN54","data":[],"visibility":"show","key":"NGoCZHUx36"}],"visibility":"show","key":"OtNNpDMZbI"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.009223,"end_time":"2021-05-11T14:50:59.696792","exception":false,"start_time":"2021-05-11T14:50:59.687569","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plotting function","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"QPizrQxZq6"}],"identifier":"plotting-function","label":"Plotting function","html_id":"plotting-function","implicit":true,"key":"kNpOq3bibz"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This plots the NO2 values over time","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"NdzFerSFWG"}],"key":"Tpnq8yHkgF"}],"visibility":"show","key":"pI6WGTaHkB"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:59.719617Z","iopub.status.busy":"2021-05-11T14:50:59.718998Z","iopub.status.idle":"2021-05-11T14:50:59.720914Z","shell.execute_reply":"2021-05-11T14:50:59.721251Z"},"papermill":{"duration":0.01535,"end_time":"2021-05-11T14:50:59.721350","exception":false,"start_time":"2021-05-11T14:50:59.706000","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\ndef plot_no2(idx):\n    \"\"\"\n    parameters:\n    idx: Input id for accessing NO2 data \n    \n    return:\n    None\n    line plots for NO2 (2020 vs 2019) are generated\n    \"\"\"\n\n    plt.plot(aoi_no2[idx]['NO2_2020']['DateTime'], aoi_no2[idx]['NO2_2020']['Mean NO2'],  label = 'NO2 levels (2020)')\n    plt.plot(aoi_no2[idx]['NO2_2020']['DateTime'], aoi_no2[idx]['NO2_2019']['Mean NO2'], label = 'NO2 levels (2019)')\n    plt.ylabel('NO2 Levels')\n    plt.xlabel('Month')\n    plt.title('NO2 levels for '+ aoi_no2[idx]['Country_BBox'])\n    plt.legend()\n    plt.savefig(aoi_no2[idx]['Country_BBox']+'.png')\n    plt.show()","visibility":"show","key":"j4AxxUahj2"},{"type":"output","id":"RbBkIsR9JR1hEVF6oMNDs","data":[],"visibility":"show","key":"NjT1ls46jQ"}],"visibility":"show","key":"Fl0s5eyspb"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:59.754293Z","iopub.status.busy":"2021-05-11T14:50:59.750576Z","iopub.status.idle":"2021-05-11T14:50:59.979810Z","shell.execute_reply":"2021-05-11T14:50:59.980143Z"},"papermill":{"duration":0.249765,"end_time":"2021-05-11T14:50:59.980261","exception":false,"start_time":"2021-05-11T14:50:59.730496","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"for idx in range(len(aoi_no2)):\n    plot_no2(idx)\n","visibility":"show","key":"Io4hPiKS8n"},{"type":"output","id":"Vyz67u9SChdfT-8R8qFve","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"89b79311522ec8518477a358f67aaabd","path":"/notebooks_test/build/89b79311522ec8518477a358f67aaabd.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"XYWHryEG24"}],"visibility":"show","key":"rRiYZmL2Qf"}],"key":"NbLQvFY3v4"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Living Planet Symposium 2022 Training Session","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/lps2022-leverage-euro-data-cube-services","group":"Contributions"},"next":{"title":"Using the NASA VEDA EOAPI","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/no2-so2-trend-veda-api-igarss-2023","group":"Contributions"}}},"domain":"http://localhost:3000"}