{"version":1,"kind":"Notebook","sha256":"2f406c869160f07a848e016ceb38ea025dc8155cbb99b70e46141c0567f0c4e8","slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.no2-analysis-covid19-lockdowns","location":"/external_notebooks/eurodatacube/notebooks/notebooks/contributions/NO2_Analysis_Covid19_Lockdowns.ipynb","dependencies":[],"frontmatter":{"title":"Impact of Covid19 induced lockdown on NO2 levels","content_includes_title":true,"kernelspec":{"name":"python3","display_name":"Python 3","language":"python"},"github":"https://github.com/eoxhub-workspaces/documentation/","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eoxhub-workspaces/documentation//blob/main/external_notebooks/eurodatacube/notebooks/notebooks/contributions/NO2_Analysis_Covid19_Lockdowns.ipynb","exports":[{"format":"ipynb","filename":"NO2_Analysis_Covid19_Lockdowns.ipynb","url":"/notebooks_test/build/NO2_Analysis_Covid19-77adb6a3602e8ffd88a8474f0113da98.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:01.016931Z","iopub.status.busy":"2021-05-11T14:50:01.016230Z","iopub.status.idle":"2021-05-11T14:50:01.074117Z","shell.execute_reply":"2021-05-11T14:50:01.074470Z"},"papermill":{"duration":0.070554,"end_time":"2021-05-11T14:50:01.074633","exception":false,"start_time":"2021-05-11T14:50:01.004079","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-0.24.5\", dependencies=[\"SH\"])","visibility":"show","key":"fFyFcMVJ2w"},{"type":"output","id":"JtaPzPUP-rVOnt3Uncg5f","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<script type=\"text/javascript\">\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    </script>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-0.24.5).","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"\n\n---------\n\nThe following environment variables are available:\n\n* `SH_CLIENT_ID`, `SH_INSTANCE_ID`, `SH_CLIENT_NAME`, `SH_CLIENT_SECRET`\n","content_type":"text/markdown"},"text/plain":{"content":"<IPython.core.display.Markdown object>","content_type":"text/plain"}}}],"visibility":"show","key":"DfpIy6nD0r"}],"visibility":"show","key":"eqB7xgiTvH"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008523,"end_time":"2021-05-11T14:50:01.091775","exception":false,"start_time":"2021-05-11T14:50:01.083252","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":1,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Impact of Covid19 induced lockdown on NO2 levels","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rBY9mlKDP8"}],"identifier":"impact-of-covid19-induced-lockdown-on-no2-levels","label":"Impact of Covid19 induced lockdown on NO2 levels","html_id":"impact-of-covid19-induced-lockdown-on-no2-levels","implicit":true,"key":"OrEvNyYAEw"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":3,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Countries have initiated lockdown measures to control the spread of the disease","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"wH2ruTugoY"}],"key":"xECRKqLGD1"}],"key":"aaQ4dxsnUX"},{"type":"listItem","spread":true,"position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Not all of the measures were successful (Italy)","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"IGkqIknAoh"}],"key":"hyAjnxIfbl"}],"key":"SSmhU3ijyd"},{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Countries (Germany) which successful implemented a lockdown showed a marked decrease in NO2 levels","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oAGR8p3jdv"}],"key":"d1gAaUEl6B"}],"key":"SFXRoN4dJ3"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"NO2 is produced when fossil fuels are burned, as during transportation (cars, trucks etc. ) or","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"oxPibZ1z0k"}],"key":"L4RTmS0n6Z"}],"key":"q2QQtiTIeM"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"due to other economic activities (like factories )","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"yLqmGC6IEV"}],"key":"rHE02KqTtP"}],"key":"bQFHUu5F9e"}],"key":"BViWsSjlan"}],"visibility":"show","key":"KCnjoZYewy"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008378,"end_time":"2021-05-11T14:50:01.108518","exception":false,"start_time":"2021-05-11T14:50:01.100140","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load required dependencies & credentials","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cDknH6Jxyt"}],"identifier":"load-required-dependencies-credentials","label":"Load required dependencies & credentials","html_id":"load-required-dependencies-credentials","implicit":true,"key":"vNOPMao7jt"}],"visibility":"show","key":"rbD8M49isK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:01.128846Z","iopub.status.busy":"2021-05-11T14:50:01.128363Z","iopub.status.idle":"2021-05-11T14:50:02.398452Z","shell.execute_reply":"2021-05-11T14:50:02.397917Z"},"papermill":{"duration":1.28161,"end_time":"2021-05-11T14:50:02.398569","exception":false,"start_time":"2021-05-11T14:50:01.116959","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Import required packages\n\nfrom xcube_sh.config import CubeConfig\nfrom xcube_sh.cube import open_cube\nfrom xcube_sh.sentinelhub import SentinelHub\nimport xarray as xr\n\nfrom sentinelhub import BBox, WmsRequest, DataSource, SHConfig\nfrom functools import partial\n\nimport numpy as np\nimport pandas as pd\n\nfrom matplotlib import pyplot as plt\n","visibility":"show","key":"b13qyCnkOz"},{"type":"output","id":"94nYQLHFROc4SBTbx2I7o","data":[],"visibility":"show","key":"YMkhWbk7uQ"}],"visibility":"show","key":"ownWJXVZvJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.418925Z","iopub.status.busy":"2021-05-11T14:50:02.418424Z","iopub.status.idle":"2021-05-11T14:50:02.420627Z","shell.execute_reply":"2021-05-11T14:50:02.420063Z"},"papermill":{"duration":0.013625,"end_time":"2021-05-11T14:50:02.420756","exception":false,"start_time":"2021-05-11T14:50:02.407131","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set Sentinel Hub credentials\n\nimport os\nsh_credentials = dict(client_id=os.environ['SH_CLIENT_ID'],\n                      client_secret=os.environ['SH_CLIENT_SECRET']) # This is only provided when the Oauth credentials are created\n\n# Sentinel-3 OLCI, Sentinel-3 SLSTR and Sentinel-5 layers are processed on different infrastructure, \n# which requires to used different end-point\n\nsh_credentials.update(api_url='https://creodias.sentinel-hub.com') ","visibility":"show","key":"bmNFnQl2tk"},{"type":"output","id":"uRYJZzGbbkjPGLzocyt_y","data":[],"visibility":"show","key":"lmhwqNyK4c"}],"visibility":"show","key":"KfFHVbRiOq"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008275,"end_time":"2021-05-11T14:50:02.438243","exception":false,"start_time":"2021-05-11T14:50:02.429968","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Core function to calculate NO2 values","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rTKEQuBZZy"}],"identifier":"core-function-to-calculate-no2-values","label":"Core function to calculate NO2 values","html_id":"core-function-to-calculate-no2-values","implicit":true,"key":"hVmZ0MOA8S"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"NO2 values are calculated over the given period (Jan -May) for 2020 & 2019","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"R7kLGwQV2N"}],"key":"JtxCbMsM4m"}],"visibility":"show","key":"dRdcZ2B3en"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.460873Z","iopub.status.busy":"2021-05-11T14:50:02.460186Z","iopub.status.idle":"2021-05-11T14:50:02.461807Z","shell.execute_reply":"2021-05-11T14:50:02.462165Z"},"papermill":{"duration":0.015747,"end_time":"2021-05-11T14:50:02.462271","exception":false,"start_time":"2021-05-11T14:50:02.446524","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"def caculateNO2(geometry, timerange):\n    \"\"\"\n    parameters:\n    geometry: BBox object to be passed. This contains the bounding box for the area of interest (AOI)\n    timerange: list giving the start & end of the time range format: YYYY-mm-dd\n    \n    return:\n    a dataframe with two columns: Mean NO2 and Timestamp\n    NO2 mean values for the time span between given timerange \n    \n    \"\"\"\n    cube_config = CubeConfig(dataset_name='S5PL2',\n                         band_names=['NO2'],\n                         tile_size=[512, 512],\n                         geometry=geometry,\n                         spatial_res=abs(bbox[2]-bbox[0])/512,\n                         time_range= timerange,\n                         time_period='3D') \n    cube = open_cube(cube_config, **sh_credentials)\n\n    no2_values = list() \n    timestamp = list()\n\n    for i in range(cube.time.shape[0]):\n        no2_values.append(np.nanmean(cube.NO2.isel(time=i).values[0]))\n        timestamp.append(cube.NO2.isel(time=i).time.values)\n        \n    assert len(no2_values) == len(timestamp)\n    \n    return pd.DataFrame({'DateTime': timestamp, 'Mean NO2': no2_values})","visibility":"show","key":"PzpyxKcmf1"},{"type":"output","id":"MqeD1bkMf05v9DIT9r2FV","data":[],"visibility":"show","key":"gHZhjXO6Gy"}],"visibility":"show","key":"UVUahEzEuy"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008259,"end_time":"2021-05-11T14:50:02.479255","exception":false,"start_time":"2021-05-11T14:50:02.470996","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Read area of interest as a csv file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"qpjGje4QB2"}],"identifier":"read-area-of-interest-as-a-csv-file","label":"Read area of interest as a csv file","html_id":"read-area-of-interest-as-a-csv-file","implicit":true,"key":"Gky4YD83bo"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Uncomment the next code block if you want to read the AOI from a csv file","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nFzD04bMmp"}],"key":"pypV9bsuDZ"}],"key":"MU2kBoU7PI"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"File has the following columns:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"xBXtXPO6UN"}],"key":"n6AP5ylwE8"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Country: Name of country/territory of interest","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"eGCblB1x1b"}],"key":"Ia6r0saHCU"},{"type":"listItem","spread":true,"position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"x1, y1 : Upper left corner co-ordinates (lat/lon)","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"AcZoJ0ibDg"}],"key":"Q4SHcF1RRj"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"x2, y2 : Lower right corner co-ordinates","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"nqTG2wwECR"}],"key":"YquXYo1bmk"}],"key":"RuJkYre7kd"}],"visibility":"show","key":"PDt9SSXnro"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.498683Z","iopub.status.busy":"2021-05-11T14:50:02.498145Z","iopub.status.idle":"2021-05-11T14:50:02.499883Z","shell.execute_reply":"2021-05-11T14:50:02.500235Z"},"papermill":{"duration":0.012739,"end_time":"2021-05-11T14:50:02.500336","exception":false,"start_time":"2021-05-11T14:50:02.487597","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# aoi = pd.read_csv('AOI.csv')\n# print(aoi.shape)\n# print(aoi.head(8))\n\n# shape = aoi.shape\n# nullCount = sum(aoi.isna().sum())\n# print(f\"Shape of 2020 DF: {shape}, Count of Null values: {nullCount}\".format(shape , nullCount ))","visibility":"show","key":"pzaIKQRmLi"},{"type":"output","id":"KAcHofHLDBC8aeGKIw3Gx","data":[],"visibility":"show","key":"wylACDvo0i"}],"visibility":"show","key":"AiiqBC6CG2"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008298,"end_time":"2021-05-11T14:50:02.517365","exception":false,"start_time":"2021-05-11T14:50:02.509067","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define AOI as a list","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bQLwMsYHXn"}],"identifier":"define-aoi-as-a-list","label":"Define AOI as a list","html_id":"define-aoi-as-a-list","implicit":true,"key":"sQz4Ryq189"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This is a list of dictionaries with the required information","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BSwJm0PNrW"}],"key":"pIK5kt6AnI"}],"key":"Ci5jsKPvcc"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Each dict has the following keys:","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Aoy0npyG2I"}],"key":"EIhmBGv1yc"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":7,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Country: Name of country/territory of interest","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"HtnXxNcqaJ"}],"key":"kHbSvtcTDT"},{"type":"listItem","spread":true,"position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"x1, y1 : Upper left corner co-ordinates (lat/lon)","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"hSvSdbLPpm"}],"key":"gjRfehiCZo"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"x2, y2 : Lower right corner co-ordinates","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"zqfXZ4WKef"}],"key":"GTbM5Eo71c"}],"key":"zGDA48kwnE"}],"visibility":"show","key":"ZDWsFI7hAN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.537911Z","iopub.status.busy":"2021-05-11T14:50:02.537386Z","iopub.status.idle":"2021-05-11T14:50:02.539548Z","shell.execute_reply":"2021-05-11T14:50:02.538933Z"},"papermill":{"duration":0.013931,"end_time":"2021-05-11T14:50:02.539639","exception":false,"start_time":"2021-05-11T14:50:02.525708","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"aoi = list()\n\n#Define two dicts\ncountry1 = dict()\ncountry1['Country'] = 'Italy'\ncountry1['x1'] = 46.28 \ncountry1['y1'] = 6.42\ncountry1['x2'] = 37.25\ncountry1['y2'] = 19.73\naoi.append(country1)\n\ncountry2 = dict()\ncountry2['Country'] = 'Germany'\ncountry2['x1'] = 54.77 \ncountry2['y1'] = 4.70\ncountry2['x2'] = 47.63\ncountry2['y2'] = 15.73\naoi.append(country2)\n\n#print(len(aoi))","visibility":"show","key":"hCxdwjwjYQ"},{"type":"output","id":"-icgRSi8YOn0esJndJbXK","data":[],"visibility":"show","key":"VSn6LbDv7j"}],"visibility":"show","key":"J9JVHtAjrE"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008218,"end_time":"2021-05-11T14:50:02.560711","exception":false,"start_time":"2021-05-11T14:50:02.552493","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Main loop","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Jufug2uaDG"}],"identifier":"main-loop","label":"Main loop","html_id":"main-loop","implicit":true,"key":"HqCUYeVeQu"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We iterate over each row in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vNh7AuENJR"},{"type":"inlineCode","value":"aoi.csv","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"baRAMemWb5"},{"type":"text","value":" file","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"U8DTL3zWqv"}],"key":"GpZS5t7UX0"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Sentinel-5P data for each defined AOI cube is extracted","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"B7WVxQmfUg"}],"key":"X28pE6B5XQ"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"NO2 values for each tile is then averaged & stored in a list","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"RrMXZXxS9j"}],"key":"ooQgckC7SF"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"For the purpose of this demo we will calculate the NO2 values for one AOI and for one month\n(","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"VrgbwpfiCM"},{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"That will ensure that we donâ€™t exceed the timelimit of 10mins!","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"AZvmvPDQ5Q"}],"key":"Xjc0s82IHz"},{"type":"text","value":")","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"IJFB3MppvV"}],"key":"qqgZUH9QXr"}],"visibility":"show","key":"qXngL4bhXM"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:02.586845Z","iopub.status.busy":"2021-05-11T14:50:02.583577Z","iopub.status.idle":"2021-05-11T14:50:59.606086Z","shell.execute_reply":"2021-05-11T14:50:59.606453Z"},"papermill":{"duration":57.037651,"end_time":"2021-05-11T14:50:59.606584","exception":false,"start_time":"2021-05-11T14:50:02.568933","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import time \n\nstart = time.time()\naoi_no2 = list()\n\n# Check length of provided aoi list OR dataframe\nlen_aoi = len(aoi)\n\n# Define how many AOIs you want to process. For the demo we will use only one \ncounter = 1\n\nfor idx in range(counter):\n    aoi_dict = dict()\n    \n    # Check if aoi is passed as a list or a dataframe\n    if isinstance(aoi, list):\n        aoi_dict['Country_BBox'] = aoi[idx]['Country']\n        x1 = int(aoi[idx]['x1'])  # degree \n        y1 = int(aoi[idx]['y1'])  # degree\n        x2 = int(aoi[idx]['x2'])  # degree\n        y2 = int(aoi[idx]['y2'])  # degree\n                \n    else:\n        aoi_dict['Country_BBox'] = aoi.loc[idx]['Country']\n        print(\"Processing: \", aoi_dict['Country_BBox'])\n        x1 = int(aoi.loc[idx]['x1'])  # degree \n        y1 = int(aoi.loc[idx]['y1'])  # degree\n        x2 = int(aoi.loc[idx]['x2'])  # degree\n        y2 = int(aoi.loc[idx]['y2'])  # degree\n\n    bbox = x1, y1, x2, y2\n    timerange = ['2020-01-01', '2020-01-31']\n    aoi_dict['NO2_2020'] = caculateNO2(bbox, timerange)\n    shape = aoi_dict['NO2_2020'].shape\n    nullCount = sum(aoi_dict['NO2_2020'].isna().sum())\n    print(f\"Shape of 2020 DF: {shape}, Count of Null values: {nullCount}\".format(shape , nullCount ))    \n    \n    timerange = ['2019-01-01', '2019-01-31']\n    aoi_dict['NO2_2019'] = caculateNO2(bbox, timerange)\n    shape = aoi_dict['NO2_2019'].shape\n    nullCount = sum(aoi_dict['NO2_2019'].isna().sum())\n    print(f\"Shape of 2019 DF: {shape}, Count of Null values: {nullCount}\".format(shape , nullCount ))\n\n    aoi_no2.append(aoi_dict)\n\nend = time.time()\n#print(len(aoi_no2))\n","visibility":"show","key":"nHYAizzwW1"},{"type":"output","id":"rSIpgm3ywqqPfMXke7K4U","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/eurodatacube-0.24.5/lib/python3.8/site-packages/xcube_sh/config.py:99: UserWarning: the geometry parameter is no longer supported, use bbox instead\n  warnings.warn('the geometry parameter is no longer supported, use bbox instead')\n"},{"name":"stdout","output_type":"stream","text":"Shape of 2020 DF: (11, 2), Count of Null values: 0\n"},{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/eurodatacube-0.24.5/lib/python3.8/site-packages/xcube_sh/config.py:99: UserWarning: the geometry parameter is no longer supported, use bbox instead\n  warnings.warn('the geometry parameter is no longer supported, use bbox instead')\n"},{"name":"stdout","output_type":"stream","text":"Shape of 2019 DF: (11, 2), Count of Null values: 0\n"}],"visibility":"show","key":"n2fxiojloN"}],"visibility":"show","key":"u3Ppgq4eJN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:59.628023Z","iopub.status.busy":"2021-05-11T14:50:59.627429Z","iopub.status.idle":"2021-05-11T14:50:59.630190Z","shell.execute_reply":"2021-05-11T14:50:59.629647Z"},"papermill":{"duration":0.014541,"end_time":"2021-05-11T14:50:59.630279","exception":false,"start_time":"2021-05-11T14:50:59.615738","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print(\"Total processing time: {:.2} mins\".format((end-start)/60)) ","visibility":"show","key":"s58HJ5ktG0"},{"type":"output","id":"ex7Tlqp2fHANC1-xcCykZ","data":[{"name":"stdout","output_type":"stream","text":"Total processing time: 0.95 mins\n"}],"visibility":"show","key":"A2tgP9wLSA"}],"visibility":"show","key":"PtP293NshE"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010733,"end_time":"2021-05-11T14:50:59.651663","exception":false,"start_time":"2021-05-11T14:50:59.640930","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The list is then pickled so that the information can then be reused in another run","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cijqPFfcep"}],"key":"SIQTMWz2SS"}],"visibility":"show","key":"kSb5KPopvd"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:59.676303Z","iopub.status.busy":"2021-05-11T14:50:59.675776Z","iopub.status.idle":"2021-05-11T14:50:59.678245Z","shell.execute_reply":"2021-05-11T14:50:59.677764Z"},"papermill":{"duration":0.015061,"end_time":"2021-05-11T14:50:59.678331","exception":false,"start_time":"2021-05-11T14:50:59.663270","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import pickle \n#print(len(aoi_no2))\nwith open('aoi_list_no2.pkl', 'wb') as f:\n    pickle.dump(aoi_no2, f)","visibility":"show","key":"kBQRibTGCr"},{"type":"output","id":"FS9DvYnBe3GgC5fg0jWbI","data":[],"visibility":"show","key":"u2DD1J6gYa"}],"visibility":"show","key":"FlgAWopZ7T"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.009223,"end_time":"2021-05-11T14:50:59.696792","exception":false,"start_time":"2021-05-11T14:50:59.687569","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plotting function","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V9968iUJkN"}],"identifier":"plotting-function","label":"Plotting function","html_id":"plotting-function","implicit":true,"key":"gJf4xgUWS3"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"This plots the NO2 values over time","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"ixMoG4mWFj"}],"key":"elou3EGhVL"}],"visibility":"show","key":"ZxaOt3x2WC"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:59.719617Z","iopub.status.busy":"2021-05-11T14:50:59.718998Z","iopub.status.idle":"2021-05-11T14:50:59.720914Z","shell.execute_reply":"2021-05-11T14:50:59.721251Z"},"papermill":{"duration":0.01535,"end_time":"2021-05-11T14:50:59.721350","exception":false,"start_time":"2021-05-11T14:50:59.706000","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import matplotlib.pyplot as plt\n\ndef plot_no2(idx):\n    \"\"\"\n    parameters:\n    idx: Input id for accessing NO2 data \n    \n    return:\n    None\n    line plots for NO2 (2020 vs 2019) are generated\n    \"\"\"\n\n    plt.plot(aoi_no2[idx]['NO2_2020']['DateTime'], aoi_no2[idx]['NO2_2020']['Mean NO2'],  label = 'NO2 levels (2020)')\n    plt.plot(aoi_no2[idx]['NO2_2020']['DateTime'], aoi_no2[idx]['NO2_2019']['Mean NO2'], label = 'NO2 levels (2019)')\n    plt.ylabel('NO2 Levels')\n    plt.xlabel('Month')\n    plt.title('NO2 levels for '+ aoi_no2[idx]['Country_BBox'])\n    plt.legend()\n    plt.savefig(aoi_no2[idx]['Country_BBox']+'.png')\n    plt.show()","visibility":"show","key":"h90hDylyzL"},{"type":"output","id":"aC-EL_lyY_bNMRhe2D02Z","data":[],"visibility":"show","key":"h15vJ7th5M"}],"visibility":"show","key":"vjebZOxvXF"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:50:59.754293Z","iopub.status.busy":"2021-05-11T14:50:59.750576Z","iopub.status.idle":"2021-05-11T14:50:59.979810Z","shell.execute_reply":"2021-05-11T14:50:59.980143Z"},"papermill":{"duration":0.249765,"end_time":"2021-05-11T14:50:59.980261","exception":false,"start_time":"2021-05-11T14:50:59.730496","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"for idx in range(len(aoi_no2)):\n    plot_no2(idx)\n","visibility":"show","key":"cVtulAJPYq"},{"type":"output","id":"aswOc1j5Dht4R5zyJfWXf","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"89b79311522ec8518477a358f67aaabd","path":"/notebooks_test/build/89b79311522ec8518477a358f67aaabd.png"},"text/plain":{"content":"<Figure size 640x480 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"gm5mG81nOx"}],"visibility":"show","key":"MAgXBDzfTb"}],"key":"oGNo2ywpE6"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Living Planet Symposium 2022 Training Session","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/lps2022-leverage-euro-data-cube-services","group":"Contributions"},"next":{"title":"Using the NASA VEDA EOAPI","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/no2-so2-trend-veda-api-igarss-2023","group":"Contributions"}}},"domain":"http://localhost:3000"}