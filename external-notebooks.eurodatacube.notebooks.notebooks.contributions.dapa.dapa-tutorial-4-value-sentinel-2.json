{"version":1,"kind":"Notebook","sha256":"1fe4e6cf2567340ac14f78334cadda53b1ed1efc5b7538092b4156ee7829b2f1","slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-4-value-sentinel-2","location":"/external_notebooks/eurodatacube/notebooks/notebooks/contributions/DAPA/DAPA_Tutorial_4_-_Value_-_Sentinel-2.ipynb","dependencies":[],"frontmatter":{"title":"DAPA Tutorial #4: Value - Sentinel-2","content_includes_title":false,"kernelspec":{"name":"edc","display_name":"EDC 0.19.6 (Python3)","language":"python"},"github":"https://github.com/eoxhub-workspaces/documentation/","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eoxhub-workspaces/documentation//blob/main/external_notebooks/eurodatacube/notebooks/notebooks/contributions/DAPA/DAPA_Tutorial_4_-_Value_-_Sentinel-2.ipynb","exports":[{"format":"ipynb","filename":"DAPA_Tutorial_4_-_Value_-_Sentinel-2.ipynb","url":"/notebooks_test/build/DAPA_Tutorial_4_-_Va-b5cf44a40abe30c951835615d5345084.ipynb"}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"state":{"4735c44d591b4fff9c2326b6bbaf64db":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletZoomControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletZoomControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletZoomControlView","options":["position","zoom_in_text","zoom_in_title","zoom_out_text","zoom_out_title"],"position":"topleft","zoom_in_text":"+","zoom_in_title":"Zoom in","zoom_out_text":"-","zoom_out_title":"Zoom out"}},"4f4e03b2fad4451683dec8f3ded21928":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapModel","state":{"_dom_classes":[],"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletMapView","bottom":0,"bounce_at_zoom_limits":true,"box_zoom":true,"center":[48.05,11.49],"close_popup_on_click":true,"controls":["IPY_MODEL_4735c44d591b4fff9c2326b6bbaf64db","IPY_MODEL_eec251d72f424b0baf80bdb04f6f7b58"],"crs":{"custom":false,"name":"EPSG3857"},"default_style":"IPY_MODEL_7ed2ac4ef55b4cc8ad34a2df364fc6b3","double_click_zoom":true,"dragging":true,"dragging_style":"IPY_MODEL_8b53adc0157749169c050b17b2019189","east":0,"fullscreen":false,"inertia":true,"inertia_deceleration":3000,"inertia_max_speed":1500,"interpolation":"bilinear","keyboard":true,"keyboard_pan_offset":80,"keyboard_zoom_offset":1,"layers":["IPY_MODEL_60d4057219ce4bf1ae1b7889b01d3782","IPY_MODEL_f84ccf5d7a24419890d6f5cbfddfffd9"],"layout":"IPY_MODEL_d11d0f19ca334f1da910dd7f54c13a1f","left":9007199254740991,"max_zoom":18,"min_zoom":1,"modisdate":"yesterday","north":0,"options":["bounce_at_zoom_limits","box_zoom","center","close_popup_on_click","double_click_zoom","dragging","fullscreen","inertia","inertia_deceleration","inertia_max_speed","interpolation","keyboard","keyboard_pan_offset","keyboard_zoom_offset","max_zoom","min_zoom","scroll_wheel_zoom","tap","tap_tolerance","touch_zoom","world_copy_jump","zoom","zoom_animation_threshold","zoom_delta","zoom_snap","zoom_start"],"right":0,"scroll_wheel_zoom":false,"south":0,"style":"IPY_MODEL_dfe1b5fff2584e1091406389371bd2a5","tap":true,"tap_tolerance":15,"top":9007199254740991,"touch_zoom":true,"west":0,"window_url":"","world_copy_jump":false,"zoom":10,"zoom_animation_threshold":4,"zoom_delta":1,"zoom_snap":1,"zoom_start":12}},"60d4057219ce4bf1ae1b7889b01d3782":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletTileLayerView","attribution":"Map data (c) <a href=\"https://openstreetmap.org\">OpenStreetMap</a> contributors","base":true,"bottom":true,"detect_retina":false,"loading":false,"max_native_zoom":18,"max_zoom":19,"min_native_zoom":0,"min_zoom":1,"name":"OpenStreetMap.Mapnik","no_wrap":false,"opacity":1,"options":["attribution","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms"],"popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"tile_size":256,"tms":false,"url":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","visible":true}},"7ed2ac4ef55b4cc8ad34a2df364fc6b3":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"grab"}},"8b53adc0157749169c050b17b2019189":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"move"}},"d11d0f19ca334f1da910dd7f54c13a1f":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"dfe1b5fff2584e1091406389371bd2a5":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"grab"}},"eec251d72f424b0baf80bdb04f6f7b58":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletAttributionControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletAttributionControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletAttributionControlView","options":["position","prefix"],"position":"bottomright","prefix":"ipyleaflet"}},"f84ccf5d7a24419890d6f5cbfddfffd9":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMarkerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMarkerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletMarkerView","alt":"","base":false,"bottom":false,"draggable":false,"icon":null,"keyboard":true,"location":[48.05,11.49],"name":"","opacity":1,"options":["alt","draggable","keyboard","rise_offset","rise_on_hover","rotation_angle","rotation_origin","title","z_index_offset"],"popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"rise_offset":250,"rise_on_hover":false,"rotation_angle":0,"rotation_origin":"","title":"","visible":true,"z_index_offset":0}}},"version_major":2,"version_minor":0}},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008299,"end_time":"2021-05-11T14:51:40.919603","exception":false,"start_time":"2021-05-11T14:51:40.911304","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load environment variables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vkGMWbBInu"}],"identifier":"load-environment-variables","label":"Load environment variables","html_id":"load-environment-variables","implicit":true,"key":"pDolkZxEDU"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Please make sure that the environment variable “DAPA_URL” is set in the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yTM5IOAND7"},{"type":"inlineCode","value":"custom.env","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rtL7nD4fHn"},{"type":"text","value":" file. You can check this by executing the following block.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"pCHNRTTwui"}],"key":"m5mcfEUgfx"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"If DAPA_URL is not set, please create a text file named ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ooKnFQStHI"},{"type":"inlineCode","value":"custom.env","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"VCKlqGcNEE"},{"type":"text","value":" in your home directory with the following input:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"TbdEG74DpN"}],"key":"xepIDMEZ8e"},{"type":"blockquote","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"DAPA_URL=YOUR-PERSONAL-DAPA-APP-URL","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rDX5G3j6WZ"}],"key":"iWyXagchLw"}],"key":"PfWnDVfOO2"}],"visibility":"show","key":"zJmTpur8D8"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:40.939429Z","iopub.status.busy":"2021-05-11T14:51:40.938896Z","iopub.status.idle":"2021-05-11T14:51:40.988212Z","shell.execute_reply":"2021-05-11T14:51:40.988543Z"},"papermill":{"duration":0.06078,"end_time":"2021-05-11T14:51:40.988692","exception":false,"start_time":"2021-05-11T14:51:40.927912","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import setup_environment_variables\nsetup_environment_variables()","visibility":"show","key":"QqQI3ixgqb"},{"type":"output","id":"cDJlTWCic7BRtha4rjriZ","data":[{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"API credentials have automatically been injected for your active subscriptions.  \nThe following environment variables are now available:\n\nThe following additional environment variables have been loaded from `~/custom.env`:\n* `AWS_BUCKET`\n* `DAPA_URL`\n* `DB_HOST`, `DB_NAME`, `DB_PASSWORD`, `DB_USER`\n* `OGC_EDC_URL`\n* `REFERENCE_DATA`\n","content_type":"text/markdown"},"text/plain":{"content":"<IPython.core.display.Markdown object>","content_type":"text/plain"}}}],"visibility":"show","key":"esJUYiZrE5"}],"visibility":"show","key":"MIqKyJgYJ5"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.008575,"end_time":"2021-05-11T14:51:41.005897","exception":false,"start_time":"2021-05-11T14:51:40.997322","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check notebook compabtibility","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"iceocrMG5B"}],"identifier":"check-notebook-compabtibility","label":"Check notebook compabtibility","html_id":"check-notebook-compabtibility","implicit":true,"key":"okjLqNuQ1N"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Please note:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"v272Zz4wV8"}],"key":"IATPDByacg"},{"type":"text","value":" If you conduct this notebook again at a later time, the base image of this Jupyter Hub service can include newer versions of the libraries installed. Thus, the notebook execution can fail. This compatibility check is only necessary when something is broken.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"tOJEnuiRsN"}],"key":"xb4BHCPSru"}],"visibility":"show","key":"iomG5mdtgZ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:41.026341Z","iopub.status.busy":"2021-05-11T14:51:41.025812Z","iopub.status.idle":"2021-05-11T14:51:41.029435Z","shell.execute_reply":"2021-05-11T14:51:41.028991Z"},"papermill":{"duration":0.015032,"end_time":"2021-05-11T14:51:41.029537","exception":false,"start_time":"2021-05-11T14:51:41.014505","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-0.24.5\", dependencies=[])","visibility":"show","key":"F7DUDiPL2T"},{"type":"output","id":"pG7f2Jb4KoNf6SyUT2zh8","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<script type=\"text/javascript\">\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    </script>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-0.24.5).","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"visibility":"show","key":"bMmE5MM0My"}],"visibility":"show","key":"W8MJyjknbX"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.009225,"end_time":"2021-05-11T14:51:41.048001","exception":false,"start_time":"2021-05-11T14:51:41.038776","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mTCdp1TLUM"}],"identifier":"load-libraries","label":"Load libraries","html_id":"load-libraries","implicit":true,"key":"d0qgRovNdT"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Python libraries used in this tutorial will be loaded.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"StGopyJOmt"}],"key":"RVCMBLbhdO"}],"visibility":"show","key":"Nwb0vf3P2r"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:41.076190Z","iopub.status.busy":"2021-05-11T14:51:41.075682Z","iopub.status.idle":"2021-05-11T14:51:42.246226Z","shell.execute_reply":"2021-05-11T14:51:42.246626Z"},"papermill":{"duration":1.189424,"end_time":"2021-05-11T14:51:42.246757","exception":false,"start_time":"2021-05-11T14:51:41.057333","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport xarray as xr\nimport pandas as pd\nimport requests\nimport matplotlib\nfrom ipyleaflet import Map, Rectangle, Marker, DrawControl, basemaps, basemap_to_tiles\n%matplotlib inline","visibility":"show","key":"DHTbBF7EoV"},{"type":"output","id":"jV0k5GixFZn_VkIn8Y5cN","data":[],"visibility":"show","key":"AJP1fUM8iW"}],"visibility":"show","key":"WaUS5sjA4g"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.009433,"end_time":"2021-05-11T14:51:42.265833","exception":false,"start_time":"2021-05-11T14:51:42.256400","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set DAPA endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"puPdh7FARd"}],"identifier":"set-dapa-endpoint","label":"Set DAPA endpoint","html_id":"set-dapa-endpoint","implicit":true,"key":"TDrEiZyNyh"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Execute the following code to check if the DAPA_URL is available in the environment variable and to set the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"WiZMWqMgui"},{"type":"inlineCode","value":"/dapa","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wvz7w2Gybt"},{"type":"text","value":" endpoint.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"bIltZnWbY0"}],"key":"p9yF39R6wI"}],"visibility":"show","key":"xjjue7qRyc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:42.288375Z","iopub.status.busy":"2021-05-11T14:51:42.287756Z","iopub.status.idle":"2021-05-11T14:51:42.290084Z","shell.execute_reply":"2021-05-11T14:51:42.290411Z"},"papermill":{"duration":0.015592,"end_time":"2021-05-11T14:51:42.290517","exception":false,"start_time":"2021-05-11T14:51:42.274925","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"service_url = None\ndapa_url = None\n\nif 'DAPA_URL' not in os.environ:\n    print('!! DAPA_URL does not exist as environment variable. Please make sure this is the case - see first block of this notebook! !!')\nelse:    \n    service_url = os.environ['DAPA_URL']\n    dapa_url = '{}/{}'.format(service_url, 'oapi')\n    print('DAPA path: {}'.format(dapa_url.replace(service_url, '')))","visibility":"show","key":"dSGxtnrhHB"},{"type":"output","id":"rB0iunH6Eh6FrH5U9dG4O","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi\n"}],"visibility":"show","key":"WjnXb9rr9m"}],"visibility":"show","key":"JLd6pdz1D7"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.009348,"end_time":"2021-05-11T14:51:42.309182","exception":false,"start_time":"2021-05-11T14:51:42.299834","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get collections supported by this endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AvrV3VEyLs"}],"identifier":"get-collections-supported-by-this-endpoint","label":"Get collections supported by this endpoint","html_id":"get-collections-supported-by-this-endpoint","implicit":true,"key":"SA33iMYCRd"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This request provides a list of collections. The path of each collection is used as starting path of this service.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SlSY2X5bkv"}],"key":"LnsgcmlrHX"}],"visibility":"show","key":"bOZHXRo3xc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:42.331199Z","iopub.status.busy":"2021-05-11T14:51:42.330656Z","iopub.status.idle":"2021-05-11T14:51:42.425318Z","shell.execute_reply":"2021-05-11T14:51:42.424819Z"},"papermill":{"duration":0.107,"end_time":"2021-05-11T14:51:42.425420","exception":false,"start_time":"2021-05-11T14:51:42.318420","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"collections_url = '{}/{}'.format(dapa_url, 'collections')\ncollections = requests.get(collections_url, headers={'Accept': 'application/json'})\n\nprint('DAPA path: {}'.format(collections.url.replace(service_url, '')))\ncollections.json()","visibility":"show","key":"bheBaACMgV"},{"type":"output","id":"iWZTpTk05DQvSglAaG7yz","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections\n"},{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"['/oapi/collections/DEM/',\n '/oapi/collections/L8L1C/',\n '/oapi/collections/S1GRD/',\n '/oapi/collections/S2L1C/',\n '/oapi/collections/S2L2A/',\n '/oapi/collections/S3OLCI/',\n '/oapi/collections/S3SLSTR/',\n '/oapi/collections/S5PL2/',\n '/oapi/collections/MODIS/']","content_type":"text/plain"}}}],"visibility":"show","key":"mOZcFHLtJx"}],"visibility":"show","key":"bCgYd0X4hT"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.009737,"end_time":"2021-05-11T14:51:42.445088","exception":false,"start_time":"2021-05-11T14:51:42.435351","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get fields of collection Sentinel-2 L2A","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"caI7ybWMoh"}],"identifier":"get-fields-of-collection-sentinel-2-l2a","label":"Get fields of collection Sentinel-2 L2A","html_id":"get-fields-of-collection-sentinel-2-l2a","implicit":true,"key":"kOgid232iQ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The fields (or variables in other DAPA endpoints - these are the bands of the raster data) can be retrieved in all requests to the DAPA endpoint. In addition to the fixed set of fields, “virtual” fields can be used to conduct math operations (e.g., the calculation of indices).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"lWNDUa1lIp"}],"key":"M2PDWJyBVw"}],"visibility":"show","key":"bYgxC9q9A4"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:42.468577Z","iopub.status.busy":"2021-05-11T14:51:42.467273Z","iopub.status.idle":"2021-05-11T14:51:42.500034Z","shell.execute_reply":"2021-05-11T14:51:42.499545Z"},"papermill":{"duration":0.045347,"end_time":"2021-05-11T14:51:42.500126","exception":false,"start_time":"2021-05-11T14:51:42.454779","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"collection = 'S2L2A'\n\nfields_url = '{}/{}/{}/{}'.format(dapa_url, 'collections', collection, 'dapa/fields')\nfields = requests.get(fields_url, headers={'Accept': 'application/json'})\n\nprint('DAPA path: {}'.format(fields.url.replace(service_url, '')))\nfields.json()","visibility":"show","key":"YZweVKcUOf"},{"type":"output","id":"tRjKHCpRM8Vo0rMcEzBvm","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections/S2L2A/dapa/fields\n"},{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"[{'id': 'B01', 'wavelength': 442.7},\n {'id': 'B02', 'wavelength': 492.4},\n {'id': 'B03', 'wavelength': 559.8},\n {'id': 'B04', 'wavelength': 664.6},\n {'id': 'B05', 'wavelength': 704.1},\n {'id': 'B06', 'wavelength': 740.5},\n {'id': 'B07', 'wavelength': 782.8},\n {'id': 'B08', 'wavelength': 832.8},\n {'id': 'B8A', 'wavelength': 864.7},\n {'id': 'B09', 'wavelength': 945.1},\n {'id': 'B11', 'wavelength': 1613.7},\n {'id': 'B12', 'wavelength': 2202.4},\n {'id': 'SCL', 'wavelength': None},\n {'id': 'SNW', 'wavelength': None},\n {'id': 'CLD', 'wavelength': None}]","content_type":"text/plain"}}}],"visibility":"show","key":"JSXTp2Bify"}],"visibility":"show","key":"aFLlxmq0Qf"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010115,"end_time":"2021-05-11T14:51:42.520387","exception":false,"start_time":"2021-05-11T14:51:42.510272","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve an NDVI value extraced for a single point","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fUtPuJcryh"}],"identifier":"retrieve-an-ndvi-value-extraced-for-a-single-point","label":"Retrieve an NDVI value extraced for a single point","html_id":"retrieve-an-ndvi-value-extraced-for-a-single-point","implicit":true,"key":"PGPZXJKHZO"}],"visibility":"show","key":"eBL6R5nYKo"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010065,"end_time":"2021-05-11T14:51:42.540595","exception":false,"start_time":"2021-05-11T14:51:42.530530","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set DAPA URL and parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eddataLjSA"}],"identifier":"set-dapa-url-and-parameters","label":"Set DAPA URL and parameters","html_id":"set-dapa-url-and-parameters","implicit":true,"key":"eTqLvz7OQV"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The output of this request is a single value requested from a point of interest (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oMPmGzYjcT"},{"type":"inlineCode","value":"value/position","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"T6XjtFuHJ2"},{"type":"text","value":" endpoint). As the input collection (S2L2A) is a multi-temporal raster and the requested geometry is a point, temporal aggregation is conducted.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"IQv3Ibcg8J"}],"key":"YOkRtqp42g"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To retrieve a single value of a point, the parameter ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"N83BPC2KtD"},{"type":"inlineCode","value":"point","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"p9kiWlyveb"},{"type":"text","value":" needs to be provided. For the temporal aggregation, the parameter ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"KHCfwsW1yA"},{"type":"inlineCode","value":"aggregate","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"kDaVhOh13C"},{"type":"text","value":" needs to include the aggregation functions splitted by comma. The ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ed1hMugT4o"},{"type":"inlineCode","value":"time","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"cZNwDuK4Qv"},{"type":"text","value":" parameter allows to aggregate data only within a specific time span. The band (","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"oZp0biDCly"},{"type":"inlineCode","value":"field","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RkpcxEvAZD"},{"type":"text","value":") from which the point is being extracted needs to be specified as well.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"hDNmQS81MS"}],"key":"MzFb8ZWkgy"}],"visibility":"show","key":"y2ojvPLAZ2"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:42.566628Z","iopub.status.busy":"2021-05-11T14:51:42.565880Z","iopub.status.idle":"2021-05-11T14:51:42.587936Z","shell.execute_reply":"2021-05-11T14:51:42.586264Z"},"papermill":{"duration":0.037374,"end_time":"2021-05-11T14:51:42.588029","exception":false,"start_time":"2021-05-11T14:51:42.550655","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# DAPA URL\nurl = '{}/{}/{}/{}'.format(dapa_url, 'collections', collection, 'dapa/value/position')\n\n# Parameters for this request\nparams = {\n    'point': '11.49,48.05',\n    'time': '2018-04-01T00:00:00Z/2018-07-01T00:00:00Z',\n    'fields': 'NDVI=(B04-B08)/(B04%2BB08)',\n    'aggregate': 'min,max,avg'\n}\n\n# show point in the map\nlocation = list(reversed([float(coord) for coord in params['point'].split(',')]))\n\nm = Map(\n    basemap=basemap_to_tiles(basemaps.OpenStreetMap.Mapnik),\n    center=location,\n    zoom=10\n)\n\nmarker = Marker(location=location, draggable=False)\nm.add_layer(marker)\n\nm","visibility":"show","key":"Y92Mc4q7gD"},{"type":"output","id":"uEqPwPNC2z71fXbSyHCh-","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"4f4e03b2fad4451683dec8f3ded21928\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Map(center=[48.05, 11.49], controls=(ZoomControl(options=['position', 'zoom_in_text', 'zoom_in_title', 'zoom_o…","content_type":"text/plain"}}}],"visibility":"show","key":"l4VEU7v3k6"}],"visibility":"show","key":"AEycC8CVKl"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010688,"end_time":"2021-05-11T14:51:42.609425","exception":false,"start_time":"2021-05-11T14:51:42.598737","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build request URL and conduct request","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"RH53RbMmMi"}],"identifier":"build-request-url-and-conduct-request","label":"Build request URL and conduct request","html_id":"build-request-url-and-conduct-request","implicit":true,"key":"SS0sMUgVpk"}],"visibility":"show","key":"tyjzEAlCBV"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:42.635811Z","iopub.status.busy":"2021-05-11T14:51:42.635195Z","iopub.status.idle":"2021-05-11T14:51:48.284127Z","shell.execute_reply":"2021-05-11T14:51:48.284469Z"},"papermill":{"duration":5.664482,"end_time":"2021-05-11T14:51:48.284593","exception":false,"start_time":"2021-05-11T14:51:42.620111","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"params_str = \"&\".join(\"%s=%s\" % (k, v) for k,v in params.items())\nr = requests.get(url, params=params_str)\n\nprint('DAPA path: {}'.format(r.url.replace(service_url, '')))\nprint('Status code: {}'.format(r.status_code))","visibility":"show","key":"GLqghflbz1"},{"type":"output","id":"JZ9WrVw8d8suJqYQIynKA","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections/S2L2A/dapa/value/position?point=11.49,48.05&time=2018-04-01T00:00:00Z/2018-07-01T00:00:00Z&fields=NDVI=(B04-B08)/(B04%2BB08)&aggregate=min,max,avg\nStatus code: 200\n"}],"visibility":"show","key":"SIyxA9HnaE"}],"visibility":"show","key":"JIIchb4IzY"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010824,"end_time":"2021-05-11T14:51:48.306561","exception":false,"start_time":"2021-05-11T14:51:48.295737","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Show content (one value for each aggregation method)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"rPXAZbJzEs"}],"identifier":"show-content-one-value-for-each-aggregation-method","label":"Show content (one value for each aggregation method)","html_id":"show-content-one-value-for-each-aggregation-method","implicit":true,"key":"zzPu5tUdO2"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The response of this request returns plain text with values splitted by comma. The order of the values relates to the order of the fields specified in the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"HooGLQ1Af6"},{"type":"inlineCode","value":"fields","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"nSg2qZE0Wd"},{"type":"text","value":" parameter in combination with the order of the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"sBcZLJZsYb"},{"type":"inlineCode","value":"aggregation","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"viCuAuK9Tj"},{"type":"text","value":" functions. Additional output formats (e.g., CSV with headers included) will be integrated within the testbed activtiy.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yvVmw2jzrw"}],"key":"qlmwsGntDD"}],"visibility":"show","key":"Qpc8Nynq4u"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:48.331720Z","iopub.status.busy":"2021-05-11T14:51:48.330998Z","iopub.status.idle":"2021-05-11T14:51:48.333362Z","shell.execute_reply":"2021-05-11T14:51:48.333734Z"},"papermill":{"duration":0.016582,"end_time":"2021-05-11T14:51:48.333831","exception":false,"start_time":"2021-05-11T14:51:48.317249","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"values = r.text\nvalues","visibility":"show","key":"kbSZOFNrnc"},{"type":"output","id":"kVew9K5QdhN1jwJUhBcbq","data":[{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/plain":{"content":"'-0.8713367,0.039432675,-0.4004872'","content_type":"text/plain"}}}],"visibility":"show","key":"SH6oJb80X2"}],"visibility":"show","key":"TVinTwxZlD"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:48.359860Z","iopub.status.busy":"2021-05-11T14:51:48.359075Z","iopub.status.idle":"2021-05-11T14:51:48.362013Z","shell.execute_reply":"2021-05-11T14:51:48.362358Z"},"papermill":{"duration":0.017802,"end_time":"2021-05-11T14:51:48.362453","exception":false,"start_time":"2021-05-11T14:51:48.344651","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"print('%s: %s' % (params['aggregate'].split(',')[0], values.split(',')[0]))\nprint('%s: %s' % (params['aggregate'].split(',')[1], values.split(',')[1]))\nprint('%s: %s' % (params['aggregate'].split(',')[2], values.split(',')[2]))","visibility":"show","key":"lU4PqHjazA"},{"type":"output","id":"9q0IsZHYuiTx63LytChRQ","data":[{"name":"stdout","output_type":"stream","text":"min: -0.8713367\nmax: 0.039432675\navg: -0.4004872\n"}],"visibility":"show","key":"zphz2lW7Hu"}],"visibility":"show","key":"kv6NRlvajH"}],"key":"dcw1Ds3pfk"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"DAPA Tutorial #3: Timeseries - Sentinel-2","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/dapa/dapa-tutorial-3-timeseries-sentinel-2","group":"Contributions"},"next":{"title":"DAPA Tutorial #5: DEM","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/dapa/dapa-tutorial-5-dem","group":"Contributions"}}},"domain":"http://localhost:3000"}