{"version":1,"kind":"Notebook","sha256":"0e707f6923e32c21ac69ef2c2b78172ba318e866cf26e2f2a8d4f374e8ca7f58","slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-3-timeseries-sentinel-2","location":"/external_notebooks/eurodatacube/notebooks/notebooks/contributions/DAPA/DAPA_Tutorial_3_-_Timeseries_-_Sentinel-2.ipynb","dependencies":[],"frontmatter":{"title":"DAPA Tutorial #3: Timeseries - Sentinel-2","content_includes_title":false,"kernelspec":{"name":"edc","display_name":"EDC 0.19.6 (Python3)","language":"python"},"github":"https://github.com/eoxhub-workspaces/documentation/","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eoxhub-workspaces/documentation//blob/main/external_notebooks/eurodatacube/notebooks/notebooks/contributions/DAPA/DAPA_Tutorial_3_-_Timeseries_-_Sentinel-2.ipynb","exports":[{"format":"ipynb","filename":"DAPA_Tutorial_3_-_Timeseries_-_Sentinel-2.ipynb","url":"/notebooks_test/build/DAPA_Tutorial_3_-_Ti-6d04ad761526a88cbc251da8e63dd358.ipynb"}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"state":{"0e9c297c0f0c41e2af97f0fea4bde858":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"grab"}},"10cfe5fb67aa4e80b148039581256397":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"grab"}},"529c796347f84d079355c0d3418ae18c":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMarkerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMarkerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletMarkerView","alt":"","base":false,"bottom":false,"draggable":false,"icon":null,"keyboard":true,"location":[48.05,11.49],"name":"","opacity":1,"options":["alt","draggable","keyboard","rise_offset","rise_on_hover","rotation_angle","rotation_origin","title","z_index_offset"],"popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"rise_offset":250,"rise_on_hover":false,"rotation_angle":0,"rotation_origin":"","title":"","visible":true,"z_index_offset":0}},"5d2cc5daf751422481b146821e4d4089":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapModel","state":{"_dom_classes":[],"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletMapView","bottom":0,"bounce_at_zoom_limits":true,"box_zoom":true,"center":[48.05,11.49],"close_popup_on_click":true,"controls":["IPY_MODEL_86d239cd25d04297b03dcb18f34ab979","IPY_MODEL_dc29de61615845aa879ced0fd166fc48"],"crs":{"custom":false,"name":"EPSG3857"},"default_style":"IPY_MODEL_10cfe5fb67aa4e80b148039581256397","double_click_zoom":true,"dragging":true,"dragging_style":"IPY_MODEL_d929b8d638f34700a2218aef3da81905","east":0,"fullscreen":false,"inertia":true,"inertia_deceleration":3000,"inertia_max_speed":1500,"interpolation":"bilinear","keyboard":true,"keyboard_pan_offset":80,"keyboard_zoom_offset":1,"layers":["IPY_MODEL_dd0bc1cc39ee4b77ad1bcd67e77c7415","IPY_MODEL_529c796347f84d079355c0d3418ae18c"],"layout":"IPY_MODEL_991ca82fcf3649bdb78092718818688b","left":9007199254740991,"max_zoom":18,"min_zoom":1,"modisdate":"yesterday","north":0,"options":["bounce_at_zoom_limits","box_zoom","center","close_popup_on_click","double_click_zoom","dragging","fullscreen","inertia","inertia_deceleration","inertia_max_speed","interpolation","keyboard","keyboard_pan_offset","keyboard_zoom_offset","max_zoom","min_zoom","scroll_wheel_zoom","tap","tap_tolerance","touch_zoom","world_copy_jump","zoom","zoom_animation_threshold","zoom_delta","zoom_snap","zoom_start"],"right":0,"scroll_wheel_zoom":false,"south":0,"style":"IPY_MODEL_0e9c297c0f0c41e2af97f0fea4bde858","tap":true,"tap_tolerance":15,"top":9007199254740991,"touch_zoom":true,"west":0,"window_url":"","world_copy_jump":false,"zoom":10,"zoom_animation_threshold":4,"zoom_delta":1,"zoom_snap":1,"zoom_start":12}},"86d239cd25d04297b03dcb18f34ab979":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletZoomControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletZoomControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletZoomControlView","options":["position","zoom_in_text","zoom_in_title","zoom_out_text","zoom_out_title"],"position":"topleft","zoom_in_text":"+","zoom_in_title":"Zoom in","zoom_out_text":"-","zoom_out_title":"Zoom out"}},"991ca82fcf3649bdb78092718818688b":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"d929b8d638f34700a2218aef3da81905":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"move"}},"dc29de61615845aa879ced0fd166fc48":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletAttributionControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletAttributionControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletAttributionControlView","options":["position","prefix"],"position":"bottomright","prefix":"ipyleaflet"}},"dd0bc1cc39ee4b77ad1bcd67e77c7415":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletTileLayerView","attribution":"Map data (c) <a href=\"https://openstreetmap.org\">OpenStreetMap</a> contributors","base":true,"bottom":true,"detect_retina":false,"loading":false,"max_native_zoom":18,"max_zoom":19,"min_native_zoom":0,"min_zoom":1,"name":"OpenStreetMap.Mapnik","no_wrap":false,"opacity":1,"options":["attribution","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms"],"popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"tile_size":256,"tms":false,"url":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","visible":true}}},"version_major":2,"version_minor":0}},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.011533,"end_time":"2021-05-11T14:51:24.177611","exception":false,"start_time":"2021-05-11T14:51:24.166078","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load environment variables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"WXjb6swf8U"}],"identifier":"load-environment-variables","label":"Load environment variables","html_id":"load-environment-variables","implicit":true,"key":"D3fEO355oc"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Please make sure that the environment variable “DAPA_URL” is set in the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oszDd7VJLI"},{"type":"inlineCode","value":"custom.env","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MjAJkObPdx"},{"type":"text","value":" file. You can check this by executing the following block.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hhxiZZAKSW"}],"key":"z3m1IcBxyi"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"If DAPA_URL is not set, please create a text file named ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"sDdhd478ua"},{"type":"inlineCode","value":"custom.env","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"eApgKJckxc"},{"type":"text","value":" in your home directory with the following input:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"iqz1HMF7eo"}],"key":"LWBIWIN2Ai"},{"type":"blockquote","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"DAPA_URL=YOUR-PERSONAL-DAPA-APP-URL","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QCeY5ggO3X"}],"key":"R1eBIn4MhM"}],"key":"cBlleJ72a9"}],"visibility":"show","key":"saXHWK0FBr"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:24.204098Z","iopub.status.busy":"2021-05-11T14:51:24.203322Z","iopub.status.idle":"2021-05-11T14:51:24.253753Z","shell.execute_reply":"2021-05-11T14:51:24.253273Z"},"papermill":{"duration":0.064841,"end_time":"2021-05-11T14:51:24.253848","exception":false,"start_time":"2021-05-11T14:51:24.189007","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import setup_environment_variables\nsetup_environment_variables()","visibility":"show","key":"rNl3DeAcnl"},{"type":"output","id":"Wya7iDgeFBUpfMacvZace","data":[{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"API credentials have automatically been injected for your active subscriptions.  \nThe following environment variables are now available:\n\nThe following additional environment variables have been loaded from `~/custom.env`:\n* `AWS_BUCKET`\n* `DAPA_URL`\n* `DB_HOST`, `DB_NAME`, `DB_PASSWORD`, `DB_USER`\n* `OGC_EDC_URL`\n* `REFERENCE_DATA`\n","content_type":"text/markdown"},"text/plain":{"content":"<IPython.core.display.Markdown object>","content_type":"text/plain"}}}],"visibility":"show","key":"rhkSwSw3kY"}],"visibility":"show","key":"NfHDQRBGAW"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.011502,"end_time":"2021-05-11T14:51:24.276829","exception":false,"start_time":"2021-05-11T14:51:24.265327","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check notebook compabtibility","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IZkNo9surJ"}],"identifier":"check-notebook-compabtibility","label":"Check notebook compabtibility","html_id":"check-notebook-compabtibility","implicit":true,"key":"TRYeQ4QKVW"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Please note:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"H9Fa3DlU22"}],"key":"jgp1XfcKP7"},{"type":"text","value":" If you conduct this notebook again at a later time, the base image of this Jupyter Hub service can include newer versions of the libraries installed. Thus, the notebook execution can fail. This compatibility check is only necessary when something is broken.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Jj9TKCVQc7"}],"key":"FRGOY6ZDct"}],"visibility":"show","key":"criLpy0noT"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:24.303077Z","iopub.status.busy":"2021-05-11T14:51:24.302403Z","iopub.status.idle":"2021-05-11T14:51:24.305632Z","shell.execute_reply":"2021-05-11T14:51:24.305975Z"},"papermill":{"duration":0.017808,"end_time":"2021-05-11T14:51:24.306073","exception":false,"start_time":"2021-05-11T14:51:24.288265","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-0.24.5\", dependencies=[])","visibility":"show","key":"nfnFGDprif"},{"type":"output","id":"MmSDbZzlzxJMPJSlUCBO3","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<script type=\"text/javascript\">\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    </script>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-0.24.5).","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"visibility":"show","key":"NyCz1c9XEM"}],"visibility":"show","key":"jZyQYArBOk"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012731,"end_time":"2021-05-11T14:51:24.330746","exception":false,"start_time":"2021-05-11T14:51:24.318015","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"pXKTlY3fWi"}],"identifier":"load-libraries","label":"Load libraries","html_id":"load-libraries","implicit":true,"key":"twx1urKX7q"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Python libraries used in this tutorial will be loaded.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"U2vNdY5suM"}],"key":"Aed6x0pD8F"}],"visibility":"show","key":"BIYWpBcuUq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:24.362141Z","iopub.status.busy":"2021-05-11T14:51:24.361637Z","iopub.status.idle":"2021-05-11T14:51:25.538578Z","shell.execute_reply":"2021-05-11T14:51:25.538051Z"},"papermill":{"duration":1.19599,"end_time":"2021-05-11T14:51:25.538697","exception":false,"start_time":"2021-05-11T14:51:24.342707","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport xarray as xr\nimport pandas as pd\nimport requests\nimport matplotlib\nfrom ipyleaflet import Map, Rectangle, Marker, DrawControl, basemaps, basemap_to_tiles\n%matplotlib inline","visibility":"show","key":"DdLTnZaXIt"},{"type":"output","id":"1zE_BjVDawLtvhzT1cPZL","data":[],"visibility":"show","key":"jzItH5EQXN"}],"visibility":"show","key":"cWam2OWupK"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012265,"end_time":"2021-05-11T14:51:25.563720","exception":false,"start_time":"2021-05-11T14:51:25.551455","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set DAPA endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TUhpA3o3nB"}],"identifier":"set-dapa-endpoint","label":"Set DAPA endpoint","html_id":"set-dapa-endpoint","implicit":true,"key":"xrvFdYGKFW"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Execute the following code to check if the DAPA_URL is available in the environment variable and to set the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"u9ghHspqvX"},{"type":"inlineCode","value":"/dapa","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"WXQ85GDKrA"},{"type":"text","value":" endpoint.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Fmgnwo3XSw"}],"key":"RUIg8XdVYp"}],"visibility":"show","key":"UHlF3eUriu"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:25.592502Z","iopub.status.busy":"2021-05-11T14:51:25.591959Z","iopub.status.idle":"2021-05-11T14:51:25.594123Z","shell.execute_reply":"2021-05-11T14:51:25.594467Z"},"papermill":{"duration":0.018329,"end_time":"2021-05-11T14:51:25.594572","exception":false,"start_time":"2021-05-11T14:51:25.576243","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"service_url = None\ndapa_url = None\n\nif 'DAPA_URL' not in os.environ:\n    print('!! DAPA_URL does not exist as environment variable. Please make sure this is the case - see first block of this notebook! !!')\nelse:    \n    service_url = os.environ['DAPA_URL']\n    dapa_url = '{}/{}'.format(service_url, 'oapi')\n    print('DAPA path: {}'.format(dapa_url.replace(service_url, '')))","visibility":"show","key":"GCBvdZGjlk"},{"type":"output","id":"mbIO7JgehUiG8IvQ2WsJd","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi\n"}],"visibility":"show","key":"EeEFzPFTEr"}],"visibility":"show","key":"oglPGbaMqg"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012214,"end_time":"2021-05-11T14:51:25.618986","exception":false,"start_time":"2021-05-11T14:51:25.606772","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get collections supported by this endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Um4ug6b6sl"}],"identifier":"get-collections-supported-by-this-endpoint","label":"Get collections supported by this endpoint","html_id":"get-collections-supported-by-this-endpoint","implicit":true,"key":"emLeSvcSWi"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This request provides a list of collections. The path of each collection is used as starting path of this service.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YcNI4KFP7v"}],"key":"J7YyO0SPbI"}],"visibility":"show","key":"Po4k0M6N4B"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:25.651021Z","iopub.status.busy":"2021-05-11T14:51:25.650449Z","iopub.status.idle":"2021-05-11T14:51:25.731046Z","shell.execute_reply":"2021-05-11T14:51:25.731438Z"},"papermill":{"duration":0.100429,"end_time":"2021-05-11T14:51:25.731566","exception":false,"start_time":"2021-05-11T14:51:25.631137","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"collections_url = '{}/{}'.format(dapa_url, 'collections')\ncollections = requests.get(collections_url, headers={'Accept': 'application/json'})\n\nprint('DAPA path: {}'.format(collections.url.replace(service_url, '')))\ncollections.json()","visibility":"show","key":"somyhOtCAI"},{"type":"output","id":"ZSYaM2-5vZe9nzvA6Lzuc","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections\n"},{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"['/oapi/collections/DEM/',\n '/oapi/collections/L8L1C/',\n '/oapi/collections/S1GRD/',\n '/oapi/collections/S2L1C/',\n '/oapi/collections/S2L2A/',\n '/oapi/collections/S3OLCI/',\n '/oapi/collections/S3SLSTR/',\n '/oapi/collections/S5PL2/',\n '/oapi/collections/MODIS/']","content_type":"text/plain"}}}],"visibility":"show","key":"gqbcpFIJSo"}],"visibility":"show","key":"y5CDlf4mZs"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012679,"end_time":"2021-05-11T14:51:25.757116","exception":false,"start_time":"2021-05-11T14:51:25.744437","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get fields of collection Sentinel-2 L2A","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zKzsZBFwI2"}],"identifier":"get-fields-of-collection-sentinel-2-l2a","label":"Get fields of collection Sentinel-2 L2A","html_id":"get-fields-of-collection-sentinel-2-l2a","implicit":true,"key":"ygwZnACMSF"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The fields (or variables in other DAPA endpoints - these are the bands of the raster data) can be retrieved in all requests to the DAPA endpoint. In addition to the fixed set of fields, “virtual” fields can be used to conduct math operations (e.g., the calculation of indices).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vquY9eXJiU"}],"key":"pDiTFNASge"}],"visibility":"show","key":"CfvLKvVnnp"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:25.785708Z","iopub.status.busy":"2021-05-11T14:51:25.785206Z","iopub.status.idle":"2021-05-11T14:51:25.812966Z","shell.execute_reply":"2021-05-11T14:51:25.812486Z"},"papermill":{"duration":0.043521,"end_time":"2021-05-11T14:51:25.813054","exception":false,"start_time":"2021-05-11T14:51:25.769533","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"collection = 'S2L2A'\n\nfields_url = '{}/{}/{}/{}'.format(dapa_url, 'collections', collection, 'dapa/fields')\nfields = requests.get(fields_url, headers={'Accept': 'application/json'})\n\nprint('DAPA path: {}'.format(fields.url.replace(service_url, '')))\nfields.json()","visibility":"show","key":"loF7OBt18Q"},{"type":"output","id":"PFjN7atFT9T4Wa-WVnQZm","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections/S2L2A/dapa/fields\n"},{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"[{'id': 'B01', 'wavelength': 442.7},\n {'id': 'B02', 'wavelength': 492.4},\n {'id': 'B03', 'wavelength': 559.8},\n {'id': 'B04', 'wavelength': 664.6},\n {'id': 'B05', 'wavelength': 704.1},\n {'id': 'B06', 'wavelength': 740.5},\n {'id': 'B07', 'wavelength': 782.8},\n {'id': 'B08', 'wavelength': 832.8},\n {'id': 'B8A', 'wavelength': 864.7},\n {'id': 'B09', 'wavelength': 945.1},\n {'id': 'B11', 'wavelength': 1613.7},\n {'id': 'B12', 'wavelength': 2202.4},\n {'id': 'SCL', 'wavelength': None},\n {'id': 'SNW', 'wavelength': None},\n {'id': 'CLD', 'wavelength': None}]","content_type":"text/plain"}}}],"visibility":"show","key":"U0C6cClH1R"}],"visibility":"show","key":"skwbrcZsAi"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012959,"end_time":"2021-05-11T14:51:25.839002","exception":false,"start_time":"2021-05-11T14:51:25.826043","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve NDVI as 1d time-series extraced for a single point","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"n7r3I1bTZm"}],"identifier":"retrieve-ndvi-as-1d-time-series-extraced-for-a-single-point","label":"Retrieve NDVI as 1d time-series extraced for a single point","html_id":"retrieve-ndvi-as-1d-time-series-extraced-for-a-single-point","implicit":true,"key":"JibAugZFnk"}],"visibility":"show","key":"KlNymrzyu1"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012995,"end_time":"2021-05-11T14:51:25.865057","exception":false,"start_time":"2021-05-11T14:51:25.852062","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set DAPA URL and parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yTs7KfQGPv"}],"identifier":"set-dapa-url-and-parameters","label":"Set DAPA URL and parameters","html_id":"set-dapa-url-and-parameters","implicit":true,"key":"FQLn6eNQtv"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The output of this request is a time-series requested from a point of interest (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"v3SjtfiZsX"},{"type":"inlineCode","value":"timeseries/position","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wDophYUuHx"},{"type":"text","value":" endpoint). As the input collection (S2L2A) is a multi-temporal raster and the requested geometry is a point, no aggregation is conducted.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"wfo0IxGKWf"}],"key":"dpyAMLCGft"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To retrieve a time-series of a point, the parameter ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Ot1WjpswMs"},{"type":"inlineCode","value":"point","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"uNl8rpFtr5"},{"type":"text","value":" needs to be provided. The ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"j3fPUJaSFV"},{"type":"inlineCode","value":"time","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"DpxYoCtAI1"},{"type":"text","value":" parameter allows to extract data only within a specific time span. The band (","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"IGKldWZfHe"},{"type":"inlineCode","value":"field","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RYnLBOsAJ5"},{"type":"text","value":") from which the point is being extracted needs to be specified as well.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"tDElKP6MaZ"}],"key":"ihkmdemL2Y"}],"visibility":"show","key":"f5zQuvhA0Q"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:25.902659Z","iopub.status.busy":"2021-05-11T14:51:25.900825Z","iopub.status.idle":"2021-05-11T14:51:25.917673Z","shell.execute_reply":"2021-05-11T14:51:25.915106Z"},"papermill":{"duration":0.039688,"end_time":"2021-05-11T14:51:25.917760","exception":false,"start_time":"2021-05-11T14:51:25.878072","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# DAPA URL\nurl = '{}/{}/{}/{}'.format(dapa_url, 'collections', collection, 'dapa/timeseries/position')\n\n# Parameters for this request\nparams = {\n    'point': '11.49,48.05',\n    'time': '2018-04-01T00:00:00Z/2018-05-01T00:00:00Z',\n    'fields': 'NDVI=(B08-B04)/(B08%2BB04)'    # Please note: + signs need to be URL encoded -> %2B\n}\n\n# show point in the map\nlocation = list(reversed([float(coord) for coord in params['point'].split(',')]))\nm = Map(\n    basemap=basemap_to_tiles(basemaps.OpenStreetMap.Mapnik),\n    center=location,\n    zoom=10\n)\n\nmarker = Marker(location=location, draggable=False)\nm.add_layer(marker)\n\nm","visibility":"show","key":"alFDrpvgt9"},{"type":"output","id":"3-Pbke8a6AK3yEsGCfvqH","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"5d2cc5daf751422481b146821e4d4089\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Map(center=[48.05, 11.49], controls=(ZoomControl(options=['position', 'zoom_in_text', 'zoom_in_title', 'zoom_o…","content_type":"text/plain"}}}],"visibility":"show","key":"OHYm5RM3fb"}],"visibility":"show","key":"wnjcduPyOb"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.021302,"end_time":"2021-05-11T14:51:25.952620","exception":false,"start_time":"2021-05-11T14:51:25.931318","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build request URL and conduct request","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"c47QrlRs68"}],"identifier":"build-request-url-and-conduct-request","label":"Build request URL and conduct request","html_id":"build-request-url-and-conduct-request","implicit":true,"key":"W0PwKTxwyH"}],"visibility":"show","key":"dqneqkLEKo"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:25.984495Z","iopub.status.busy":"2021-05-11T14:51:25.983830Z","iopub.status.idle":"2021-05-11T14:51:29.192201Z","shell.execute_reply":"2021-05-11T14:51:29.192536Z"},"papermill":{"duration":3.226748,"end_time":"2021-05-11T14:51:29.192661","exception":false,"start_time":"2021-05-11T14:51:25.965913","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"params_str = \"&\".join(\"%s=%s\" % (k, v) for k,v in params.items())\nr = requests.get(url, params=params_str)\n\nprint('DAPA path: {}'.format(r.url.replace(service_url, '')))\nprint('Status code: {}'.format(r.status_code))","visibility":"show","key":"FiwWlC3VFh"},{"type":"output","id":"Ar92gafy9N0XxWl-5sscy","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections/S2L2A/dapa/timeseries/position?point=11.49,48.05&time=2018-04-01T00:00:00Z/2018-05-01T00:00:00Z&fields=NDVI=(B08-B04)/(B08%2BB04)\nStatus code: 200\n"}],"visibility":"show","key":"G6ox0lYS5z"}],"visibility":"show","key":"xJQKV9ePa7"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.013554,"end_time":"2021-05-11T14:51:29.220113","exception":false,"start_time":"2021-05-11T14:51:29.206559","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Write timeseries dataset to CSV file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OwIA5mOnxw"}],"identifier":"write-timeseries-dataset-to-csv-file","label":"Write timeseries dataset to CSV file","html_id":"write-timeseries-dataset-to-csv-file","implicit":true,"key":"a4CzyBvMp1"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The response of this request returns data as CSV including headers splitted by comma. Additional output formats (e.g., CSV with headers included) will be integrated within the testbed activtiy.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"TiRRtlXi7v"}],"key":"tsn1p7vZfh"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"You can either write the response to file or use it as string (","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"HvWhkfAftT"},{"type":"inlineCode","value":"r.content","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"dJKKCSmbxr"},{"type":"text","value":" variable).","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Nac43CecAU"}],"key":"hDWpqPGYPC"}],"visibility":"show","key":"AcDPOWBxf2"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:29.250301Z","iopub.status.busy":"2021-05-11T14:51:29.249795Z","iopub.status.idle":"2021-05-11T14:51:29.251980Z","shell.execute_reply":"2021-05-11T14:51:29.251454Z"},"papermill":{"duration":0.018327,"end_time":"2021-05-11T14:51:29.252068","exception":false,"start_time":"2021-05-11T14:51:29.233741","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# write time-series data to CSV file\nwith open('timeseries_s2.csv', 'wb') as filew:\n    filew.write(r.content)","visibility":"show","key":"JPV1xC2prA"},{"type":"output","id":"a8dgxFR4tNlm46lbFy-Sq","data":[],"visibility":"show","key":"nEi9q7IGml"}],"visibility":"show","key":"SCsllW6yBS"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.014449,"end_time":"2021-05-11T14:51:29.285334","exception":false,"start_time":"2021-05-11T14:51:29.270885","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open timeseries dataset with pandas","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bqurQyVt6R"}],"identifier":"open-timeseries-dataset-with-pandas","label":"Open timeseries dataset with pandas","html_id":"open-timeseries-dataset-with-pandas","implicit":true,"key":"SLMSPiL5PQ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Time-series data can be opened, processed, and plotted easily with the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"YLM0NTXfQ2"},{"type":"inlineCode","value":"Pandas","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"tiukU7uFoB"},{"type":"text","value":" library. You only need to specify the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"hm7ZoRyBVt"},{"type":"inlineCode","value":"datetime","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"AmEZgbwTGx"},{"type":"text","value":" column to automatically convert dates from string to a datetime object.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"MovmaR1bxE"}],"key":"Jx9JzAJkkc"}],"visibility":"show","key":"yXtrWZTaz3"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:29.315925Z","iopub.status.busy":"2021-05-11T14:51:29.315424Z","iopub.status.idle":"2021-05-11T14:51:29.328339Z","shell.execute_reply":"2021-05-11T14:51:29.327912Z"},"papermill":{"duration":0.029651,"end_time":"2021-05-11T14:51:29.328436","exception":false,"start_time":"2021-05-11T14:51:29.298785","status":"completed"},"scrolled":true,"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# read data into Pandas dataframe\nds = pd.read_csv('timeseries_s2.csv', parse_dates=['datetime'])\n\n# set index to datetime column\nds.set_index('datetime', inplace=True)\n\n# show dataframe\nds","visibility":"show","key":"zG7GpjPnsK"},{"type":"output","id":"FqnoC9qJY6y2EF6rXJmWt","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>NDVI</th>\n    </tr>\n    <tr>\n      <th>datetime</th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2018-04-02 10:24:35+00:00</th>\n      <td>0.701217</td>\n    </tr>\n    <tr>\n      <th>2018-04-04 10:10:21+00:00</th>\n      <td>0.229457</td>\n    </tr>\n    <tr>\n      <th>2018-04-07 10:20:20+00:00</th>\n      <td>0.833333</td>\n    </tr>\n    <tr>\n      <th>2018-04-09 10:13:43+00:00</th>\n      <td>0.634615</td>\n    </tr>\n    <tr>\n      <th>2018-04-12 10:20:24+00:00</th>\n      <td>0.100667</td>\n    </tr>\n    <tr>\n      <th>2018-04-14 10:15:36+00:00</th>\n      <td>0.509171</td>\n    </tr>\n    <tr>\n      <th>2018-04-17 10:20:21+00:00</th>\n      <td>0.497207</td>\n    </tr>\n    <tr>\n      <th>2018-04-19 10:14:57+00:00</th>\n      <td>0.686788</td>\n    </tr>\n    <tr>\n      <th>2018-04-22 10:21:15+00:00</th>\n      <td>0.671642</td>\n    </tr>\n    <tr>\n      <th>2018-04-24 10:15:26+00:00</th>\n      <td>0.016803</td>\n    </tr>\n    <tr>\n      <th>2018-04-27 10:20:22+00:00</th>\n      <td>0.774345</td>\n    </tr>\n    <tr>\n      <th>2018-04-29 10:12:58+00:00</th>\n      <td>0.214486</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"                               NDVI\ndatetime                           \n2018-04-02 10:24:35+00:00  0.701217\n2018-04-04 10:10:21+00:00  0.229457\n2018-04-07 10:20:20+00:00  0.833333\n2018-04-09 10:13:43+00:00  0.634615\n2018-04-12 10:20:24+00:00  0.100667\n2018-04-14 10:15:36+00:00  0.509171\n2018-04-17 10:20:21+00:00  0.497207\n2018-04-19 10:14:57+00:00  0.686788\n2018-04-22 10:21:15+00:00  0.671642\n2018-04-24 10:15:26+00:00  0.016803\n2018-04-27 10:20:22+00:00  0.774345\n2018-04-29 10:12:58+00:00  0.214486","content_type":"text/plain"}}}],"visibility":"show","key":"pS38LRLYmd"}],"visibility":"show","key":"IpzNu5z5BX"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.014261,"end_time":"2021-05-11T14:51:29.356960","exception":false,"start_time":"2021-05-11T14:51:29.342699","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot NDVI data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"MfDLQP53uo"}],"identifier":"plot-ndvi-data","label":"Plot NDVI data","html_id":"plot-ndvi-data","implicit":true,"key":"ktxOZ47cRF"}],"visibility":"show","key":"PeGiDpWFae"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:29.388147Z","iopub.status.busy":"2021-05-11T14:51:29.387657Z","iopub.status.idle":"2021-05-11T14:51:29.550786Z","shell.execute_reply":"2021-05-11T14:51:29.550272Z"},"papermill":{"duration":0.179878,"end_time":"2021-05-11T14:51:29.550884","exception":false,"start_time":"2021-05-11T14:51:29.371006","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds.plot()","visibility":"show","key":"lIGEbc0Jsn"},{"type":"output","id":"ZzXkRTOOhUwEhx-u8bgxz","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"fd2dfca41eebcb0c22be23ad7f801496","path":"/notebooks_test/build/fd2dfca41eebcb0c22be23ad7f801496.png"},"text/plain":{"content":"<Figure size 432x288 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"Oiba047sqS"}],"visibility":"show","key":"w1y6wgSbyb"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.01493,"end_time":"2021-05-11T14:51:29.583236","exception":false,"start_time":"2021-05-11T14:51:29.568306","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Output CSV file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"h9mcIfBFwq"}],"identifier":"output-csv-file","label":"Output CSV file","html_id":"output-csv-file","implicit":true,"key":"nSYk50swCa"}],"visibility":"show","key":"UouRknXdYo"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:29.615817Z","iopub.status.busy":"2021-05-11T14:51:29.615274Z","iopub.status.idle":"2021-05-11T14:51:30.245105Z","shell.execute_reply":"2021-05-11T14:51:30.244657Z"},"papermill":{"duration":0.647059,"end_time":"2021-05-11T14:51:30.245204","exception":false,"start_time":"2021-05-11T14:51:29.598145","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"!cat timeseries_s2.csv","visibility":"show","key":"nQO3KEglqU"},{"type":"output","id":"ISGzeWro35Qi0uHCuDIDk","data":[{"name":"stdout","output_type":"stream","text":"datetime,NDVI\r\r\n2018-04-02T10:24:35Z,0.7012165\r\r\n2018-04-04T10:10:21Z,0.22945666\r\r\n2018-04-07T10:20:20Z,0.8333333\r\r\n2018-04-09T10:13:43Z,0.63461536\r\r\n2018-04-12T10:20:24Z,0.10066674\r\r\n2018-04-14T10:15:36Z,0.5091714\r\r\n2018-04-17T10:20:21Z,0.49720672\r\r\n2018-04-19T10:14:57Z,0.68678766\r\r\n2018-04-22T10:21:15Z,0.67164177\r\r\n2018-04-24T10:15:26Z,0.0168028\r\r\n2018-04-27T10:20:22Z,0.77434456\r\r\n2018-04-29T10:12:58Z,0.2144858\r\r\n"}],"visibility":"show","key":"tNJzbnpD5R"}],"visibility":"show","key":"xoI74fBgbn"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.015061,"end_time":"2021-05-11T14:51:30.275518","exception":false,"start_time":"2021-05-11T14:51:30.260457","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Time-series aggregated over area","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Cp9xghn4OB"}],"identifier":"time-series-aggregated-over-area","label":"Time-series aggregated over area","html_id":"time-series-aggregated-over-area","implicit":true,"key":"UeU7Nuy1LF"}],"visibility":"show","key":"iMM5fZwWVk"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:30.314780Z","iopub.status.busy":"2021-05-11T14:51:30.314130Z","iopub.status.idle":"2021-05-11T14:51:38.253882Z","shell.execute_reply":"2021-05-11T14:51:38.254376Z"},"papermill":{"duration":7.96391,"end_time":"2021-05-11T14:51:38.254548","exception":false,"start_time":"2021-05-11T14:51:30.290638","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# DAPA URL\nurl = '{}/{}/{}/{}'.format(dapa_url, 'collections', collection, 'dapa/timeseries/area')\n\n# Parameters for this request\nparams = {\n    #'point': '11.49,48.05',\n    'bbox': '11.49,48.05,11.66,48.22',\n    'aggregate': 'min,max,avg',\n    'time': '2018-04-01T00:00:00Z/2018-05-01T00:00:00Z',\n    'fields': 'NDVI=(B08-B04)/(B08%2BB04)'    # Please note: + signs need to be URL encoded -> %2B\n}\n\nparams_str = \"&\".join(\"%s=%s\" % (k, v) for k,v in params.items())\nr = requests.get(url, params=params_str)\n\nprint('DAPA path: {}'.format(r.url.replace(service_url, '')))\nprint('Status code: {}'.format(r.status_code))","visibility":"show","key":"baZbJIA4Au"},{"type":"output","id":"0eWHcVw4ZnvSExCYVAC6v","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections/S2L2A/dapa/timeseries/area?bbox=11.49,48.05,11.66,48.22&aggregate=min,max,avg&time=2018-04-01T00:00:00Z/2018-05-01T00:00:00Z&fields=NDVI=(B08-B04)/(B08%2BB04)\nStatus code: 200\n"}],"visibility":"show","key":"SSiGC2DWZh"}],"visibility":"show","key":"ExHAgvfcSV"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:38.292255Z","iopub.status.busy":"2021-05-11T14:51:38.291710Z","iopub.status.idle":"2021-05-11T14:51:38.300200Z","shell.execute_reply":"2021-05-11T14:51:38.300531Z"},"papermill":{"duration":0.03024,"end_time":"2021-05-11T14:51:38.300661","exception":false,"start_time":"2021-05-11T14:51:38.270421","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# read data into Pandas dataframe\nfrom io import StringIO\nds = pd.read_csv(StringIO(r.text), parse_dates=['datetime'])\n\n# set index to datetime column\nds.set_index('datetime', inplace=True)\n\n# show dataframe\nds","visibility":"show","key":"acIpjzjZfd"},{"type":"output","id":"dBaEXe6txPqZgG1B2UfeG","data":[{"output_type":"execute_result","execution_count":14,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>NDVI_min</th>\n      <th>NDVI_max</th>\n      <th>NDVI_avg</th>\n    </tr>\n    <tr>\n      <th>datetime</th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>2018-04-02 10:24:35+00:00</th>\n      <td>-1.000000</td>\n      <td>1.000000</td>\n      <td>0.351652</td>\n    </tr>\n    <tr>\n      <th>2018-04-04 10:10:21+00:00</th>\n      <td>-0.089418</td>\n      <td>0.601969</td>\n      <td>0.146855</td>\n    </tr>\n    <tr>\n      <th>2018-04-07 10:20:20+00:00</th>\n      <td>-1.000000</td>\n      <td>1.000000</td>\n      <td>0.366545</td>\n    </tr>\n    <tr>\n      <th>2018-04-09 10:13:43+00:00</th>\n      <td>-0.236350</td>\n      <td>0.874247</td>\n      <td>0.190702</td>\n    </tr>\n    <tr>\n      <th>2018-04-12 10:20:24+00:00</th>\n      <td>-0.086605</td>\n      <td>0.435908</td>\n      <td>0.096532</td>\n    </tr>\n    <tr>\n      <th>2018-04-14 10:15:36+00:00</th>\n      <td>-0.210497</td>\n      <td>0.798558</td>\n      <td>0.313741</td>\n    </tr>\n    <tr>\n      <th>2018-04-17 10:20:21+00:00</th>\n      <td>-0.565506</td>\n      <td>0.914530</td>\n      <td>0.217762</td>\n    </tr>\n    <tr>\n      <th>2018-04-19 10:14:57+00:00</th>\n      <td>-1.000000</td>\n      <td>1.000000</td>\n      <td>0.428746</td>\n    </tr>\n    <tr>\n      <th>2018-04-22 10:21:15+00:00</th>\n      <td>-1.000000</td>\n      <td>1.000000</td>\n      <td>0.459265</td>\n    </tr>\n    <tr>\n      <th>2018-04-24 10:15:26+00:00</th>\n      <td>-0.377535</td>\n      <td>1.000000</td>\n      <td>0.289178</td>\n    </tr>\n    <tr>\n      <th>2018-04-27 10:20:22+00:00</th>\n      <td>-1.000000</td>\n      <td>1.000000</td>\n      <td>0.490446</td>\n    </tr>\n    <tr>\n      <th>2018-04-29 10:12:58+00:00</th>\n      <td>-0.006635</td>\n      <td>0.830065</td>\n      <td>0.230646</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"                           NDVI_min  NDVI_max  NDVI_avg\ndatetime                                               \n2018-04-02 10:24:35+00:00 -1.000000  1.000000  0.351652\n2018-04-04 10:10:21+00:00 -0.089418  0.601969  0.146855\n2018-04-07 10:20:20+00:00 -1.000000  1.000000  0.366545\n2018-04-09 10:13:43+00:00 -0.236350  0.874247  0.190702\n2018-04-12 10:20:24+00:00 -0.086605  0.435908  0.096532\n2018-04-14 10:15:36+00:00 -0.210497  0.798558  0.313741\n2018-04-17 10:20:21+00:00 -0.565506  0.914530  0.217762\n2018-04-19 10:14:57+00:00 -1.000000  1.000000  0.428746\n2018-04-22 10:21:15+00:00 -1.000000  1.000000  0.459265\n2018-04-24 10:15:26+00:00 -0.377535  1.000000  0.289178\n2018-04-27 10:20:22+00:00 -1.000000  1.000000  0.490446\n2018-04-29 10:12:58+00:00 -0.006635  0.830065  0.230646","content_type":"text/plain"}}}],"visibility":"show","key":"jRDNo4jm5b"}],"visibility":"show","key":"HSFe7SLw1e"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:38.339966Z","iopub.status.busy":"2021-05-11T14:51:38.339047Z","iopub.status.idle":"2021-05-11T14:51:38.512756Z","shell.execute_reply":"2021-05-11T14:51:38.513116Z"},"papermill":{"duration":0.196694,"end_time":"2021-05-11T14:51:38.513224","exception":false,"start_time":"2021-05-11T14:51:38.316530","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds.plot()","visibility":"show","key":"m79FIyZGcu"},{"type":"output","id":"o-tkryUYmXhKB3HDtYBMM","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"2a7d3198f60a2e35dc1d7b9c0a30f894","path":"/notebooks_test/build/2a7d3198f60a2e35dc1d7b9c0a30f894.png"},"text/plain":{"content":"<Figure size 432x288 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"cSynUo7066"}],"visibility":"show","key":"YYFsx2NI6u"}],"key":"Je4bLyt8rq"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"DAPA Tutorial #2: Area - Sentinel-2","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/dapa/dapa-tutorial-2-area-sentinel-2","group":"Contributions"},"next":{"title":"DAPA Tutorial #4: Value - Sentinel-2","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/dapa/dapa-tutorial-4-value-sentinel-2","group":"Contributions"}}},"domain":"http://localhost:3000"}