{"version":1,"kind":"Notebook","sha256":"9bcdeb9635fbeb35ff2bfc0ad54f42686a7d00639fc1e3b734a14d62d34dff0d","slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.dapa.dapa-tutorial-2-area-sentinel-2","location":"/external_notebooks/eurodatacube/notebooks/notebooks/contributions/DAPA/DAPA_Tutorial_2_-_Area_-_Sentinel-2.ipynb","dependencies":[],"frontmatter":{"title":"DAPA Tutorial #2: Area - Sentinel-2","content_includes_title":false,"kernelspec":{"name":"edc","display_name":"EDC 0.19.6 (Python3)","language":"python"},"github":"https://github.com/eoxhub-workspaces/documentation/","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eoxhub-workspaces/documentation//blob/main/external_notebooks/eurodatacube/notebooks/notebooks/contributions/DAPA/DAPA_Tutorial_2_-_Area_-_Sentinel-2.ipynb","exports":[{"format":"ipynb","filename":"DAPA_Tutorial_2_-_Area_-_Sentinel-2.ipynb","url":"/notebooks_test/build/DAPA_Tutorial_2_-_Ar-01cb7863fa396fedeb1f24b8d861ade2.ipynb"}]},"widgets":{"application/vnd.jupyter.widget-state+json":{"state":{"021a00b876534269a12cdff4e0d8ecb5":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletRectangleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletRectangleModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletRectangleView","base":false,"bottom":false,"bounds":[[48.05,11.49],[48.22,11.66]],"color":"#0033FF","dash_array":null,"draggable":false,"fill":true,"fill_color":null,"fill_opacity":0.2,"line_cap":"round","line_join":"round","locations":[],"name":"","no_clip":true,"opacity":1,"options":["color","dash_array","draggable","fill","fill_color","fill_opacity","line_cap","line_join","no_clip","opacity","pointer_events","smooth_factor","stroke","transform","weight"],"pointer_events":"","popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"rotation":true,"scaling":true,"smooth_factor":1,"stroke":true,"transform":false,"uniform_scaling":false,"weight":5}},"1a6c764dce0d4707bd598574bad8b913":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"move"}},"1e5eaf0717dd43408a1c0e70bc4fe41f":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletTileLayerModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletTileLayerModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletTileLayerView","attribution":"Map data (c) <a href=\"https://openstreetmap.org\">OpenStreetMap</a> contributors","base":true,"bottom":true,"detect_retina":false,"loading":false,"max_native_zoom":18,"max_zoom":19,"min_native_zoom":0,"min_zoom":1,"name":"OpenStreetMap.Mapnik","no_wrap":false,"opacity":1,"options":["attribution","detect_retina","max_native_zoom","max_zoom","min_native_zoom","min_zoom","no_wrap","tile_size","tms"],"popup":null,"popup_max_height":null,"popup_max_width":300,"popup_min_width":50,"show_loading":false,"tile_size":256,"tms":false,"url":"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","visible":true}},"2159ae5f87d94b4d9a4692ec8b79d734":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"grab"}},"8c1fcaf03e984995968d615cd577da6e":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapStyleModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapStyleModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"StyleView","cursor":"grab"}},"8d8888b2ab7a45ba8b8c17eb3fc81e27":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletMapModel","state":{"_dom_classes":[],"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletMapModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletMapView","bottom":0,"bounce_at_zoom_limits":true,"box_zoom":true,"center":[48.14,11.56],"close_popup_on_click":true,"controls":["IPY_MODEL_9310232e439749f98d39fc59c9dcb3c6","IPY_MODEL_ef4a8a51868646809e2f7aa018cc31fa"],"crs":{"custom":false,"name":"EPSG3857"},"default_style":"IPY_MODEL_8c1fcaf03e984995968d615cd577da6e","double_click_zoom":true,"dragging":true,"dragging_style":"IPY_MODEL_1a6c764dce0d4707bd598574bad8b913","east":0,"fullscreen":false,"inertia":true,"inertia_deceleration":3000,"inertia_max_speed":1500,"interpolation":"bilinear","keyboard":true,"keyboard_pan_offset":80,"keyboard_zoom_offset":1,"layers":["IPY_MODEL_1e5eaf0717dd43408a1c0e70bc4fe41f","IPY_MODEL_021a00b876534269a12cdff4e0d8ecb5"],"layout":"IPY_MODEL_940c9ae3def34076987c8cfb9ff0caeb","left":9007199254740991,"max_zoom":18,"min_zoom":1,"modisdate":"yesterday","north":0,"options":["bounce_at_zoom_limits","box_zoom","center","close_popup_on_click","double_click_zoom","dragging","fullscreen","inertia","inertia_deceleration","inertia_max_speed","interpolation","keyboard","keyboard_pan_offset","keyboard_zoom_offset","max_zoom","min_zoom","scroll_wheel_zoom","tap","tap_tolerance","touch_zoom","world_copy_jump","zoom","zoom_animation_threshold","zoom_delta","zoom_snap","zoom_start"],"right":0,"scroll_wheel_zoom":false,"south":0,"style":"IPY_MODEL_2159ae5f87d94b4d9a4692ec8b79d734","tap":true,"tap_tolerance":15,"top":9007199254740991,"touch_zoom":true,"west":0,"window_url":"","world_copy_jump":false,"zoom":10,"zoom_animation_threshold":4,"zoom_delta":1,"zoom_snap":1,"zoom_start":12}},"9310232e439749f98d39fc59c9dcb3c6":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletZoomControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletZoomControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletZoomControlView","options":["position","zoom_in_text","zoom_in_title","zoom_out_text","zoom_out_title"],"position":"topleft","zoom_in_text":"+","zoom_in_title":"Zoom in","zoom_out_text":"-","zoom_out_title":"Zoom out"}},"940c9ae3def34076987c8cfb9ff0caeb":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ef4a8a51868646809e2f7aa018cc31fa":{"model_module":"jupyter-leaflet","model_module_version":"^0.13.5","model_name":"LeafletAttributionControlModel","state":{"_model_module":"jupyter-leaflet","_model_module_version":"^0.13.5","_model_name":"LeafletAttributionControlModel","_view_count":null,"_view_module":"jupyter-leaflet","_view_module_version":"^0.13.5","_view_name":"LeafletAttributionControlView","options":["position","prefix"],"position":"bottomright","prefix":"ipyleaflet"}}},"version_major":2,"version_minor":0}},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.009892,"end_time":"2021-05-11T14:51:17.299595","exception":false,"start_time":"2021-05-11T14:51:17.289703","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load environment variables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sJIHL8hmKC"}],"identifier":"load-environment-variables","label":"Load environment variables","html_id":"load-environment-variables","implicit":true,"key":"kddYjBCecU"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Please make sure that the environment variable “DAPA_URL” is set in the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"BnArxYZR5N"},{"type":"inlineCode","value":"custom.env","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"RCUpiBGIxA"},{"type":"text","value":" file. You can check this by executing the following block.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"CSlF4aNAeE"}],"key":"o0dL6Z6pKJ"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"If DAPA_URL is not set, please create a text file named ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"kX47wNYvjc"},{"type":"inlineCode","value":"custom.env","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"QpqRE5T1OG"},{"type":"text","value":" in your home directory with the following input:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"G8KoJhYA5K"}],"key":"esbBeC3qj5"},{"type":"blockquote","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"DAPA_URL=YOUR-PERSONAL-DAPA-APP-URL","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Bp3i7xb6CR"}],"key":"C3OmAzT28g"}],"key":"dHzut8hO8b"}],"visibility":"show","key":"CxldDAsgII"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:17.322985Z","iopub.status.busy":"2021-05-11T14:51:17.322375Z","iopub.status.idle":"2021-05-11T14:51:17.372763Z","shell.execute_reply":"2021-05-11T14:51:17.372282Z"},"papermill":{"duration":0.062984,"end_time":"2021-05-11T14:51:17.372861","exception":false,"start_time":"2021-05-11T14:51:17.309877","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import setup_environment_variables\nsetup_environment_variables()","visibility":"show","key":"dDgL769AkJ"},{"type":"output","id":"SUsmJCU-4PLHu4ZZEhmtC","data":[{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"API credentials have automatically been injected for your active subscriptions.  \nThe following environment variables are now available:\n\nThe following additional environment variables have been loaded from `~/custom.env`:\n* `AWS_BUCKET`\n* `DAPA_URL`\n* `DB_HOST`, `DB_NAME`, `DB_PASSWORD`, `DB_USER`\n* `OGC_EDC_URL`\n* `REFERENCE_DATA`\n","content_type":"text/markdown"},"text/plain":{"content":"<IPython.core.display.Markdown object>","content_type":"text/plain"}}}],"visibility":"show","key":"tLtNbwiWkr"}],"visibility":"show","key":"basptRZfWF"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010111,"end_time":"2021-05-11T14:51:17.393158","exception":false,"start_time":"2021-05-11T14:51:17.383047","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check notebook compabtibility","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mnytGL6HyF"}],"identifier":"check-notebook-compabtibility","label":"Check notebook compabtibility","html_id":"check-notebook-compabtibility","implicit":true,"key":"svSmC9JQob"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"strong","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Please note:","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"mN7e1IhHFS"}],"key":"toBM8jhzlz"},{"type":"text","value":" If you conduct this notebook again at a later time, the base image of this Jupyter Hub service can include newer versions of the libraries installed. Thus, the notebook execution can fail. This compatibility check is only necessary when something is broken.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"QDeDPXk0kl"}],"key":"kuF7GBjgex"}],"visibility":"show","key":"F84X0J35Do"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:17.416547Z","iopub.status.busy":"2021-05-11T14:51:17.415960Z","iopub.status.idle":"2021-05-11T14:51:17.419772Z","shell.execute_reply":"2021-05-11T14:51:17.419345Z"},"papermill":{"duration":0.016656,"end_time":"2021-05-11T14:51:17.419858","exception":false,"start_time":"2021-05-11T14:51:17.403202","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from edc import check_compatibility\ncheck_compatibility(\"user-0.24.5\", dependencies=[])","visibility":"show","key":"eis3aTtS93"},{"type":"output","id":"GQiK-wMQQnoQ25hNvMPhb","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<script type=\"text/javascript\">\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    </script>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-0.24.5).","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}}],"visibility":"show","key":"sRBtCpGXzU"}],"visibility":"show","key":"OAu6lJYBj4"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010568,"end_time":"2021-05-11T14:51:17.441089","exception":false,"start_time":"2021-05-11T14:51:17.430521","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Load libraries","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"l2D7rERXe4"}],"identifier":"load-libraries","label":"Load libraries","html_id":"load-libraries","implicit":true,"key":"CjB0JWtPMZ"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Python libraries used in this tutorial will be loaded.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"EdOE6txqsh"}],"key":"mRL3fsUyQB"}],"visibility":"show","key":"i1UUUXHeOG"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:17.469861Z","iopub.status.busy":"2021-05-11T14:51:17.469370Z","iopub.status.idle":"2021-05-11T14:51:18.652047Z","shell.execute_reply":"2021-05-11T14:51:18.651503Z"},"papermill":{"duration":1.196381,"end_time":"2021-05-11T14:51:18.652155","exception":false,"start_time":"2021-05-11T14:51:17.455774","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"import os\nimport xarray as xr\nimport pandas as pd\nimport requests\nimport matplotlib\nfrom ipyleaflet import Map, Rectangle, DrawControl, basemaps, basemap_to_tiles\n%matplotlib inline","visibility":"show","key":"egS7r5DwSx"},{"type":"output","id":"QNLZ31rrbNzjfCGLb2ySb","data":[],"visibility":"show","key":"MsB0KENhl5"}],"visibility":"show","key":"R9sfwLf07G"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010677,"end_time":"2021-05-11T14:51:18.673783","exception":false,"start_time":"2021-05-11T14:51:18.663106","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set DAPA endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Zhql9iF3ex"}],"identifier":"set-dapa-endpoint","label":"Set DAPA endpoint","html_id":"set-dapa-endpoint","implicit":true,"key":"eUqCzmyTX3"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Execute the following code to check if the DAPA_URL is available in the environment variable and to set the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"vpmJ6e66uU"},{"type":"inlineCode","value":"/dapa","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"yYf4TYD5y1"},{"type":"text","value":" endpoint.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"rcj0xrIj3j"}],"key":"bU2oUoZg8C"}],"visibility":"show","key":"IK7K4aP4gd"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:18.699087Z","iopub.status.busy":"2021-05-11T14:51:18.698415Z","iopub.status.idle":"2021-05-11T14:51:18.701185Z","shell.execute_reply":"2021-05-11T14:51:18.700754Z"},"papermill":{"duration":0.01692,"end_time":"2021-05-11T14:51:18.701276","exception":false,"start_time":"2021-05-11T14:51:18.684356","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"service_url = None\ndapa_url = None\n\nif 'DAPA_URL' not in os.environ:\n    print('!! DAPA_URL does not exist as environment variable. Please make sure this is the case - see first block of this notebook! !!')\nelse:    \n    service_url = os.environ['DAPA_URL']\n    dapa_url = '{}/{}'.format(service_url, 'oapi')\n    print('DAPA path: {}'.format(dapa_url.replace(service_url, '')))","visibility":"show","key":"xRk8ZSo1NQ"},{"type":"output","id":"ozfSfivJtGNnk3-t7PlN8","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi\n"}],"visibility":"show","key":"CA0VHLob2m"}],"visibility":"show","key":"dXMGqOiLs2"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.010727,"end_time":"2021-05-11T14:51:18.722823","exception":false,"start_time":"2021-05-11T14:51:18.712096","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get collections supported by this endpoint","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"CQaqoTc3MG"}],"identifier":"get-collections-supported-by-this-endpoint","label":"Get collections supported by this endpoint","html_id":"get-collections-supported-by-this-endpoint","implicit":true,"key":"TuPsNqPnoE"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"This request provides a list of collections. The path of each collection is used as starting path of this service.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"FgHwlg2iv7"}],"key":"KQ9opQkcTt"}],"visibility":"show","key":"LXVGe63Abx"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:18.752305Z","iopub.status.busy":"2021-05-11T14:51:18.751799Z","iopub.status.idle":"2021-05-11T14:51:18.835062Z","shell.execute_reply":"2021-05-11T14:51:18.834439Z"},"papermill":{"duration":0.101616,"end_time":"2021-05-11T14:51:18.835257","exception":false,"start_time":"2021-05-11T14:51:18.733641","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"collections_url = '{}/{}'.format(dapa_url, 'collections')\ncollections = requests.get(collections_url, headers={'Accept': 'application/json'})\n\nprint('DAPA path: {}'.format(collections.url.replace(service_url, '')))\ncollections.json()","visibility":"show","key":"NUydJFAPbi"},{"type":"output","id":"4QwHOYNXxI3WM_P8brtpJ","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections\n"},{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/plain":{"content":"['/oapi/collections/DEM/',\n '/oapi/collections/L8L1C/',\n '/oapi/collections/S1GRD/',\n '/oapi/collections/S2L1C/',\n '/oapi/collections/S2L2A/',\n '/oapi/collections/S3OLCI/',\n '/oapi/collections/S3SLSTR/',\n '/oapi/collections/S5PL2/',\n '/oapi/collections/MODIS/']","content_type":"text/plain"}}}],"visibility":"show","key":"j7BWzuTM8U"}],"visibility":"show","key":"qAS4V2Hyva"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.011394,"end_time":"2021-05-11T14:51:18.858389","exception":false,"start_time":"2021-05-11T14:51:18.846995","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Get fields of collection Sentinel-2 L2A","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"nfLHD5ZfPc"}],"identifier":"get-fields-of-collection-sentinel-2-l2a","label":"Get fields of collection Sentinel-2 L2A","html_id":"get-fields-of-collection-sentinel-2-l2a","implicit":true,"key":"CVTifZ062w"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The fields (or variables in other DAPA endpoints - these are the bands of the raster data) can be retrieved in all requests to the DAPA endpoint. In addition to the fixed set of fields, “virtual” fields can be used to conduct math operations (e.g., the calculation of indices).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"SoglpX9riU"}],"key":"psGLXh894t"}],"visibility":"show","key":"DC7Bmn2BTZ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:18.885897Z","iopub.status.busy":"2021-05-11T14:51:18.885372Z","iopub.status.idle":"2021-05-11T14:51:18.915095Z","shell.execute_reply":"2021-05-11T14:51:18.914653Z"},"papermill":{"duration":0.045364,"end_time":"2021-05-11T14:51:18.915234","exception":false,"start_time":"2021-05-11T14:51:18.869870","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"collection = 'S2L2A'\n\nfields_url = '{}/{}/{}/{}'.format(dapa_url, 'collections', collection, 'dapa/fields')\nfields = requests.get(fields_url, headers={'Accept': 'application/json'})\n\nprint('DAPA path: {}'.format(fields.url.replace(service_url, '')))\nfields.json()","visibility":"show","key":"mbvZVJTQDU"},{"type":"output","id":"iO7sC0epZks70iRquHWcn","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections/S2L2A/dapa/fields\n"},{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/plain":{"content":"[{'id': 'B01', 'wavelength': 442.7},\n {'id': 'B02', 'wavelength': 492.4},\n {'id': 'B03', 'wavelength': 559.8},\n {'id': 'B04', 'wavelength': 664.6},\n {'id': 'B05', 'wavelength': 704.1},\n {'id': 'B06', 'wavelength': 740.5},\n {'id': 'B07', 'wavelength': 782.8},\n {'id': 'B08', 'wavelength': 832.8},\n {'id': 'B8A', 'wavelength': 864.7},\n {'id': 'B09', 'wavelength': 945.1},\n {'id': 'B11', 'wavelength': 1613.7},\n {'id': 'B12', 'wavelength': 2202.4},\n {'id': 'SCL', 'wavelength': None},\n {'id': 'SNW', 'wavelength': None},\n {'id': 'CLD', 'wavelength': None}]","content_type":"text/plain"}}}],"visibility":"show","key":"Ynufnpa5Ht"}],"visibility":"show","key":"h1FfvOiLdo"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.011631,"end_time":"2021-05-11T14:51:18.939067","exception":false,"start_time":"2021-05-11T14:51:18.927436","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Retrieve data as raster aggregated by time","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vJnT8KslSb"}],"identifier":"retrieve-data-as-raster-aggregated-by-time","label":"Retrieve data as raster aggregated by time","html_id":"retrieve-data-as-raster-aggregated-by-time","implicit":true,"key":"mG2xS7FvfN"}],"visibility":"show","key":"HKK3eVVzB7"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.011985,"end_time":"2021-05-11T14:51:18.964681","exception":false,"start_time":"2021-05-11T14:51:18.952696","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Set DAPA URL and parameters","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wMmLRkdpDP"}],"identifier":"set-dapa-url-and-parameters","label":"Set DAPA URL and parameters","html_id":"set-dapa-url-and-parameters","implicit":true,"key":"Xdjd5rN2wC"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The output of this request is a single raster (","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"oJDMYPHjpm"},{"type":"inlineCode","value":"area","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"cHtIgG0Kzg"},{"type":"text","value":" endpoint). As the input collection (S2L2A) is a multi-temporal raster and the output format is an area, temporal aggregation is conducted for each pixel in the area.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Lj6wvPnyI6"}],"key":"MQNX07b2Qu"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"To retrieve a single raster, a bounding box (","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"K4uzEXAx0M"},{"type":"inlineCode","value":"bbox","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"YuEfY6fWr9"},{"type":"text","value":") or polygon geometry (","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"K15eUteoc1"},{"type":"inlineCode","value":"geom","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"RkuonzX9Oq"},{"type":"text","value":") needs to be provided. The ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"WsuetZN6Kc"},{"type":"inlineCode","value":"time","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XBbf5TY9ng"},{"type":"text","value":" parameter allows to aggregate data only within a specific time span. Also the band (","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"LfEWw7Zlvb"},{"type":"inlineCode","value":"field","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"Gr1RzhbGDw"},{"type":"text","value":") to be returned by DAPA needs to be specified as well.","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"ughXyDUG4Q"}],"key":"Wc4H2ZSL6a"}],"visibility":"show","key":"iNzPFKJTYy"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:18.998664Z","iopub.status.busy":"2021-05-11T14:51:18.995472Z","iopub.status.idle":"2021-05-11T14:51:19.015997Z","shell.execute_reply":"2021-05-11T14:51:19.012612Z"},"papermill":{"duration":0.039839,"end_time":"2021-05-11T14:51:19.016101","exception":false,"start_time":"2021-05-11T14:51:18.976262","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# DAPA URL\nurl = '{}/{}/{}/{}'.format(dapa_url, 'collections', collection, 'dapa/area')\n\n# Parameters for this request\nparams = {\n    'bbox': '11.49,48.05,11.66,48.22',\n    'time': '2018-05-07T10:00:00Z/2018-05-07T12:00:00Z',\n    'fields': 'NDVI=(B08-B04)/(B08%2BB04),NDBI=(B11-B08)/(B11%2BB08)', # Please note: + signs need to be URL encoded -> %2B\n    'aggregate': 'avg'\n}\n\n# show point in the map\nm = Map(\n    basemap=basemap_to_tiles(basemaps.OpenStreetMap.Mapnik),\n    center=(48.14, 11.56),\n    zoom=10\n)\n\nbbox = [float(coord) for coord in params['bbox'].split(',')]\nrectangle = Rectangle(bounds=((bbox[1], bbox[0]), (bbox[3], bbox[2])))\nm.add_layer(rectangle)\n\nm","visibility":"show","key":"rqdENIbXFD"},{"type":"output","id":"I6gJ62ceazJ3j48kTY5fh","data":[{"output_type":"display_data","metadata":{},"data":{"application/vnd.jupyter.widget-view+json":{"content":"{\"model_id\":\"8d8888b2ab7a45ba8b8c17eb3fc81e27\",\"version_major\":2,\"version_minor\":0}","content_type":"application/vnd.jupyter.widget-view+json"},"text/plain":{"content":"Map(center=[48.14, 11.56], controls=(ZoomControl(options=['position', 'zoom_in_text', 'zoom_in_title', 'zoom_o…","content_type":"text/plain"}}}],"visibility":"show","key":"lPNQ14jwAn"}],"visibility":"show","key":"wb8K77OopP"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.011861,"end_time":"2021-05-11T14:51:19.040059","exception":false,"start_time":"2021-05-11T14:51:19.028198","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build request URL and conduct request","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"H1Jo9OmELn"}],"identifier":"build-request-url-and-conduct-request","label":"Build request URL and conduct request","html_id":"build-request-url-and-conduct-request","implicit":true,"key":"WJl0lVCqZO"}],"visibility":"show","key":"ywzg3rEuHf"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:19.073527Z","iopub.status.busy":"2021-05-11T14:51:19.072887Z","iopub.status.idle":"2021-05-11T14:51:20.323515Z","shell.execute_reply":"2021-05-11T14:51:20.322957Z"},"papermill":{"duration":1.26737,"end_time":"2021-05-11T14:51:20.323623","exception":false,"start_time":"2021-05-11T14:51:19.056253","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"params_str = \"&\".join(\"%s=%s\" % (k, v) for k,v in params.items())\nr = requests.get(url, params=params_str)\n\nprint('DAPA path: {}'.format(r.url.replace(service_url, '')))\nprint('Status code: {}'.format(r.status_code))","visibility":"show","key":"YqVWMj6FyN"},{"type":"output","id":"6lbBR6lgDZU-yS0MSyqdA","data":[{"name":"stdout","output_type":"stream","text":"DAPA path: /oapi/collections/S2L2A/dapa/area?bbox=11.49,48.05,11.66,48.22&time=2018-05-07T10:00:00Z/2018-05-07T12:00:00Z&fields=NDVI=(B08-B04)/(B08%2BB04),NDBI=(B11-B08)/(B11%2BB08)&aggregate=avg\nStatus code: 200\n"}],"visibility":"show","key":"ndphoNsy1Q"}],"visibility":"show","key":"BmS1nuqE01"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012255,"end_time":"2021-05-11T14:51:20.348644","exception":false,"start_time":"2021-05-11T14:51:20.336389","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Write raster dataset to GeoTIFF file","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"awNEwDIndp"}],"identifier":"write-raster-dataset-to-geotiff-file","label":"Write raster dataset to GeoTIFF file","html_id":"write-raster-dataset-to-geotiff-file","implicit":true,"key":"O3MhDhgTUy"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The response of the ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"O0Y1yLtFCm"},{"type":"inlineCode","value":"area","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"JZM1o13rGt"},{"type":"text","value":" endpoint is currently a GeoTIFF file, which can either be saved to disk or used directly in further processing.","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"X35YKyT4Sc"}],"key":"gYvsMHYu57"}],"visibility":"show","key":"ets0qw9wRH"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:20.376375Z","iopub.status.busy":"2021-05-11T14:51:20.375867Z","iopub.status.idle":"2021-05-11T14:51:20.378457Z","shell.execute_reply":"2021-05-11T14:51:20.378795Z"},"papermill":{"duration":0.017716,"end_time":"2021-05-11T14:51:20.378895","exception":false,"start_time":"2021-05-11T14:51:20.361179","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"with open('area_avg.tif', 'wb') as filew:\n    filew.write(r.content)","visibility":"show","key":"ErIkJdnQDz"},{"type":"output","id":"T7XS77qCcEu1y2HH2Gbvk","data":[],"visibility":"show","key":"Cq2IHNfgsc"}],"visibility":"show","key":"esTrmeJKy0"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012099,"end_time":"2021-05-11T14:51:20.403441","exception":false,"start_time":"2021-05-11T14:51:20.391342","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open raster dataset with xarray","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OiMSDA4RDB"}],"identifier":"open-raster-dataset-with-xarray","label":"Open raster dataset with xarray","html_id":"open-raster-dataset-with-xarray","implicit":true,"key":"IQEA6YLwkF"},{"type":"paragraph","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"The GeoTIFF file can be opened with xarray. The file consists of bands related to each ","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"OlEQZ9DDw0"},{"type":"inlineCode","value":"field","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"OMwgeaM0yR"},{"type":"text","value":" and each aggregation function (see descriptions attribute in the xarray output).","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Ft2LXbA8WS"}],"key":"n6XPA9bLmn"}],"visibility":"show","key":"dJMH2lKelO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:20.430669Z","iopub.status.busy":"2021-05-11T14:51:20.430134Z","iopub.status.idle":"2021-05-11T14:51:20.550491Z","shell.execute_reply":"2021-05-11T14:51:20.549991Z"},"papermill":{"duration":0.134957,"end_time":"2021-05-11T14:51:20.550600","exception":false,"start_time":"2021-05-11T14:51:20.415643","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds = xr.open_rasterio('area_avg.tif')\nds","visibility":"show","key":"pw2SUzqhc7"},{"type":"output","id":"ak0jcY0JGxK_UwxxlpAzu","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));\n  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));\n  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));\n  --xr-border-color: var(--jp-border-color2, #e0e0e0);\n  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);\n  --xr-background-color: var(--jp-layout-color0, white);\n  --xr-background-color-row-even: var(--jp-layout-color1, white);\n  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);\n}\n\nhtml[theme=dark],\nbody.vscode-dark {\n  --xr-font-color0: rgba(255, 255, 255, 1);\n  --xr-font-color2: rgba(255, 255, 255, 0.54);\n  --xr-font-color3: rgba(255, 255, 255, 0.38);\n  --xr-border-color: #1F1F1F;\n  --xr-disabled-color: #515151;\n  --xr-background-color: #111111;\n  --xr-background-color-row-even: #111111;\n  --xr-background-color-row-odd: #313131;\n}\n\n.xr-wrap {\n  display: block;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 20px 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: none;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: '►';\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: '▼';\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: '(';\n}\n\n.xr-dim-list:after {\n  content: ')';\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: ',';\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  margin-bottom: 0;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data {\n  display: none;\n  background-color: var(--xr-background-color) !important;\n  padding-bottom: 5px !important;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2 {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray (band: 2, y: 512, x: 512)&gt;\n[524288 values with dtype=float32]\nCoordinates:\n  * band     (band) int64 1 2\n  * y        (y) float64 48.22 48.22 48.22 48.22 ... 48.05 48.05 48.05 48.05\n  * x        (x) float64 11.49 11.49 11.49 11.49 ... 11.66 11.66 11.66 11.66\nAttributes:\n    transform:               (0.00033203124999999986, 0.0, 11.49, 0.0, -0.000...\n    crs:                     +init=epsg:4326\n    res:                     (0.00033203124999999986, 0.00033203125000000333)\n    is_tiled:                0\n    nodatavals:              (nan, nan)\n    scales:                  (1.0, 1.0)\n    offsets:                 (0.0, 0.0)\n    descriptions:            (&#x27;NDVI_avg&#x27;, &#x27;NDBI_avg&#x27;)\n    AREA_OR_POINT:           Area\n    TIFFTAG_RESOLUTIONUNIT:  1 (unitless)\n    TIFFTAG_XRESOLUTION:     1\n    TIFFTAG_YRESOLUTION:     1</pre><div class='xr-wrap' hidden><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'></div><ul class='xr-dim-list'><li><span class='xr-has-index'>band</span>: 2</li><li><span class='xr-has-index'>y</span>: 512</li><li><span class='xr-has-index'>x</span>: 512</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-cde83e52-8f3a-461a-a53e-87d7397722ac' class='xr-array-in' type='checkbox' checked><label for='section-cde83e52-8f3a-461a-a53e-87d7397722ac' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>...</span></div><div class='xr-array-data'><pre>[524288 values with dtype=float32]</pre></div></div></li><li class='xr-section-item'><input id='section-b2022200-733b-4ffb-bc49-2ee8d981ea0a' class='xr-section-summary-in' type='checkbox'  checked><label for='section-b2022200-733b-4ffb-bc49-2ee8d981ea0a' class='xr-section-summary' >Coordinates: <span>(3)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>band</span></div><div class='xr-var-dims'>(band)</div><div class='xr-var-dtype'>int64</div><div class='xr-var-preview xr-preview'>1 2</div><input id='attrs-57b54d3c-bc6e-415c-83c8-8c5ed3a9fee1' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-57b54d3c-bc6e-415c-83c8-8c5ed3a9fee1' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-2483bdeb-f8b1-4a45-b309-547ca68679e9' class='xr-var-data-in' type='checkbox'><label for='data-2483bdeb-f8b1-4a45-b309-547ca68679e9' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([1, 2])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>y</span></div><div class='xr-var-dims'>(y)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>48.22 48.22 48.22 ... 48.05 48.05</div><input id='attrs-8cae1164-8ac1-4390-991f-0ebd5d5bb393' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8cae1164-8ac1-4390-991f-0ebd5d5bb393' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-6c205240-ae71-4a7f-9826-c005765588ee' class='xr-var-data-in' type='checkbox'><label for='data-6c205240-ae71-4a7f-9826-c005765588ee' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([48.219834, 48.219502, 48.21917 , ..., 48.05083 , 48.050498, 48.050166])</pre></div></li><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>x</span></div><div class='xr-var-dims'>(x)</div><div class='xr-var-dtype'>float64</div><div class='xr-var-preview xr-preview'>11.49 11.49 11.49 ... 11.66 11.66</div><input id='attrs-8101c20a-76ae-445a-990f-f5f7029f657f' class='xr-var-attrs-in' type='checkbox' disabled><label for='attrs-8101c20a-76ae-445a-990f-f5f7029f657f' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-4da149ec-18cf-4334-9df8-258a06b11c0a' class='xr-var-data-in' type='checkbox'><label for='data-4da149ec-18cf-4334-9df8-258a06b11c0a' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'></dl></div><div class='xr-var-data'><pre>array([11.490166, 11.490498, 11.49083 , ..., 11.65917 , 11.659502, 11.659834])</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-78b29b2c-9791-469e-865d-3d1a0d98d6f0' class='xr-section-summary-in' type='checkbox'  ><label for='section-78b29b2c-9791-469e-865d-3d1a0d98d6f0' class='xr-section-summary' >Attributes: <span>(12)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'><dt><span>transform :</span></dt><dd>(0.00033203124999999986, 0.0, 11.49, 0.0, -0.00033203125000000333, 48.22)</dd><dt><span>crs :</span></dt><dd>+init=epsg:4326</dd><dt><span>res :</span></dt><dd>(0.00033203124999999986, 0.00033203125000000333)</dd><dt><span>is_tiled :</span></dt><dd>0</dd><dt><span>nodatavals :</span></dt><dd>(nan, nan)</dd><dt><span>scales :</span></dt><dd>(1.0, 1.0)</dd><dt><span>offsets :</span></dt><dd>(0.0, 0.0)</dd><dt><span>descriptions :</span></dt><dd>(&#x27;NDVI_avg&#x27;, &#x27;NDBI_avg&#x27;)</dd><dt><span>AREA_OR_POINT :</span></dt><dd>Area</dd><dt><span>TIFFTAG_RESOLUTIONUNIT :</span></dt><dd>1 (unitless)</dd><dt><span>TIFFTAG_XRESOLUTION :</span></dt><dd>1</dd><dt><span>TIFFTAG_YRESOLUTION :</span></dt><dd>1</dd></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.DataArray (band: 2, y: 512, x: 512)>\n[524288 values with dtype=float32]\nCoordinates:\n  * band     (band) int64 1 2\n  * y        (y) float64 48.22 48.22 48.22 48.22 ... 48.05 48.05 48.05 48.05\n  * x        (x) float64 11.49 11.49 11.49 11.49 ... 11.66 11.66 11.66 11.66\nAttributes:\n    transform:               (0.00033203124999999986, 0.0, 11.49, 0.0, -0.000...\n    crs:                     +init=epsg:4326\n    res:                     (0.00033203124999999986, 0.00033203125000000333)\n    is_tiled:                0\n    nodatavals:              (nan, nan)\n    scales:                  (1.0, 1.0)\n    offsets:                 (0.0, 0.0)\n    descriptions:            ('NDVI_avg', 'NDBI_avg')\n    AREA_OR_POINT:           Area\n    TIFFTAG_RESOLUTIONUNIT:  1 (unitless)\n    TIFFTAG_XRESOLUTION:     1\n    TIFFTAG_YRESOLUTION:     1","content_type":"text/plain"}}}],"visibility":"show","key":"ACguID6WHL"}],"visibility":"show","key":"OCX8cCVC18"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.012864,"end_time":"2021-05-11T14:51:20.580237","exception":false,"start_time":"2021-05-11T14:51:20.567373","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot NDVI image (first band)","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"azDqCf6pUk"}],"identifier":"plot-ndvi-image-first-band","label":"Plot NDVI image (first band)","html_id":"plot-ndvi-image-first-band","implicit":true,"key":"zGzQsDUElX"}],"visibility":"show","key":"qfRqwNzbBN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:20.610121Z","iopub.status.busy":"2021-05-11T14:51:20.609561Z","iopub.status.idle":"2021-05-11T14:51:21.044109Z","shell.execute_reply":"2021-05-11T14:51:21.044498Z"},"papermill":{"duration":0.451384,"end_time":"2021-05-11T14:51:21.044669","exception":false,"start_time":"2021-05-11T14:51:20.593285","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"ds[0].plot(cmap=\"RdYlGn\")","visibility":"show","key":"DQl5IfSHd3"},{"type":"output","id":"8c3UR_7IsAIJL884V9TWd","data":[{"output_type":"display_data","metadata":{"needs_background":"light"},"data":{"image/png":{"content_type":"image/png","hash":"215a5ac58d52ce5c7cf019099aa805a3","path":"/notebooks_test/build/215a5ac58d52ce5c7cf019099aa805a3.png"},"text/plain":{"content":"<Figure size 432x288 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"SIpik82NDu"}],"visibility":"show","key":"lbGvclp8TB"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.018061,"end_time":"2021-05-11T14:51:21.081825","exception":false,"start_time":"2021-05-11T14:51:21.063764","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Output gdalinfo","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q2nhgOTR9i"}],"identifier":"output-gdalinfo","label":"Output gdalinfo","html_id":"output-gdalinfo","implicit":true,"key":"xK2lOM7hpH"}],"visibility":"show","key":"AdO8FWIIHI"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2021-05-11T14:51:21.121207Z","iopub.status.busy":"2021-05-11T14:51:21.120641Z","iopub.status.idle":"2021-05-11T14:51:21.836492Z","shell.execute_reply":"2021-05-11T14:51:21.836829Z"},"papermill":{"duration":0.737144,"end_time":"2021-05-11T14:51:21.836953","exception":false,"start_time":"2021-05-11T14:51:21.099809","status":"completed"},"scrolled":true,"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"!gdalinfo -stats area_avg.tif","visibility":"show","key":"sxBFzSm8g3"},{"type":"output","id":"t_t8zpo0KTHvvPYciaD1Q","data":[{"name":"stdout","output_type":"stream","text":"Warning 1: area_avg.tif: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn't match SamplesPerPixel. Defining non-color channels as ExtraSamples.\r\nDriver: GTiff/GeoTIFF\r\nFiles: area_avg.tif\r\nSize is 512, 512\r\n"},{"name":"stdout","output_type":"stream","text":"Coordinate System is:\r\nGEOGCRS[\"WGS 84\",\r\n    DATUM[\"World Geodetic System 1984\",\r\n        ELLIPSOID[\"WGS 84\",6378137,298.257223563,\r\n            LENGTHUNIT[\"metre\",1]]],\r\n    PRIMEM[\"Greenwich\",0,\r\n        ANGLEUNIT[\"degree\",0.0174532925199433]],\r\n    CS[ellipsoidal,2],\r\n        AXIS[\"geodetic latitude (Lat)\",north,\r\n            ORDER[1],\r\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\r\n        AXIS[\"geodetic longitude (Lon)\",east,\r\n            ORDER[2],\r\n            ANGLEUNIT[\"degree\",0.0174532925199433]],\r\n    ID[\"EPSG\",4326]]\r\nData axis to CRS axis mapping: 2,1\r\nOrigin = (11.490000000000000,48.219999999999999)\r\nPixel Size = (0.000332031250000,-0.000332031250000)\r\nMetadata:\r\n  AREA_OR_POINT=Area\r\n  TIFFTAG_RESOLUTIONUNIT=1 (unitless)\r\n  TIFFTAG_XRESOLUTION=1\r\n  TIFFTAG_YRESOLUTION=1\r\nImage Structure Metadata:\r\n  COMPRESSION=DEFLATE\r\n  INTERLEAVE=PIXEL\r\nWarning 1: TIFFReadDirectory:Sum of Photometric type-related color channels and ExtraSamples doesn't match SamplesPerPixel. Defining non-color channels as ExtraSamples.\r\nCorner Coordinates:\r\nUpper Left  (  11.4900000,  48.2200000) ( 11d29'24.00\"E, 48d13'12.00\"N)\r\nLower Left  (  11.4900000,  48.0500000) ( 11d29'24.00\"E, 48d 3' 0.00\"N)\r\nUpper Right (  11.6600000,  48.2200000) ( 11d39'36.00\"E, 48d13'12.00\"N)\r\nLower Right (  11.6600000,  48.0500000) ( 11d39'36.00\"E, 48d 3' 0.00\"N)\r\nCenter      (  11.5750000,  48.1350000) ( 11d34'30.00\"E, 48d 8' 6.00\"N)\r\nBand 1 Block=512x8 Type=Float32, ColorInterp=Gray\r\n  Description = NDVI_avg\r\n  Minimum=-1.000, Maximum=1.000, Mean=0.527, StdDev=0.253\r\n  Metadata:\r\n    STATISTICS_MAXIMUM=1\r\n    STATISTICS_MEAN=0.52696186269059\r\n    STATISTICS_MINIMUM=-1\r\n    STATISTICS_STDDEV=0.25294857961659\r\n    STATISTICS_VALID_PERCENT=100\r\nBand 2 Block=512x8 Type=Float32, ColorInterp=Undefined\r\n  Description = NDBI_avg\r\n  Minimum=-0.655, Maximum=1.000, Mean=-0.134, StdDev=0.178\r\n  Metadata:\r\n    STATISTICS_MAXIMUM=1\r\n    STATISTICS_MEAN=-0.13420287323754\r\n    STATISTICS_MINIMUM=-0.65451771020889\r\n    STATISTICS_STDDEV=0.17816229549198\r\n    STATISTICS_VALID_PERCENT=100\r\n"}],"visibility":"show","key":"OgopTZJRHZ"}],"visibility":"show","key":"u2TVO13opy"}],"key":"Ot7v3BlrgZ"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"DAPA Tutorial #1: Cube - Sentinel-2","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/dapa/dapa-tutorial-1-cube-sentinel-2","group":"Contributions"},"next":{"title":"DAPA Tutorial #3: Timeseries - Sentinel-2","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/dapa/dapa-tutorial-3-timeseries-sentinel-2","group":"Contributions"}}},"domain":"http://localhost:3000"}