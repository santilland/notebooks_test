{"version":1,"kind":"Notebook","sha256":"d49c8c78de25269f3e9a2275083bb0c1d1064c13bd87fa03b60aef38d6a6b292","slug":"external-notebooks.eurodatacube.notebooks.notebooks.contributions.lps2022-leverage-euro-data-cube-services","location":"/external_notebooks/eurodatacube/notebooks/notebooks/contributions/LPS2022_Leverage_Euro_Data_Cube_Services.ipynb","dependencies":[],"frontmatter":{"title":"Living Planet Symposium 2022 Training Session","content_includes_title":true,"kernelspec":{"name":"edc","display_name":"EDC 2022.02 (Python3)","language":"python"},"github":"https://github.com/eoxhub-workspaces/documentation/","numbering":{"title":{"offset":5}},"edit_url":"https://github.com/eoxhub-workspaces/documentation//blob/main/external_notebooks/eurodatacube/notebooks/notebooks/contributions/LPS2022_Leverage_Euro_Data_Cube_Services.ipynb","exports":[{"format":"ipynb","filename":"LPS2022_Leverage_Euro_Data_Cube_Services.ipynb","url":"/build/LPS2022_Leverage_Eur-9fb043e0fdf2adfb8b074003a7a4dc97.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.054083,"end_time":"2023-03-22T13:00:43.625621","exception":false,"start_time":"2023-03-22T13:00:43.571538","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Living Planet Symposium 2022 Training Session","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YhthffUUGe"}],"identifier":"living-planet-symposium-2022-training-session","label":"Living Planet Symposium 2022 Training Session","html_id":"living-planet-symposium-2022-training-session","implicit":true,"key":"VbvjXAhHoS"},{"type":"heading","depth":1,"position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"children":[{"type":"text","value":"Leverage Euro Data Cube services for accessing, analysing and visualising EO data","position":{"start":{"line":2,"column":1},"end":{"line":2,"column":1}},"key":"Hkys15X0Kl"}],"identifier":"leverage-euro-data-cube-services-for-accessing-analysing-and-visualising-eo-data","label":"Leverage Euro Data Cube services for accessing, analysing and visualising EO data","html_id":"leverage-euro-data-cube-services-for-accessing-analysing-and-visualising-eo-data","implicit":true,"key":"Xd8S0GmKQz"},{"type":"thematicBreak","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"lPT1znlFEn"},{"type":"paragraph","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"strong","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Original JN:","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"K0d1DMXdd4"}],"key":"AX2w4DrT9O"},{"type":"text","value":" ","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"XvW36zw1A0"},{"type":"emphasis","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"children":[{"type":"text","value":"Exploring Time and Space: A guide to accessing, analysing and visualising data in the Euro DataÂ Cube","position":{"start":{"line":4,"column":1},"end":{"line":4,"column":1}},"key":"IuSwInr3pH"}],"key":"xCOpUHnV6L"}],"key":"HMNc1ztoJz"},{"type":"paragraph","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"strong","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"Author original JN:","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"LGBOApyOPG"}],"key":"e7k5o7TJjT"},{"type":"text","value":" ","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"I9etp3ldc4"},{"type":"emphasis","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"text","value":"William Ray","position":{"start":{"line":6,"column":1},"end":{"line":6,"column":1}},"key":"YmxVVNzYSf"}],"key":"v0fjPTpniB"}],"key":"UQmEb0uu1h"},{"type":"paragraph","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"strong","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Edited and extended by:","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"ZW8rE38wPC"}],"key":"IW0IhaIALA"},{"type":"text","value":" ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"b0GwjEiFy5"},{"type":"emphasis","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Alicja Balfanz","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"xtjREvZbdi"}],"key":"bWyie3r54p"},{"type":"text","value":" & ","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"OOrG081OQi"},{"type":"emphasis","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"Max Kampen","position":{"start":{"line":8,"column":1},"end":{"line":8,"column":1}},"key":"PKnCvfRllX"}],"key":"YBdXcrjPtg"}],"key":"rBII7ACJ2g"},{"type":"heading","depth":2,"position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"Getting started with EDC","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"GKtR3MqRs7"}],"identifier":"getting-started-with-edc","label":"Getting started with EDC","html_id":"getting-started-with-edc","implicit":true,"key":"hs1ULjgLCC"},{"type":"paragraph","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"text","value":"In this demonstration Jupyter Notebook, we will be visualising and analysing a flooding event using Sentinel data to demonstrate how you can use EDC for your own applications. Much of what we we will focus on can be used for many other applications and use cases.","position":{"start":{"line":12,"column":1},"end":{"line":12,"column":1}},"key":"DgPkaHfJXe"}],"key":"MPOyKw41uT"},{"type":"paragraph","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"text","value":"We are going to use EDC with its associated libaries and APIs to do this. In this notebook we will learn how to:","position":{"start":{"line":14,"column":1},"end":{"line":14,"column":1}},"key":"o2zULFpsUm"}],"key":"I8PHOPneDl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":16,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"Build a data cube","position":{"start":{"line":16,"column":1},"end":{"line":16,"column":1}},"key":"sfsG3J9VOq"}],"key":"YqBeAB2XYP"},{"type":"listItem","spread":true,"position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Create a new variable","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"iMgALjZGMD"}],"key":"xdyx7UwShM"},{"type":"listItem","spread":true,"position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"children":[{"type":"text","value":"Visualise a variable of your data cube","position":{"start":{"line":18,"column":1},"end":{"line":18,"column":1}},"key":"UOHGOC2V6Q"}],"key":"raxOiv0hSl"},{"type":"listItem","spread":true,"position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"children":[{"type":"text","value":"Create a new variable using a threshold","position":{"start":{"line":19,"column":1},"end":{"line":19,"column":1}},"key":"sXgodRxIw9"}],"key":"uJt5wAYEiL"},{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Visualise a spatial subset of a variable over time","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"CLhnYEg4ej"}],"key":"bclIwJNOJM"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Create a new variable based upon space and time","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"ql0QT3K23j"}],"key":"xDcsIoPlI0"}],"key":"vUGu4tBA5B"}],"visibility":"show","key":"wwURaR0SyD"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.045341,"end_time":"2023-03-22T13:00:43.837291","exception":false,"start_time":"2023-03-22T13:00:43.791950","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Configuration","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"zzVp7AzE0o"}],"identifier":"configuration","label":"Configuration","html_id":"configuration","implicit":true,"key":"zLKrif9NH6"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Before acccessing the data, we will start by importing the necessary Python libraries (already configured in your EDC workspace), and fetch pre-generated credentials as environment variables to access the services.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"HvRlOwWRcS"}],"key":"eaModPFkNw"}],"visibility":"show","key":"rK2V06yiyg"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:43.937978Z","iopub.status.busy":"2023-03-22T13:00:43.937489Z","iopub.status.idle":"2023-03-22T13:00:47.128032Z","shell.execute_reply":"2023-03-22T13:00:47.126559Z"},"papermill":{"duration":3.253196,"end_time":"2023-03-22T13:00:47.131227","exception":false,"start_time":"2023-03-22T13:00:43.878031","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Check compatibility and import environment credentials\nfrom edc import check_compatibility\ncheck_compatibility(\"user-2023.03-02\", dependencies=[\"GEODB\", \"SH\"])\n\n# EDC libraries\nfrom xcube_sh.config import CubeConfig\nfrom xcube_sh.cube import open_cube\nfrom xcube_sh.sentinelhub import SentinelHub\nfrom xcube.core.geom import mask_dataset_by_geometry\n\n# Sentinel Hub\nfrom sentinelhub import BBox\n\n# Utilities\nimport IPython.display\nimport matplotlib.pyplot as plt\nimport datetime as dt\nimport rioxarray\nimport shapely\n\n# Numerical computation\nimport xarray as xr\nimport numpy as np","visibility":"show","key":"h3xVNnlgOE"},{"type":"output","id":"bg9-rY9idWwEhra4NMpnh","data":[{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"<script type=\"text/javascript\">\n        function toggle(id) {\n            el = document.getElementById(id);\n            el.style.display = el.style.display === \"none\" ? \"block\" : \"none\";\n        }\n    </script>","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/html":{"content":"This notebook is compatible with this base image version (user-2023.03-02).","content_type":"text/html"},"text/plain":{"content":"<IPython.core.display.HTML object>","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"text/markdown":{"content":"\n\n---------\n\nThe following environment variables are available:\n\n* `GEODB_AUTH_AUD`, `GEODB_AUTH_CLIENT_ID`, `GEODB_AUTH_DOMAIN`, `GEODB_API_SERVER_URL`, `GEODB_AUTH_CLIENT_SECRET`, `GEODB_API_SERVER_PORT`\n* `SH_CLIENT_ID`, `SH_INSTANCE_ID`, `SH_CLIENT_NAME`, `SH_CLIENT_SECRET`\n","content_type":"text/markdown"},"text/plain":{"content":"<IPython.core.display.Markdown object>","content_type":"text/plain"}}}],"visibility":"show","key":"ujuk6Sr1Gz"}],"visibility":"show","key":"INMWrVrMRQ"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.021365,"end_time":"2023-03-22T13:00:47.175217","exception":false,"start_time":"2023-03-22T13:00:47.153852","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Define an AOI","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LSXEdLm6bh"}],"identifier":"define-an-aoi","label":"Define an AOI","html_id":"define-an-aoi","implicit":true,"key":"nenNA4Pfs5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Next, we will define our area of interest using a bounding box. For our example we will use WGS84 coordinates to build the data cube. We have chosen an AOI that covers Madagascarâs capital city Antananarivo and surrounding regions. In early 2022, the east coast of Madagascar was impacted by two different tropical weather systems, which caused heavy rainfall and flooding in the countryâs capital and Analamanga region (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"q7TumwApM7"},{"type":"link","url":"https://reliefweb.int/report/madagascar/madagascar-rainy-and-cyclone-season-flash-update-no1-24-january-2022","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"source","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yga0y3qRNP"}],"urlSource":"https://reliefweb.int/report/madagascar/madagascar-rainy-and-cyclone-season-flash-update-no1-24-january-2022","key":"SQvUPd5UHv"},{"type":"text","value":"). Across Madagascar, the heavy rainfall persisted throughout January and February, when the moderate tropical storm ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"x3mgikgspZ"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Ana","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hKV9XYn6aJ"}],"key":"u2Gfsuc8hI"},{"type":"text","value":" and the tropical cyclone ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"YOCMsck0li"},{"type":"emphasis","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Batsirai","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UaxckNpFlc"}],"key":"d3am1bc0j3"},{"type":"text","value":" made landfall in January and Februrary respectively (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"faKoQFFVXm"},{"type":"link","url":"https://www.worldweatherattribution.org/climate-change-increased-rainfall-associated-with-tropical-cyclones-hitting-highly-vulnerable-communities-in-madagascar-mozambique-malawi/","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"source","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"DuDzBlhFu6"}],"urlSource":"https://www.worldweatherattribution.org/climate-change-increased-rainfall-associated-with-tropical-cyclones-hitting-highly-vulnerable-communities-in-madagascar-mozambique-malawi/","key":"uEiewCZqII"},{"type":"text","value":").","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"hBH7AJjLPo"}],"key":"ojhrs3pqA5"}],"visibility":"show","key":"AolsnY2ouo"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:47.231380Z","iopub.status.busy":"2023-03-22T13:00:47.229248Z","iopub.status.idle":"2023-03-22T13:00:47.240092Z","shell.execute_reply":"2023-03-22T13:00:47.237939Z"},"papermill":{"duration":0.041494,"end_time":"2023-03-22T13:00:47.243454","exception":false,"start_time":"2023-03-22T13:00:47.201960","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Bbox\nAntananarivo_bbox = [47.221985, -19.129599, 47.671051, -18.659257]\n\n# Bbox EPSG\nbbox_epsg = 4326","visibility":"show","key":"mC1llknjpw"},{"type":"output","id":"HTNX4j4WYN_XJ1N2L0ZVi","data":[],"visibility":"show","key":"wwd3hEe3Gt"}],"visibility":"show","key":"FqY2MPGNbN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:47.291948Z","iopub.status.busy":"2023-03-22T13:00:47.290759Z","iopub.status.idle":"2023-03-22T13:00:47.321101Z","shell.execute_reply":"2023-03-22T13:00:47.307641Z"},"papermill":{"duration":0.060041,"end_time":"2023-03-22T13:00:47.326212","exception":false,"start_time":"2023-03-22T13:00:47.266171","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the bounding box on a map\nIPython.display.GeoJSON(BBox(Antananarivo_bbox,crs=bbox_epsg).get_geojson())","visibility":"show","key":"Z5Ki7FfTH4"},{"type":"output","id":"Liuc6ESFl4tS321tBfVl7","data":[{"output_type":"display_data","metadata":{"application/geo+json":{"expanded":false,"root":"root"}},"data":{"application/geo+json":{"content":"{\"coordinates\":[[[47.221985,-19.129599],[47.221985,-18.659257],[47.671051,-18.659257],[47.671051,-19.129599],[47.221985,-19.129599]]],\"crs\":{\"properties\":{\"name\":\"urn:ogc:def:crs:EPSG::4326\"},\"type\":\"name\"},\"type\":\"Polygon\"}","content_type":"application/geo+json"},"text/plain":{"content":"<IPython.display.GeoJSON object>","content_type":"text/plain"}}}],"visibility":"show","key":"aIDzqHYLbA"}],"visibility":"show","key":"RKLazulmRk"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.020407,"end_time":"2023-03-22T13:00:47.373927","exception":false,"start_time":"2023-03-22T13:00:47.353520","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"How to build a data cube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"GPo4PvJivk"}],"identifier":"how-to-build-a-data-cube","label":"How to build a data cube","html_id":"how-to-build-a-data-cube","implicit":true,"key":"sWWa6WWq8s"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Firstly, we will go through the required steps to build a data cube.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"m0eZG97Hlt"}],"key":"VGKurRgXO9"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We are going to visualise the flooding events using Sentinel-2 imagery. The Sentinel-2 system (consisting of two twin satellites) is part of the Copernicus programme and collects multispectral data globally with a revisit time of 5 days. The satelliteâs multispectral imager acquires data in 13 spectral bands spanning from the visible and near infrared to shortwave infrared.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"EORpD4c9nB"}],"key":"trk5N5H7lK"},{"type":"heading","depth":3,"position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Check available Sentinel-2 L2A bands","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"POayEbErwf"}],"identifier":"check-available-sentinel-2-l2a-bands","label":"Check available Sentinel-2 L2A bands","html_id":"check-available-sentinel-2-l2a-bands","implicit":true,"key":"LCmVAYIEVN"},{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"Using EDC inbuilt functions that query Sentinel Hub services, we can easily list the available bands for a given dataset to help us build the cube!","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"o37nFjqNkm"}],"key":"h6lRdyVQdx"}],"visibility":"show","key":"wAqJoAotTq"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:47.430757Z","iopub.status.busy":"2023-03-22T13:00:47.430156Z","iopub.status.idle":"2023-03-22T13:00:47.652307Z","shell.execute_reply":"2023-03-22T13:00:47.649981Z"},"papermill":{"duration":0.26265,"end_time":"2023-03-22T13:00:47.658914","exception":false,"start_time":"2023-03-22T13:00:47.396264","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Create a Sentinel Hub class\nSH = SentinelHub()\n\n# List bands for S2-L2A\nSH.band_names('S2L2A')","visibility":"show","key":"za26dJKgny"},{"type":"output","id":"HGAxGy7nFG5i1KiTa5q8Q","data":[{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/plain":{"content":"['B01',\n 'B02',\n 'B03',\n 'B04',\n 'B05',\n 'B06',\n 'B07',\n 'B08',\n 'B8A',\n 'B09',\n 'B11',\n 'B12',\n 'SCL',\n 'SNW',\n 'CLD',\n 'viewZenithMean',\n 'viewAzimuthMean',\n 'sunZenithAngles',\n 'sunAzimuthAngles',\n 'AOT',\n 'CLM',\n 'CLP']","content_type":"text/plain"}}}],"visibility":"show","key":"ihErOhBTiu"}],"visibility":"show","key":"nuKgpSwJgQ"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.032592,"end_time":"2023-03-22T13:00:47.719863","exception":false,"start_time":"2023-03-22T13:00:47.687271","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build an xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"SPB8cr8VB0"}],"identifier":"build-an-xcube","label":"Build an xcube","html_id":"build-an-xcube","implicit":true,"key":"zSZ1J673bb"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we will specify the input parameters needed to build an xcube array. The following parameters are specified:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Y3OTgOYD86"}],"key":"SxpuSGfiXh"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"dataset_name","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"IPnOmsfFGi"}],"key":"EYeobW1OLR"},{"type":"text","value":": the Sentinel Hub identification of the dataset. Here we will call ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"LKEJDnkSOB"},{"type":"inlineCode","value":"S2L2A","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"f2dhNB3Egc"},{"type":"text","value":" for Sentinel-2 L2A. All available datasets can be listed with ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"N8ShqQS9ZC"},{"type":"inlineCode","value":"SH.dataset_names","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QE63jBCDhV"}],"key":"Kd0mhnQ13w"}],"key":"NLOFE3Wjgl"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"band_names","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"DfkbnWxc0T"}],"key":"C1aDzUDBxE"},{"type":"text","value":": the band names to be used in the xcube array (see previous code cell). Here, we will call the B02, B03, B04, B08, CLM (Blue, Green, Red & NIR, Cloud Mask) bands.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"JxJiSgYCgE"}],"key":"kJrwgk7h6J"}],"key":"PJGY3GXlGG"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"bbox","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"jUH4fdi3mx"}],"key":"ZeW9tPJqcJ"},{"type":"text","value":": the bounding box that sets the extent of the AOI. Because we are using the default WGS84 coordinate system here, the CRS parameter doesnât need to be set.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"YojIOnPWOt"}],"key":"VXSV76AdwY"}],"key":"WaQqdydlPo"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"spatial_res","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"rZQO9hBws7"}],"key":"U7mNKaDTxw"},{"type":"text","value":": the spatial resolution of the rasters contained in the xcube array. The spatial resolution is expressed in the units of the coordinate system used. Therefore, in this example, the spatial resolution is set in degrees. For an approximate pixel size of 30 meters, we set the resolution to 0.00045 degrees.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"uDJyH2Drpe"}],"key":"T5URBS1WKm"}],"key":"AgHiE95NXJ"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"time_range","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"supU96r7Wd"}],"key":"n4JafLTKfJ"},{"type":"text","value":": a list of two dates [start_date, end_date] forming a time period for which all acquisitions will be returned. Sentinel-2 L2A data is available from October 2016 onwards. In this example, we will fetch data for January 2022 through March 2022.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"uwpKNQTunM"}],"key":"IBRUfERikl"}],"key":"SZKpfdiV7T"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"time_tolerance","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"ha5qH2YfWa"}],"key":"HASgAjLNLa"},{"type":"text","value":": The tolerance used to identify whether a dataset should still be included within a time period. Here, ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"KlImbf51mh"},{"type":"inlineCode","value":"30M","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"PikmrGMFTv"},{"type":"text","value":" corresponds to 30 minutes, thus avoiding duplicate datasets.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"LEhppm9Z3i"}],"key":"wxpoyAMpxa"}],"key":"YZoGvtB0Kr"}],"key":"gcUwhRkbG8"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Note: the ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"EXafsJ3lsC"},{"type":"inlineCode","value":"return _coerce_scalar_to_timedelta_type(arg, unit=unit, errors=errors)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"bSvEacT5Pm"},{"type":"text","value":" warning can be safely ignored.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"NsQhvdKTw9"}],"key":"tX2F17gNpI"}],"key":"Ys7UxQCemG"}],"visibility":"show","key":"NtMApI0WTU"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:47.816861Z","iopub.status.busy":"2023-03-22T13:00:47.815405Z","iopub.status.idle":"2023-03-22T13:00:47.849284Z","shell.execute_reply":"2023-03-22T13:00:47.842190Z"},"papermill":{"duration":0.098227,"end_time":"2023-03-22T13:00:47.855907","exception":false,"start_time":"2023-03-22T13:00:47.757680","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Setup xcube\ns2_cube_config = CubeConfig(dataset_name='S2L2A',\n                            band_names=['B02', 'B03', 'B04', 'B08', 'CLM'],\n                            bbox=Antananarivo_bbox,\n                            spatial_res=0.00045,\n                            time_range=['2022-01-01', '2022-04-01'],\n                            time_tolerance='30M')","visibility":"show","key":"njaNbOWdL4"},{"type":"output","id":"pmKnQ7NYSodfbWwasHeQn","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/xcube_sh/config.py:248: FutureWarning: Units 'M', 'Y' and 'y' do not represent unambiguous timedelta values and will be removed in a future version.\n  time_tolerance = pd.to_timedelta(time_tolerance)\n"}],"visibility":"show","key":"LYAw9GUBai"}],"visibility":"show","key":"iRoF4Acmsp"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.036027,"end_time":"2023-03-22T13:00:47.935659","exception":false,"start_time":"2023-03-22T13:00:47.899632","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open the xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cgktSyhPri"}],"identifier":"open-the-xcube","label":"Open the xcube","html_id":"open-the-xcube","implicit":true,"key":"a0qVG1N1Or"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we open the cube and display its contents. Itâs important to note that at this stage, weâre not processing anything, but generate a cube on the fly with data ready to be called when needed for analysis.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"BtTvOgkJHe"}],"key":"vVljSvw49D"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Once you open the cube, you can visualise the contents. For example, you can view the number of timestamps as a list in the Coordinates tab. You can also visualise the seperate variables, with information on their size and data type.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Oij1jevr9Z"}],"key":"kor2aBD6C3"}],"visibility":"show","key":"Lk61vhfmdP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:48.009187Z","iopub.status.busy":"2023-03-22T13:00:48.006590Z","iopub.status.idle":"2023-03-22T13:00:48.475372Z","shell.execute_reply":"2023-03-22T13:00:48.473742Z"},"papermill":{"duration":0.509915,"end_time":"2023-03-22T13:00:48.480118","exception":false,"start_time":"2023-03-22T13:00:47.970203","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open cube (on the fly)\ns2_cube = open_cube(s2_cube_config)\n\n# Display contents\ns2_cube","visibility":"show","key":"Srr3wjaYWD"},{"type":"output","id":"6OF0b1G1GGS0FzpNGfyWF","data":[{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"caafd69da7f801d95e63b2be2f811d98","path":"/build/caafd69da7f801d95e63b2be2f811d98.html"},"text/plain":{"content":"<xarray.Dataset>\nDimensions:    (time: 36, lat: 1045, lon: 998, bnds: 2)\nCoordinates:\n  * lat        (lat) float64 -18.66 -18.66 -18.66 ... -19.13 -19.13 -19.13\n  * lon        (lon) float64 47.22 47.22 47.22 47.22 ... 47.67 47.67 47.67 47.67\n  * time       (time) datetime64[ns] 2022-01-03T07:14:49 ... 2022-03-31T07:04:55\n    time_bnds  (time, bnds) datetime64[ns] dask.array<chunksize=(36, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    B02        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    B03        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    B04        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    B08        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    CLM        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   S2L2A Data Cube Subset\n    history:                 [{'program': 'xcube_sh.chunkstore.SentinelHubChu...\n    date_created:            2023-03-22T13:00:48.269151\n    time_coverage_start:     2022-01-03T07:14:43+00:00\n    time_coverage_end:       2022-03-31T07:05:02+00:00\n    time_coverage_duration:  P86DT23H50M19S\n    geospatial_lon_min:      47.221985\n    geospatial_lat_min:      -19.129599\n    geospatial_lon_max:      47.671085\n    geospatial_lat_max:      -18.659349\n    processing_level:        L2A","content_type":"text/plain"}}}],"visibility":"show","key":"neAQZOtb9q"}],"visibility":"show","key":"JoljUMGuBo"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.039289,"end_time":"2023-03-22T13:00:48.560186","exception":false,"start_time":"2023-03-22T13:00:48.520897","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Create a new variable","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"i1TLvsR0zW"}],"identifier":"create-a-new-variable","label":"Create a new variable","html_id":"create-a-new-variable","implicit":true,"key":"hWWNxhNRKp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"A great way to visualise the extent of surface water with multispectral data at hand, is to use the Normalised Difference Water Index (NDWI). We can calculate the index with the Green and NIR bands as stated below, and add it to the data cube as a new variable.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"eRiMZ6VcLa"}],"key":"VTtxilwT2A"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"NDWI = Green - NIR / Green + NIR","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BaAC8CpbKD"}],"key":"cM2C1Rad1B"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"For this, we are going to create a new variable in the next cell. To create the new variable we are using two existing variables defined as s2.cube.B03 and s2_cube.B08. We then insert these variables into an index formula to calculate our ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bb342d7RvI"},{"type":"inlineCode","value":"ndwi","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hQlgbcxjnA"},{"type":"text","value":" variable. To integrate the new varibale into our data cube, we first need to define a new empty data cube attribute, provided with a name and associated units, before assigning the calculated ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"TQjuL711Xa"},{"type":"inlineCode","value":"ndwi","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"hY5n29vJ0f"},{"type":"text","value":" variable to it. Feel free to call ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"dFiKgvpouf"},{"type":"inlineCode","value":"s2_cube","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Aa1n960eLp"},{"type":"text","value":" again to check the newly added variable that can now be called from the data cube.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"M9TmgvhySR"}],"key":"zt6Y9ZmTGp"}],"visibility":"show","key":"C7g3uQBqXa"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:48.639867Z","iopub.status.busy":"2023-03-22T13:00:48.639445Z","iopub.status.idle":"2023-03-22T13:00:48.772995Z","shell.execute_reply":"2023-03-22T13:00:48.771477Z"},"papermill":{"duration":0.18119,"end_time":"2023-03-22T13:00:48.778187","exception":false,"start_time":"2023-03-22T13:00:48.596997","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Define NDWI in visualisation\nndwi = ((s2_cube.B03-s2_cube.B08)/(s2_cube.B03+s2_cube.B08))\n\nndwi.attrs['long_name'] = 'NDWI'\nndwi.attrs['units'] ='unitless'\n\ns2_cube['NDWI'] = ndwi\ns2_cube","visibility":"show","key":"h8qvuclzbs"},{"type":"output","id":"LfKfysmt6kWhQcvpZCvN_","data":[{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"4d089ce7f3726fd68e057b1a30fc5d57","path":"/build/4d089ce7f3726fd68e057b1a30fc5d57.html"},"text/plain":{"content":"<xarray.Dataset>\nDimensions:    (time: 36, lat: 1045, lon: 998, bnds: 2)\nCoordinates:\n  * lat        (lat) float64 -18.66 -18.66 -18.66 ... -19.13 -19.13 -19.13\n  * lon        (lon) float64 47.22 47.22 47.22 47.22 ... 47.67 47.67 47.67 47.67\n  * time       (time) datetime64[ns] 2022-01-03T07:14:49 ... 2022-03-31T07:04:55\n    time_bnds  (time, bnds) datetime64[ns] dask.array<chunksize=(36, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    B02        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    B03        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    B04        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    B08        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    CLM        (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    NDWI       (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   S2L2A Data Cube Subset\n    history:                 [{'program': 'xcube_sh.chunkstore.SentinelHubChu...\n    date_created:            2023-03-22T13:00:48.269151\n    time_coverage_start:     2022-01-03T07:14:43+00:00\n    time_coverage_end:       2022-03-31T07:05:02+00:00\n    time_coverage_duration:  P86DT23H50M19S\n    geospatial_lon_min:      47.221985\n    geospatial_lat_min:      -19.129599\n    geospatial_lon_max:      47.671085\n    geospatial_lat_max:      -18.659349\n    processing_level:        L2A","content_type":"text/plain"}}}],"visibility":"show","key":"gBxtOV65Oo"}],"visibility":"show","key":"cnWqLWSK03"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.034,"end_time":"2023-03-22T13:00:48.849421","exception":false,"start_time":"2023-03-22T13:00:48.815421","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"How to visualise your datacube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IJGgaMs16T"}],"identifier":"how-to-visualise-your-datacube","label":"How to visualise your datacube","html_id":"how-to-visualise-your-datacube","implicit":true,"key":"lqQ86yUMHm"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Visualise variables","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"l2QaQ8biqC"}],"identifier":"visualise-variables","label":"Visualise variables","html_id":"visualise-variables","implicit":true,"key":"Fdq0rHJXBo"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We are going to visualise a True Color image and the NDWI image in the same plot. For the True Color image, we select the Blue, Green and RED bands for one timstamp in the data cube in order to create a multiband RGB image stack. For visualisation purposes, we will multiply the reflectance values by 3 to brighten the image a little. We also fetch the NDWI variable for the exact same date for a side-by-side comparison.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"BCmgqXSC4p"}],"key":"Iry0w0hVUZ"}],"visibility":"show","key":"ifJuScWDF2"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:48.922552Z","iopub.status.busy":"2023-03-22T13:00:48.922125Z","iopub.status.idle":"2023-03-22T13:00:55.538405Z","shell.execute_reply":"2023-03-22T13:00:55.536600Z"},"papermill":{"duration":6.686338,"end_time":"2023-03-22T13:00:55.569959","exception":false,"start_time":"2023-03-22T13:00:48.883621","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select timestamp\nt = '2022-01-30 07:00:00'\n\n# Select the bands and stack them.\nRed = s2_cube.B04.sel(time=t, method='nearest')\nGreen = s2_cube.B03.sel(time=t, method='nearest')\nBlue = s2_cube.B02.sel(time=t, method='nearest')\n\nrgb = np.dstack((Red,Green,Blue)) #Stack the three arrays\n\nndwi = s2_cube.NDWI.sel(time=t, method='nearest')\n\n# Plot \nf = plt.figure(figsize=[18, 16])\nf.add_subplot(1, 2, 1)\nplt.title(f\"True Color: {str(s2_cube.time.sel(time=t, method='nearest').data).split('T')[0]}\")\nplt.imshow(3 * rgb)  # We multiply the rgb by 3 to make the image brighter\nf.add_subplot(1, 2, 2)\nplt.title(f\"NDWI: {str(s2_cube.time.sel(time=t, method='nearest').data).split('T')[0]}\")\nplt.imshow(ndwi, vmin=-1, vmax=1, cmap='GnBu')\nplt.show()","visibility":"show","key":"EaO8roRURc"},{"type":"output","id":"HZIu7XnsZg9XR4_qnYbIL","data":[{"name":"stderr","output_type":"stream","text":"Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1f4965e2e729a29c6251cbf6538ed7ee","path":"/build/1f4965e2e729a29c6251cbf6538ed7ee.png"},"text/plain":{"content":"<Figure size 1800x1600 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"ZQDFf2RriF"}],"visibility":"show","key":"fGKojn7Sng"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.069796,"end_time":"2023-03-22T13:00:55.712089","exception":false,"start_time":"2023-03-22T13:00:55.642293","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualise multiple timestamps","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"USr2AKS7uD"}],"identifier":"visualise-multiple-timestamps","label":"Visualise multiple timestamps","html_id":"visualise-multiple-timestamps","implicit":true,"key":"WO10dX8iu5"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"We would like to get a better idea of the course of events and examine how the two storm weather systems affected the area. The flooding events we are trying to monitor happened in the middle of the Southwest Indian Ocean cyclone season, which approximately lasts from November until April. In order to check how many suitable Sentinel-2 acquisitions we have at hand, we will take a look at multiple timestamps from the data cube.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"h1asEEw4vs"}],"key":"b9TF3XOvBz"}],"visibility":"show","key":"GUa6cuYbHz"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:00:55.872862Z","iopub.status.busy":"2023-03-22T13:00:55.872319Z","iopub.status.idle":"2023-03-22T13:01:16.087099Z","shell.execute_reply":"2023-03-22T13:01:16.085528Z"},"papermill":{"duration":20.328313,"end_time":"2023-03-22T13:01:16.113048","exception":false,"start_time":"2023-03-22T13:00:55.784735","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Select timestamps\nndwi1 = s2_cube.NDWI.sel(time='2022-01-05 07:00:00', method='nearest')\nndwi2 = s2_cube.NDWI.sel(time='2022-01-15 07:00:00', method='nearest')\nndwi3 = s2_cube.NDWI.sel(time='2022-01-30 07:00:00', method='nearest')\nndwi4 = s2_cube.NDWI.sel(time='2022-02-09 07:00:00', method='nearest')\nndwi5 = s2_cube.NDWI.sel(time='2022-02-24 07:00:00', method='nearest')\nndwi6 = s2_cube.NDWI.sel(time='2022-03-06 07:00:00', method='nearest')\nndwi7 = s2_cube.NDWI.sel(time='2022-03-16 07:00:00', method='nearest')\nndwi8 = s2_cube.NDWI.sel(time='2022-03-31 07:00:00', method='nearest')\n\n# Plot \nf = plt.figure(figsize=[16, 18])\nax1 = f.add_subplot(3, 3, 1)\nax2 = f.add_subplot(3, 3, 2)\nax3 = f.add_subplot(3, 3, 3)\nax4 = f.add_subplot(3, 3, 4)\nax5 = f.add_subplot(3, 3, 5)\nax6 = f.add_subplot(3, 3, 6)\nax7 = f.add_subplot(3, 3, 7)\nax8 = f.add_subplot(3, 3, 8)\n\naxlist = [ax1, ax2, ax3, ax4, ax5, ax6, ax7, ax8]\n\nt = ndwi1.plot.imshow(ax=ax1, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi2.plot.imshow(ax=ax2, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi3.plot.imshow(ax=ax3, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi4.plot.imshow(ax=ax4, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi5.plot.imshow(ax=ax5, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi6.plot.imshow(ax=ax6, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi7.plot.imshow(ax=ax7, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\nndwi8.plot.imshow(ax=ax8, vmin=-1, vmax=1, cmap='GnBu', add_colorbar=False)\n\ncbar_ax = f.add_axes([1, 0.15, 0.05, 0.7])\nf.colorbar(t, cax=cbar_ax, label=\"NDWI\")\n\nplt.show()","visibility":"show","key":"xYO2wREERP"},{"type":"output","id":"SDJCOKghAmnta21TLBxh_","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3fd1cf950f1072b15c40ba8f86afc695","path":"/build/3fd1cf950f1072b15c40ba8f86afc695.png"},"text/plain":{"content":"<Figure size 1600x1800 with 9 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"jZ81bkIJw3"}],"visibility":"show","key":"krUGfaWjt4"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.207117,"end_time":"2023-03-22T13:01:16.461933","exception":false,"start_time":"2023-03-22T13:01:16.254816","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Unsurprisingly, the weather conditions during storm season are not suitable for Earth monitoring with optical imagery. Of the eight dates we have requested, only one, the acquisition from 30th January, is not completely overcast and the remaining ones are unusable. Fortunately, we can resort to using Sentinel-1 GRD radar data, which is unimpeded by weather conditions and should provide a better picture of the course of events.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ApxnaTy90U"}],"key":"rknGKNj5uS"},{"type":"thematicBreak","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"TUeFxiRjAO"}],"visibility":"show","key":"aHhHtiV0Eu"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.13127,"end_time":"2023-03-22T13:01:16.722077","exception":false,"start_time":"2023-03-22T13:01:16.590807","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Buildind a Sentinel-1 data cube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"tTxXcOmLTf"}],"identifier":"buildind-a-sentinel-1-data-cube","label":"Buildind a Sentinel-1 data cube","html_id":"buildind-a-sentinel-1-data-cube","implicit":true,"key":"qG9HpzHvGH"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"The Sentinel-1 satellite system is also part of the Copernicus programme and collects data globally with a revisit time of 5 days when both twin satellites are active. Unfortunately, the recent failure of Sentinel-1B leaves us with longer revisit times (","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"VTBijrztXb"},{"type":"link","url":"https://scihub.copernicus.eu/news/News01026","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"source","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"dXs7ZXnaHe"}],"urlSource":"https://scihub.copernicus.eu/news/News01026","key":"Zw2LMau3vJ"},{"type":"text","value":"). In contrast to Sentinel-2, Sentinel-1 SAR is an active sensor that sends SAR signals and records the backscatter. Due to the wavelengths used, SAR is not hindered by clouds and can be operated day and night.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"fgAbpTk1wp"}],"key":"MY776DaG1F"}],"visibility":"show","key":"LyVBXEaYc0"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.140898,"end_time":"2023-03-22T13:01:16.982767","exception":false,"start_time":"2023-03-22T13:01:16.841869","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Check Sentinel-1 GRD available bands","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"vFNgcLlbHo"}],"identifier":"check-sentinel-1-grd-available-bands","label":"Check Sentinel-1 GRD available bands","html_id":"check-sentinel-1-grd-available-bands","implicit":true,"key":"l63iKGu0dI"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Using EDC inbuilt functions that query Sentinel Hub services, we can easily list the available bands for a given dataset.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"xxmPJKuMJq"}],"key":"zqep1n7ksc"}],"visibility":"show","key":"b9PAErI4yQ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:17.225360Z","iopub.status.busy":"2023-03-22T13:01:17.223415Z","iopub.status.idle":"2023-03-22T13:01:17.250742Z","shell.execute_reply":"2023-03-22T13:01:17.248718Z"},"papermill":{"duration":0.152241,"end_time":"2023-03-22T13:01:17.253856","exception":false,"start_time":"2023-03-22T13:01:17.101615","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# List bands for S1-GRD\nSH.band_names('S1GRD')","visibility":"show","key":"HnXBPn7UEI"},{"type":"output","id":"xzgfZoSKR0eURPKduyAqM","data":[{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/plain":{"content":"['VV', 'HH', 'VH', 'localIncidenceAngle', 'scatteringArea', 'shadowMask', 'HV']","content_type":"text/plain"}}}],"visibility":"show","key":"trArB0y2Xn"}],"visibility":"show","key":"AMZpRfrl7v"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.106507,"end_time":"2023-03-22T13:01:17.480606","exception":false,"start_time":"2023-03-22T13:01:17.374099","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Build the S-1 GRD xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"sw7g3k7vHe"}],"identifier":"build-the-s-1-grd-xcube","label":"Build the S-1 GRD xcube","html_id":"build-the-s-1-grd-xcube","implicit":true,"key":"ZNCsKnygRB"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we will specify the input parameters needed to build an xcube array. The following parameters are specified:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"yqVZWMkHDh"}],"key":"yyZberl8J6"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":5,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":5,"column":1},"end":{"line":6,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"dataset_name","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"qPVvszEI6n"}],"key":"TkH5s9YSae"},{"type":"text","value":": the Sentinel Hub identification of the dataset. Here we will call ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VFhjUtQD6r"},{"type":"inlineCode","value":"S1GRD","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"uI8IPpnobK"},{"type":"text","value":" for Sentinel-1 GRD. All available datasets can be listed with ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"I1RJPyipdy"},{"type":"inlineCode","value":"SH.dataset_names","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gpHnK2hOOU"}],"key":"ssYByzJ6gz"}],"key":"zvUOAuw8Qw"},{"type":"listItem","spread":true,"position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"band_names","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"N0zTIbD8Cl"}],"key":"CFoYxrNMcm"},{"type":"text","value":": the band names to be used in the xcube array (see previous code cell). Here, we will call just the VV polarisation band.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"bXCKLofHSz"}],"key":"zv5FXzGyPE"}],"key":"TQhV0cjztX"},{"type":"listItem","spread":true,"position":{"start":{"line":9,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"children":[{"type":"text","value":"bbox","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"avbcozw7Ic"}],"key":"QfZDfwx1qX"},{"type":"text","value":": the bounding box that sets the extent of the AOI. Because we are using the default WGS84 coordinate system here, the CRS parameter doesnât need to be set.","position":{"start":{"line":9,"column":1},"end":{"line":9,"column":1}},"key":"ZXHqhC9JsB"}],"key":"QdIl3V0uVg"}],"key":"wSV1kttWNl"},{"type":"listItem","spread":true,"position":{"start":{"line":11,"column":1},"end":{"line":12,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"spatial_res","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"R0Kj2XfbUt"}],"key":"mkG20MXZaG"},{"type":"text","value":": the spatial resolution of the rasters contained in the xcube array. The spatial resolution is expressed in the units of the coordinate system used. Therefore, in this example, the spatial resolution is set in degrees. For an approximate pixel size of 30 meters, we set the resolution to 0.00045 degrees.","position":{"start":{"line":11,"column":1},"end":{"line":11,"column":1}},"key":"v3R0tggCpy"}],"key":"esz878UsOM"}],"key":"Z9MYkG74kW"},{"type":"listItem","spread":true,"position":{"start":{"line":13,"column":1},"end":{"line":14,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"time_range","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"affzPUEDsC"}],"key":"LhKqRqD7th"},{"type":"text","value":": a list of two dates [start_date, end_date] forming a time period for which all acquisitions will be returned. Sentinel-1 GRD data is available from February 2015 onwards. In this example, we will fetch data for January 2022 through March 2022.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"Ksog1QIamO"}],"key":"LL774fQcjt"}],"key":"qH4u54SoW0"},{"type":"listItem","spread":true,"position":{"start":{"line":15,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"paragraph","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"children":[{"type":"text","value":"time_tolerance","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"Rhwyyn0fID"}],"key":"LoLG4ItWK9"},{"type":"text","value":": The tolerance used to identify whether a dataset should still be included within a time period. Here, ","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"T9mcWdIb0A"},{"type":"inlineCode","value":"30M","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"X4MPonKnzp"},{"type":"text","value":" corresponds to 30 minutes, thus avoiding duplicate datasets.","position":{"start":{"line":15,"column":1},"end":{"line":15,"column":1}},"key":"G0ehCJcBWQ"}],"key":"KBxC5i36Om"}],"key":"CfAmohWNnN"}],"key":"NMT9dOjXEw"},{"type":"paragraph","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"emphasis","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"children":[{"type":"text","value":"Note: the ","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"kPYidUxj0o"},{"type":"inlineCode","value":"return _coerce_scalar_to_timedelta_type(arg, unit=unit, errors=errors)","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"zQ2p7CeCSo"},{"type":"text","value":" warning can be safely ignored.","position":{"start":{"line":17,"column":1},"end":{"line":17,"column":1}},"key":"ToWXeGHXU0"}],"key":"P8cWJJXESv"}],"key":"HGwXmpSRz0"}],"visibility":"show","key":"PvPFlh5CQu"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:17.705417Z","iopub.status.busy":"2023-03-22T13:01:17.703849Z","iopub.status.idle":"2023-03-22T13:01:17.717644Z","shell.execute_reply":"2023-03-22T13:01:17.714859Z"},"papermill":{"duration":0.144429,"end_time":"2023-03-22T13:01:17.734762","exception":false,"start_time":"2023-03-22T13:01:17.590333","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Setup xcube\ns1_cube_config = CubeConfig(dataset_name='S1GRD',\n                            band_names=['VV'],\n                            bbox=Antananarivo_bbox,\n                            spatial_res=0.00045,\n                            time_range=['2022-01-01', '2022-04-01'],\n                            time_tolerance='30M')","visibility":"show","key":"dT0R36oyGy"},{"type":"output","id":"6UW52tdNGuLC-Aljlshvh","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/xcube_sh/config.py:248: FutureWarning: Units 'M', 'Y' and 'y' do not represent unambiguous timedelta values and will be removed in a future version.\n  time_tolerance = pd.to_timedelta(time_tolerance)\n"}],"visibility":"show","key":"EFZNiEDbKm"}],"visibility":"show","key":"TixhfF0QJR"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.159292,"end_time":"2023-03-22T13:01:18.069906","exception":false,"start_time":"2023-03-22T13:01:17.910614","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Open the xcube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"bBbQ3GRfh3"}],"identifier":"open-the-xcube","label":"Open the xcube","html_id":"open-the-xcube-1","implicit":true,"key":"C2NEjMp9oR"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"In the following cell we pass the configurated cube to the open cube command to open the cube and display its contents.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Fan956YSqU"}],"key":"WHnjJUQRyj"}],"visibility":"show","key":"GlzkDcpysN"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:18.330950Z","iopub.status.busy":"2023-03-22T13:01:18.330575Z","iopub.status.idle":"2023-03-22T13:01:18.673200Z","shell.execute_reply":"2023-03-22T13:01:18.671773Z"},"papermill":{"duration":0.458801,"end_time":"2023-03-22T13:01:18.677166","exception":false,"start_time":"2023-03-22T13:01:18.218365","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Open cube (on the fly)\ns1_cube = open_cube(s1_cube_config)\n\n# Display contents\ns1_cube","visibility":"show","key":"gDJ8B2xzAw"},{"type":"output","id":"EMgB1fQEOtRayp4wQRiuU","data":[{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"26670d4c2f133e5135eb7b28170cf186","path":"/build/26670d4c2f133e5135eb7b28170cf186.html"},"text/plain":{"content":"<xarray.Dataset>\nDimensions:    (time: 8, lat: 1045, lon: 998, bnds: 2)\nCoordinates:\n  * lat        (lat) float64 -18.66 -18.66 -18.66 ... -19.13 -19.13 -19.13\n  * lon        (lon) float64 47.22 47.22 47.22 47.22 ... 47.67 47.67 47.67 47.67\n  * time       (time) datetime64[ns] 2022-01-03T02:19:35 ... 2022-03-28T02:19:33\n    time_bnds  (time, bnds) datetime64[ns] dask.array<chunksize=(8, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    VV         (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   S1GRD Data Cube Subset\n    history:                 [{'program': 'xcube_sh.chunkstore.SentinelHubChu...\n    date_created:            2023-03-22T13:01:18.601978\n    time_coverage_start:     2022-01-03T02:19:35+00:00\n    time_coverage_end:       2022-03-28T02:19:33+00:00\n    time_coverage_duration:  P83DT23H59M58S\n    geospatial_lon_min:      47.221985\n    geospatial_lat_min:      -19.129599\n    geospatial_lon_max:      47.671085\n    geospatial_lat_max:      -18.659349\n    processing_level:        L1B","content_type":"text/plain"}}}],"visibility":"show","key":"FdEk22yCZI"}],"visibility":"show","key":"VHEE89lEWh"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.11505,"end_time":"2023-03-22T13:01:18.942269","exception":false,"start_time":"2023-03-22T13:01:18.827219","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Visualising the flooded areas using SAR","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"mbUAPeGlDE"}],"identifier":"visualising-the-flooded-areas-using-sar","label":"Visualising the flooded areas using SAR","html_id":"visualising-the-flooded-areas-using-sar","implicit":true,"key":"EHXV9YWOPe"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Firstly, we need to generate a new variable. For Sentinel-1 data, the values are returned in linear power. For a more convenient analysis we will convert the values to decibels. This is done by mutiplying the log10 of each pixel value by 10. Secondly, as there will be pixels with a value of -inf after this operation, we need to account for this with the second function that will automatically assign 0 to these pixels.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"vR9sKO8d7x"}],"key":"mgrC0jsEYZ"}],"visibility":"show","key":"SdbVkqOu9Z"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:19.195415Z","iopub.status.busy":"2023-03-22T13:01:19.194830Z","iopub.status.idle":"2023-03-22T13:01:19.221979Z","shell.execute_reply":"2023-03-22T13:01:19.219640Z"},"papermill":{"duration":0.168906,"end_time":"2023-03-22T13:01:19.229476","exception":false,"start_time":"2023-03-22T13:01:19.060570","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Convert VV Digital numbers to Decibels\nvv_dn = s1_cube.VV\nvv_db = 10 * (np.log10(vv_dn))\n\nvv_db = vv_db.where(np.isfinite(vv_db), 0)\n\nvv_db.attrs['long_name'] = 'VV_dB'\nvv_db.attrs['units'] = 'decibels'\n\ns1_cube['VV_dB'] = vv_db","visibility":"show","key":"Nn3mcrNhuW"},{"type":"output","id":"LJ1e7bAiVKw--e5Xk6392","data":[],"visibility":"show","key":"TWstZMaTl2"}],"visibility":"show","key":"oQ1UuSuIwO"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.107087,"end_time":"2023-03-22T13:01:19.450333","exception":false,"start_time":"2023-03-22T13:01:19.343246","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"From the news and our previous visualisation of Sentinel-2 data, we know that there was significant surface water flooding in January and February 2022. Letâs visualise one of the acquisitions from the end of January, when the tropical storm ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XK7JbxLhSW"},{"type":"emphasis","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Ana","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"isvf57wlBO"}],"key":"EY064VP537"},{"type":"text","value":" brought heavy rainfall to the area. Here, we select the closest acquisition to 25th January 2022 and plot the calculated ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"j7MzZXhcsn"},{"type":"inlineCode","value":"VV_dB","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"DfYQyCChMX"},{"type":"text","value":" variable for our region of interest.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"knyLgBM4Ce"}],"key":"uUQVpGMJjb"}],"visibility":"show","key":"elHHMyVV9F"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:19.680997Z","iopub.status.busy":"2023-03-22T13:01:19.680453Z","iopub.status.idle":"2023-03-22T13:01:22.634264Z","shell.execute_reply":"2023-03-22T13:01:22.632831Z"},"papermill":{"duration":3.08264,"end_time":"2023-03-22T13:01:22.642549","exception":false,"start_time":"2023-03-22T13:01:19.559909","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# select and define the timestamp you want to visualise \nVV_dB_timestamp = s1_cube.VV_dB.sel(time='2022-01-25 07:00:00', method='nearest')\n\n# plot the timestamp\nVV_dB_timestamp.plot.imshow(vmin=-40, vmax=0, cmap='winter', figsize=(10, 10))\n\n# save and display the plot\nplt.show()","visibility":"show","key":"ebjCLET7Rf"},{"type":"output","id":"wJUUnVWGWNAErM-sHKzAm","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3e6cc842aa27c15cc96ad723e24db917","path":"/build/3e6cc842aa27c15cc96ad723e24db917.png"},"text/plain":{"content":"<Figure size 1000x1000 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"SWMEqyv38x"}],"visibility":"show","key":"XDC1BnWzfE"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.122003,"end_time":"2023-03-22T13:01:22.875886","exception":false,"start_time":"2023-03-22T13:01:22.753883","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"On this Sentinel-1 acquisition from 27th January, we can clearly see the extent of flooded areas in darker blue colour. The visualisation already looks fairly well defined, so letâs plot multiple timestamps to confirm that this is a good variable for generating subsequent products like flood masks.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uoBtGqdqV9"}],"key":"KlcjeEumEJ"}],"visibility":"show","key":"DrF2LD8kFJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:23.160721Z","iopub.status.busy":"2023-03-22T13:01:23.159899Z","iopub.status.idle":"2023-03-22T13:01:36.239302Z","shell.execute_reply":"2023-03-22T13:01:36.237534Z"},"papermill":{"duration":13.25194,"end_time":"2023-03-22T13:01:36.273201","exception":false,"start_time":"2023-03-22T13:01:23.021261","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#### Timestamp selection\nvv1 = s1_cube.VV_dB.sel(time='2022-01-03 07:00:00', method='nearest')\nvv2 = s1_cube.VV_dB.sel(time='2022-01-15 07:00:00', method='nearest')\nvv3 = s1_cube.VV_dB.sel(time='2022-01-27 07:00:00', method='nearest')\nvv4 = s1_cube.VV_dB.sel(time='2022-02-08 07:00:00', method='nearest')\nvv5 = s1_cube.VV_dB.sel(time='2022-02-20 07:00:00', method='nearest')\nvv6 = s1_cube.VV_dB.sel(time='2022-03-04 07:00:00', method='nearest')\nvv7 = s1_cube.VV_dB.sel(time='2022-03-16 07:00:00', method='nearest')\nvv8 = s1_cube.VV_dB.sel(time='2022-03-28 07:00:00', method='nearest')\n\n# Plot \nf = plt.figure(figsize=[16, 18])\nax1 = f.add_subplot(3, 3, 1)\nax2 = f.add_subplot(3, 3, 2)\nax3 = f.add_subplot(3, 3, 3)\nax4 = f.add_subplot(3, 3, 4)\nax5 = f.add_subplot(3, 3, 5)\nax6 = f.add_subplot(3, 3, 6)\nax7 = f.add_subplot(3, 3, 7)\nax8 = f.add_subplot(3, 3, 8)\n\naxlist = [ax1, ax2, ax3, ax4, ax5, ax6, ax7, ax8]\n\nt = vv1.plot.imshow(ax=ax1, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv2.plot.imshow(ax=ax2, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv3.plot.imshow(ax=ax3, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv4.plot.imshow(ax=ax4, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv5.plot.imshow(ax=ax5, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv6.plot.imshow(ax=ax6, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv7.plot.imshow(ax=ax7, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\nvv8.plot.imshow(ax=ax8, vmin=-40, vmax=0, cmap='winter', add_colorbar=False)\n\ncbar_ax = f.add_axes([1, 0.15, 0.05, 0.7])\nf.colorbar(t, cax=cbar_ax, label=\"VV dB\")\n\nplt.show()","visibility":"show","key":"fa90awlbRl"},{"type":"output","id":"BhQaKMKITN6fqVnnz-jPJ","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"f19f583ad6d13f6cc5d37444796a88df","path":"/build/f19f583ad6d13f6cc5d37444796a88df.png"},"text/plain":{"content":"<Figure size 1600x1800 with 9 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"QM64A2ED2j"}],"visibility":"show","key":"AciWtUHucj"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.170639,"end_time":"2023-03-22T13:01:36.667471","exception":false,"start_time":"2023-03-22T13:01:36.496832","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This gives us a much clearer picture of the spatial and temporal extent of the flooding events in the region. We can make out two flooding peaks in the acquisitons from 27th January and 4th March, which are congruent with the reports on the two storms making landfall.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"e8bS9f8mz9"}],"key":"MEjlMylOVY"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Creating a flood mask","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"byOGzC5BYd"}],"identifier":"creating-a-flood-mask","label":"Creating a flood mask","html_id":"creating-a-flood-mask","implicit":true,"key":"qQuqwk7AnU"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Next, we want to generate a flood mask using a threshold for the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"zaH1rn26GT"},{"type":"inlineCode","value":"VV_dB","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"lqjr7hKDOL"},{"type":"text","value":" variable. In VV polarization mode, values below -20 dB are usually surface water. Letâs define different thresholds for a side-by-side comparison in order to find the most suitable value for generating the flood mask.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"oWfUHQiXRr"}],"key":"aWZf2pZCnL"}],"visibility":"show","key":"Tj8ZNGKzfQ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:37.237513Z","iopub.status.busy":"2023-03-22T13:01:37.236300Z","iopub.status.idle":"2023-03-22T13:01:37.315745Z","shell.execute_reply":"2023-03-22T13:01:37.312592Z"},"papermill":{"duration":0.348192,"end_time":"2023-03-22T13:01:37.328625","exception":false,"start_time":"2023-03-22T13:01:36.980433","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"flood_threshold1_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB >= -15, 1)\nflood_threshold2_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB >= -18, 1)\nflood_threshold3_step1 = s1_cube.VV_dB.where(s1_cube.VV_dB >= -20, 1)\n\nflood_threshold1_step2 = flood_threshold1_step1.where(flood_threshold1_step1 == 1, 0)\nflood_threshold2_step2 = flood_threshold2_step1.where(flood_threshold2_step1 == 1, 0)\nflood_threshold3_step2 = flood_threshold3_step1.where(flood_threshold3_step1 == 1, 0)\n\nflood_threshold1 = flood_threshold1_step2.sel(time='2022-01-27 07:00:00', method='nearest')\nflood_threshold2 = flood_threshold2_step2.sel(time='2022-01-27 07:00:00', method='nearest')\nflood_threshold3 = flood_threshold3_step2.sel(time='2022-01-27 07:00:00', method='nearest')","visibility":"show","key":"QpPnORnyB5"},{"type":"output","id":"-9AYgS6fMjbMxYslsQ2Hz","data":[],"visibility":"show","key":"PB5usNBxJp"}],"visibility":"show","key":"rZs6jWDPYx"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.154039,"end_time":"2023-03-22T13:01:37.685494","exception":false,"start_time":"2023-03-22T13:01:37.531455","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next we will plot the new thresholds we want to test:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dZ0x9f3Q22"}],"key":"d1D3sgJB3D"}],"visibility":"show","key":"ZMcx6NTURn"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:38.109846Z","iopub.status.busy":"2023-03-22T13:01:38.108042Z","iopub.status.idle":"2023-03-22T13:01:39.688201Z","shell.execute_reply":"2023-03-22T13:01:39.685989Z"},"papermill":{"duration":1.819761,"end_time":"2023-03-22T13:01:39.702571","exception":false,"start_time":"2023-03-22T13:01:37.882810","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot \nf = plt.figure(figsize=[20, 16])\nax1 = f.add_subplot(2, 3, 1)\nax2 = f.add_subplot(2, 3, 2)\nax3 = f.add_subplot(2, 3, 3)\n\nflood_threshold1.plot.imshow(ax=ax1, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nflood_threshold2.plot.imshow(ax=ax2, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nflood_threshold3.plot.imshow(ax=ax3, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\n\nplt.show()","visibility":"show","key":"JszaxYPkxQ"},{"type":"output","id":"AS6ZaFFOSjNiSVNHOE7Ux","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"d52db9cd8aed2af53f58384be139a058","path":"/build/d52db9cd8aed2af53f58384be139a058.png"},"text/plain":{"content":"<Figure size 2000x1600 with 3 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"z5LlMETXWf"}],"visibility":"show","key":"ogGCapQOO3"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.204567,"end_time":"2023-03-22T13:01:40.154550","exception":false,"start_time":"2023-03-22T13:01:39.949983","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Changing the threshold by only 2 or 3 dB makes a large difference. If we set a higher threshold, we pick up a lot more false positives. With a lower threshold, we start to create more false negatives and a more fragmented flood extent. Based on the visualisation above, we will use -18 dB as the threshold.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jbEtzISOTL"}],"key":"OCeDoiBdxi"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Letâs add the flood mask variable to our Sentinel-1 data cube. At first glance, the below cell may not make much sense. The definition of variable ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"uslF7Bbtc3"},{"type":"inlineCode","value":"step1","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"td8RCxm9D2"},{"type":"text","value":" could be interpreted as assigning a value of 1 to pixels that are equal or more than -18 dB. However, what is actually happening is that theÂ ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"bw5hiUc3Nh"},{"type":"inlineCode","value":".where","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"XfGZRK2heR"},{"type":"text","value":" method preserves all the pixel values of the variable that are below -18 dB and assigns everything else a value of 1. More detailed information on the method can be found in the ","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"gVTJHJRLcp"},{"type":"link","url":"https://xarray.pydata.org/en/stable/generated/xarray.DataArray.where.html","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"respective xarray documentation","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"Iy0BpzBOjB"}],"urlSource":"https://xarray.pydata.org/en/stable/generated/xarray.DataArray.where.html","key":"WU5rOcI7eZ"},{"type":"text","value":".","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"UHp4xC4Ssh"}],"key":"Zu2XoznJz9"}],"visibility":"show","key":"kWyqrHxf0b"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:40.493257Z","iopub.status.busy":"2023-03-22T13:01:40.486675Z","iopub.status.idle":"2023-03-22T13:01:40.568271Z","shell.execute_reply":"2023-03-22T13:01:40.565688Z"},"papermill":{"duration":0.243315,"end_time":"2023-03-22T13:01:40.571699","exception":false,"start_time":"2023-03-22T13:01:40.328384","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Assign all pixels equal or smaller than -18 a value of 1 and preserve the values of pixels \nstep1 = s1_cube.VV_dB.where(s1_cube.VV_dB >= -18, 1)\n\n# Assign all other pixels a value of 0. \nflooded = step1.where(step1 == 1, 0)\n\nflooded.attrs['long_name'] = 'flood_mask'\nflooded.attrs['units'] = 'nounits'\n\ns1_cube['flood_mask'] = flooded\ns1_cube","visibility":"show","key":"RR7mdkQnNe"},{"type":"output","id":"z96IImeRdZzO6o13g_h_P","data":[{"output_type":"execute_result","execution_count":18,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"179042f31b7a1c610e48a091468858a5","path":"/build/179042f31b7a1c610e48a091468858a5.html"},"text/plain":{"content":"<xarray.Dataset>\nDimensions:     (time: 8, lat: 1045, lon: 998, bnds: 2)\nCoordinates:\n  * lat         (lat) float64 -18.66 -18.66 -18.66 ... -19.13 -19.13 -19.13\n  * lon         (lon) float64 47.22 47.22 47.22 47.22 ... 47.67 47.67 47.67\n  * time        (time) datetime64[ns] 2022-01-03T02:19:35 ... 2022-03-28T02:1...\n    time_bnds   (time, bnds) datetime64[ns] dask.array<chunksize=(8, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    VV          (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    VV_dB       (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    flood_mask  (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   S1GRD Data Cube Subset\n    history:                 [{'program': 'xcube_sh.chunkstore.SentinelHubChu...\n    date_created:            2023-03-22T13:01:18.601978\n    time_coverage_start:     2022-01-03T02:19:35+00:00\n    time_coverage_end:       2022-03-28T02:19:33+00:00\n    time_coverage_duration:  P83DT23H59M58S\n    geospatial_lon_min:      47.221985\n    geospatial_lat_min:      -19.129599\n    geospatial_lon_max:      47.671085\n    geospatial_lat_max:      -18.659349\n    processing_level:        L1B","content_type":"text/plain"}}}],"visibility":"show","key":"pZRGki13jN"}],"visibility":"show","key":"u7Ktbpt3li"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.152535,"end_time":"2023-03-22T13:01:40.874435","exception":false,"start_time":"2023-03-22T13:01:40.721900","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Letâs plot the generated flood mask over multiple timestamps again:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"K6nDWtNyMc"}],"key":"sXj1rATWRr"}],"visibility":"show","key":"KVHkvThB2I"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:41.202892Z","iopub.status.busy":"2023-03-22T13:01:41.202489Z","iopub.status.idle":"2023-03-22T13:01:44.431864Z","shell.execute_reply":"2023-03-22T13:01:44.429612Z"},"papermill":{"duration":3.395669,"end_time":"2023-03-22T13:01:44.436913","exception":false,"start_time":"2023-03-22T13:01:41.041244","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"#### Timestamp selection\nfm1 = s1_cube.flood_mask.sel(time='2022-01-03 07:00:00', method='nearest')\nfm2 = s1_cube.flood_mask.sel(time='2022-01-15 07:00:00', method='nearest')\nfm3 = s1_cube.flood_mask.sel(time='2022-01-27 07:00:00', method='nearest')\nfm4 = s1_cube.flood_mask.sel(time='2022-02-08 07:00:00', method='nearest')\nfm5 = s1_cube.flood_mask.sel(time='2022-02-20 07:00:00', method='nearest')\nfm6 = s1_cube.flood_mask.sel(time='2022-03-04 07:00:00', method='nearest')\nfm7 = s1_cube.flood_mask.sel(time='2022-03-16 07:00:00', method='nearest')\nfm8 = s1_cube.flood_mask.sel(time='2022-03-28 07:00:00', method='nearest')\n\n# Plot \nf = plt.figure(figsize=[16, 18])\nax1 = f.add_subplot(3, 3, 1)\nax2 = f.add_subplot(3, 3, 2)\nax3 = f.add_subplot(3, 3, 3)\nax4 = f.add_subplot(3, 3, 4)\nax5 = f.add_subplot(3, 3, 5)\nax6 = f.add_subplot(3, 3, 6)\nax7 = f.add_subplot(3, 3, 7)\nax8 = f.add_subplot(3, 3, 8)\n\naxlist = [ax1, ax2, ax3, ax4, ax5, ax6, ax7, ax8]\n\nt = fm1.plot.imshow(ax=ax1, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nfm2.plot.imshow(ax=ax2, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nfm3.plot.imshow(ax=ax3, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nfm4.plot.imshow(ax=ax4, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nfm5.plot.imshow(ax=ax5, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nfm6.plot.imshow(ax=ax6, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nfm7.plot.imshow(ax=ax7, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\nfm8.plot.imshow(ax=ax8, vmin=0, vmax=1, cmap='Blues', add_colorbar=False)\n\nplt.show()","visibility":"show","key":"rk03CLRAMA"},{"type":"output","id":"ilWzpvOvSdOSfUCwyv9pW","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"1104d027368812c9380ff501d9c6c5ef","path":"/build/1104d027368812c9380ff501d9c6c5ef.png"},"text/plain":{"content":"<Figure size 1600x1800 with 8 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"k1JvC1hqmB"}],"visibility":"show","key":"mSrLE2sp7U"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.192645,"end_time":"2023-03-22T13:01:44.802807","exception":false,"start_time":"2023-03-22T13:01:44.610162","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Despite the flood mask containing some noise, the chosen threshold looks adequate across time and space. Letâs move on to visualising the data from the temporal point of view.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IwAsl6P3oY"}],"key":"rBWGXRMISG"},{"type":"heading","depth":2,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"How to generate a time series plot for a point","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"E1ahOxqOtA"}],"identifier":"how-to-generate-a-time-series-plot-for-a-point","label":"How to generate a time series plot for a point","html_id":"how-to-generate-a-time-series-plot-for-a-point","implicit":true,"key":"Qa9nr99yRB"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We now have a really good picture of how the flooding evolved over space and time. Following this, we want to monitor a specific point location within the AOI and observe how NDWI and then VV_dB variables in the cubes compare over time. Firstly, we define the pointâs coordinates with ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QqSL9qJ7AO"},{"type":"inlineCode","value":"point_lat","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"pgw20Y1pGi"},{"type":"text","value":" and ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"rlrwhP5CZG"},{"type":"inlineCode","value":"point_lon","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"YtKvxXL1C3"},{"type":"text","value":". These are used as inputs when we select the variables accross all available timestamps with the help of the ","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"VL4Y5E9vsq"},{"type":"inlineCode","value":".to_series()","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"xOcmR5I5xV"},{"type":"text","value":" method. Itâs at this point too that we use the CLM variable to mask out cloudy areas from the Sentinel 2 acquisitions in the time steps.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"z5Boo6hUPQ"}],"key":"eHwSSjoWQj"}],"visibility":"show","key":"xtAebc3dyP"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:45.100606Z","iopub.status.busy":"2023-03-22T13:01:45.098325Z","iopub.status.idle":"2023-03-22T13:01:45.112784Z","shell.execute_reply":"2023-03-22T13:01:45.110009Z"},"papermill":{"duration":0.171386,"end_time":"2023-03-22T13:01:45.121577","exception":false,"start_time":"2023-03-22T13:01:44.950191","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Set latitude and longitude of point to query\npoint_lat = -18.96377\npoint_lon = 47.48737","visibility":"show","key":"lqnWzGbHpb"},{"type":"output","id":"lhF6g_Y_JDUJuDw54OdK9","data":[],"visibility":"show","key":"cma66s3674"}],"visibility":"show","key":"A0ZHWX4s17"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:01:45.435730Z","iopub.status.busy":"2023-03-22T13:01:45.435266Z","iopub.status.idle":"2023-03-22T13:03:00.336431Z","shell.execute_reply":"2023-03-22T13:03:00.333886Z"},"papermill":{"duration":75.056277,"end_time":"2023-03-22T13:03:00.341072","exception":false,"start_time":"2023-03-22T13:01:45.284795","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get timeseries\nmasked = s2_cube.NDWI.where(s2_cube.CLM == 0)\ntimeseriesNDWI_masked = masked.sel(lat=point_lat, lon=point_lon, method='nearest').to_series()\ntimeseriesNDWI_masked = timeseriesNDWI_masked.where(timeseriesNDWI_masked !=0).dropna()\n\ntimeseriesNDWI = s2_cube.NDWI.sel(lat=point_lat, lon=point_lon, method='nearest').to_series()\ntimeseriesNDWI = timeseriesNDWI.where(timeseriesNDWI !=0).dropna()","visibility":"show","key":"jZPjsysVGP"},{"type":"output","id":"wUhoZAwo71ZKpjJ801JG0","data":[],"visibility":"show","key":"RbxiKiLoRg"}],"visibility":"show","key":"qvJlleEM2u"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.159939,"end_time":"2023-03-22T13:03:00.718515","exception":false,"start_time":"2023-03-22T13:03:00.558576","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Plot NDWI time series for a given point location","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"cK2I6ehgpU"}],"identifier":"plot-ndwi-time-series-for-a-given-point-location","label":"Plot NDWI time series for a given point location","html_id":"plot-ndwi-time-series-for-a-given-point-location","implicit":true,"key":"oilMWM0Ljp"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Using matplotlib we can now visualise how NDWI changes over time. In the plot we will plot 2 series, a cloud-masked series in blue, and an unmasked series in grey.","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"llgf7Shutz"}],"key":"uVHzSeGN5g"}],"visibility":"show","key":"Jy0PF6fCpE"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:01.073218Z","iopub.status.busy":"2023-03-22T13:03:01.070710Z","iopub.status.idle":"2023-03-22T13:03:01.725207Z","shell.execute_reply":"2023-03-22T13:03:01.714853Z"},"papermill":{"duration":0.83979,"end_time":"2023-03-22T13:03:01.730819","exception":false,"start_time":"2023-03-22T13:03:00.891029","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot NDWI timeseries\n_, ax = plt.subplots(1, figsize=(15, 6))\nax.plot(timeseriesNDWI, color=\"Grey\", marker=\"o\", linewidth=0.5, alpha=0.4)\nax.plot(timeseriesNDWI_masked, color=\"blue\", linestyle=\"none\", marker=\"o\", linewidth=0.5)\nax.set_title(f\"NDWI timeseries. Latitude: {point_lat}, Longitude: {point_lon}.\")\nplt.show()","visibility":"show","key":"FlYh70WwoJ"},{"type":"output","id":"2dCPgsy6UfFRstkRjS0I0","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"31d408583340a8e97ceff4c76695e631","path":"/build/31d408583340a8e97ceff4c76695e631.png"},"text/plain":{"content":"<Figure size 1500x600 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"mKIDu9ZiUc"}],"visibility":"show","key":"H18tjPupKj"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.17306,"end_time":"2023-03-22T13:03:02.179077","exception":false,"start_time":"2023-03-22T13:03:02.006017","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The NDWI time series for Sentinel-2 doesnât really show us anything significant. There is no farily consistent NDWI value to go from which makes it difficult to establish a point of reference. There are peaks in NDWI at the end of December and the start of February but as was demonstrated earlier cloud cover is a big issue. There are big gaps between non-cloudy acquisitions of over a month in some cases. Letâs plot the same but for the VV polarisation from Sentinel-1.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"V0g8mLBitZ"}],"key":"kmOj6SCjwy"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Plot VV dB timeseries for a given point location","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"mQ1guo3uBB"}],"identifier":"plot-vv-db-timeseries-for-a-given-point-location","label":"Plot VV dB timeseries for a given point location","html_id":"plot-vv-db-timeseries-for-a-given-point-location","implicit":true,"key":"BEyXUWvu0T"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We can now visualise how VV dB changes over time.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"HWIzUutHsJ"}],"key":"k3szz6rqEW"}],"visibility":"show","key":"rjFZ67OCYO"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:02.556318Z","iopub.status.busy":"2023-03-22T13:03:02.555891Z","iopub.status.idle":"2023-03-22T13:03:03.110286Z","shell.execute_reply":"2023-03-22T13:03:03.108725Z"},"papermill":{"duration":0.734243,"end_time":"2023-03-22T13:03:03.113992","exception":false,"start_time":"2023-03-22T13:03:02.379749","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Get timeseries\ntimeseriesVV_dB = s1_cube.VV_dB.sel(lat=point_lat, lon=point_lon, method='nearest').to_series()\ntimeseriesVV_dB = timeseriesVV_dB.where(timeseriesVV_dB !=0).dropna()","visibility":"show","key":"fhjsxAZpZo"},{"type":"output","id":"M0vwTu5oHfJX2xskHlC2k","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"}],"visibility":"show","key":"A3zBSX4OsN"}],"visibility":"show","key":"O0IteAwCQJ"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:03.446001Z","iopub.status.busy":"2023-03-22T13:03:03.445470Z","iopub.status.idle":"2023-03-22T13:03:04.031552Z","shell.execute_reply":"2023-03-22T13:03:04.030173Z"},"papermill":{"duration":0.758449,"end_time":"2023-03-22T13:03:04.035016","exception":false,"start_time":"2023-03-22T13:03:03.276567","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot VV_dB timeseries\nfig, ax = plt.subplots(1, figsize=(12, 6))\nax.plot(timeseriesVV_dB, color=\"blue\", marker=\"o\", linewidth=0.5)\nax.set_title(f\"VV dB timeseries. Latitude: {point_lat}, Longitude: {point_lon}.\")\nplt.show()","visibility":"show","key":"mAG1oF2QR7"},{"type":"output","id":"HBAb8qgePlho0-clqQhsY","data":[{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"b929f91921092c6bd74aa4f124a28bc4","path":"/build/b929f91921092c6bd74aa4f124a28bc4.png"},"text/plain":{"content":"<Figure size 1200x600 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"o4U8PN4mbd"}],"visibility":"show","key":"l3AnVwAPxS"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.188652,"end_time":"2023-03-22T13:03:04.405277","exception":false,"start_time":"2023-03-22T13:03:04.216625","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This is much clearer than the Sentinel 2 time series as we have more observations due to no interference from cloud cover. We have a clear point of reference for what the VV polarisation response is during flood and non flooded time periods with a VV response of -8 to 0 dB when dry and < - dB when flooded. The time series really clearly shows the two flood events at the end of January and February.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Z6LNlB3fzT"}],"key":"LfYcJfjAnx"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Plot VV dB timeseries for a given AOI polygon","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"I34fJ3CyYt"}],"identifier":"plot-vv-db-timeseries-for-a-given-aoi-polygon","label":"Plot VV dB timeseries for a given AOI polygon","html_id":"plot-vv-db-timeseries-for-a-given-aoi-polygon","implicit":true,"key":"tNwJPyPhQy"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Letâs take this another step further, and generate the time series using a polygon instead of a point. For this we can use for example the administrative regions of Madagaskar, which are included into the geoDB (","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"QbQOklIl2Q"},{"type":"link","url":"https://data.humdata.org/dataset/cod-ab-mdg","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"source","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"Ic861c4vdi"}],"urlSource":"https://data.humdata.org/dataset/cod-ab-mdg","key":"K2tRlgC9Cr"},{"type":"text","value":").","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"jBnFXQ5F5X"}],"key":"cmlFBEvHHe"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"To be able to use data from the geoDB, we need to instantiate a geoDB client.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"oWOOd1PVeD"}],"key":"WDrg8LWIHX"}],"visibility":"show","key":"Xt7HlMQD3t"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:04.841218Z","iopub.status.busy":"2023-03-22T13:03:04.840180Z","iopub.status.idle":"2023-03-22T13:03:04.860653Z","shell.execute_reply":"2023-03-22T13:03:04.858423Z"},"papermill":{"duration":0.263625,"end_time":"2023-03-22T13:03:04.864364","exception":false,"start_time":"2023-03-22T13:03:04.600739","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"from xcube_geodb.core.geodb import GeoDBClient\ngeodb = GeoDBClient()","visibility":"show","key":"OXz8wBm7jP"},{"type":"output","id":"4RVZg9WRpPXbC9rCIny7r","data":[],"visibility":"show","key":"ZqkkXeLv3j"}],"visibility":"show","key":"Xva5j0mMzw"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.202579,"end_time":"2023-03-22T13:03:05.273810","exception":false,"start_time":"2023-03-22T13:03:05.071231","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"To see, what geoDB role we have, we can ask who I am. You will see a different id in your workspace.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"M3NQtydRdN"}],"key":"Q9yfd9hte0"}],"visibility":"show","key":"gbmWi8fm0B"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:05.753928Z","iopub.status.busy":"2023-03-22T13:03:05.753471Z","iopub.status.idle":"2023-03-22T13:03:06.622716Z","shell.execute_reply":"2023-03-22T13:03:06.616915Z"},"papermill":{"duration":1.105836,"end_time":"2023-03-22T13:03:06.626734","exception":false,"start_time":"2023-03-22T13:03:05.520898","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"geodb.whoami","visibility":"show","key":"iyDFds1ft9"},{"type":"output","id":"nGWLOwTSCc6NIfTsJVPZb","data":[{"output_type":"execute_result","execution_count":26,"metadata":{},"data":{"text/plain":{"content":"'geodb_418dfeac-15f0-4606-9edb-fd9eb722bf04'","content_type":"text/plain"}}}],"visibility":"show","key":"u8mn6ZNIpc"}],"visibility":"show","key":"biYfGlEGx3"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.318534,"end_time":"2023-03-22T13:03:07.174843","exception":false,"start_time":"2023-03-22T13:03:06.856309","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Different resoulution of administrative boundaries of Madagaskar are in the database called âmadagascar_adm_boundariesâ. Letâs have a look how many different collections we have:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"aXC9WJQzJP"}],"key":"LFxGVyvwHV"}],"visibility":"show","key":"Ml7X4TF0cn"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:07.638783Z","iopub.status.busy":"2023-03-22T13:03:07.638033Z","iopub.status.idle":"2023-03-22T13:03:07.901238Z","shell.execute_reply":"2023-03-22T13:03:07.898539Z"},"papermill":{"duration":0.501949,"end_time":"2023-03-22T13:03:07.905918","exception":false,"start_time":"2023-03-22T13:03:07.403969","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"geodb.get_my_collections(database=\"madagascar_adm_boundaries\")","visibility":"show","key":"aRIYRFg3zt"},{"type":"output","id":"HhpbjZfTwnkxFmbF4ky4N","data":[{"output_type":"execute_result","execution_count":27,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>owner</th>\n      <th>database</th>\n      <th>collection</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>geodb_admin</td>\n      <td>madagascar_adm_boundaries</td>\n      <td>adm0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>geodb_admin</td>\n      <td>madagascar_adm_boundaries</td>\n      <td>adm1</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>geodb_admin</td>\n      <td>madagascar_adm_boundaries</td>\n      <td>adm2</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>geodb_admin</td>\n      <td>madagascar_adm_boundaries</td>\n      <td>adm3</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>geodb_admin</td>\n      <td>madagascar_adm_boundaries</td>\n      <td>adm4</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"         owner                   database collection\n0  geodb_admin  madagascar_adm_boundaries       adm0\n1  geodb_admin  madagascar_adm_boundaries       adm1\n2  geodb_admin  madagascar_adm_boundaries       adm2\n3  geodb_admin  madagascar_adm_boundaries       adm3\n4  geodb_admin  madagascar_adm_boundaries       adm4","content_type":"text/plain"}}}],"visibility":"show","key":"KHC10mnMUi"}],"visibility":"show","key":"H8D7cvkQ21"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.207683,"end_time":"2023-03-22T13:03:08.342715","exception":false,"start_time":"2023-03-22T13:03:08.135032","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Letâs have a look, what is in the adm1 collection:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fTaNKZtqYr"}],"key":"oBn3xRb27s"}],"visibility":"show","key":"OraK00s8XK"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:08.767653Z","iopub.status.busy":"2023-03-22T13:03:08.766713Z","iopub.status.idle":"2023-03-22T13:03:15.204707Z","shell.execute_reply":"2023-03-22T13:03:15.202633Z"},"papermill":{"duration":6.666234,"end_time":"2023-03-22T13:03:15.207326","exception":false,"start_time":"2023-03-22T13:03:08.541092","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"adm1 = geodb.get_collection_pg(\"adm1\", database=\"madagascar_adm_boundaries\")","visibility":"show","key":"B6Ap22iP9y"},{"type":"output","id":"jeukYiB2mjYk_ktddotGn","data":[],"visibility":"show","key":"r0mRfeQarW"}],"visibility":"show","key":"huFw0q9rHV"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.175076,"end_time":"2023-03-22T13:03:15.526970","exception":false,"start_time":"2023-03-22T13:03:15.351894","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We want to get a brief idea of the data inside the collection, so we print out the first few lines of the data","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"klVaB9iCvp"}],"key":"eeskPQJEyP"}],"visibility":"show","key":"PxiNmI7E7T"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:15.899867Z","iopub.status.busy":"2023-03-22T13:03:15.898225Z","iopub.status.idle":"2023-03-22T13:03:16.456035Z","shell.execute_reply":"2023-03-22T13:03:16.452805Z"},"papermill":{"duration":0.752148,"end_time":"2023-03-22T13:03:16.460317","exception":false,"start_time":"2023-03-22T13:03:15.708169","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"adm1.head()","visibility":"show","key":"ISCM3F0ng9"},{"type":"output","id":"jRU7gZWp2T2hOI6RGwbMg","data":[{"output_type":"execute_result","execution_count":29,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>created_at</th>\n      <th>modified_at</th>\n      <th>geometry</th>\n      <th>adm0_pcode</th>\n      <th>adm0_en</th>\n      <th>adm1_pcode</th>\n      <th>adm1_en</th>\n      <th>adm1_type</th>\n      <th>prov_code</th>\n      <th>old_provin</th>\n      <th>prov_type</th>\n      <th>source</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>2022-04-29T12:29:10.323348+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((46.74249 -17.71321, 46.74325 -17.713...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>2022-04-29T12:29:10.323348+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.49716 -19.11777, 47.49748 -19.118...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG12</td>\n      <td>Vakinankaratra</td>\n      <td>Region</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>2022-04-29T12:29:10.323348+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((46.57273 -18.67973, 46.57734 -18.679...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG13</td>\n      <td>Itasy</td>\n      <td>Region</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>2022-04-29T12:29:10.323348+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((46.46281 -17.74554, 46.46550 -17.745...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG14</td>\n      <td>Bongolava</td>\n      <td>Region</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>2022-04-29T12:29:10.323348+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((46.57042 -20.70627, 46.57205 -20.707...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG21</td>\n      <td>Haute Matsiatra</td>\n      <td>Region</td>\n      <td>2</td>\n      <td>Fianarantsoa</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"   id                        created_at modified_at  \\\n0   1  2022-04-29T12:29:10.323348+00:00        None   \n1   2  2022-04-29T12:29:10.323348+00:00        None   \n2   3  2022-04-29T12:29:10.323348+00:00        None   \n3   4  2022-04-29T12:29:10.323348+00:00        None   \n4   5  2022-04-29T12:29:10.323348+00:00        None   \n\n                                            geometry adm0_pcode     adm0_en  \\\n0  POLYGON ((46.74249 -17.71321, 46.74325 -17.713...         MG  Madagascar   \n1  POLYGON ((47.49716 -19.11777, 47.49748 -19.118...         MG  Madagascar   \n2  POLYGON ((46.57273 -18.67973, 46.57734 -18.679...         MG  Madagascar   \n3  POLYGON ((46.46281 -17.74554, 46.46550 -17.745...         MG  Madagascar   \n4  POLYGON ((46.57042 -20.70627, 46.57205 -20.707...         MG  Madagascar   \n\n  adm1_pcode          adm1_en adm1_type  prov_code    old_provin  \\\n0       MG11       Analamanga    Region          1  Antananarivo   \n1       MG12   Vakinankaratra    Region          1  Antananarivo   \n2       MG13            Itasy    Region          1  Antananarivo   \n3       MG14        Bongolava    Region          1  Antananarivo   \n4       MG21  Haute Matsiatra    Region          2  Fianarantsoa   \n\n                                  prov_type  \\\n0  Old Provinces/Faritany dissolved in 2007   \n1  Old Provinces/Faritany dissolved in 2007   \n2  Old Provinces/Faritany dissolved in 2007   \n3  Old Provinces/Faritany dissolved in 2007   \n4  Old Provinces/Faritany dissolved in 2007   \n\n                                              source  \n0  BNGRC (National Disaster Management Office) Fo...  \n1  BNGRC (National Disaster Management Office) Fo...  \n2  BNGRC (National Disaster Management Office) Fo...  \n3  BNGRC (National Disaster Management Office) Fo...  \n4  BNGRC (National Disaster Management Office) Fo...  ","content_type":"text/plain"}}}],"visibility":"show","key":"kBGSpCzjZQ"}],"visibility":"show","key":"N2dK75IAVl"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.223079,"end_time":"2023-03-22T13:03:16.873187","exception":false,"start_time":"2023-03-22T13:03:16.650108","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Sometimes it helps more to see a plot of the data, here we group the regions by the column âold_provinâ.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VzfOtFWC15"}],"key":"Lm5iVJOPfS"}],"visibility":"show","key":"qiZUroNs8Q"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:17.286173Z","iopub.status.busy":"2023-03-22T13:03:17.283097Z","iopub.status.idle":"2023-03-22T13:03:18.015728Z","shell.execute_reply":"2023-03-22T13:03:18.008027Z"},"papermill":{"duration":0.941106,"end_time":"2023-03-22T13:03:18.019843","exception":false,"start_time":"2023-03-22T13:03:17.078737","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"adm1.plot(column=\"old_provin\", figsize=(15,15), cmap = 'jet')\n","visibility":"show","key":"aYXJYmE6em"},{"type":"output","id":"0O2Nuzw2ZD1ALjOe78cra","data":[{"output_type":"execute_result","execution_count":30,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"2d5eb56de07f4ac7f9489ef59762cbe3","path":"/build/2d5eb56de07f4ac7f9489ef59762cbe3.png"},"text/plain":{"content":"<Figure size 1500x1500 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"mPoHlnmWQ0"}],"visibility":"show","key":"n2udaMSKgr"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.186482,"end_time":"2023-03-22T13:03:18.395937","exception":false,"start_time":"2023-03-22T13:03:18.209455","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The data inside collection adm1 is a bit too coarse for our area of interest, letâs see what we find in adm2:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"jkPi8XKfon"}],"key":"rO6puIh9tc"}],"visibility":"show","key":"heCyzVbIf6"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:18.758639Z","iopub.status.busy":"2023-03-22T13:03:18.758204Z","iopub.status.idle":"2023-03-22T13:03:24.512385Z","shell.execute_reply":"2023-03-22T13:03:24.509500Z"},"papermill":{"duration":5.934043,"end_time":"2023-03-22T13:03:24.516044","exception":false,"start_time":"2023-03-22T13:03:18.582001","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"adm2 = geodb.get_collection_pg(\"adm2\", database=\"madagascar_adm_boundaries\")","visibility":"show","key":"xlcF1bJuBt"},{"type":"output","id":"PwQJK5lW5njLJ6Cgh3nGL","data":[],"visibility":"show","key":"yQga6lRjVa"}],"visibility":"show","key":"BYyrLTNRDm"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:24.861811Z","iopub.status.busy":"2023-03-22T13:03:24.859943Z","iopub.status.idle":"2023-03-22T13:03:24.926916Z","shell.execute_reply":"2023-03-22T13:03:24.924421Z"},"papermill":{"duration":0.253667,"end_time":"2023-03-22T13:03:24.934289","exception":false,"start_time":"2023-03-22T13:03:24.680622","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"adm2.head()","visibility":"show","key":"TDQyb4Uw8j"},{"type":"output","id":"4jVQblZ2YGsUNxIEsihyh","data":[{"output_type":"execute_result","execution_count":32,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>created_at</th>\n      <th>modified_at</th>\n      <th>geometry</th>\n      <th>adm0_pcode</th>\n      <th>adm0_en</th>\n      <th>adm1_pcode</th>\n      <th>adm1_en</th>\n      <th>adm1_type</th>\n      <th>adm2_pcode</th>\n      <th>adm2_en</th>\n      <th>adm2_type</th>\n      <th>prov_code</th>\n      <th>old_provin</th>\n      <th>prov_type</th>\n      <th>notes</th>\n      <th>source</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>239</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.50556 -18.89146, 47.50563 -18.891...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101001A</td>\n      <td>1er Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>240</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.55842 -18.91178, 47.55857 -18.911...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101002A</td>\n      <td>2e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>241</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.51365 -18.87834, 47.51775 -18.879...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101003A</td>\n      <td>3e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>242</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.50262 -18.91043, 47.50261 -18.910...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101004A</td>\n      <td>4e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>243</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.53500 -18.85464, 47.53518 -18.854...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101005A</td>\n      <td>5e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"    id                        created_at modified_at  \\\n0  239  2022-04-29T12:32:11.189736+00:00        None   \n1  240  2022-04-29T12:32:11.189736+00:00        None   \n2  241  2022-04-29T12:32:11.189736+00:00        None   \n3  242  2022-04-29T12:32:11.189736+00:00        None   \n4  243  2022-04-29T12:32:11.189736+00:00        None   \n\n                                            geometry adm0_pcode     adm0_en  \\\n0  POLYGON ((47.50556 -18.89146, 47.50563 -18.891...         MG  Madagascar   \n1  POLYGON ((47.55842 -18.91178, 47.55857 -18.911...         MG  Madagascar   \n2  POLYGON ((47.51365 -18.87834, 47.51775 -18.879...         MG  Madagascar   \n3  POLYGON ((47.50262 -18.91043, 47.50261 -18.910...         MG  Madagascar   \n4  POLYGON ((47.53500 -18.85464, 47.53518 -18.854...         MG  Madagascar   \n\n  adm1_pcode     adm1_en adm1_type   adm2_pcode             adm2_en adm2_type  \\\n0       MG11  Analamanga    Region  MG11101001A  1er Arrondissement  District   \n1       MG11  Analamanga    Region  MG11101002A   2e Arrondissement  District   \n2       MG11  Analamanga    Region  MG11101003A   3e Arrondissement  District   \n3       MG11  Analamanga    Region  MG11101004A   4e Arrondissement  District   \n4       MG11  Analamanga    Region  MG11101005A   5e Arrondissement  District   \n\n   prov_code    old_provin                                 prov_type  \\\n0          1  Antananarivo  Old Provinces/Faritany dissolved in 2007   \n1          1  Antananarivo  Old Provinces/Faritany dissolved in 2007   \n2          1  Antananarivo  Old Provinces/Faritany dissolved in 2007   \n3          1  Antananarivo  Old Provinces/Faritany dissolved in 2007   \n4          1  Antananarivo  Old Provinces/Faritany dissolved in 2007   \n\n                                               notes  \\\n0  Previous district name is Antananarivo Renivoh...   \n1  Previous district name is Antananarivo Renivoh...   \n2  Previous district name is Antananarivo Renivoh...   \n3  Previous district name is Antananarivo Renivoh...   \n4  Previous district name is Antananarivo Renivoh...   \n\n                                              source  \n0  Note that Communes (admin 3) have become the D...  \n1  Note that Communes (admin 3) have become the D...  \n2  Note that Communes (admin 3) have become the D...  \n3  Note that Communes (admin 3) have become the D...  \n4  Note that Communes (admin 3) have become the D...  ","content_type":"text/plain"}}}],"visibility":"show","key":"G1l3EZW6CP"}],"visibility":"show","key":"rQ0cS3q0wl"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.145654,"end_time":"2023-03-22T13:03:25.245952","exception":false,"start_time":"2023-03-22T13:03:25.100298","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We are interested in the administrative region of Antananarivo, which belongs to Analamanga. Here we select only the rows which belong to Analamanga.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"OyPsApG8JD"}],"key":"Jk92tP4CAT"}],"visibility":"show","key":"Mn7XGUMJw8"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:25.536348Z","iopub.status.busy":"2023-03-22T13:03:25.535837Z","iopub.status.idle":"2023-03-22T13:03:25.782484Z","shell.execute_reply":"2023-03-22T13:03:25.781512Z"},"papermill":{"duration":0.397605,"end_time":"2023-03-22T13:03:25.785236","exception":false,"start_time":"2023-03-22T13:03:25.387631","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"adm2_Analamanga = geodb.get_collection(\"adm2\", database=\"madagascar_adm_boundaries\", query='adm1_en=eq.Analamanga')\n","visibility":"show","key":"CCzQXmvjzd"},{"type":"output","id":"dv6B4ZWJpsIBrRY44u3Ei","data":[],"visibility":"show","key":"JXxgrzjrtl"}],"visibility":"show","key":"RJq96iV6BL"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:26.105079Z","iopub.status.busy":"2023-03-22T13:03:26.104228Z","iopub.status.idle":"2023-03-22T13:03:26.395669Z","shell.execute_reply":"2023-03-22T13:03:26.393640Z"},"papermill":{"duration":0.470557,"end_time":"2023-03-22T13:03:26.399759","exception":false,"start_time":"2023-03-22T13:03:25.929202","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"adm2_Analamanga","visibility":"show","key":"I1OOqT17sK"},{"type":"output","id":"85KjBNUFQtx6fuyTQDuS4","data":[{"output_type":"execute_result","execution_count":34,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>created_at</th>\n      <th>modified_at</th>\n      <th>geometry</th>\n      <th>adm0_pcode</th>\n      <th>adm0_en</th>\n      <th>adm1_pcode</th>\n      <th>adm1_en</th>\n      <th>adm1_type</th>\n      <th>adm2_pcode</th>\n      <th>adm2_en</th>\n      <th>adm2_type</th>\n      <th>prov_code</th>\n      <th>old_provin</th>\n      <th>prov_type</th>\n      <th>notes</th>\n      <th>source</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>239</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.50556 -18.89146, 47.50563 -18.891...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101001A</td>\n      <td>1er Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>240</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.55842 -18.91178, 47.55857 -18.911...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101002A</td>\n      <td>2e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>241</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.51365 -18.87834, 47.51775 -18.879...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101003A</td>\n      <td>3e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>242</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.50262 -18.91043, 47.50261 -18.910...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101004A</td>\n      <td>4e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>243</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.53500 -18.85464, 47.53518 -18.854...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101005A</td>\n      <td>5e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>244</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.48436 -18.83989, 47.48491 -18.840...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101006A</td>\n      <td>6e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>245</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.61521 -18.71709, 47.61702 -18.717...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11102</td>\n      <td>Antananarivo Avaradrano</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>246</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.49982 -18.43546, 47.50490 -18.439...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11103</td>\n      <td>Ambohidratrimo</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>8</th>\n      <td>247</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((46.74249 -17.71321, 46.74325 -17.713...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11104</td>\n      <td>Ankazobe</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>248</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.72437 -18.47394, 47.72465 -18.477...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11106</td>\n      <td>Manjakandriana</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>249</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.84665 -17.76164, 47.84740 -17.762...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11107</td>\n      <td>Anjozorobe</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>11</th>\n      <td>250</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.72871 -19.14659, 47.72961 -19.147...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11115</td>\n      <td>Andramasina</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>251</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.47574 -18.87596, 47.47633 -18.876...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11117</td>\n      <td>Antananarivo Atsimondrano</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"     id                        created_at modified_at  \\\n0   239  2022-04-29T12:32:11.189736+00:00        None   \n1   240  2022-04-29T12:32:11.189736+00:00        None   \n2   241  2022-04-29T12:32:11.189736+00:00        None   \n3   242  2022-04-29T12:32:11.189736+00:00        None   \n4   243  2022-04-29T12:32:11.189736+00:00        None   \n5   244  2022-04-29T12:32:11.189736+00:00        None   \n6   245  2022-04-29T12:32:11.189736+00:00        None   \n7   246  2022-04-29T12:32:11.189736+00:00        None   \n8   247  2022-04-29T12:32:11.189736+00:00        None   \n9   248  2022-04-29T12:32:11.189736+00:00        None   \n10  249  2022-04-29T12:32:11.189736+00:00        None   \n11  250  2022-04-29T12:32:11.189736+00:00        None   \n12  251  2022-04-29T12:32:11.189736+00:00        None   \n\n                                             geometry adm0_pcode     adm0_en  \\\n0   POLYGON ((47.50556 -18.89146, 47.50563 -18.891...         MG  Madagascar   \n1   POLYGON ((47.55842 -18.91178, 47.55857 -18.911...         MG  Madagascar   \n2   POLYGON ((47.51365 -18.87834, 47.51775 -18.879...         MG  Madagascar   \n3   POLYGON ((47.50262 -18.91043, 47.50261 -18.910...         MG  Madagascar   \n4   POLYGON ((47.53500 -18.85464, 47.53518 -18.854...         MG  Madagascar   \n5   POLYGON ((47.48436 -18.83989, 47.48491 -18.840...         MG  Madagascar   \n6   POLYGON ((47.61521 -18.71709, 47.61702 -18.717...         MG  Madagascar   \n7   POLYGON ((47.49982 -18.43546, 47.50490 -18.439...         MG  Madagascar   \n8   POLYGON ((46.74249 -17.71321, 46.74325 -17.713...         MG  Madagascar   \n9   POLYGON ((47.72437 -18.47394, 47.72465 -18.477...         MG  Madagascar   \n10  POLYGON ((47.84665 -17.76164, 47.84740 -17.762...         MG  Madagascar   \n11  POLYGON ((47.72871 -19.14659, 47.72961 -19.147...         MG  Madagascar   \n12  POLYGON ((47.47574 -18.87596, 47.47633 -18.876...         MG  Madagascar   \n\n   adm1_pcode     adm1_en adm1_type   adm2_pcode                    adm2_en  \\\n0        MG11  Analamanga    Region  MG11101001A         1er Arrondissement   \n1        MG11  Analamanga    Region  MG11101002A          2e Arrondissement   \n2        MG11  Analamanga    Region  MG11101003A          3e Arrondissement   \n3        MG11  Analamanga    Region  MG11101004A          4e Arrondissement   \n4        MG11  Analamanga    Region  MG11101005A          5e Arrondissement   \n5        MG11  Analamanga    Region  MG11101006A          6e Arrondissement   \n6        MG11  Analamanga    Region      MG11102    Antananarivo Avaradrano   \n7        MG11  Analamanga    Region      MG11103             Ambohidratrimo   \n8        MG11  Analamanga    Region      MG11104                   Ankazobe   \n9        MG11  Analamanga    Region      MG11106             Manjakandriana   \n10       MG11  Analamanga    Region      MG11107                 Anjozorobe   \n11       MG11  Analamanga    Region      MG11115                Andramasina   \n12       MG11  Analamanga    Region      MG11117  Antananarivo Atsimondrano   \n\n   adm2_type  prov_code    old_provin  \\\n0   District          1  Antananarivo   \n1   District          1  Antananarivo   \n2   District          1  Antananarivo   \n3   District          1  Antananarivo   \n4   District          1  Antananarivo   \n5   District          1  Antananarivo   \n6   District          1  Antananarivo   \n7   District          1  Antananarivo   \n8   District          1  Antananarivo   \n9   District          1  Antananarivo   \n10  District          1  Antananarivo   \n11  District          1  Antananarivo   \n12  District          1  Antananarivo   \n\n                                   prov_type  \\\n0   Old Provinces/Faritany dissolved in 2007   \n1   Old Provinces/Faritany dissolved in 2007   \n2   Old Provinces/Faritany dissolved in 2007   \n3   Old Provinces/Faritany dissolved in 2007   \n4   Old Provinces/Faritany dissolved in 2007   \n5   Old Provinces/Faritany dissolved in 2007   \n6   Old Provinces/Faritany dissolved in 2007   \n7   Old Provinces/Faritany dissolved in 2007   \n8   Old Provinces/Faritany dissolved in 2007   \n9   Old Provinces/Faritany dissolved in 2007   \n10  Old Provinces/Faritany dissolved in 2007   \n11  Old Provinces/Faritany dissolved in 2007   \n12  Old Provinces/Faritany dissolved in 2007   \n\n                                                notes  \\\n0   Previous district name is Antananarivo Renivoh...   \n1   Previous district name is Antananarivo Renivoh...   \n2   Previous district name is Antananarivo Renivoh...   \n3   Previous district name is Antananarivo Renivoh...   \n4   Previous district name is Antananarivo Renivoh...   \n5   Previous district name is Antananarivo Renivoh...   \n6                                                None   \n7                                                None   \n8                                                None   \n9                                                None   \n10                                               None   \n11                                               None   \n12                                               None   \n\n                                               source  \n0   Note that Communes (admin 3) have become the D...  \n1   Note that Communes (admin 3) have become the D...  \n2   Note that Communes (admin 3) have become the D...  \n3   Note that Communes (admin 3) have become the D...  \n4   Note that Communes (admin 3) have become the D...  \n5   Note that Communes (admin 3) have become the D...  \n6   BNGRC (National Disaster Management Office) Fo...  \n7   BNGRC (National Disaster Management Office) Fo...  \n8   BNGRC (National Disaster Management Office) Fo...  \n9   BNGRC (National Disaster Management Office) Fo...  \n10  BNGRC (National Disaster Management Office) Fo...  \n11  BNGRC (National Disaster Management Office) Fo...  \n12  BNGRC (National Disaster Management Office) Fo...  ","content_type":"text/plain"}}}],"visibility":"show","key":"a6TzGn15gl"}],"visibility":"show","key":"lvN0nlFyb1"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.14672,"end_time":"2023-03-22T13:03:26.691964","exception":false,"start_time":"2023-03-22T13:03:26.545244","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Letâs take a bief look at a plot of our subset:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"JbmdWC53k0"}],"key":"qWfe5WmPv7"}],"visibility":"show","key":"KjyqzN0VxW"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:27.074117Z","iopub.status.busy":"2023-03-22T13:03:27.073722Z","iopub.status.idle":"2023-03-22T13:03:27.848210Z","shell.execute_reply":"2023-03-22T13:03:27.845941Z"},"papermill":{"duration":1.009258,"end_time":"2023-03-22T13:03:27.857512","exception":false,"start_time":"2023-03-22T13:03:26.848254","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"adm2_Analamanga.plot(figsize=(15,15), cmap = 'jet')","visibility":"show","key":"LCJG59u3b5"},{"type":"output","id":"FIEop_Wbyn3l9MXbhTaGb","data":[{"output_type":"execute_result","execution_count":35,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"e46001ea76203aaf21a3832ba2aef294","path":"/build/e46001ea76203aaf21a3832ba2aef294.png"},"text/plain":{"content":"<Figure size 1500x1500 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"znrHUTWqpC"}],"visibility":"show","key":"rqgdBD5opH"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.212959,"end_time":"2023-03-22T13:03:28.251908","exception":false,"start_time":"2023-03-22T13:03:28.038949","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":3,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Select regions to mask the cube","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"fIKcjCekgN"}],"identifier":"select-regions-to-mask-the-cube","label":"Select regions to mask the cube","html_id":"select-regions-to-mask-the-cube","implicit":true,"key":"pkMWrVrV8Q"}],"visibility":"show","key":"Ij0qnUlbqo"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:28.693093Z","iopub.status.busy":"2023-03-22T13:03:28.692642Z","iopub.status.idle":"2023-03-22T13:03:28.715336Z","shell.execute_reply":"2023-03-22T13:03:28.713309Z"},"papermill":{"duration":0.309984,"end_time":"2023-03-22T13:03:28.738739","exception":false,"start_time":"2023-03-22T13:03:28.428755","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"sub_Analamanga = adm2_Analamanga.loc[(adm2_Analamanga.adm2_en == \"Antananarivo Atsimondrano\") |\n                                     (adm2_Analamanga.adm2_en == \"Antananarivo Avaradrano\") |\n                                     (adm2_Analamanga.adm2_en == \"Ambohidratrimo\") |\n                                     (adm2_Analamanga.adm2_en == \"1er Arrondissement\") |\n                                     (adm2_Analamanga.adm2_en == \"2e Arrondissement\") |\n                                     (adm2_Analamanga.adm2_en == \"3e Arrondissement\") |\n                                     (adm2_Analamanga.adm2_en == \"4e Arrondissement\") |\n                                     (adm2_Analamanga.adm2_en == \"5e Arrondissement\") |\n                                     (adm2_Analamanga.adm2_en == \"6e Arrondissement\") ]","visibility":"show","key":"UKghUYlUeK"},{"type":"output","id":"19ZEIOrohBaU-WIaNvryl","data":[],"visibility":"show","key":"WOkBkZlgPI"}],"visibility":"show","key":"RU9rxd0Uir"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:29.166736Z","iopub.status.busy":"2023-03-22T13:03:29.165686Z","iopub.status.idle":"2023-03-22T13:03:29.302667Z","shell.execute_reply":"2023-03-22T13:03:29.298598Z"},"papermill":{"duration":0.395867,"end_time":"2023-03-22T13:03:29.313526","exception":false,"start_time":"2023-03-22T13:03:28.917659","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"sub_Analamanga","visibility":"show","key":"z2COo7UlMp"},{"type":"output","id":"oxuxxGCosPsLBi8BxRvZE","data":[{"output_type":"execute_result","execution_count":37,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>created_at</th>\n      <th>modified_at</th>\n      <th>geometry</th>\n      <th>adm0_pcode</th>\n      <th>adm0_en</th>\n      <th>adm1_pcode</th>\n      <th>adm1_en</th>\n      <th>adm1_type</th>\n      <th>adm2_pcode</th>\n      <th>adm2_en</th>\n      <th>adm2_type</th>\n      <th>prov_code</th>\n      <th>old_provin</th>\n      <th>prov_type</th>\n      <th>notes</th>\n      <th>source</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>239</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.50556 -18.89146, 47.50563 -18.891...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101001A</td>\n      <td>1er Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>240</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.55842 -18.91178, 47.55857 -18.911...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101002A</td>\n      <td>2e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>241</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.51365 -18.87834, 47.51775 -18.879...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101003A</td>\n      <td>3e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>242</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.50262 -18.91043, 47.50261 -18.910...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101004A</td>\n      <td>4e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>243</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.53500 -18.85464, 47.53518 -18.854...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101005A</td>\n      <td>5e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>244</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.48436 -18.83989, 47.48491 -18.840...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11101006A</td>\n      <td>6e Arrondissement</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>Previous district name is Antananarivo Renivoh...</td>\n      <td>Note that Communes (admin 3) have become the D...</td>\n    </tr>\n    <tr>\n      <th>6</th>\n      <td>245</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.61521 -18.71709, 47.61702 -18.717...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11102</td>\n      <td>Antananarivo Avaradrano</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>7</th>\n      <td>246</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.49982 -18.43546, 47.50490 -18.439...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11103</td>\n      <td>Ambohidratrimo</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n    <tr>\n      <th>12</th>\n      <td>251</td>\n      <td>2022-04-29T12:32:11.189736+00:00</td>\n      <td>None</td>\n      <td>POLYGON ((47.47574 -18.87596, 47.47633 -18.876...</td>\n      <td>MG</td>\n      <td>Madagascar</td>\n      <td>MG11</td>\n      <td>Analamanga</td>\n      <td>Region</td>\n      <td>MG11117</td>\n      <td>Antananarivo Atsimondrano</td>\n      <td>District</td>\n      <td>1</td>\n      <td>Antananarivo</td>\n      <td>Old Provinces/Faritany dissolved in 2007</td>\n      <td>None</td>\n      <td>BNGRC (National Disaster Management Office) Fo...</td>\n    </tr>\n  </tbody>\n</table>\n</div>","content_type":"text/html"},"text/plain":{"content":"     id                        created_at modified_at  \\\n0   239  2022-04-29T12:32:11.189736+00:00        None   \n1   240  2022-04-29T12:32:11.189736+00:00        None   \n2   241  2022-04-29T12:32:11.189736+00:00        None   \n3   242  2022-04-29T12:32:11.189736+00:00        None   \n4   243  2022-04-29T12:32:11.189736+00:00        None   \n5   244  2022-04-29T12:32:11.189736+00:00        None   \n6   245  2022-04-29T12:32:11.189736+00:00        None   \n7   246  2022-04-29T12:32:11.189736+00:00        None   \n12  251  2022-04-29T12:32:11.189736+00:00        None   \n\n                                             geometry adm0_pcode     adm0_en  \\\n0   POLYGON ((47.50556 -18.89146, 47.50563 -18.891...         MG  Madagascar   \n1   POLYGON ((47.55842 -18.91178, 47.55857 -18.911...         MG  Madagascar   \n2   POLYGON ((47.51365 -18.87834, 47.51775 -18.879...         MG  Madagascar   \n3   POLYGON ((47.50262 -18.91043, 47.50261 -18.910...         MG  Madagascar   \n4   POLYGON ((47.53500 -18.85464, 47.53518 -18.854...         MG  Madagascar   \n5   POLYGON ((47.48436 -18.83989, 47.48491 -18.840...         MG  Madagascar   \n6   POLYGON ((47.61521 -18.71709, 47.61702 -18.717...         MG  Madagascar   \n7   POLYGON ((47.49982 -18.43546, 47.50490 -18.439...         MG  Madagascar   \n12  POLYGON ((47.47574 -18.87596, 47.47633 -18.876...         MG  Madagascar   \n\n   adm1_pcode     adm1_en adm1_type   adm2_pcode                    adm2_en  \\\n0        MG11  Analamanga    Region  MG11101001A         1er Arrondissement   \n1        MG11  Analamanga    Region  MG11101002A          2e Arrondissement   \n2        MG11  Analamanga    Region  MG11101003A          3e Arrondissement   \n3        MG11  Analamanga    Region  MG11101004A          4e Arrondissement   \n4        MG11  Analamanga    Region  MG11101005A          5e Arrondissement   \n5        MG11  Analamanga    Region  MG11101006A          6e Arrondissement   \n6        MG11  Analamanga    Region      MG11102    Antananarivo Avaradrano   \n7        MG11  Analamanga    Region      MG11103             Ambohidratrimo   \n12       MG11  Analamanga    Region      MG11117  Antananarivo Atsimondrano   \n\n   adm2_type  prov_code    old_provin  \\\n0   District          1  Antananarivo   \n1   District          1  Antananarivo   \n2   District          1  Antananarivo   \n3   District          1  Antananarivo   \n4   District          1  Antananarivo   \n5   District          1  Antananarivo   \n6   District          1  Antananarivo   \n7   District          1  Antananarivo   \n12  District          1  Antananarivo   \n\n                                   prov_type  \\\n0   Old Provinces/Faritany dissolved in 2007   \n1   Old Provinces/Faritany dissolved in 2007   \n2   Old Provinces/Faritany dissolved in 2007   \n3   Old Provinces/Faritany dissolved in 2007   \n4   Old Provinces/Faritany dissolved in 2007   \n5   Old Provinces/Faritany dissolved in 2007   \n6   Old Provinces/Faritany dissolved in 2007   \n7   Old Provinces/Faritany dissolved in 2007   \n12  Old Provinces/Faritany dissolved in 2007   \n\n                                                notes  \\\n0   Previous district name is Antananarivo Renivoh...   \n1   Previous district name is Antananarivo Renivoh...   \n2   Previous district name is Antananarivo Renivoh...   \n3   Previous district name is Antananarivo Renivoh...   \n4   Previous district name is Antananarivo Renivoh...   \n5   Previous district name is Antananarivo Renivoh...   \n6                                                None   \n7                                                None   \n12                                               None   \n\n                                               source  \n0   Note that Communes (admin 3) have become the D...  \n1   Note that Communes (admin 3) have become the D...  \n2   Note that Communes (admin 3) have become the D...  \n3   Note that Communes (admin 3) have become the D...  \n4   Note that Communes (admin 3) have become the D...  \n5   Note that Communes (admin 3) have become the D...  \n6   BNGRC (National Disaster Management Office) Fo...  \n7   BNGRC (National Disaster Management Office) Fo...  \n12  BNGRC (National Disaster Management Office) Fo...  ","content_type":"text/plain"}}}],"visibility":"show","key":"elxH1EZ2wy"}],"visibility":"show","key":"npVdoPoBkC"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:29.910540Z","iopub.status.busy":"2023-03-22T13:03:29.908221Z","iopub.status.idle":"2023-03-22T13:03:30.756867Z","shell.execute_reply":"2023-03-22T13:03:30.754282Z"},"papermill":{"duration":1.096873,"end_time":"2023-03-22T13:03:30.762333","exception":false,"start_time":"2023-03-22T13:03:29.665460","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"sub_Analamanga.plot(figsize=(15,15), cmap = 'jet')\n","visibility":"show","key":"to8hyZSn0H"},{"type":"output","id":"0ZqLsvuQJuuhdZp4WCiXR","data":[{"output_type":"execute_result","execution_count":38,"metadata":{},"data":{"text/plain":{"content":"<Axes: >","content_type":"text/plain"}}},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"61e6f4b7eddec003b798aa3cb2ee7553","path":"/build/61e6f4b7eddec003b798aa3cb2ee7553.png"},"text/plain":{"content":"<Figure size 1500x1500 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"gC68yqYxwD"}],"visibility":"show","key":"RShiD56R8y"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.228713,"end_time":"2023-03-22T13:03:31.188866","exception":false,"start_time":"2023-03-22T13:03:30.960153","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we have selected only the rows which we are interested in. But they are in seperate geometry objects:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XU9Fiet1o2"}],"key":"acPeGo6iOL"}],"visibility":"show","key":"ikaqtTwrtM"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:31.605750Z","iopub.status.busy":"2023-03-22T13:03:31.605284Z","iopub.status.idle":"2023-03-22T13:03:31.688177Z","shell.execute_reply":"2023-03-22T13:03:31.684726Z"},"papermill":{"duration":0.305389,"end_time":"2023-03-22T13:03:31.692238","exception":false,"start_time":"2023-03-22T13:03:31.386849","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"sub_Analamanga.geometry","visibility":"show","key":"CfLIHBZmoI"},{"type":"output","id":"SvqVgjUzg8KGrjUkb3LzD","data":[{"output_type":"execute_result","execution_count":39,"metadata":{},"data":{"text/plain":{"content":"0     POLYGON ((47.50556 -18.89146, 47.50563 -18.891...\n1     POLYGON ((47.55842 -18.91178, 47.55857 -18.911...\n2     POLYGON ((47.51365 -18.87834, 47.51775 -18.879...\n3     POLYGON ((47.50262 -18.91043, 47.50261 -18.910...\n4     POLYGON ((47.53500 -18.85464, 47.53518 -18.854...\n5     POLYGON ((47.48436 -18.83989, 47.48491 -18.840...\n6     POLYGON ((47.61521 -18.71709, 47.61702 -18.717...\n7     POLYGON ((47.49982 -18.43546, 47.50490 -18.439...\n12    POLYGON ((47.47574 -18.87596, 47.47633 -18.876...\nName: geometry, dtype: geometry","content_type":"text/plain"}}}],"visibility":"show","key":"ebvKUp52be"}],"visibility":"show","key":"r21pizQlkt"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.212563,"end_time":"2023-03-22T13:03:32.118495","exception":false,"start_time":"2023-03-22T13:03:31.905932","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Unify the subareas into one area of interest:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LuRNYbf5CP"}],"key":"r3rWHYCT8m"}],"visibility":"show","key":"lcO6oiz0X9"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:32.474950Z","iopub.status.busy":"2023-03-22T13:03:32.473300Z","iopub.status.idle":"2023-03-22T13:03:32.526885Z","shell.execute_reply":"2023-03-22T13:03:32.523105Z"},"papermill":{"duration":0.238506,"end_time":"2023-03-22T13:03:32.530367","exception":false,"start_time":"2023-03-22T13:03:32.291861","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"Antananarivo_region = shapely.ops.unary_union(geoms=[sub_Analamanga.geometry.iloc[i] for i in range(len(sub_Analamanga.geometry))])","visibility":"show","key":"bl9lVz6GPF"},{"type":"output","id":"CjHoW1DUfHTLxbGgaLlbw","data":[],"visibility":"show","key":"iYJtcZMO4A"}],"visibility":"show","key":"usBPMie2Ea"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:32.905283Z","iopub.status.busy":"2023-03-22T13:03:32.903935Z","iopub.status.idle":"2023-03-22T13:03:32.941781Z","shell.execute_reply":"2023-03-22T13:03:32.940394Z"},"papermill":{"duration":0.275152,"end_time":"2023-03-22T13:03:32.971027","exception":false,"start_time":"2023-03-22T13:03:32.695875","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot the polygon on a map\n\nIPython.display.GeoJSON(shapely.geometry.polygon.Polygon(Antananarivo_region).__geo_interface__)","visibility":"show","key":"wZgYTJpjrT"},{"type":"output","id":"fDXr1UaBmp8kC1AZn_1Es","data":[{"output_type":"display_data","metadata":{"application/geo+json":{"expanded":false,"root":"root"}},"data":{"application/geo+json":{"content_type":"application/geo+json","hash":"9ef3dcd0a443c5d4e2d52348164ec376","path":"/build/9ef3dcd0a443c5d4e2d52348164ec376.json"},"text/plain":{"content":"<IPython.display.GeoJSON object>","content_type":"text/plain"}}}],"visibility":"show","key":"sf68vgCA7F"}],"visibility":"show","key":"lTWu7w7gFT"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.289648,"end_time":"2023-03-22T13:03:33.521264","exception":false,"start_time":"2023-03-22T13:03:33.231616","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next, letâs mask our dataset by the polygon we have just defined and visualise our âmaskedâ datacube.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"yARXIYvKcE"}],"key":"MBtAnhLuaA"}],"visibility":"show","key":"FTjjuJOzUh"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:34.017619Z","iopub.status.busy":"2023-03-22T13:03:34.014002Z","iopub.status.idle":"2023-03-22T13:03:34.089692Z","shell.execute_reply":"2023-03-22T13:03:34.086040Z"},"papermill":{"duration":0.34351,"end_time":"2023-03-22T13:03:34.092902","exception":false,"start_time":"2023-03-22T13:03:33.749392","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"s1_cube","visibility":"show","key":"UupBRnZ3lJ"},{"type":"output","id":"aLmvr5X_C3PwHhW42W_n_","data":[{"output_type":"execute_result","execution_count":42,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"3e14d9def217d04336e1999fabf34b42","path":"/build/3e14d9def217d04336e1999fabf34b42.html"},"text/plain":{"content":"<xarray.Dataset>\nDimensions:     (time: 8, lat: 1045, lon: 998, bnds: 2)\nCoordinates:\n  * lat         (lat) float64 -18.66 -18.66 -18.66 ... -19.13 -19.13 -19.13\n  * lon         (lon) float64 47.22 47.22 47.22 47.22 ... 47.67 47.67 47.67\n  * time        (time) datetime64[ns] 2022-01-03T02:19:35 ... 2022-03-28T02:1...\n    time_bnds   (time, bnds) datetime64[ns] dask.array<chunksize=(8, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    VV          (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    VV_dB       (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\n    flood_mask  (time, lat, lon) float32 dask.array<chunksize=(1, 1045, 998), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   S1GRD Data Cube Subset\n    history:                 [{'program': 'xcube_sh.chunkstore.SentinelHubChu...\n    date_created:            2023-03-22T13:01:18.601978\n    time_coverage_start:     2022-01-03T02:19:35+00:00\n    time_coverage_end:       2022-03-28T02:19:33+00:00\n    time_coverage_duration:  P83DT23H59M58S\n    geospatial_lon_min:      47.221985\n    geospatial_lat_min:      -19.129599\n    geospatial_lon_max:      47.671085\n    geospatial_lat_max:      -18.659349\n    processing_level:        L1B","content_type":"text/plain"}}}],"visibility":"show","key":"Ji0SKZBHLU"}],"visibility":"show","key":"phNYg3l3iE"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.229698,"end_time":"2023-03-22T13:03:34.629194","exception":false,"start_time":"2023-03-22T13:03:34.399496","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now we take a look at the data which is within our desired administrative boundaries. Therefore we mask the s1_cube:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"gN5CqTJDIZ"}],"key":"kWbtqJanAQ"}],"visibility":"show","key":"pheDGbnq3V"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:35.095679Z","iopub.status.busy":"2023-03-22T13:03:35.093847Z","iopub.status.idle":"2023-03-22T13:03:35.164089Z","shell.execute_reply":"2023-03-22T13:03:35.162615Z"},"papermill":{"duration":0.322258,"end_time":"2023-03-22T13:03:35.167632","exception":false,"start_time":"2023-03-22T13:03:34.845374","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"water_antananarivo = mask_dataset_by_geometry(s1_cube, geometry=Antananarivo_region)","visibility":"show","key":"jEmHOJs8aE"},{"type":"output","id":"tj-UaGPsa6GO60M21VE-A","data":[],"visibility":"show","key":"VgKBHTjPKy"}],"visibility":"show","key":"JAh18MdjDy"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.258934,"end_time":"2023-03-22T13:03:35.645634","exception":false,"start_time":"2023-03-22T13:03:35.386700","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Letâs visualise our masked data cube using the timestep on 27th January and the VV_dB variable:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EBCvsmmSDm"}],"key":"ggOLd2Hq6N"}],"visibility":"show","key":"jlMRatBCSe"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:36.188470Z","iopub.status.busy":"2023-03-22T13:03:36.187968Z","iopub.status.idle":"2023-03-22T13:03:37.402407Z","shell.execute_reply":"2023-03-22T13:03:37.399542Z"},"papermill":{"duration":1.514868,"end_time":"2023-03-22T13:03:37.414415","exception":false,"start_time":"2023-03-22T13:03:35.899547","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"water_antananarivo.VV_dB.isel(time=2).plot.imshow(cmap='Greys', vmin=-20, vmax=0, figsize=(10, 10))\nplt.show()","visibility":"show","key":"sR4OttaUcj"},{"type":"output","id":"F69C5QLb2ko2Djh61s6wr","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"9245206439cc1049578915b48d46197b","path":"/build/9245206439cc1049578915b48d46197b.png"},"text/plain":{"content":"<Figure size 1000x1000 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"UXMMlH8Lrz"}],"visibility":"show","key":"ezOACveKIn"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.20018,"end_time":"2023-03-22T13:03:37.876144","exception":false,"start_time":"2023-03-22T13:03:37.675964","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"OK, this looks good. Now we are going to calculate the mean VV dB polarisation across the area for each time step. Firstly, we want to calculate the mean VV_dB on axis 1 (lat) and 2 (lon). The second function removes any observations with values of 0 (observations that donât cover our area of interest).","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"TTK4mykFu4"}],"key":"gbVzZOLbfZ"}],"visibility":"show","key":"wfBK0gYuM1"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:38.306046Z","iopub.status.busy":"2023-03-22T13:03:38.302913Z","iopub.status.idle":"2023-03-22T13:03:39.128226Z","shell.execute_reply":"2023-03-22T13:03:39.124645Z"},"papermill":{"duration":1.047959,"end_time":"2023-03-22T13:03:39.131531","exception":false,"start_time":"2023-03-22T13:03:38.083572","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# calculate the mean VV dB for each time step\ntimeseriesVV_dB = water_antananarivo.VV_dB.mean(axis=(1,2), skipna=True)\n\n# remove any observations with no data\ntimeseriesVV_dB = timeseriesVV_dB.where(timeseriesVV_dB !=0).dropna(\"time\")\n\n# return the new data cube chunk\ntimeseriesVV_dB","visibility":"show","key":"EOdmDuHeNF"},{"type":"output","id":"evtnykrDxaQhy6GHNj6sY","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"execute_result","execution_count":45,"metadata":{},"data":{"text/html":{"content":"<div><svg style=\"position: absolute; width: 0; height: 0; overflow: hidden\">\n<defs>\n<symbol id=\"icon-database\" viewBox=\"0 0 32 32\">\n<path d=\"M16 0c-8.837 0-16 2.239-16 5v4c0 2.761 7.163 5 16 5s16-2.239 16-5v-4c0-2.761-7.163-5-16-5z\"></path>\n<path d=\"M16 17c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n<path d=\"M16 26c-8.837 0-16-2.239-16-5v6c0 2.761 7.163 5 16 5s16-2.239 16-5v-6c0 2.761-7.163 5-16 5z\"></path>\n</symbol>\n<symbol id=\"icon-file-text2\" viewBox=\"0 0 32 32\">\n<path d=\"M28.681 7.159c-0.694-0.947-1.662-2.053-2.724-3.116s-2.169-2.030-3.116-2.724c-1.612-1.182-2.393-1.319-2.841-1.319h-15.5c-1.378 0-2.5 1.121-2.5 2.5v27c0 1.378 1.122 2.5 2.5 2.5h23c1.378 0 2.5-1.122 2.5-2.5v-19.5c0-0.448-0.137-1.23-1.319-2.841zM24.543 5.457c0.959 0.959 1.712 1.825 2.268 2.543h-4.811v-4.811c0.718 0.556 1.584 1.309 2.543 2.268zM28 29.5c0 0.271-0.229 0.5-0.5 0.5h-23c-0.271 0-0.5-0.229-0.5-0.5v-27c0-0.271 0.229-0.5 0.5-0.5 0 0 15.499-0 15.5 0v7c0 0.552 0.448 1 1 1h7v19.5z\"></path>\n<path d=\"M23 26h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 22h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n<path d=\"M23 18h-14c-0.552 0-1-0.448-1-1s0.448-1 1-1h14c0.552 0 1 0.448 1 1s-0.448 1-1 1z\"></path>\n</symbol>\n</defs>\n</svg>\n<style>/* CSS stylesheet for displaying xarray objects in jupyterlab.\n *\n */\n\n:root {\n  --xr-font-color0: var(--jp-content-font-color0, rgba(0, 0, 0, 1));\n  --xr-font-color2: var(--jp-content-font-color2, rgba(0, 0, 0, 0.54));\n  --xr-font-color3: var(--jp-content-font-color3, rgba(0, 0, 0, 0.38));\n  --xr-border-color: var(--jp-border-color2, #e0e0e0);\n  --xr-disabled-color: var(--jp-layout-color3, #bdbdbd);\n  --xr-background-color: var(--jp-layout-color0, white);\n  --xr-background-color-row-even: var(--jp-layout-color1, white);\n  --xr-background-color-row-odd: var(--jp-layout-color2, #eeeeee);\n}\n\nhtml[theme=dark],\nbody[data-theme=dark],\nbody.vscode-dark {\n  --xr-font-color0: rgba(255, 255, 255, 1);\n  --xr-font-color2: rgba(255, 255, 255, 0.54);\n  --xr-font-color3: rgba(255, 255, 255, 0.38);\n  --xr-border-color: #1F1F1F;\n  --xr-disabled-color: #515151;\n  --xr-background-color: #111111;\n  --xr-background-color-row-even: #111111;\n  --xr-background-color-row-odd: #313131;\n}\n\n.xr-wrap {\n  display: block !important;\n  min-width: 300px;\n  max-width: 700px;\n}\n\n.xr-text-repr-fallback {\n  /* fallback to plain text repr when CSS is not injected (untrusted notebook) */\n  display: none;\n}\n\n.xr-header {\n  padding-top: 6px;\n  padding-bottom: 6px;\n  margin-bottom: 4px;\n  border-bottom: solid 1px var(--xr-border-color);\n}\n\n.xr-header > div,\n.xr-header > ul {\n  display: inline;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.xr-obj-type,\n.xr-array-name {\n  margin-left: 2px;\n  margin-right: 10px;\n}\n\n.xr-obj-type {\n  color: var(--xr-font-color2);\n}\n\n.xr-sections {\n  padding-left: 0 !important;\n  display: grid;\n  grid-template-columns: 150px auto auto 1fr 20px 20px;\n}\n\n.xr-section-item {\n  display: contents;\n}\n\n.xr-section-item input {\n  display: none;\n}\n\n.xr-section-item input + label {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-item input:enabled + label {\n  cursor: pointer;\n  color: var(--xr-font-color2);\n}\n\n.xr-section-item input:enabled + label:hover {\n  color: var(--xr-font-color0);\n}\n\n.xr-section-summary {\n  grid-column: 1;\n  color: var(--xr-font-color2);\n  font-weight: 500;\n}\n\n.xr-section-summary > span {\n  display: inline-block;\n  padding-left: 0.5em;\n}\n\n.xr-section-summary-in:disabled + label {\n  color: var(--xr-font-color2);\n}\n\n.xr-section-summary-in + label:before {\n  display: inline-block;\n  content: 'âº';\n  font-size: 11px;\n  width: 15px;\n  text-align: center;\n}\n\n.xr-section-summary-in:disabled + label:before {\n  color: var(--xr-disabled-color);\n}\n\n.xr-section-summary-in:checked + label:before {\n  content: 'â¼';\n}\n\n.xr-section-summary-in:checked + label > span {\n  display: none;\n}\n\n.xr-section-summary,\n.xr-section-inline-details {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n.xr-section-inline-details {\n  grid-column: 2 / -1;\n}\n\n.xr-section-details {\n  display: none;\n  grid-column: 1 / -1;\n  margin-bottom: 5px;\n}\n\n.xr-section-summary-in:checked ~ .xr-section-details {\n  display: contents;\n}\n\n.xr-array-wrap {\n  grid-column: 1 / -1;\n  display: grid;\n  grid-template-columns: 20px auto;\n}\n\n.xr-array-wrap > label {\n  grid-column: 1;\n  vertical-align: top;\n}\n\n.xr-preview {\n  color: var(--xr-font-color3);\n}\n\n.xr-array-preview,\n.xr-array-data {\n  padding: 0 5px !important;\n  grid-column: 2;\n}\n\n.xr-array-data,\n.xr-array-in:checked ~ .xr-array-preview {\n  display: none;\n}\n\n.xr-array-in:checked ~ .xr-array-data,\n.xr-array-preview {\n  display: inline-block;\n}\n\n.xr-dim-list {\n  display: inline-block !important;\n  list-style: none;\n  padding: 0 !important;\n  margin: 0;\n}\n\n.xr-dim-list li {\n  display: inline-block;\n  padding: 0;\n  margin: 0;\n}\n\n.xr-dim-list:before {\n  content: '(';\n}\n\n.xr-dim-list:after {\n  content: ')';\n}\n\n.xr-dim-list li:not(:last-child):after {\n  content: ',';\n  padding-right: 5px;\n}\n\n.xr-has-index {\n  font-weight: bold;\n}\n\n.xr-var-list,\n.xr-var-item {\n  display: contents;\n}\n\n.xr-var-item > div,\n.xr-var-item label,\n.xr-var-item > .xr-var-name span {\n  background-color: var(--xr-background-color-row-even);\n  margin-bottom: 0;\n}\n\n.xr-var-item > .xr-var-name:hover span {\n  padding-right: 5px;\n}\n\n.xr-var-list > li:nth-child(odd) > div,\n.xr-var-list > li:nth-child(odd) > label,\n.xr-var-list > li:nth-child(odd) > .xr-var-name span {\n  background-color: var(--xr-background-color-row-odd);\n}\n\n.xr-var-name {\n  grid-column: 1;\n}\n\n.xr-var-dims {\n  grid-column: 2;\n}\n\n.xr-var-dtype {\n  grid-column: 3;\n  text-align: right;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-preview {\n  grid-column: 4;\n}\n\n.xr-index-preview {\n  grid-column: 2 / 5;\n  color: var(--xr-font-color2);\n}\n\n.xr-var-name,\n.xr-var-dims,\n.xr-var-dtype,\n.xr-preview,\n.xr-attrs dt {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-right: 10px;\n}\n\n.xr-var-name:hover,\n.xr-var-dims:hover,\n.xr-var-dtype:hover,\n.xr-attrs dt:hover {\n  overflow: visible;\n  width: auto;\n  z-index: 1;\n}\n\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  display: none;\n  background-color: var(--xr-background-color) !important;\n  padding-bottom: 5px !important;\n}\n\n.xr-var-attrs-in:checked ~ .xr-var-attrs,\n.xr-var-data-in:checked ~ .xr-var-data,\n.xr-index-data-in:checked ~ .xr-index-data {\n  display: block;\n}\n\n.xr-var-data > table {\n  float: right;\n}\n\n.xr-var-name span,\n.xr-var-data,\n.xr-index-name div,\n.xr-index-data,\n.xr-attrs {\n  padding-left: 25px !important;\n}\n\n.xr-attrs,\n.xr-var-attrs,\n.xr-var-data,\n.xr-index-data {\n  grid-column: 1 / -1;\n}\n\ndl.xr-attrs {\n  padding: 0;\n  margin: 0;\n  display: grid;\n  grid-template-columns: 125px auto;\n}\n\n.xr-attrs dt,\n.xr-attrs dd {\n  padding: 0;\n  margin: 0;\n  float: left;\n  padding-right: 10px;\n  width: auto;\n}\n\n.xr-attrs dt {\n  font-weight: normal;\n  grid-column: 1;\n}\n\n.xr-attrs dt:hover span {\n  display: inline-block;\n  background: var(--xr-background-color);\n  padding-right: 10px;\n}\n\n.xr-attrs dd {\n  grid-column: 2;\n  white-space: pre-wrap;\n  word-break: break-all;\n}\n\n.xr-icon-database,\n.xr-icon-file-text2,\n.xr-no-icon {\n  display: inline-block;\n  vertical-align: middle;\n  width: 1em;\n  height: 1.5em !important;\n  stroke-width: 0;\n  stroke: currentColor;\n  fill: currentColor;\n}\n</style><pre class='xr-text-repr-fallback'>&lt;xarray.DataArray &#x27;VV_dB&#x27; (time: 8)&gt;\ndask.array&lt;where, shape=(8,), dtype=float32, chunksize=(1,), chunktype=numpy.ndarray&gt;\nCoordinates:\n  * time     (time) datetime64[ns] 2022-01-03T02:19:35 ... 2022-03-28T02:19:33</pre><div class='xr-wrap' style='display:none'><div class='xr-header'><div class='xr-obj-type'>xarray.DataArray</div><div class='xr-array-name'>'VV_dB'</div><ul class='xr-dim-list'><li><span class='xr-has-index'>time</span>: 8</li></ul></div><ul class='xr-sections'><li class='xr-section-item'><div class='xr-array-wrap'><input id='section-7e2b0f4d-7aa6-4f3d-a791-4f9a818f034f' class='xr-array-in' type='checkbox' checked><label for='section-7e2b0f4d-7aa6-4f3d-a791-4f9a818f034f' title='Show/hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-array-preview xr-preview'><span>dask.array&lt;chunksize=(1,), meta=np.ndarray&gt;</span></div><div class='xr-array-data'><table>\n    <tr>\n        <td>\n            <table style=\"border-collapse: collapse;\">\n                <thead>\n                    <tr>\n                        <td> </td>\n                        <th> Array </th>\n                        <th> Chunk </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    \n                    <tr>\n                        <th> Bytes </th>\n                        <td> 32 B </td>\n                        <td> 4 B </td>\n                    </tr>\n                    \n                    <tr>\n                        <th> Shape </th>\n                        <td> (8,) </td>\n                        <td> (1,) </td>\n                    </tr>\n                    <tr>\n                        <th> Dask graph </th>\n                        <td colspan=\"2\"> 8 chunks in 14 graph layers </td>\n                    </tr>\n                    <tr>\n                        <th> Data type </th>\n                        <td colspan=\"2\"> float32 numpy.ndarray </td>\n                    </tr>\n                </tbody>\n            </table>\n        </td>\n        <td>\n        <svg width=\"170\" height=\"89\" style=\"stroke:rgb(0,0,0);stroke-width:1\" >\n\n  <!-- Horizontal lines -->\n  <line x1=\"0\" y1=\"0\" x2=\"120\" y2=\"0\" style=\"stroke-width:2\" />\n  <line x1=\"0\" y1=\"39\" x2=\"120\" y2=\"39\" style=\"stroke-width:2\" />\n\n  <!-- Vertical lines -->\n  <line x1=\"0\" y1=\"0\" x2=\"0\" y2=\"39\" style=\"stroke-width:2\" />\n  <line x1=\"15\" y1=\"0\" x2=\"15\" y2=\"39\" />\n  <line x1=\"30\" y1=\"0\" x2=\"30\" y2=\"39\" />\n  <line x1=\"45\" y1=\"0\" x2=\"45\" y2=\"39\" />\n  <line x1=\"60\" y1=\"0\" x2=\"60\" y2=\"39\" />\n  <line x1=\"75\" y1=\"0\" x2=\"75\" y2=\"39\" />\n  <line x1=\"90\" y1=\"0\" x2=\"90\" y2=\"39\" />\n  <line x1=\"105\" y1=\"0\" x2=\"105\" y2=\"39\" />\n  <line x1=\"120\" y1=\"0\" x2=\"120\" y2=\"39\" style=\"stroke-width:2\" />\n\n  <!-- Colored Rectangle -->\n  <polygon points=\"0.0,0.0 120.0,0.0 120.0,39.793935054828374 0.0,39.793935054828374\" style=\"fill:#ECB172A0;stroke-width:0\"/>\n\n  <!-- Text -->\n  <text x=\"60.000000\" y=\"59.793935\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" >8</text>\n  <text x=\"140.000000\" y=\"19.896968\" font-size=\"1.0rem\" font-weight=\"100\" text-anchor=\"middle\" transform=\"rotate(0,140.000000,19.896968)\">1</text>\n</svg>\n        </td>\n    </tr>\n</table></div></div></li><li class='xr-section-item'><input id='section-f9a0d3fd-0c7a-401f-abd2-03bed1a9b01b' class='xr-section-summary-in' type='checkbox'  checked><label for='section-f9a0d3fd-0c7a-401f-abd2-03bed1a9b01b' class='xr-section-summary' >Coordinates: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-var-name'><span class='xr-has-index'>time</span></div><div class='xr-var-dims'>(time)</div><div class='xr-var-dtype'>datetime64[ns]</div><div class='xr-var-preview xr-preview'>2022-01-03T02:19:35 ... 2022-03-...</div><input id='attrs-5d0081e8-bfc9-432e-aa21-28901bf5b976' class='xr-var-attrs-in' type='checkbox' ><label for='attrs-5d0081e8-bfc9-432e-aa21-28901bf5b976' title='Show/Hide attributes'><svg class='icon xr-icon-file-text2'><use xlink:href='#icon-file-text2'></use></svg></label><input id='data-222bb6a3-73d2-465b-9a11-1d1ce9761a02' class='xr-var-data-in' type='checkbox'><label for='data-222bb6a3-73d2-465b-9a11-1d1ce9761a02' title='Show/Hide data repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-var-attrs'><dl class='xr-attrs'><dt><span>standard_name :</span></dt><dd>time</dd><dt><span>bounds :</span></dt><dd>time_bnds</dd></dl></div><div class='xr-var-data'><pre>array([&#x27;2022-01-03T02:19:35.000000000&#x27;, &#x27;2022-01-15T02:19:34.000000000&#x27;,\n       &#x27;2022-01-27T02:19:34.000000000&#x27;, &#x27;2022-02-08T02:19:33.000000000&#x27;,\n       &#x27;2022-02-20T02:19:33.000000000&#x27;, &#x27;2022-03-04T02:19:33.000000000&#x27;,\n       &#x27;2022-03-16T02:19:33.000000000&#x27;, &#x27;2022-03-28T02:19:33.000000000&#x27;],\n      dtype=&#x27;datetime64[ns]&#x27;)</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-d640b7ec-32e4-4681-b5bb-02ad599c1d07' class='xr-section-summary-in' type='checkbox'  ><label for='section-d640b7ec-32e4-4681-b5bb-02ad599c1d07' class='xr-section-summary' >Indexes: <span>(1)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><ul class='xr-var-list'><li class='xr-var-item'><div class='xr-index-name'><div>time</div></div><div class='xr-index-preview'>PandasIndex</div><div></div><input id='index-12e08538-fc07-44e7-884d-87bf030470fe' class='xr-index-data-in' type='checkbox'/><label for='index-12e08538-fc07-44e7-884d-87bf030470fe' title='Show/Hide index repr'><svg class='icon xr-icon-database'><use xlink:href='#icon-database'></use></svg></label><div class='xr-index-data'><pre>PandasIndex(DatetimeIndex([&#x27;2022-01-03 02:19:35&#x27;, &#x27;2022-01-15 02:19:34&#x27;,\n               &#x27;2022-01-27 02:19:34&#x27;, &#x27;2022-02-08 02:19:33&#x27;,\n               &#x27;2022-02-20 02:19:33&#x27;, &#x27;2022-03-04 02:19:33&#x27;,\n               &#x27;2022-03-16 02:19:33&#x27;, &#x27;2022-03-28 02:19:33&#x27;],\n              dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;time&#x27;, freq=None))</pre></div></li></ul></div></li><li class='xr-section-item'><input id='section-2465b1f4-21db-4663-ac25-b09bbe4a1539' class='xr-section-summary-in' type='checkbox' disabled ><label for='section-2465b1f4-21db-4663-ac25-b09bbe4a1539' class='xr-section-summary'  title='Expand/collapse section'>Attributes: <span>(0)</span></label><div class='xr-section-inline-details'></div><div class='xr-section-details'><dl class='xr-attrs'></dl></div></li></ul></div></div>","content_type":"text/html"},"text/plain":{"content":"<xarray.DataArray 'VV_dB' (time: 8)>\ndask.array<where, shape=(8,), dtype=float32, chunksize=(1,), chunktype=numpy.ndarray>\nCoordinates:\n  * time     (time) datetime64[ns] 2022-01-03T02:19:35 ... 2022-03-28T02:19:33","content_type":"text/plain"}}}],"visibility":"show","key":"PdE131jetB"}],"visibility":"show","key":"PeGTpgjwOK"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.213482,"end_time":"2023-03-22T13:03:39.560180","exception":false,"start_time":"2023-03-22T13:03:39.346698","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Next we can plot this new array we have generated. The result is an excellent time series plot showing the two flood events that occured in the time period. We can see the larger picture as this is the mean value over several pixels rather than just a single point like we previously plotted.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"eBBaxFhlvC"}],"key":"SbcgrS5uql"}],"visibility":"show","key":"dJz5WbjtD2"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:39.987144Z","iopub.status.busy":"2023-03-22T13:03:39.986718Z","iopub.status.idle":"2023-03-22T13:03:41.104978Z","shell.execute_reply":"2023-03-22T13:03:41.099637Z"},"papermill":{"duration":1.328133,"end_time":"2023-03-22T13:03:41.108273","exception":false,"start_time":"2023-03-22T13:03:39.780140","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# Plot VV_dB timeseries\nfig, ax = plt.subplots(1, figsize=(12, 6))\nax.plot(timeseriesVV_dB.time, timeseriesVV_dB, color=\"blue\", marker=\"o\", linewidth=0.5)\nax.set_title(\"Mean VV dB returned from AOI over 01-01-2022 to 01-05-2022\")\nax.set_xlabel('Time')\nax.set_ylabel('VV dB')\nplt.show()","visibility":"show","key":"pAEr94BtNi"},{"type":"output","id":"GBlOa9eDoFP7jlUiEJjSC","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"3e179788e04400019cd3f9f1d323072d","path":"/build/3e179788e04400019cd3f9f1d323072d.png"},"text/plain":{"content":"<Figure size 1200x600 with 1 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"HrocvnoMwC"}],"visibility":"show","key":"zyM9CO6DS7"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.208953,"end_time":"2023-03-22T13:03:41.590846","exception":false,"start_time":"2023-03-22T13:03:41.381893","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"In the time series plot generated from averaged VV_dB values over the selected region, the two separate flooding events appear appear as one longer period with surface flooding that stretches from mid January to early March 2022.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"On0CCmpVl5"}],"key":"fUxI4hkIIR"}],"visibility":"show","key":"F4JG57fuaD"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.206675,"end_time":"2023-03-22T13:03:42.010910","exception":false,"start_time":"2023-03-22T13:03:41.804235","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Creating advanced variables","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"VE80ADIhPf"}],"identifier":"creating-advanced-variables","label":"Creating advanced variables","html_id":"creating-advanced-variables","implicit":true,"key":"hb1P5Qx8Z6"},{"type":"heading","depth":3,"position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Mapping flooding frequency across the whole AOI","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"irwsEHjIAS"}],"identifier":"mapping-flooding-frequency-across-the-whole-aoi","label":"Mapping flooding frequency across the whole AOI","html_id":"mapping-flooding-frequency-across-the-whole-aoi","implicit":true,"key":"DsfFKFSEdX"},{"type":"paragraph","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"We can utilise the generated water mask to calculate the flooding frequency proportionate to the overall number of observations. Since the flood mask is a binary layer, we just need to calculate the sum of all flooded observations for each pixel and divide it by the total number (count) of observations.","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"gcW7MXW9Ag"}],"key":"jcMUndSdro"}],"visibility":"show","key":"URaVxOFBsV"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:42.432703Z","iopub.status.busy":"2023-03-22T13:03:42.432139Z","iopub.status.idle":"2023-03-22T13:03:42.459235Z","shell.execute_reply":"2023-03-22T13:03:42.457572Z"},"papermill":{"duration":0.241555,"end_time":"2023-03-22T13:03:42.462308","exception":false,"start_time":"2023-03-22T13:03:42.220753","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"flood_sum = s1_cube.flood_mask.sum(dim=\"time\")\nflood_count = s1_cube.flood_mask.count(dim=\"time\")\nflood_average = flood_sum / flood_count\n\nflood_average.attrs['long_name'] = 'flood_average'\nflood_average.attrs['units'] = 'nounits'\n\ns1_cube['flood_average'] = flood_average","visibility":"show","key":"ZBqG6TNC3w"},{"type":"output","id":"iDwpE0l9pXrrOf3m5c4MC","data":[],"visibility":"show","key":"nmBrDFwo88"}],"visibility":"show","key":"sfmZFIrxOr"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.253074,"end_time":"2023-03-22T13:03:42.965715","exception":false,"start_time":"2023-03-22T13:03:42.712641","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now letâs plot the flood_average into a plot:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NR42IiYJ9M"}],"key":"s1FOvEmr7X"}],"visibility":"show","key":"weR39yYh3d"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:43.473831Z","iopub.status.busy":"2023-03-22T13:03:43.473326Z","iopub.status.idle":"2023-03-22T13:03:44.950241Z","shell.execute_reply":"2023-03-22T13:03:44.947813Z"},"papermill":{"duration":1.764444,"end_time":"2023-03-22T13:03:44.953806","exception":false,"start_time":"2023-03-22T13:03:43.189362","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"flood_average.plot.imshow(cmap='GnBu', vmin=0, vmax=0.5, figsize=(10, 10))\nplt.show()","visibility":"show","key":"ixAIWoZhCh"},{"type":"output","id":"zVYcCCUtC9V06e1VgeMxU","data":[{"name":"stderr","output_type":"stream","text":"/opt/conda/envs/edc-default-2023.03-02/lib/python3.9/site-packages/dask/core.py:119: RuntimeWarning: divide by zero encountered in log10\n  return func(*(_execute_task(a, cache) for a in args))\n"},{"output_type":"display_data","metadata":{},"data":{"image/png":{"content_type":"image/png","hash":"27f0d4c9fb69d93029fd66d343f67344","path":"/build/27f0d4c9fb69d93029fd66d343f67344.png"},"text/plain":{"content":"<Figure size 1000x1000 with 2 Axes>","content_type":"text/plain"}}}],"visibility":"show","key":"vDUiBUevB1"}],"visibility":"show","key":"uWxiaIRbaf"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.253629,"end_time":"2023-03-22T13:03:45.464428","exception":false,"start_time":"2023-03-22T13:03:45.210799","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"For our end product, we have visualised the flood plain extent very clearly here and can also identify some areas that are more susceptible to flooding than others. Added value products like this flood average map enable policy makers to make more informed decisions,","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"wbCgmKU259"}],"key":"epJ05s3iOn"}],"visibility":"show","key":"VqBg9Xk7ev"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.211045,"end_time":"2023-03-22T13:03:45.917258","exception":false,"start_time":"2023-03-22T13:03:45.706213","status":"completed"},"tags":[]},"children":[{"type":"heading","depth":2,"position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Export a variable to GeoTiff","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NFrYruNmy4"}],"identifier":"export-a-variable-to-geotiff","label":"Export a variable to GeoTiff","html_id":"export-a-variable-to-geotiff","implicit":true,"key":"pt8NrPTcrA"},{"type":"paragraph","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"children":[{"type":"text","value":"Finally we will export some of the variables we have generated in this notebook. This is really easy to do and is shown in the next cell:","position":{"start":{"line":3,"column":1},"end":{"line":3,"column":1}},"key":"o6htLfvUul"}],"key":"G4iUod0mT2"}],"visibility":"show","key":"XU7YmpfjIx"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:46.334970Z","iopub.status.busy":"2023-03-22T13:03:46.334551Z","iopub.status.idle":"2023-03-22T13:03:46.434501Z","shell.execute_reply":"2023-03-22T13:03:46.432580Z"},"papermill":{"duration":0.312418,"end_time":"2023-03-22T13:03:46.438161","exception":false,"start_time":"2023-03-22T13:03:46.125743","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# define the timestep you wish to export\ntimestep = flood_threshold2_step2.sel(time='2022-01-27 10:00:00', method='nearest')\n\n# define projection\ntimestep_wgs84 = timestep.rio.write_crs(\"epsg:4326\")\n\n# write to raster\ntimestep_wgs84.rio.to_raster(\"flood_extent_20220127.tif\")","visibility":"show","key":"jqovDxmsjQ"},{"type":"output","id":"qHeiADptA0Wm_LTrfWasl","data":[],"visibility":"show","key":"BXbWfyOco2"}],"visibility":"show","key":"Un1IOfqrps"},{"type":"block","kind":"notebook-content","data":{"papermill":{"duration":0.44605,"end_time":"2023-03-22T13:03:47.175713","exception":false,"start_time":"2023-03-22T13:03:46.729663","status":"completed"},"tags":[]},"children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Now letâs export the flood_average variable which is even easier to do as we donât need to select a single timestamp.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"FDR4HXSSod"}],"key":"JI9vIpe4tJ"}],"visibility":"show","key":"xJLc9PlhNc"},{"type":"block","kind":"notebook-code","data":{"execution":{"iopub.execute_input":"2023-03-22T13:03:47.931916Z","iopub.status.busy":"2023-03-22T13:03:47.930900Z","iopub.status.idle":"2023-03-22T13:03:48.530883Z","shell.execute_reply":"2023-03-22T13:03:48.529549Z"},"papermill":{"duration":0.896181,"end_time":"2023-03-22T13:03:48.533618","exception":false,"start_time":"2023-03-22T13:03:47.637437","status":"completed"},"tags":[]},"children":[{"type":"code","lang":"python","executable":true,"value":"# define projection\nflood_average_wgs84 = flood_average.rio.write_crs(\"epsg:4326\")\n\n# write to raster\nflood_average_wgs84.rio.to_raster(\"flood_average.tif\")","visibility":"show","key":"KG8pWEi1Xu"},{"type":"output","id":"zfULMlg4GCb1JGrS-5le1","data":[],"visibility":"show","key":"xYcmF0XLTZ"}],"visibility":"show","key":"Dy6pCKSvUV"}],"key":"cE9483c7Up"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"LPIS Use Case for Land Use / Land Cover Classification","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/lpis-lulc-slo","group":"Contributions"},"next":{"title":"Impact of Covid19 induced lockdown on NO2 levels","url":"/external-notebooks/eurodatacube/notebooks/notebooks/contributions/no2-analysis-covid19-lockdowns","group":"Contributions"}}},"domain":"http://localhost:3000"}